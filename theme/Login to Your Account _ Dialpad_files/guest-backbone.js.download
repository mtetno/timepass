!function e(t,n,i){function r(o,a){if(!n[o]){if(!t[o]){var c="function"==typeof require&&require;if(!a&&c)return c(o,!0);if(s)return s(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[o]={exports:{}};t[o][0].call(u.exports,function(e){var n=t[o][1][e];return r(n||e)},u,u.exports,e,t,n,i)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<i.length;o++)r(i[o]);return r}({1:[function(e,t,exports){(function(t){"use strict";if(e(327),e(328),e(2),t._babelPolyfill)throw new Error("only one instance of babel-polyfill is allowed");t._babelPolyfill=!0;var n="defineProperty";function i(e,t,i){e[t]||Object[n](e,t,{writable:!0,configurable:!0,value:i})}i(String.prototype,"padLeft","".padStart),i(String.prototype,"padRight","".padEnd),"pop,reverse,shift,keys,values,entries,indexOf,every,some,forEach,map,filter,find,findIndex,includes,join,slice,concat,push,splice,unshift,sort,lastIndexOf,reduce,reduceRight,copyWithin,fill".split(",").forEach(function(e){[][e]&&i(Array,e,Function.call.bind([][e]))})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{2:2,327:327,328:328}],2:[function(e,t,exports){e(130),t.exports=e(23).RegExp.escape},{130:130,23:23}],3:[function(e,t,exports){t.exports=function(e){if("function"!=typeof e)throw TypeError(e+" is not a function!");return e}},{}],4:[function(e,t,exports){var n=e(18);t.exports=function(e,t){if("number"!=typeof e&&"Number"!=n(e))throw TypeError(t);return+e}},{18:18}],5:[function(e,t,exports){var n=e(128)("unscopables"),i=Array.prototype;null==i[n]&&e(42)(i,n,{}),t.exports=function(e){i[n][e]=!0}},{128:128,42:42}],6:[function(e,t,exports){t.exports=function(e,t,n,i){if(!(e instanceof t)||void 0!==i&&i in e)throw TypeError(n+": incorrect invocation!");return e}},{}],7:[function(e,t,exports){var n=e(51);t.exports=function(e){if(!n(e))throw TypeError(e+" is not an object!");return e}},{51:51}],8:[function(e,t,exports){"use strict";var n=e(119),i=e(114),r=e(118);t.exports=[].copyWithin||function(e,t){var s=n(this),o=r(s.length),a=i(e,o),c=i(t,o),l=arguments.length>2?arguments[2]:void 0,u=Math.min((void 0===l?o:i(l,o))-c,o-a),h=1;for(c<a&&a<c+u&&(h=-1,c+=u-1,a+=u-1);u-- >0;)c in s?s[a]=s[c]:delete s[a],a+=h,c+=h;return s}},{114:114,118:118,119:119}],9:[function(e,t,exports){"use strict";var n=e(119),i=e(114),r=e(118);t.exports=function(e){for(var t=n(this),s=r(t.length),o=arguments.length,a=i(o>1?arguments[1]:void 0,s),c=o>2?arguments[2]:void 0,l=void 0===c?s:i(c,s);l>a;)t[a++]=e;return t}},{114:114,118:118,119:119}],10:[function(e,t,exports){var n=e(39);t.exports=function(e,t){var i=[];return n(e,!1,i.push,i,t),i}},{39:39}],11:[function(e,t,exports){var n=e(117),i=e(118),r=e(114);t.exports=function(e){return function(t,s,o){var a,c=n(t),l=i(c.length),u=r(o,l);if(e&&s!=s){for(;l>u;)if((a=c[u++])!=a)return!0}else for(;l>u;u++)if((e||u in c)&&c[u]===s)return e||u||0;return!e&&-1}}},{114:114,117:117,118:118}],12:[function(e,t,exports){var n=e(25),i=e(47),r=e(119),s=e(118),o=e(15);t.exports=function(e,t){var a=1==e,c=2==e,l=3==e,u=4==e,h=6==e,d=5==e||h,f=t||o;return function(t,o,p){for(var g,m,_=r(t),v=i(_),y=n(o,p,3),b=s(v.length),S=0,C=a?f(t,b):c?f(t,0):void 0;b>S;S++)if((d||S in v)&&(m=y(g=v[S],S,_),e))if(a)C[S]=m;else if(m)switch(e){case 3:return!0;case 5:return g;case 6:return S;case 2:C.push(g)}else if(u)return!1;return h?-1:l||u?u:C}}},{118:118,119:119,15:15,25:25,47:47}],13:[function(e,t,exports){var n=e(3),i=e(119),r=e(47),s=e(118);t.exports=function(e,t,o,a,c){n(t);var l=i(e),u=r(l),h=s(l.length),d=c?h-1:0,f=c?-1:1;if(o<2)for(;;){if(d in u){a=u[d],d+=f;break}if(d+=f,c?d<0:h<=d)throw TypeError("Reduce of empty array with no initial value")}for(;c?d>=0:h>d;d+=f)d in u&&(a=t(a,u[d],d,l));return a}},{118:118,119:119,3:3,47:47}],14:[function(e,t,exports){var n=e(51),i=e(49),r=e(128)("species");t.exports=function(e){var t;return i(e)&&("function"!=typeof(t=e.constructor)||t!==Array&&!i(t.prototype)||(t=void 0),n(t)&&null===(t=t[r])&&(t=void 0)),void 0===t?Array:t}},{128:128,49:49,51:51}],15:[function(e,t,exports){var n=e(14);t.exports=function(e,t){return new(n(e))(t)}},{14:14}],16:[function(e,t,exports){"use strict";var n=e(3),i=e(51),r=e(46),s=[].slice,o={};t.exports=Function.bind||function(e){var t=n(this),a=s.call(arguments,1),c=function(){var n=a.concat(s.call(arguments));return this instanceof c?function(e,t,n){if(!(t in o)){for(var i=[],r=0;r<t;r++)i[r]="a["+r+"]";o[t]=Function("F,a","return new F("+i.join(",")+")")}return o[t](e,n)}(t,n.length,n):r(t,n,e)};return i(t.prototype)&&(c.prototype=t.prototype),c}},{3:3,46:46,51:51}],17:[function(e,t,exports){var n=e(18),i=e(128)("toStringTag"),r="Arguments"==n(function(){return arguments}());t.exports=function(e){var t,s,o;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(s=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),i))?s:r?n(t):"Object"==(o=n(t))&&"function"==typeof t.callee?"Arguments":o}},{128:128,18:18}],18:[function(e,t,exports){var n={}.toString;t.exports=function(e){return n.call(e).slice(8,-1)}},{}],19:[function(e,t,exports){"use strict";var n=e(72).f,i=e(71),r=e(93),s=e(25),o=e(6),a=e(39),c=e(55),l=e(57),u=e(100),h=e(29),d=e(66).fastKey,f=e(125),p=h?"_s":"size",g=function(e,t){var n,i=d(t);if("F"!==i)return e._i[i];for(n=e._f;n;n=n.n)if(n.k==t)return n};t.exports={getConstructor:function(e,t,c,l){var u=e(function(e,n){o(e,u,t,"_i"),e._t=t,e._i=i(null),e._f=void 0,e._l=void 0,e[p]=0,null!=n&&a(n,c,e[l],e)});return r(u.prototype,{clear:function(){for(var e=f(this,t),n=e._i,i=e._f;i;i=i.n)i.r=!0,i.p&&(i.p=i.p.n=void 0),delete n[i.i];e._f=e._l=void 0,e[p]=0},delete:function(e){var n=f(this,t),i=g(n,e);if(i){var r=i.n,s=i.p;delete n._i[i.i],i.r=!0,s&&(s.n=r),r&&(r.p=s),n._f==i&&(n._f=r),n._l==i&&(n._l=s),n[p]--}return!!i},forEach:function(e){f(this,t);for(var n,i=s(e,arguments.length>1?arguments[1]:void 0,3);n=n?n.n:this._f;)for(i(n.v,n.k,this);n&&n.r;)n=n.p},has:function(e){return!!g(f(this,t),e)}}),h&&n(u.prototype,"size",{get:function(){return f(this,t)[p]}}),u},def:function(e,t,n){var i,r,s=g(e,t);return s?s.v=n:(e._l=s={i:r=d(t,!0),k:t,v:n,p:i=e._l,n:void 0,r:!1},e._f||(e._f=s),i&&(i.n=s),e[p]++,"F"!==r&&(e._i[r]=s)),e},getEntry:g,setStrong:function(e,t,n){c(e,t,function(e,n){this._t=f(e,t),this._k=n,this._l=void 0},function(){for(var e=this._k,t=this._l;t&&t.r;)t=t.p;return this._t&&(this._l=t=t?t.n:this._t._f)?l(0,"keys"==e?t.k:"values"==e?t.v:[t.k,t.v]):(this._t=void 0,l(1))},n?"entries":"values",!n,!0),u(t)}}},{100:100,125:125,25:25,29:29,39:39,55:55,57:57,6:6,66:66,71:71,72:72,93:93}],20:[function(e,t,exports){var n=e(17),i=e(10);t.exports=function(e){return function(){if(n(this)!=e)throw TypeError(e+"#toJSON isn't generic");return i(this)}}},{10:10,17:17}],21:[function(e,t,exports){"use strict";var n=e(93),i=e(66).getWeak,r=e(7),s=e(51),o=e(6),a=e(39),c=e(12),l=e(41),u=e(125),h=c(5),d=c(6),f=0,p=function(e){return e._l||(e._l=new g)},g=function(){this.a=[]},m=function(e,t){return h(e.a,function(e){return e[0]===t})};g.prototype={get:function(e){var t=m(this,e);if(t)return t[1]},has:function(e){return!!m(this,e)},set:function(e,t){var n=m(this,e);n?n[1]=t:this.a.push([e,t])},delete:function(e){var t=d(this.a,function(t){return t[0]===e});return~t&&this.a.splice(t,1),!!~t}},t.exports={getConstructor:function(e,t,r,c){var h=e(function(e,n){o(e,h,t,"_i"),e._t=t,e._i=f++,e._l=void 0,null!=n&&a(n,r,e[c],e)});return n(h.prototype,{delete:function(e){if(!s(e))return!1;var n=i(e);return!0===n?p(u(this,t)).delete(e):n&&l(n,this._i)&&delete n[this._i]},has:function(e){if(!s(e))return!1;var n=i(e);return!0===n?p(u(this,t)).has(e):n&&l(n,this._i)}}),h},def:function(e,t,n){var s=i(r(t),!0);return!0===s?p(e).set(t,n):s[e._i]=n,e},ufstore:p}},{12:12,125:125,39:39,41:41,51:51,6:6,66:66,7:7,93:93}],22:[function(e,t,exports){"use strict";var n=e(40),i=e(33),r=e(94),s=e(93),o=e(66),a=e(39),c=e(6),l=e(51),u=e(35),h=e(56),d=e(101),f=e(45);t.exports=function(e,t,p,g,m,_){var v=n[e],y=v,b=m?"set":"add",S=y&&y.prototype,C={},w=function(e){var t=S[e];r(S,e,"delete"==e?function(e){return!(_&&!l(e))&&t.call(this,0===e?0:e)}:"has"==e?function(e){return!(_&&!l(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return _&&!l(e)?void 0:t.call(this,0===e?0:e)}:"add"==e?function(e){return t.call(this,0===e?0:e),this}:function(e,n){return t.call(this,0===e?0:e,n),this})};if("function"==typeof y&&(_||S.forEach&&!u(function(){(new y).entries().next()}))){var T=new y,k=T[b](_?{}:-0,1)!=T,E=u(function(){T.has(1)}),A=h(function(e){new y(e)}),x=!_&&u(function(){for(var e=new y,t=5;t--;)e[b](t,t);return!e.has(-0)});A||((y=t(function(t,n){c(t,y,e);var i=f(new v,t,y);return null!=n&&a(n,m,i[b],i),i})).prototype=S,S.constructor=y),(E||x)&&(w("delete"),w("has"),m&&w("get")),(x||k)&&w(b),_&&S.clear&&delete S.clear}else y=g.getConstructor(t,e,m,b),s(y.prototype,p),o.NEED=!0;return d(y,e),C[e]=y,i(i.G+i.W+i.F*(y!=v),C),_||g.setStrong(y,e,m),y}},{101:101,33:33,35:35,39:39,40:40,45:45,51:51,56:56,6:6,66:66,93:93,94:94}],23:[function(e,t,exports){var n=t.exports={version:"2.5.0"};"number"==typeof __e&&(__e=n)},{}],24:[function(e,t,exports){"use strict";var n=e(72),i=e(92);t.exports=function(e,t,r){t in e?n.f(e,t,i(0,r)):e[t]=r}},{72:72,92:92}],25:[function(e,t,exports){var n=e(3);t.exports=function(e,t,i){if(n(e),void 0===t)return e;switch(i){case 1:return function(n){return e.call(t,n)};case 2:return function(n,i){return e.call(t,n,i)};case 3:return function(n,i,r){return e.call(t,n,i,r)}}return function(){return e.apply(t,arguments)}}},{3:3}],26:[function(e,t,exports){"use strict";var n=e(35),i=Date.prototype.getTime,r=Date.prototype.toISOString,s=function(e){return e>9?e:"0"+e};t.exports=n(function(){return"0385-07-25T07:06:39.999Z"!=r.call(new Date(-5e13-1))})||!n(function(){r.call(new Date(NaN))})?function(){if(!isFinite(i.call(this)))throw RangeError("Invalid time value");var e=this,t=e.getUTCFullYear(),n=e.getUTCMilliseconds(),r=t<0?"-":t>9999?"+":"";return r+("00000"+Math.abs(t)).slice(r?-6:-4)+"-"+s(e.getUTCMonth()+1)+"-"+s(e.getUTCDate())+"T"+s(e.getUTCHours())+":"+s(e.getUTCMinutes())+":"+s(e.getUTCSeconds())+"."+(n>99?n:"0"+s(n))+"Z"}:r},{35:35}],27:[function(e,t,exports){"use strict";var n=e(7),i=e(120);t.exports=function(e){if("string"!==e&&"number"!==e&&"default"!==e)throw TypeError("Incorrect hint");return i(n(this),"number"!=e)}},{120:120,7:7}],28:[function(e,t,exports){t.exports=function(e){if(null==e)throw TypeError("Can't call method on  "+e);return e}},{}],29:[function(e,t,exports){t.exports=!e(35)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},{35:35}],30:[function(e,t,exports){var n=e(51),i=e(40).document,r=n(i)&&n(i.createElement);t.exports=function(e){return r?i.createElement(e):{}}},{40:40,51:51}],31:[function(e,t,exports){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},{}],32:[function(e,t,exports){var n=e(81),i=e(78),r=e(82);t.exports=function(e){var t=n(e),s=i.f;if(s)for(var o,a=s(e),c=r.f,l=0;a.length>l;)c.call(e,o=a[l++])&&t.push(o);return t}},{78:78,81:81,82:82}],33:[function(e,t,exports){var n=e(40),i=e(23),r=e(42),s=e(94),o=e(25),a=function(e,t,c){var l,u,h,d,f=e&a.F,p=e&a.G,g=e&a.S,m=e&a.P,_=e&a.B,v=p?n:g?n[t]||(n[t]={}):(n[t]||{}).prototype,exports=p?i:i[t]||(i[t]={}),y=exports.prototype||(exports.prototype={});for(l in p&&(c=t),c)h=((u=!f&&v&&void 0!==v[l])?v:c)[l],d=_&&u?o(h,n):m&&"function"==typeof h?o(Function.call,h):h,v&&s(v,l,h,e&a.U),exports[l]!=h&&r(exports,l,d),m&&y[l]!=h&&(y[l]=h)};n.core=i,a.F=1,a.G=2,a.S=4,a.P=8,a.B=16,a.W=32,a.U=64,a.R=128,t.exports=a},{23:23,25:25,40:40,42:42,94:94}],34:[function(e,t,exports){var n=e(128)("match");t.exports=function(e){var t=/./;try{"/./"[e](t)}catch(i){try{return t[n]=!1,!"/./"[e](t)}catch(e){}}return!0}},{128:128}],35:[function(e,t,exports){t.exports=function(e){try{return!!e()}catch(e){return!0}}},{}],36:[function(e,t,exports){"use strict";var n=e(42),i=e(94),r=e(35),s=e(28),o=e(128);t.exports=function(e,t,a){var c=o(e),l=a(s,c,""[e]),u=l[0],h=l[1];r(function(){var t={};return t[c]=function(){return 7},7!=""[e](t)})&&(i(String.prototype,e,u),n(RegExp.prototype,c,2==t?function(e,t){return h.call(e,this,t)}:function(e){return h.call(e,this)}))}},{128:128,28:28,35:35,42:42,94:94}],37:[function(e,t,exports){"use strict";var n=e(7);t.exports=function(){var e=n(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}},{7:7}],38:[function(e,t,exports){"use strict";var n=e(49),i=e(51),r=e(118),s=e(25),o=e(128)("isConcatSpreadable");t.exports=function e(t,a,c,l,u,h,d,f){for(var p,g,m=u,_=0,v=!!d&&s(d,f,3);_<l;){if(_ in c){if(p=v?v(c[_],_,a):c[_],g=!1,i(p)&&(g=void 0!==(g=p[o])?!!g:n(p)),g&&h>0)m=e(t,a,p,r(p.length),m,h-1)-1;else{if(m>=9007199254740991)throw TypeError();t[m]=p}m++}_++}return m}},{118:118,128:128,25:25,49:49,51:51}],39:[function(e,t,exports){var n=e(25),i=e(53),r=e(48),s=e(7),o=e(118),a=e(129),c={},l={};(exports=t.exports=function(e,t,u,h,d){var f,p,g,m,_=d?function(){return e}:a(e),v=n(u,h,t?2:1),y=0;if("function"!=typeof _)throw TypeError(e+" is not iterable!");if(r(_)){for(f=o(e.length);f>y;y++)if((m=t?v(s(p=e[y])[0],p[1]):v(e[y]))===c||m===l)return m}else for(g=_.call(e);!(p=g.next()).done;)if((m=i(g,v,p.value,t))===c||m===l)return m}).BREAK=c,exports.RETURN=l},{118:118,129:129,25:25,48:48,53:53,7:7}],40:[function(e,t,exports){var n=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=n)},{}],41:[function(e,t,exports){var n={}.hasOwnProperty;t.exports=function(e,t){return n.call(e,t)}},{}],42:[function(e,t,exports){var n=e(72),i=e(92);t.exports=e(29)?function(e,t,r){return n.f(e,t,i(1,r))}:function(e,t,n){return e[t]=n,e}},{29:29,72:72,92:92}],43:[function(e,t,exports){var n=e(40).document;t.exports=n&&n.documentElement},{40:40}],44:[function(e,t,exports){t.exports=!e(29)&&!e(35)(function(){return 7!=Object.defineProperty(e(30)("div"),"a",{get:function(){return 7}}).a})},{29:29,30:30,35:35}],45:[function(e,t,exports){var n=e(51),i=e(99).set;t.exports=function(e,t,r){var s,o=t.constructor;return o!==r&&"function"==typeof o&&(s=o.prototype)!==r.prototype&&n(s)&&i&&i(e,s),e}},{51:51,99:99}],46:[function(e,t,exports){t.exports=function(e,t,n){var i=void 0===n;switch(t.length){case 0:return i?e():e.call(n);case 1:return i?e(t[0]):e.call(n,t[0]);case 2:return i?e(t[0],t[1]):e.call(n,t[0],t[1]);case 3:return i?e(t[0],t[1],t[2]):e.call(n,t[0],t[1],t[2]);case 4:return i?e(t[0],t[1],t[2],t[3]):e.call(n,t[0],t[1],t[2],t[3])}return e.apply(n,t)}},{}],47:[function(e,t,exports){var n=e(18);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(e){return"String"==n(e)?e.split(""):Object(e)}},{18:18}],48:[function(e,t,exports){var n=e(58),i=e(128)("iterator"),r=Array.prototype;t.exports=function(e){return void 0!==e&&(n.Array===e||r[i]===e)}},{128:128,58:58}],49:[function(e,t,exports){var n=e(18);t.exports=Array.isArray||function(e){return"Array"==n(e)}},{18:18}],50:[function(e,t,exports){var n=e(51),i=Math.floor;t.exports=function(e){return!n(e)&&isFinite(e)&&i(e)===e}},{51:51}],51:[function(e,t,exports){t.exports=function(e){return"object"==typeof e?null!==e:"function"==typeof e}},{}],52:[function(e,t,exports){var n=e(51),i=e(18),r=e(128)("match");t.exports=function(e){var t;return n(e)&&(void 0!==(t=e[r])?!!t:"RegExp"==i(e))}},{128:128,18:18,51:51}],53:[function(e,t,exports){var n=e(7);t.exports=function(e,t,i,r){try{return r?t(n(i)[0],i[1]):t(i)}catch(t){var s=e.return;throw void 0!==s&&n(s.call(e)),t}}},{7:7}],54:[function(e,t,exports){"use strict";var n=e(71),i=e(92),r=e(101),s={};e(42)(s,e(128)("iterator"),function(){return this}),t.exports=function(e,t,o){e.prototype=n(s,{next:i(1,o)}),r(e,t+" Iterator")}},{101:101,128:128,42:42,71:71,92:92}],55:[function(e,t,exports){"use strict";var n=e(60),i=e(33),r=e(94),s=e(42),o=e(41),a=e(58),c=e(54),l=e(101),u=e(79),h=e(128)("iterator"),d=!([].keys&&"next"in[].keys()),f=function(){return this};t.exports=function(e,t,p,g,m,_,v){c(p,t,g);var y,b,S,C=function(e){if(!d&&e in E)return E[e];switch(e){case"keys":case"values":return function(){return new p(this,e)}}return function(){return new p(this,e)}},w=t+" Iterator",T="values"==m,k=!1,E=e.prototype,A=E[h]||E["@@iterator"]||m&&E[m],x=A||C(m),R=m?T?C("entries"):x:void 0,I="Array"==t&&E.entries||A;if(I&&(S=u(I.call(new e)))!==Object.prototype&&S.next&&(l(S,w,!0),n||o(S,h)||s(S,h,f)),T&&A&&"values"!==A.name&&(k=!0,x=function(){return A.call(this)}),n&&!v||!d&&!k&&E[h]||s(E,h,x),a[t]=x,a[w]=f,m)if(y={values:T?x:C("values"),keys:_?x:C("keys"),entries:R},v)for(b in y)b in E||r(E,b,y[b]);else i(i.P+i.F*(d||k),t,y);return y}},{101:101,128:128,33:33,41:41,42:42,54:54,58:58,60:60,79:79,94:94}],56:[function(e,t,exports){var n=e(128)("iterator"),i=!1;try{var r=[7][n]();r.return=function(){i=!0},Array.from(r,function(){throw 2})}catch(e){}t.exports=function(e,t){if(!t&&!i)return!1;var r=!1;try{var s=[7],o=s[n]();o.next=function(){return{done:r=!0}},s[n]=function(){return o},e(s)}catch(e){}return r}},{128:128}],57:[function(e,t,exports){t.exports=function(e,t){return{value:t,done:!!e}}},{}],58:[function(e,t,exports){t.exports={}},{}],59:[function(e,t,exports){var n=e(81),i=e(117);t.exports=function(e,t){for(var r,s=i(e),o=n(s),a=o.length,c=0;a>c;)if(s[r=o[c++]]===t)return r}},{117:117,81:81}],60:[function(e,t,exports){t.exports=!1},{}],61:[function(e,t,exports){var n=Math.expm1;t.exports=!n||n(10)>22025.465794806718||n(10)<22025.465794806718||-2e-17!=n(-2e-17)?function(e){return 0==(e=+e)?e:e>-1e-6&&e<1e-6?e+e*e/2:Math.exp(e)-1}:n},{}],62:[function(e,t,exports){var n=e(65),i=Math.pow,r=i(2,-52),s=i(2,-23),o=i(2,127)*(2-s),a=i(2,-126);t.exports=Math.fround||function(e){var t,i,c=Math.abs(e),l=n(e);return c<a?l*(c/a/s+1/r-1/r)*a*s:(i=(t=(1+s/r)*c)-(t-c))>o||i!=i?l*(1/0):l*i}},{65:65}],63:[function(e,t,exports){t.exports=Math.log1p||function(e){return(e=+e)>-1e-8&&e<1e-8?e-e*e/2:Math.log(1+e)}},{}],64:[function(e,t,exports){t.exports=Math.scale||function(e,t,n,i,r){return 0===arguments.length||e!=e||t!=t||n!=n||i!=i||r!=r?NaN:e===1/0||e===-1/0?e:(e-t)*(r-i)/(n-t)+i}},{}],65:[function(e,t,exports){t.exports=Math.sign||function(e){return 0==(e=+e)||e!=e?e:e<0?-1:1}},{}],66:[function(e,t,exports){var n=e(124)("meta"),i=e(51),r=e(41),s=e(72).f,o=0,a=Object.isExtensible||function(){return!0},c=!e(35)(function(){return a(Object.preventExtensions({}))}),l=function(e){s(e,n,{value:{i:"O"+ ++o,w:{}}})},u=t.exports={KEY:n,NEED:!1,fastKey:function(e,t){if(!i(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!r(e,n)){if(!a(e))return"F";if(!t)return"E";l(e)}return e[n].i},getWeak:function(e,t){if(!r(e,n)){if(!a(e))return!0;if(!t)return!1;l(e)}return e[n].w},onFreeze:function(e){return c&&u.NEED&&a(e)&&!r(e,n)&&l(e),e}}},{124:124,35:35,41:41,51:51,72:72}],67:[function(e,t,exports){var n=e(160),i=e(33),r=e(103)("metadata"),s=r.store||(r.store=new(e(266))),o=function(e,t,i){var r=s.get(e);if(!r){if(!i)return;s.set(e,r=new n)}var o=r.get(t);if(!o){if(!i)return;r.set(t,o=new n)}return o};t.exports={store:s,map:o,has:function(e,t,n){var i=o(t,n,!1);return void 0!==i&&i.has(e)},get:function(e,t,n){var i=o(t,n,!1);return void 0===i?void 0:i.get(e)},set:function(e,t,n,i){o(n,i,!0).set(e,t)},keys:function(e,t){var n=o(e,t,!1),i=[];return n&&n.forEach(function(e,t){i.push(t)}),i},key:function(e){return void 0===e||"symbol"==typeof e?e:String(e)},exp:function(e){i(i.S,"Reflect",e)}}},{103:103,160:160,266:266,33:33}],68:[function(e,t,exports){var n=e(40),i=e(113).set,r=n.MutationObserver||n.WebKitMutationObserver,s=n.process,o=n.Promise,a="process"==e(18)(s);t.exports=function(){var e,t,c,l=function(){var n,i;for(a&&(n=s.domain)&&n.exit();e;){i=e.fn,e=e.next;try{i()}catch(n){throw e?c():t=void 0,n}}t=void 0,n&&n.enter()};if(a)c=function(){s.nextTick(l)};else if(r){var u=!0,h=document.createTextNode("");new r(l).observe(h,{characterData:!0}),c=function(){h.data=u=!u}}else if(o&&o.resolve){var d=o.resolve();c=function(){d.then(l)}}else c=function(){i.call(n,l)};return function(n){var i={fn:n,next:void 0};t&&(t.next=i),e||(e=i,c()),t=i}}},{113:113,18:18,40:40}],69:[function(e,t,exports){"use strict";var n=e(3);function i(e){var t,i;this.promise=new e(function(e,n){if(void 0!==t||void 0!==i)throw TypeError("Bad Promise constructor");t=e,i=n}),this.resolve=n(t),this.reject=n(i)}t.exports.f=function(e){return new i(e)}},{3:3}],70:[function(e,t,exports){"use strict";var n=e(81),i=e(78),r=e(82),s=e(119),o=e(47),a=Object.assign;t.exports=!a||e(35)(function(){var e={},t={},n=Symbol(),i="abcdefghijklmnopqrst";return e[n]=7,i.split("").forEach(function(e){t[e]=e}),7!=a({},e)[n]||Object.keys(a({},t)).join("")!=i})?function(e,t){for(var a=s(e),c=arguments.length,l=1,u=i.f,h=r.f;c>l;)for(var d,f=o(arguments[l++]),p=u?n(f).concat(u(f)):n(f),g=p.length,m=0;g>m;)h.call(f,d=p[m++])&&(a[d]=f[d]);return a}:a},{119:119,35:35,47:47,78:78,81:81,82:82}],71:[function(e,t,exports){var n=e(7),i=e(73),r=e(31),s=e(102)("IE_PROTO"),o=function(){},a=function(){var t,n=e(30)("iframe"),i=r.length;for(n.style.display="none",e(43).appendChild(n),n.src="javascript:",(t=n.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),a=t.F;i--;)delete a.prototype[r[i]];return a()};t.exports=Object.create||function(e,t){var r;return null!==e?(o.prototype=n(e),r=new o,o.prototype=null,r[s]=e):r=a(),void 0===t?r:i(r,t)}},{102:102,30:30,31:31,43:43,7:7,73:73}],72:[function(e,t,exports){var n=e(7),i=e(44),r=e(120),s=Object.defineProperty;exports.f=e(29)?Object.defineProperty:function(e,t,o){if(n(e),t=r(t,!0),n(o),i)try{return s(e,t,o)}catch(e){}if("get"in o||"set"in o)throw TypeError("Accessors not supported!");return"value"in o&&(e[t]=o.value),e}},{120:120,29:29,44:44,7:7}],73:[function(e,t,exports){var n=e(72),i=e(7),r=e(81);t.exports=e(29)?Object.defineProperties:function(e,t){i(e);for(var s,o=r(t),a=o.length,c=0;a>c;)n.f(e,s=o[c++],t[s]);return e}},{29:29,7:7,72:72,81:81}],74:[function(e,t,exports){"use strict";t.exports=e(60)||!e(35)(function(){var t=Math.random();__defineSetter__.call(null,t,function(){}),delete e(40)[t]})},{35:35,40:40,60:60}],75:[function(e,t,exports){var n=e(82),i=e(92),r=e(117),s=e(120),o=e(41),a=e(44),c=Object.getOwnPropertyDescriptor;exports.f=e(29)?c:function(e,t){if(e=r(e),t=s(t,!0),a)try{return c(e,t)}catch(e){}if(o(e,t))return i(!n.f.call(e,t),e[t])}},{117:117,120:120,29:29,41:41,44:44,82:82,92:92}],76:[function(e,t,exports){var n=e(117),i=e(77).f,r={}.toString,s="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];t.exports.f=function(e){return s&&"[object Window]"==r.call(e)?function(e){try{return i(e)}catch(e){return s.slice()}}(e):i(n(e))}},{117:117,77:77}],77:[function(e,t,exports){var n=e(80),i=e(31).concat("length","prototype");exports.f=Object.getOwnPropertyNames||function(e){return n(e,i)}},{31:31,80:80}],78:[function(e,t,exports){exports.f=Object.getOwnPropertySymbols},{}],79:[function(e,t,exports){var n=e(41),i=e(119),r=e(102)("IE_PROTO"),s=Object.prototype;t.exports=Object.getPrototypeOf||function(e){return e=i(e),n(e,r)?e[r]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?s:null}},{102:102,119:119,41:41}],80:[function(e,t,exports){var n=e(41),i=e(117),r=e(11)(!1),s=e(102)("IE_PROTO");t.exports=function(e,t){var o,a=i(e),c=0,l=[];for(o in a)o!=s&&n(a,o)&&l.push(o);for(;t.length>c;)n(a,o=t[c++])&&(~r(l,o)||l.push(o));return l}},{102:102,11:11,117:117,41:41}],81:[function(e,t,exports){var n=e(80),i=e(31);t.exports=Object.keys||function(e){return n(e,i)}},{31:31,80:80}],82:[function(e,t,exports){exports.f={}.propertyIsEnumerable},{}],83:[function(e,t,exports){var n=e(33),i=e(23),r=e(35);t.exports=function(e,t){var s=(i.Object||{})[e]||Object[e],o={};o[e]=t(s),n(n.S+n.F*r(function(){s(1)}),"Object",o)}},{23:23,33:33,35:35}],84:[function(e,t,exports){var n=e(81),i=e(117),r=e(82).f;t.exports=function(e){return function(t){for(var s,o=i(t),a=n(o),c=a.length,l=0,u=[];c>l;)r.call(o,s=a[l++])&&u.push(e?[s,o[s]]:o[s]);return u}}},{117:117,81:81,82:82}],85:[function(e,t,exports){var n=e(77),i=e(78),r=e(7),s=e(40).Reflect;t.exports=s&&s.ownKeys||function(e){var t=n.f(r(e)),s=i.f;return s?t.concat(s(e)):t}},{40:40,7:7,77:77,78:78}],86:[function(e,t,exports){var n=e(40).parseFloat,i=e(111).trim;t.exports=1/n(e(112)+"-0")!=-1/0?function(e){var t=i(String(e),3),r=n(t);return 0===r&&"-"==t.charAt(0)?-0:r}:n},{111:111,112:112,40:40}],87:[function(e,t,exports){var n=e(40).parseInt,i=e(111).trim,r=e(112),s=/^[-+]?0[xX]/;t.exports=8!==n(r+"08")||22!==n(r+"0x16")?function(e,t){var r=i(String(e),3);return n(r,t>>>0||(s.test(r)?16:10))}:n},{111:111,112:112,40:40}],88:[function(e,t,exports){"use strict";var n=e(89),i=e(46),r=e(3);t.exports=function(){for(var e=r(this),t=arguments.length,s=Array(t),o=0,a=n._,c=!1;t>o;)(s[o]=arguments[o++])===a&&(c=!0);return function(){var n,r=arguments.length,o=0,l=0;if(!c&&!r)return i(e,s,this);if(n=s.slice(),c)for(;t>o;o++)n[o]===a&&(n[o]=arguments[l++]);for(;r>l;)n.push(arguments[l++]);return i(e,n,this)}}},{3:3,46:46,89:89}],89:[function(e,t,exports){t.exports=e(40)},{40:40}],90:[function(e,t,exports){t.exports=function(e){try{return{e:!1,v:e()}}catch(e){return{e:!0,v:e}}}},{}],91:[function(e,t,exports){var n=e(69);t.exports=function(e,t){var i=n.f(e);return(0,i.resolve)(t),i.promise}},{69:69}],92:[function(e,t,exports){t.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},{}],93:[function(e,t,exports){var n=e(94);t.exports=function(e,t,i){for(var r in t)n(e,r,t[r],i);return e}},{94:94}],94:[function(e,t,exports){var n=e(40),i=e(42),r=e(41),s=e(124)("src"),o=Function.toString,a=(""+o).split("toString");e(23).inspectSource=function(e){return o.call(e)},(t.exports=function(e,t,o,c){var l="function"==typeof o;l&&(r(o,"name")||i(o,"name",t)),e[t]!==o&&(l&&(r(o,s)||i(o,s,e[t]?""+e[t]:a.join(String(t)))),e===n?e[t]=o:c?e[t]?e[t]=o:i(e,t,o):(delete e[t],i(e,t,o)))})(Function.prototype,"toString",function(){return"function"==typeof this&&this[s]||o.call(this)})},{124:124,23:23,40:40,41:41,42:42}],95:[function(e,t,exports){t.exports=function(e,t){var n=t===Object(t)?function(e){return t[e]}:t;return function(t){return String(t).replace(e,n)}}},{}],96:[function(e,t,exports){t.exports=Object.is||function(e,t){return e===t?0!==e||1/e==1/t:e!=e&&t!=t}},{}],97:[function(e,t,exports){"use strict";var n=e(33),i=e(3),r=e(25),s=e(39);t.exports=function(e){n(n.S,e,{from:function(e){var t,n,o,a,c=arguments[1];return i(this),(t=void 0!==c)&&i(c),null==e?new this:(n=[],t?(o=0,a=r(c,arguments[2],2),s(e,!1,function(e){n.push(a(e,o++))})):s(e,!1,n.push,n),new this(n))}})}},{25:25,3:3,33:33,39:39}],98:[function(e,t,exports){"use strict";var n=e(33);t.exports=function(e){n(n.S,e,{of:function(){for(var e=arguments.length,t=Array(e);e--;)t[e]=arguments[e];return new this(t)}})}},{33:33}],99:[function(e,t,exports){var n=e(51),i=e(7),r=function(e,t){if(i(e),!n(t)&&null!==t)throw TypeError(t+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,n,i){try{(i=e(25)(Function.call,e(75).f(Object.prototype,"__proto__").set,2))(t,[]),n=!(t instanceof Array)}catch(e){n=!0}return function(e,t){return r(e,t),n?e.__proto__=t:i(e,t),e}}({},!1):void 0),check:r}},{25:25,51:51,7:7,75:75}],100:[function(e,t,exports){"use strict";var n=e(40),i=e(72),r=e(29),s=e(128)("species");t.exports=function(e){var t=n[e];r&&t&&!t[s]&&i.f(t,s,{configurable:!0,get:function(){return this}})}},{128:128,29:29,40:40,72:72}],101:[function(e,t,exports){var n=e(72).f,i=e(41),r=e(128)("toStringTag");t.exports=function(e,t,s){e&&!i(e=s?e:e.prototype,r)&&n(e,r,{configurable:!0,value:t})}},{128:128,41:41,72:72}],102:[function(e,t,exports){var n=e(103)("keys"),i=e(124);t.exports=function(e){return n[e]||(n[e]=i(e))}},{103:103,124:124}],103:[function(e,t,exports){var n=e(40),i=n["__core-js_shared__"]||(n["__core-js_shared__"]={});t.exports=function(e){return i[e]||(i[e]={})}},{40:40}],104:[function(e,t,exports){var n=e(7),i=e(3),r=e(128)("species");t.exports=function(e,t){var s,o=n(e).constructor;return void 0===o||null==(s=n(o)[r])?t:i(s)}},{128:128,3:3,7:7}],105:[function(e,t,exports){"use strict";var n=e(35);t.exports=function(e,t){return!!e&&n(function(){t?e.call(null,function(){},1):e.call(null)})}},{35:35}],106:[function(e,t,exports){var n=e(116),i=e(28);t.exports=function(e){return function(t,r){var s,o,a=String(i(t)),c=n(r),l=a.length;return c<0||c>=l?e?"":void 0:(s=a.charCodeAt(c))<55296||s>56319||c+1===l||(o=a.charCodeAt(c+1))<56320||o>57343?e?a.charAt(c):s:e?a.slice(c,c+2):o-56320+(s-55296<<10)+65536}}},{116:116,28:28}],107:[function(e,t,exports){var n=e(52),i=e(28);t.exports=function(e,t,r){if(n(t))throw TypeError("String#"+r+" doesn't accept regex!");return String(i(e))}},{28:28,52:52}],108:[function(e,t,exports){var n=e(33),i=e(35),r=e(28),s=/"/g,o=function(e,t,n,i){var o=String(r(e)),a="<"+t;return""!==n&&(a+=" "+n+'="'+String(i).replace(s,"&quot;")+'"'),a+">"+o+"</"+t+">"};t.exports=function(e,t){var r={};r[e]=t(o),n(n.P+n.F*i(function(){var t=""[e]('"');return t!==t.toLowerCase()||t.split('"').length>3}),"String",r)}},{28:28,33:33,35:35}],109:[function(e,t,exports){var n=e(118),i=e(110),r=e(28);t.exports=function(e,t,s,o){var a=String(r(e)),c=a.length,l=void 0===s?" ":String(s),u=n(t);if(u<=c||""==l)return a;var h=u-c,d=i.call(l,Math.ceil(h/l.length));return d.length>h&&(d=d.slice(0,h)),o?d+a:a+d}},{110:110,118:118,28:28}],110:[function(e,t,exports){"use strict";var n=e(116),i=e(28);t.exports=function(e){var t=String(i(this)),r="",s=n(e);if(s<0||s==1/0)throw RangeError("Count can't be negative");for(;s>0;(s>>>=1)&&(t+=t))1&s&&(r+=t);return r}},{116:116,28:28}],111:[function(e,t,exports){var n=e(33),i=e(28),r=e(35),s=e(112),o="["+s+"]",a=RegExp("^"+o+o+"*"),c=RegExp(o+o+"*$"),l=function(e,t,i){var o={},a=r(function(){return!!s[e]()||"​"!="​"[e]()}),c=o[e]=a?t(u):s[e];i&&(o[i]=c),n(n.P+n.F*a,"String",o)},u=l.trim=function(e,t){return e=String(i(e)),1&t&&(e=e.replace(a,"")),2&t&&(e=e.replace(c,"")),e};t.exports=l},{112:112,28:28,33:33,35:35}],112:[function(e,t,exports){t.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},{}],113:[function(e,t,exports){var n,i,r,s=e(25),o=e(46),a=e(43),c=e(30),l=e(40),u=l.process,h=l.setImmediate,d=l.clearImmediate,f=l.MessageChannel,p=l.Dispatch,g=0,m={},_=function(){var e=+this;if(m.hasOwnProperty(e)){var t=m[e];delete m[e],t()}},v=function(e){_.call(e.data)};h&&d||(h=function(e){for(var t=[],i=1;arguments.length>i;)t.push(arguments[i++]);return m[++g]=function(){o("function"==typeof e?e:Function(e),t)},n(g),g},d=function(e){delete m[e]},"process"==e(18)(u)?n=function(e){u.nextTick(s(_,e,1))}:p&&p.now?n=function(e){p.now(s(_,e,1))}:f?(r=(i=new f).port2,i.port1.onmessage=v,n=s(r.postMessage,r,1)):l.addEventListener&&"function"==typeof postMessage&&!l.importScripts?(n=function(e){l.postMessage(e+"","*")},l.addEventListener("message",v,!1)):n="onreadystatechange"in c("script")?function(e){a.appendChild(c("script")).onreadystatechange=function(){a.removeChild(this),_.call(e)}}:function(e){setTimeout(s(_,e,1),0)}),t.exports={set:h,clear:d}},{18:18,25:25,30:30,40:40,43:43,46:46}],114:[function(e,t,exports){var n=e(116),i=Math.max,r=Math.min;t.exports=function(e,t){return(e=n(e))<0?i(e+t,0):r(e,t)}},{116:116}],115:[function(e,t,exports){var n=e(116),i=e(118);t.exports=function(e){if(void 0===e)return 0;var t=n(e),r=i(t);if(t!==r)throw RangeError("Wrong length!");return r}},{116:116,118:118}],116:[function(e,t,exports){var n=Math.ceil,i=Math.floor;t.exports=function(e){return isNaN(e=+e)?0:(e>0?i:n)(e)}},{}],117:[function(e,t,exports){var n=e(47),i=e(28);t.exports=function(e){return n(i(e))}},{28:28,47:47}],118:[function(e,t,exports){var n=e(116),i=Math.min;t.exports=function(e){return e>0?i(n(e),9007199254740991):0}},{116:116}],119:[function(e,t,exports){var n=e(28);t.exports=function(e){return Object(n(e))}},{28:28}],120:[function(e,t,exports){var n=e(51);t.exports=function(e,t){if(!n(e))return e;var i,r;if(t&&"function"==typeof(i=e.toString)&&!n(r=i.call(e)))return r;if("function"==typeof(i=e.valueOf)&&!n(r=i.call(e)))return r;if(!t&&"function"==typeof(i=e.toString)&&!n(r=i.call(e)))return r;throw TypeError("Can't convert object to primitive value")}},{51:51}],121:[function(e,t,exports){"use strict";if(e(29)){var n=e(60),i=e(40),r=e(35),s=e(33),o=e(123),a=e(122),c=e(25),l=e(6),u=e(92),h=e(42),d=e(93),f=e(116),p=e(118),g=e(115),m=e(114),_=e(120),v=e(41),y=e(17),b=e(51),S=e(119),C=e(48),w=e(71),T=e(79),k=e(77).f,E=e(129),A=e(124),x=e(128),R=e(12),I=e(11),L=e(104),M=e(141),P=e(58),O=e(56),D=e(100),N=e(9),F=e(8),j=e(72),U=e(75),q=j.f,V=U.f,B=i.RangeError,H=i.TypeError,W=i.Uint8Array,G=Array.prototype,z=a.ArrayBuffer,K=a.DataView,Y=R(0),J=R(2),Q=R(3),X=R(4),Z=R(5),ee=R(6),te=I(!0),ne=I(!1),ie=M.values,re=M.keys,se=M.entries,oe=G.lastIndexOf,ae=G.reduce,ce=G.reduceRight,le=G.join,ue=G.sort,he=G.slice,de=G.toString,fe=G.toLocaleString,pe=x("iterator"),ge=x("toStringTag"),me=A("typed_constructor"),_e=A("def_constructor"),ve=o.CONSTR,ye=o.TYPED,be=o.VIEW,Se=R(1,function(e,t){return Ee(L(e,e[_e]),t)}),Ce=r(function(){return 1===new W(new Uint16Array([1]).buffer)[0]}),we=!!W&&!!W.prototype.set&&r(function(){new W(1).set({})}),Te=function(e,t){var n=f(e);if(n<0||n%t)throw B("Wrong offset!");return n},ke=function(e){if(b(e)&&ye in e)return e;throw H(e+" is not a typed array!")},Ee=function(e,t){if(!(b(e)&&me in e))throw H("It is not a typed array constructor!");return new e(t)},Ae=function(e,t){return xe(L(e,e[_e]),t)},xe=function(e,t){for(var n=0,i=t.length,r=Ee(e,i);i>n;)r[n]=t[n++];return r},Re=function(e,t,n){q(e,t,{get:function(){return this._d[n]}})},Ie=function(e){var t,n,i,r,s,o,a=S(e),l=arguments.length,u=l>1?arguments[1]:void 0,h=void 0!==u,d=E(a);if(null!=d&&!C(d)){for(o=d.call(a),i=[],t=0;!(s=o.next()).done;t++)i.push(s.value);a=i}for(h&&l>2&&(u=c(u,arguments[2],2)),t=0,n=p(a.length),r=Ee(this,n);n>t;t++)r[t]=h?u(a[t],t):a[t];return r},Le=function(){for(var e=0,t=arguments.length,n=Ee(this,t);t>e;)n[e]=arguments[e++];return n},Me=!!W&&r(function(){fe.call(new W(1))}),Pe=function(){return fe.apply(Me?he.call(ke(this)):ke(this),arguments)},Oe={copyWithin:function(e,t){return F.call(ke(this),e,t,arguments.length>2?arguments[2]:void 0)},every:function(e){return X(ke(this),e,arguments.length>1?arguments[1]:void 0)},fill:function(e){return N.apply(ke(this),arguments)},filter:function(e){return Ae(this,J(ke(this),e,arguments.length>1?arguments[1]:void 0))},find:function(e){return Z(ke(this),e,arguments.length>1?arguments[1]:void 0)},findIndex:function(e){return ee(ke(this),e,arguments.length>1?arguments[1]:void 0)},forEach:function(e){Y(ke(this),e,arguments.length>1?arguments[1]:void 0)},indexOf:function(e){return ne(ke(this),e,arguments.length>1?arguments[1]:void 0)},includes:function(e){return te(ke(this),e,arguments.length>1?arguments[1]:void 0)},join:function(e){return le.apply(ke(this),arguments)},lastIndexOf:function(e){return oe.apply(ke(this),arguments)},map:function(e){return Se(ke(this),e,arguments.length>1?arguments[1]:void 0)},reduce:function(e){return ae.apply(ke(this),arguments)},reduceRight:function(e){return ce.apply(ke(this),arguments)},reverse:function(){for(var e,t=ke(this).length,n=Math.floor(t/2),i=0;i<n;)e=this[i],this[i++]=this[--t],this[t]=e;return this},some:function(e){return Q(ke(this),e,arguments.length>1?arguments[1]:void 0)},sort:function(e){return ue.call(ke(this),e)},subarray:function(e,t){var n=ke(this),i=n.length,r=m(e,i);return new(L(n,n[_e]))(n.buffer,n.byteOffset+r*n.BYTES_PER_ELEMENT,p((void 0===t?i:m(t,i))-r))}},De=function(e,t){return Ae(this,he.call(ke(this),e,t))},Ne=function(e){ke(this);var t=Te(arguments[1],1),n=this.length,i=S(e),r=p(i.length),s=0;if(r+t>n)throw B("Wrong length!");for(;s<r;)this[t+s]=i[s++]},Fe={entries:function(){return se.call(ke(this))},keys:function(){return re.call(ke(this))},values:function(){return ie.call(ke(this))}},je=function(e,t){return b(e)&&e[ye]&&"symbol"!=typeof t&&t in e&&String(+t)==String(t)},Ue=function(e,t){return je(e,t=_(t,!0))?u(2,e[t]):V(e,t)},qe=function(e,t,n){return!(je(e,t=_(t,!0))&&b(n)&&v(n,"value"))||v(n,"get")||v(n,"set")||n.configurable||v(n,"writable")&&!n.writable||v(n,"enumerable")&&!n.enumerable?q(e,t,n):(e[t]=n.value,e)};ve||(U.f=Ue,j.f=qe),s(s.S+s.F*!ve,"Object",{getOwnPropertyDescriptor:Ue,defineProperty:qe}),r(function(){de.call({})})&&(de=fe=function(){return le.call(this)});var Ve=d({},Oe);d(Ve,Fe),h(Ve,pe,Fe.values),d(Ve,{slice:De,set:Ne,constructor:function(){},toString:de,toLocaleString:Pe}),Re(Ve,"buffer","b"),Re(Ve,"byteOffset","o"),Re(Ve,"byteLength","l"),Re(Ve,"length","e"),q(Ve,ge,{get:function(){return this[ye]}}),t.exports=function(e,t,a,c){var u=e+((c=!!c)?"Clamped":"")+"Array",d="get"+e,f="set"+e,m=i[u],_=m||{},v=m&&T(m),S=!m||!o.ABV,C={},E=m&&m.prototype,A=function(e,n){q(e,n,{get:function(){return function(e,n){var i=e._d;return i.v[d](n*t+i.o,Ce)}(this,n)},set:function(e){return function(e,n,i){var r=e._d;c&&(i=(i=Math.round(i))<0?0:i>255?255:255&i),r.v[f](n*t+r.o,i,Ce)}(this,n,e)},enumerable:!0})};S?(m=a(function(e,n,i,r){l(e,m,u,"_d");var s,o,a,c,d=0,f=0;if(b(n)){if(!(n instanceof z||"ArrayBuffer"==(c=y(n))||"SharedArrayBuffer"==c))return ye in n?xe(m,n):Ie.call(m,n);s=n,f=Te(i,t);var _=n.byteLength;if(void 0===r){if(_%t)throw B("Wrong length!");if((o=_-f)<0)throw B("Wrong length!")}else if((o=p(r)*t)+f>_)throw B("Wrong length!");a=o/t}else a=g(n),s=new z(o=a*t);for(h(e,"_d",{b:s,o:f,l:o,e:a,v:new K(s)});d<a;)A(e,d++)}),E=m.prototype=w(Ve),h(E,"constructor",m)):r(function(){m(1)})&&r(function(){new m(-1)})&&O(function(e){new m,new m(null),new m(1.5),new m(e)},!0)||(m=a(function(e,n,i,r){var s;return l(e,m,u),b(n)?n instanceof z||"ArrayBuffer"==(s=y(n))||"SharedArrayBuffer"==s?void 0!==r?new _(n,Te(i,t),r):void 0!==i?new _(n,Te(i,t)):new _(n):ye in n?xe(m,n):Ie.call(m,n):new _(g(n))}),Y(v!==Function.prototype?k(_).concat(k(v)):k(_),function(e){e in m||h(m,e,_[e])}),m.prototype=E,n||(E.constructor=m));var x=E[pe],R=!!x&&("values"==x.name||null==x.name),I=Fe.values;h(m,me,!0),h(E,ye,u),h(E,be,!0),h(E,_e,m),(c?new m(1)[ge]==u:ge in E)||q(E,ge,{get:function(){return u}}),C[u]=m,s(s.G+s.W+s.F*(m!=_),C),s(s.S,u,{BYTES_PER_ELEMENT:t}),s(s.S+s.F*r(function(){_.of.call(m,1)}),u,{from:Ie,of:Le}),"BYTES_PER_ELEMENT"in E||h(E,"BYTES_PER_ELEMENT",t),s(s.P,u,Oe),D(u),s(s.P+s.F*we,u,{set:Ne}),s(s.P+s.F*!R,u,Fe),n||E.toString==de||(E.toString=de),s(s.P+s.F*r(function(){new m(1).slice()}),u,{slice:De}),s(s.P+s.F*(r(function(){return[1,2].toLocaleString()!=new m([1,2]).toLocaleString()})||!r(function(){E.toLocaleString.call([1,2])})),u,{toLocaleString:Pe}),P[u]=R?x:I,n||R||h(E,pe,I)}}else t.exports=function(){}},{100:100,104:104,11:11,114:114,115:115,116:116,118:118,119:119,12:12,120:120,122:122,123:123,124:124,128:128,129:129,141:141,17:17,25:25,29:29,33:33,35:35,40:40,41:41,42:42,48:48,51:51,56:56,58:58,6:6,60:60,71:71,72:72,75:75,77:77,79:79,8:8,9:9,92:92,93:93}],122:[function(e,t,exports){"use strict";var n=e(40),i=e(29),r=e(60),s=e(123),o=e(42),a=e(93),c=e(35),l=e(6),u=e(116),h=e(118),d=e(115),f=e(77).f,p=e(72).f,g=e(9),m=e(101),_="prototype",v="Wrong index!",y=n.ArrayBuffer,b=n.DataView,S=n.Math,C=n.RangeError,w=n.Infinity,T=y,k=S.abs,E=S.pow,A=S.floor,x=S.log,R=S.LN2,I=i?"_b":"buffer",L=i?"_l":"byteLength",M=i?"_o":"byteOffset";function P(e,t,n){var i,r,s,o=Array(n),a=8*n-t-1,c=(1<<a)-1,l=c>>1,u=23===t?E(2,-24)-E(2,-77):0,h=0,d=e<0||0===e&&1/e<0?1:0;for((e=k(e))!=e||e===w?(r=e!=e?1:0,i=c):(i=A(x(e)/R),e*(s=E(2,-i))<1&&(i--,s*=2),(e+=i+l>=1?u/s:u*E(2,1-l))*s>=2&&(i++,s/=2),i+l>=c?(r=0,i=c):i+l>=1?(r=(e*s-1)*E(2,t),i+=l):(r=e*E(2,l-1)*E(2,t),i=0));t>=8;o[h++]=255&r,r/=256,t-=8);for(i=i<<t|r,a+=t;a>0;o[h++]=255&i,i/=256,a-=8);return o[--h]|=128*d,o}function O(e,t,n){var i,r=8*n-t-1,s=(1<<r)-1,o=s>>1,a=r-7,c=n-1,l=e[c--],u=127&l;for(l>>=7;a>0;u=256*u+e[c],c--,a-=8);for(i=u&(1<<-a)-1,u>>=-a,a+=t;a>0;i=256*i+e[c],c--,a-=8);if(0===u)u=1-o;else{if(u===s)return i?NaN:l?-w:w;i+=E(2,t),u-=o}return(l?-1:1)*i*E(2,u-t)}function D(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]}function N(e){return[255&e]}function F(e){return[255&e,e>>8&255]}function j(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]}function U(e){return P(e,52,8)}function q(e){return P(e,23,4)}function V(e,t,n){p(e[_],t,{get:function(){return this[n]}})}function B(e,t,n,i){var r=d(+n);if(r+t>e[L])throw C(v);var s=e[I]._b,o=r+e[M],a=s.slice(o,o+t);return i?a:a.reverse()}function H(e,t,n,i,r,s){var o=d(+n);if(o+t>e[L])throw C(v);for(var a=e[I]._b,c=o+e[M],l=i(+r),u=0;u<t;u++)a[c+u]=l[s?u:t-u-1]}if(s.ABV){if(!c(function(){y(1)})||!c(function(){new y(-1)})||c(function(){return new y,new y(1.5),new y(NaN),"ArrayBuffer"!=y.name})){for(var W,G=(y=function(e){return l(this,y),new T(d(e))})[_]=T[_],z=f(T),K=0;z.length>K;)(W=z[K++])in y||o(y,W,T[W]);r||(G.constructor=y)}var Y=new b(new y(2)),J=b[_].setInt8;Y.setInt8(0,2147483648),Y.setInt8(1,2147483649),!Y.getInt8(0)&&Y.getInt8(1)||a(b[_],{setInt8:function(e,t){J.call(this,e,t<<24>>24)},setUint8:function(e,t){J.call(this,e,t<<24>>24)}},!0)}else y=function(e){l(this,y,"ArrayBuffer");var t=d(e);this._b=g.call(Array(t),0),this[L]=t},b=function(e,t,n){l(this,b,"DataView"),l(e,y,"DataView");var i=e[L],r=u(t);if(r<0||r>i)throw C("Wrong offset!");if(r+(n=void 0===n?i-r:h(n))>i)throw C("Wrong length!");this[I]=e,this[M]=r,this[L]=n},i&&(V(y,"byteLength","_l"),V(b,"buffer","_b"),V(b,"byteLength","_l"),V(b,"byteOffset","_o")),a(b[_],{getInt8:function(e){return B(this,1,e)[0]<<24>>24},getUint8:function(e){return B(this,1,e)[0]},getInt16:function(e){var t=B(this,2,e,arguments[1]);return(t[1]<<8|t[0])<<16>>16},getUint16:function(e){var t=B(this,2,e,arguments[1]);return t[1]<<8|t[0]},getInt32:function(e){return D(B(this,4,e,arguments[1]))},getUint32:function(e){return D(B(this,4,e,arguments[1]))>>>0},getFloat32:function(e){return O(B(this,4,e,arguments[1]),23,4)},getFloat64:function(e){return O(B(this,8,e,arguments[1]),52,8)},setInt8:function(e,t){H(this,1,e,N,t)},setUint8:function(e,t){H(this,1,e,N,t)},setInt16:function(e,t){H(this,2,e,F,t,arguments[2])},setUint16:function(e,t){H(this,2,e,F,t,arguments[2])},setInt32:function(e,t){H(this,4,e,j,t,arguments[2])},setUint32:function(e,t){H(this,4,e,j,t,arguments[2])},setFloat32:function(e,t){H(this,4,e,q,t,arguments[2])},setFloat64:function(e,t){H(this,8,e,U,t,arguments[2])}});m(y,"ArrayBuffer"),m(b,"DataView"),o(b[_],s.VIEW,!0),exports.ArrayBuffer=y,exports.DataView=b},{101:101,115:115,116:116,118:118,123:123,29:29,35:35,40:40,42:42,6:6,60:60,72:72,77:77,9:9,93:93}],123:[function(e,t,exports){for(var n,i=e(40),r=e(42),s=e(124),o=s("typed_array"),a=s("view"),c=!(!i.ArrayBuffer||!i.DataView),l=c,u=0,h="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");u<9;)(n=i[h[u++]])?(r(n.prototype,o,!0),r(n.prototype,a,!0)):l=!1;t.exports={ABV:c,CONSTR:l,TYPED:o,VIEW:a}},{124:124,40:40,42:42}],124:[function(e,t,exports){var n=0,i=Math.random();t.exports=function(e){return"Symbol(".concat(void 0===e?"":e,")_",(++n+i).toString(36))}},{}],125:[function(e,t,exports){var n=e(51);t.exports=function(e,t){if(!n(e)||e._t!==t)throw TypeError("Incompatible receiver, "+t+" required!");return e}},{51:51}],126:[function(e,t,exports){var n=e(40),i=e(23),r=e(60),s=e(127),o=e(72).f;t.exports=function(e){var t=i.Symbol||(i.Symbol=r?{}:n.Symbol||{});"_"==e.charAt(0)||e in t||o(t,e,{value:s.f(e)})}},{127:127,23:23,40:40,60:60,72:72}],127:[function(e,t,exports){exports.f=e(128)},{128:128}],128:[function(e,t,exports){var n=e(103)("wks"),i=e(124),r=e(40).Symbol,s="function"==typeof r;(t.exports=function(e){return n[e]||(n[e]=s&&r[e]||(s?r:i)("Symbol."+e))}).store=n},{103:103,124:124,40:40}],129:[function(e,t,exports){var n=e(17),i=e(128)("iterator"),r=e(58);t.exports=e(23).getIteratorMethod=function(e){if(null!=e)return e[i]||e["@@iterator"]||r[n(e)]}},{128:128,17:17,23:23,58:58}],130:[function(e,t,exports){var n=e(33),i=e(95)(/[\\^$*+?.()|[\]{}]/g,"\\$&");n(n.S,"RegExp",{escape:function(e){return i(e)}})},{33:33,95:95}],131:[function(e,t,exports){var n=e(33);n(n.P,"Array",{copyWithin:e(8)}),e(5)("copyWithin")},{33:33,5:5,8:8}],132:[function(e,t,exports){"use strict";var n=e(33),i=e(12)(4);n(n.P+n.F*!e(105)([].every,!0),"Array",{every:function(e){return i(this,e,arguments[1])}})},{105:105,12:12,33:33}],133:[function(e,t,exports){var n=e(33);n(n.P,"Array",{fill:e(9)}),e(5)("fill")},{33:33,5:5,9:9}],134:[function(e,t,exports){"use strict";var n=e(33),i=e(12)(2);n(n.P+n.F*!e(105)([].filter,!0),"Array",{filter:function(e){return i(this,e,arguments[1])}})},{105:105,12:12,33:33}],135:[function(e,t,exports){"use strict";var n=e(33),i=e(12)(6),r="findIndex",s=!0;r in[]&&Array(1)[r](function(){s=!1}),n(n.P+n.F*s,"Array",{findIndex:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),e(5)(r)},{12:12,33:33,5:5}],136:[function(e,t,exports){"use strict";var n=e(33),i=e(12)(5),r=!0;"find"in[]&&Array(1).find(function(){r=!1}),n(n.P+n.F*r,"Array",{find:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),e(5)("find")},{12:12,33:33,5:5}],137:[function(e,t,exports){"use strict";var n=e(33),i=e(12)(0),r=e(105)([].forEach,!0);n(n.P+n.F*!r,"Array",{forEach:function(e){return i(this,e,arguments[1])}})},{105:105,12:12,33:33}],138:[function(e,t,exports){"use strict";var n=e(25),i=e(33),r=e(119),s=e(53),o=e(48),a=e(118),c=e(24),l=e(129);i(i.S+i.F*!e(56)(function(e){Array.from(e)}),"Array",{from:function(e){var t,i,u,h,d=r(e),f="function"==typeof this?this:Array,p=arguments.length,g=p>1?arguments[1]:void 0,m=void 0!==g,_=0,v=l(d);if(m&&(g=n(g,p>2?arguments[2]:void 0,2)),null==v||f==Array&&o(v))for(i=new f(t=a(d.length));t>_;_++)c(i,_,m?g(d[_],_):d[_]);else for(h=v.call(d),i=new f;!(u=h.next()).done;_++)c(i,_,m?s(h,g,[u.value,_],!0):u.value);return i.length=_,i}})},{118:118,119:119,129:129,24:24,25:25,33:33,48:48,53:53,56:56}],139:[function(e,t,exports){"use strict";var n=e(33),i=e(11)(!1),r=[].indexOf,s=!!r&&1/[1].indexOf(1,-0)<0;n(n.P+n.F*(s||!e(105)(r)),"Array",{indexOf:function(e){return s?r.apply(this,arguments)||0:i(this,e,arguments[1])}})},{105:105,11:11,33:33}],140:[function(e,t,exports){var n=e(33);n(n.S,"Array",{isArray:e(49)})},{33:33,49:49}],141:[function(e,t,exports){"use strict";var n=e(5),i=e(57),r=e(58),s=e(117);t.exports=e(55)(Array,"Array",function(e,t){this._t=s(e),this._i=0,this._k=t},function(){var e=this._t,t=this._k,n=this._i++;return!e||n>=e.length?(this._t=void 0,i(1)):i(0,"keys"==t?n:"values"==t?e[n]:[n,e[n]])},"values"),r.Arguments=r.Array,n("keys"),n("values"),n("entries")},{117:117,5:5,55:55,57:57,58:58}],142:[function(e,t,exports){"use strict";var n=e(33),i=e(117),r=[].join;n(n.P+n.F*(e(47)!=Object||!e(105)(r)),"Array",{join:function(e){return r.call(i(this),void 0===e?",":e)}})},{105:105,117:117,33:33,47:47}],143:[function(e,t,exports){"use strict";var n=e(33),i=e(117),r=e(116),s=e(118),o=[].lastIndexOf,a=!!o&&1/[1].lastIndexOf(1,-0)<0;n(n.P+n.F*(a||!e(105)(o)),"Array",{lastIndexOf:function(e){if(a)return o.apply(this,arguments)||0;var t=i(this),n=s(t.length),c=n-1;for(arguments.length>1&&(c=Math.min(c,r(arguments[1]))),c<0&&(c=n+c);c>=0;c--)if(c in t&&t[c]===e)return c||0;return-1}})},{105:105,116:116,117:117,118:118,33:33}],144:[function(e,t,exports){"use strict";var n=e(33),i=e(12)(1);n(n.P+n.F*!e(105)([].map,!0),"Array",{map:function(e){return i(this,e,arguments[1])}})},{105:105,12:12,33:33}],145:[function(e,t,exports){"use strict";var n=e(33),i=e(24);n(n.S+n.F*e(35)(function(){function e(){}return!(Array.of.call(e)instanceof e)}),"Array",{of:function(){for(var e=0,t=arguments.length,n=new("function"==typeof this?this:Array)(t);t>e;)i(n,e,arguments[e++]);return n.length=t,n}})},{24:24,33:33,35:35}],146:[function(e,t,exports){"use strict";var n=e(33),i=e(13);n(n.P+n.F*!e(105)([].reduceRight,!0),"Array",{reduceRight:function(e){return i(this,e,arguments.length,arguments[1],!0)}})},{105:105,13:13,33:33}],147:[function(e,t,exports){"use strict";var n=e(33),i=e(13);n(n.P+n.F*!e(105)([].reduce,!0),"Array",{reduce:function(e){return i(this,e,arguments.length,arguments[1],!1)}})},{105:105,13:13,33:33}],148:[function(e,t,exports){"use strict";var n=e(33),i=e(43),r=e(18),s=e(114),o=e(118),a=[].slice;n(n.P+n.F*e(35)(function(){i&&a.call(i)}),"Array",{slice:function(e,t){var n=o(this.length),i=r(this);if(t=void 0===t?n:t,"Array"==i)return a.call(this,e,t);for(var c=s(e,n),l=s(t,n),u=o(l-c),h=Array(u),d=0;d<u;d++)h[d]="String"==i?this.charAt(c+d):this[c+d];return h}})},{114:114,118:118,18:18,33:33,35:35,43:43}],149:[function(e,t,exports){"use strict";var n=e(33),i=e(12)(3);n(n.P+n.F*!e(105)([].some,!0),"Array",{some:function(e){return i(this,e,arguments[1])}})},{105:105,12:12,33:33}],150:[function(e,t,exports){"use strict";var n=e(33),i=e(3),r=e(119),s=e(35),o=[].sort,a=[1,2,3];n(n.P+n.F*(s(function(){a.sort(void 0)})||!s(function(){a.sort(null)})||!e(105)(o)),"Array",{sort:function(e){return void 0===e?o.call(r(this)):o.call(r(this),i(e))}})},{105:105,119:119,3:3,33:33,35:35}],151:[function(e,t,exports){e(100)("Array")},{100:100}],152:[function(e,t,exports){var n=e(33);n(n.S,"Date",{now:function(){return(new Date).getTime()}})},{33:33}],153:[function(e,t,exports){var n=e(33),i=e(26);n(n.P+n.F*(Date.prototype.toISOString!==i),"Date",{toISOString:i})},{26:26,33:33}],154:[function(e,t,exports){"use strict";var n=e(33),i=e(119),r=e(120);n(n.P+n.F*e(35)(function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}),"Date",{toJSON:function(e){var t=i(this),n=r(t);return"number"!=typeof n||isFinite(n)?t.toISOString():null}})},{119:119,120:120,33:33,35:35}],155:[function(e,t,exports){var n=e(128)("toPrimitive"),i=Date.prototype;n in i||e(42)(i,n,e(27))},{128:128,27:27,42:42}],156:[function(e,t,exports){var n=Date.prototype,i=n.toString,r=n.getTime;new Date(NaN)+""!="Invalid Date"&&e(94)(n,"toString",function(){var e=r.call(this);return e==e?i.call(this):"Invalid Date"})},{94:94}],157:[function(e,t,exports){var n=e(33);n(n.P,"Function",{bind:e(16)})},{16:16,33:33}],158:[function(e,t,exports){"use strict";var n=e(51),i=e(79),r=e(128)("hasInstance"),s=Function.prototype;r in s||e(72).f(s,r,{value:function(e){if("function"!=typeof this||!n(e))return!1;if(!n(this.prototype))return e instanceof this;for(;e=i(e);)if(this.prototype===e)return!0;return!1}})},{128:128,51:51,72:72,79:79}],159:[function(e,t,exports){var n=e(72).f,i=Function.prototype,r=/^\s*function ([^ (]*)/;"name"in i||e(29)&&n(i,"name",{configurable:!0,get:function(){try{return(""+this).match(r)[1]}catch(e){return""}}})},{29:29,72:72}],160:[function(e,t,exports){"use strict";var n=e(19),i=e(125);t.exports=e(22)("Map",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{get:function(e){var t=n.getEntry(i(this,"Map"),e);return t&&t.v},set:function(e,t){return n.def(i(this,"Map"),0===e?0:e,t)}},n,!0)},{125:125,19:19,22:22}],161:[function(e,t,exports){var n=e(33),i=e(63),r=Math.sqrt,s=Math.acosh;n(n.S+n.F*!(s&&710==Math.floor(s(Number.MAX_VALUE))&&s(1/0)==1/0),"Math",{acosh:function(e){return(e=+e)<1?NaN:e>94906265.62425156?Math.log(e)+Math.LN2:i(e-1+r(e-1)*r(e+1))}})},{33:33,63:63}],162:[function(e,t,exports){var n=e(33),i=Math.asinh;n(n.S+n.F*!(i&&1/i(0)>0),"Math",{asinh:function e(t){return isFinite(t=+t)&&0!=t?t<0?-e(-t):Math.log(t+Math.sqrt(t*t+1)):t}})},{33:33}],163:[function(e,t,exports){var n=e(33),i=Math.atanh;n(n.S+n.F*!(i&&1/i(-0)<0),"Math",{atanh:function(e){return 0==(e=+e)?e:Math.log((1+e)/(1-e))/2}})},{33:33}],164:[function(e,t,exports){var n=e(33),i=e(65);n(n.S,"Math",{cbrt:function(e){return i(e=+e)*Math.pow(Math.abs(e),1/3)}})},{33:33,65:65}],165:[function(e,t,exports){var n=e(33);n(n.S,"Math",{clz32:function(e){return(e>>>=0)?31-Math.floor(Math.log(e+.5)*Math.LOG2E):32}})},{33:33}],166:[function(e,t,exports){var n=e(33),i=Math.exp;n(n.S,"Math",{cosh:function(e){return(i(e=+e)+i(-e))/2}})},{33:33}],167:[function(e,t,exports){var n=e(33),i=e(61);n(n.S+n.F*(i!=Math.expm1),"Math",{expm1:i})},{33:33,61:61}],168:[function(e,t,exports){var n=e(33);n(n.S,"Math",{fround:e(62)})},{33:33,62:62}],169:[function(e,t,exports){var n=e(33),i=Math.abs;n(n.S,"Math",{hypot:function(e,t){for(var n,r,s=0,o=0,a=arguments.length,c=0;o<a;)c<(n=i(arguments[o++]))?(s=s*(r=c/n)*r+1,c=n):s+=n>0?(r=n/c)*r:n;return c===1/0?1/0:c*Math.sqrt(s)}})},{33:33}],170:[function(e,t,exports){var n=e(33),i=Math.imul;n(n.S+n.F*e(35)(function(){return-5!=i(4294967295,5)||2!=i.length}),"Math",{imul:function(e,t){var n=+e,i=+t,r=65535&n,s=65535&i;return 0|r*s+((65535&n>>>16)*s+r*(65535&i>>>16)<<16>>>0)}})},{33:33,35:35}],171:[function(e,t,exports){var n=e(33);n(n.S,"Math",{log10:function(e){return Math.log(e)*Math.LOG10E}})},{33:33}],172:[function(e,t,exports){var n=e(33);n(n.S,"Math",{log1p:e(63)})},{33:33,63:63}],173:[function(e,t,exports){var n=e(33);n(n.S,"Math",{log2:function(e){return Math.log(e)/Math.LN2}})},{33:33}],174:[function(e,t,exports){var n=e(33);n(n.S,"Math",{sign:e(65)})},{33:33,65:65}],175:[function(e,t,exports){var n=e(33),i=e(61),r=Math.exp;n(n.S+n.F*e(35)(function(){return-2e-17!=!Math.sinh(-2e-17)}),"Math",{sinh:function(e){return Math.abs(e=+e)<1?(i(e)-i(-e))/2:(r(e-1)-r(-e-1))*(Math.E/2)}})},{33:33,35:35,61:61}],176:[function(e,t,exports){var n=e(33),i=e(61),r=Math.exp;n(n.S,"Math",{tanh:function(e){var t=i(e=+e),n=i(-e);return t==1/0?1:n==1/0?-1:(t-n)/(r(e)+r(-e))}})},{33:33,61:61}],177:[function(e,t,exports){var n=e(33);n(n.S,"Math",{trunc:function(e){return(e>0?Math.floor:Math.ceil)(e)}})},{33:33}],178:[function(e,t,exports){"use strict";var n=e(40),i=e(41),r=e(18),s=e(45),o=e(120),a=e(35),c=e(77).f,l=e(75).f,u=e(72).f,h=e(111).trim,d=n.Number,f=d,p=d.prototype,g="Number"==r(e(71)(p)),m="trim"in String.prototype,_=function(e){var t=o(e,!1);if("string"==typeof t&&t.length>2){var n,i,r,s=(t=m?t.trim():h(t,3)).charCodeAt(0);if(43===s||45===s){if(88===(n=t.charCodeAt(2))||120===n)return NaN}else if(48===s){switch(t.charCodeAt(1)){case 66:case 98:i=2,r=49;break;case 79:case 111:i=8,r=55;break;default:return+t}for(var a,c=t.slice(2),l=0,u=c.length;l<u;l++)if((a=c.charCodeAt(l))<48||a>r)return NaN;return parseInt(c,i)}}return+t};if(!d(" 0o1")||!d("0b1")||d("+0x1")){d=function(e){var t=arguments.length<1?0:e,n=this;return n instanceof d&&(g?a(function(){p.valueOf.call(n)}):"Number"!=r(n))?s(new f(_(t)),n,d):_(t)};for(var v,y=e(29)?c(f):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),b=0;y.length>b;b++)i(f,v=y[b])&&!i(d,v)&&u(d,v,l(f,v));d.prototype=p,p.constructor=d,e(94)(n,"Number",d)}},{111:111,120:120,18:18,29:29,35:35,40:40,41:41,45:45,71:71,72:72,75:75,77:77,94:94}],179:[function(e,t,exports){var n=e(33);n(n.S,"Number",{EPSILON:Math.pow(2,-52)})},{33:33}],180:[function(e,t,exports){var n=e(33),i=e(40).isFinite;n(n.S,"Number",{isFinite:function(e){return"number"==typeof e&&i(e)}})},{33:33,40:40}],181:[function(e,t,exports){var n=e(33);n(n.S,"Number",{isInteger:e(50)})},{33:33,50:50}],182:[function(e,t,exports){var n=e(33);n(n.S,"Number",{isNaN:function(e){return e!=e}})},{33:33}],183:[function(e,t,exports){var n=e(33),i=e(50),r=Math.abs;n(n.S,"Number",{isSafeInteger:function(e){return i(e)&&r(e)<=9007199254740991}})},{33:33,50:50}],184:[function(e,t,exports){var n=e(33);n(n.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},{33:33}],185:[function(e,t,exports){var n=e(33);n(n.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},{33:33}],186:[function(e,t,exports){var n=e(33),i=e(86);n(n.S+n.F*(Number.parseFloat!=i),"Number",{parseFloat:i})},{33:33,86:86}],187:[function(e,t,exports){var n=e(33),i=e(87);n(n.S+n.F*(Number.parseInt!=i),"Number",{parseInt:i})},{33:33,87:87}],188:[function(e,t,exports){"use strict";var n=e(33),i=e(116),r=e(4),s=e(110),o=1..toFixed,a=Math.floor,c=[0,0,0,0,0,0],l="Number.toFixed: incorrect invocation!",u=function(e,t){for(var n=-1,i=t;++n<6;)i+=e*c[n],c[n]=i%1e7,i=a(i/1e7)},h=function(e){for(var t=6,n=0;--t>=0;)n+=c[t],c[t]=a(n/e),n=n%e*1e7},d=function(){for(var e=6,t="";--e>=0;)if(""!==t||0===e||0!==c[e]){var n=String(c[e]);t=""===t?n:t+s.call("0",7-n.length)+n}return t},f=function(e,t,n){return 0===t?n:t%2==1?f(e,t-1,n*e):f(e*e,t/2,n)};n(n.P+n.F*(!!o&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!e(35)(function(){o.call({})})),"Number",{toFixed:function(e){var t,n,o,a,c=r(this,l),p=i(e),g="",m="0";if(p<0||p>20)throw RangeError(l);if(c!=c)return"NaN";if(c<=-1e21||c>=1e21)return String(c);if(c<0&&(g="-",c=-c),c>1e-21)if(n=(t=function(e){for(var t=0,n=e;n>=4096;)t+=12,n/=4096;for(;n>=2;)t+=1,n/=2;return t}(c*f(2,69,1))-69)<0?c*f(2,-t,1):c/f(2,t,1),n*=4503599627370496,(t=52-t)>0){for(u(0,n),o=p;o>=7;)u(1e7,0),o-=7;for(u(f(10,o,1),0),o=t-1;o>=23;)h(1<<23),o-=23;h(1<<o),u(1,1),h(2),m=d()}else u(0,n),u(1<<-t,0),m=d()+s.call("0",p);return m=p>0?g+((a=m.length)<=p?"0."+s.call("0",p-a)+m:m.slice(0,a-p)+"."+m.slice(a-p)):g+m}})},{110:110,116:116,33:33,35:35,4:4}],189:[function(e,t,exports){"use strict";var n=e(33),i=e(35),r=e(4),s=1..toPrecision;n(n.P+n.F*(i(function(){return"1"!==s.call(1,void 0)})||!i(function(){s.call({})})),"Number",{toPrecision:function(e){var t=r(this,"Number#toPrecision: incorrect invocation!");return void 0===e?s.call(t):s.call(t,e)}})},{33:33,35:35,4:4}],190:[function(e,t,exports){var n=e(33);n(n.S+n.F,"Object",{assign:e(70)})},{33:33,70:70}],191:[function(e,t,exports){var n=e(33);n(n.S,"Object",{create:e(71)})},{33:33,71:71}],192:[function(e,t,exports){var n=e(33);n(n.S+n.F*!e(29),"Object",{defineProperties:e(73)})},{29:29,33:33,73:73}],193:[function(e,t,exports){var n=e(33);n(n.S+n.F*!e(29),"Object",{defineProperty:e(72).f})},{29:29,33:33,72:72}],194:[function(e,t,exports){var n=e(51),i=e(66).onFreeze;e(83)("freeze",function(e){return function(t){return e&&n(t)?e(i(t)):t}})},{51:51,66:66,83:83}],195:[function(e,t,exports){var n=e(117),i=e(75).f;e(83)("getOwnPropertyDescriptor",function(){return function(e,t){return i(n(e),t)}})},{117:117,75:75,83:83}],196:[function(e,t,exports){e(83)("getOwnPropertyNames",function(){return e(76).f})},{76:76,83:83}],197:[function(e,t,exports){var n=e(119),i=e(79);e(83)("getPrototypeOf",function(){return function(e){return i(n(e))}})},{119:119,79:79,83:83}],198:[function(e,t,exports){var n=e(51);e(83)("isExtensible",function(e){return function(t){return!!n(t)&&(!e||e(t))}})},{51:51,83:83}],199:[function(e,t,exports){var n=e(51);e(83)("isFrozen",function(e){return function(t){return!n(t)||!!e&&e(t)}})},{51:51,83:83}],200:[function(e,t,exports){var n=e(51);e(83)("isSealed",function(e){return function(t){return!n(t)||!!e&&e(t)}})},{51:51,83:83}],201:[function(e,t,exports){var n=e(33);n(n.S,"Object",{is:e(96)})},{33:33,96:96}],202:[function(e,t,exports){var n=e(119),i=e(81);e(83)("keys",function(){return function(e){return i(n(e))}})},{119:119,81:81,83:83}],203:[function(e,t,exports){var n=e(51),i=e(66).onFreeze;e(83)("preventExtensions",function(e){return function(t){return e&&n(t)?e(i(t)):t}})},{51:51,66:66,83:83}],204:[function(e,t,exports){var n=e(51),i=e(66).onFreeze;e(83)("seal",function(e){return function(t){return e&&n(t)?e(i(t)):t}})},{51:51,66:66,83:83}],205:[function(e,t,exports){var n=e(33);n(n.S,"Object",{setPrototypeOf:e(99).set})},{33:33,99:99}],206:[function(e,t,exports){"use strict";var n=e(17),i={};i[e(128)("toStringTag")]="z",i+""!="[object z]"&&e(94)(Object.prototype,"toString",function(){return"[object "+n(this)+"]"},!0)},{128:128,17:17,94:94}],207:[function(e,t,exports){var n=e(33),i=e(86);n(n.G+n.F*(parseFloat!=i),{parseFloat:i})},{33:33,86:86}],208:[function(e,t,exports){var n=e(33),i=e(87);n(n.G+n.F*(parseInt!=i),{parseInt:i})},{33:33,87:87}],209:[function(e,t,exports){"use strict";var n,i,r,s,o=e(60),a=e(40),c=e(25),l=e(17),u=e(33),h=e(51),d=e(3),f=e(6),p=e(39),g=e(104),m=e(113).set,_=e(68)(),v=e(69),y=e(90),b=e(91),S=a.TypeError,C=a.process,w=a.Promise,T="process"==l(C),k=function(){},E=i=v.f,A=!!function(){try{var t=w.resolve(1),n=(t.constructor={})[e(128)("species")]=function(e){e(k,k)};return(T||"function"==typeof PromiseRejectionEvent)&&t.then(k)instanceof n}catch(e){}}(),x=o?function(e,t){return e===t||e===w&&t===s}:function(e,t){return e===t},R=function(e){var t;return!(!h(e)||"function"!=typeof(t=e.then))&&t},I=function(e,t){if(!e._n){e._n=!0;var n=e._c;_(function(){for(var i=e._v,r=1==e._s,s=0,o=function(t){var n,s,o=r?t.ok:t.fail,a=t.resolve,c=t.reject,l=t.domain;try{o?(r||(2==e._h&&P(e),e._h=1),!0===o?n=i:(l&&l.enter(),n=o(i),l&&l.exit()),n===t.promise?c(S("Promise-chain cycle")):(s=R(n))?s.call(n,a,c):a(n)):c(i)}catch(e){c(e)}};n.length>s;)o(n[s++]);e._c=[],e._n=!1,t&&!e._h&&L(e)})}},L=function(e){m.call(a,function(){var t,n,i,r=e._v,s=M(e);if(s&&(t=y(function(){T?C.emit("unhandledRejection",r,e):(n=a.onunhandledrejection)?n({promise:e,reason:r}):(i=a.console)&&i.error&&i.error("Unhandled promise rejection",r)}),e._h=T||M(e)?2:1),e._a=void 0,s&&t.e)throw t.v})},M=function(e){if(1==e._h)return!1;for(var t,n=e._a||e._c,i=0;n.length>i;)if((t=n[i++]).fail||!M(t.promise))return!1;return!0},P=function(e){m.call(a,function(){var t;T?C.emit("rejectionHandled",e):(t=a.onrejectionhandled)&&t({promise:e,reason:e._v})})},O=function(e){var t=this;t._d||(t._d=!0,(t=t._w||t)._v=e,t._s=2,t._a||(t._a=t._c.slice()),I(t,!0))},D=function(e){var t,n=this;if(!n._d){n._d=!0,n=n._w||n;try{if(n===e)throw S("Promise can't be resolved itself");(t=R(e))?_(function(){var i={_w:n,_d:!1};try{t.call(e,c(D,i,1),c(O,i,1))}catch(e){O.call(i,e)}}):(n._v=e,n._s=1,I(n,!1))}catch(e){O.call({_w:n,_d:!1},e)}}};A||(w=function(e){f(this,w,"Promise","_h"),d(e),n.call(this);try{e(c(D,this,1),c(O,this,1))}catch(e){O.call(this,e)}},(n=function(e){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=e(93)(w.prototype,{then:function(e,t){var n=E(g(this,w));return n.ok="function"!=typeof e||e,n.fail="function"==typeof t&&t,n.domain=T?C.domain:void 0,this._c.push(n),this._a&&this._a.push(n),this._s&&I(this,!1),n.promise},catch:function(e){return this.then(void 0,e)}}),r=function(){var e=new n;this.promise=e,this.resolve=c(D,e,1),this.reject=c(O,e,1)},v.f=E=function(e){return x(w,e)?new r(e):i(e)}),u(u.G+u.W+u.F*!A,{Promise:w}),e(101)(w,"Promise"),e(100)("Promise"),s=e(23).Promise,u(u.S+u.F*!A,"Promise",{reject:function(e){var t=E(this);return(0,t.reject)(e),t.promise}}),u(u.S+u.F*(o||!A),"Promise",{resolve:function(e){return e instanceof w&&x(e.constructor,this)?e:b(this,e)}}),u(u.S+u.F*!(A&&e(56)(function(e){w.all(e).catch(k)})),"Promise",{all:function(e){var t=this,n=E(t),i=n.resolve,r=n.reject,s=y(function(){var n=[],s=0,o=1;p(e,!1,function(e){var a=s++,c=!1;n.push(void 0),o++,t.resolve(e).then(function(e){c||(c=!0,n[a]=e,--o||i(n))},r)}),--o||i(n)});return s.e&&r(s.v),n.promise},race:function(e){var t=this,n=E(t),i=n.reject,r=y(function(){p(e,!1,function(e){t.resolve(e).then(n.resolve,i)})});return r.e&&i(r.v),n.promise}})},{100:100,101:101,104:104,113:113,128:128,17:17,23:23,25:25,3:3,33:33,39:39,40:40,51:51,56:56,6:6,60:60,68:68,69:69,90:90,91:91,93:93}],210:[function(e,t,exports){var n=e(33),i=e(3),r=e(7),s=(e(40).Reflect||{}).apply,o=Function.apply;n(n.S+n.F*!e(35)(function(){s(function(){})}),"Reflect",{apply:function(e,t,n){var a=i(e),c=r(n);return s?s(a,t,c):o.call(a,t,c)}})},{3:3,33:33,35:35,40:40,7:7}],211:[function(e,t,exports){var n=e(33),i=e(71),r=e(3),s=e(7),o=e(51),a=e(35),c=e(16),l=(e(40).Reflect||{}).construct,u=a(function(){function e(){}return!(l(function(){},[],e)instanceof e)}),h=!a(function(){l(function(){})});n(n.S+n.F*(u||h),"Reflect",{construct:function(e,t){r(e),s(t);var n=arguments.length<3?e:r(arguments[2]);if(h&&!u)return l(e,t,n);if(e==n){switch(t.length){case 0:return new e;case 1:return new e(t[0]);case 2:return new e(t[0],t[1]);case 3:return new e(t[0],t[1],t[2]);case 4:return new e(t[0],t[1],t[2],t[3])}var a=[null];return a.push.apply(a,t),new(c.apply(e,a))}var d=n.prototype,f=i(o(d)?d:Object.prototype),p=Function.apply.call(e,f,t);return o(p)?p:f}})},{16:16,3:3,33:33,35:35,40:40,51:51,7:7,71:71}],212:[function(e,t,exports){var n=e(72),i=e(33),r=e(7),s=e(120);i(i.S+i.F*e(35)(function(){Reflect.defineProperty(n.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function(e,t,i){r(e),t=s(t,!0),r(i);try{return n.f(e,t,i),!0}catch(e){return!1}}})},{120:120,33:33,35:35,7:7,72:72}],213:[function(e,t,exports){var n=e(33),i=e(75).f,r=e(7);n(n.S,"Reflect",{deleteProperty:function(e,t){var n=i(r(e),t);return!(n&&!n.configurable)&&delete e[t]}})},{33:33,7:7,75:75}],214:[function(e,t,exports){"use strict";var n=e(33),i=e(7),r=function(e){this._t=i(e),this._i=0;var t,n=this._k=[];for(t in e)n.push(t)};e(54)(r,"Object",function(){var e,t=this._k;do{if(this._i>=t.length)return{value:void 0,done:!0}}while(!((e=t[this._i++])in this._t));return{value:e,done:!1}}),n(n.S,"Reflect",{enumerate:function(e){return new r(e)}})},{33:33,54:54,7:7}],215:[function(e,t,exports){var n=e(75),i=e(33),r=e(7);i(i.S,"Reflect",{getOwnPropertyDescriptor:function(e,t){return n.f(r(e),t)}})},{33:33,7:7,75:75}],216:[function(e,t,exports){var n=e(33),i=e(79),r=e(7);n(n.S,"Reflect",{getPrototypeOf:function(e){return i(r(e))}})},{33:33,7:7,79:79}],217:[function(e,t,exports){var n=e(75),i=e(79),r=e(41),s=e(33),o=e(51),a=e(7);s(s.S,"Reflect",{get:function e(t,s){var c,l,u=arguments.length<3?t:arguments[2];return a(t)===u?t[s]:(c=n.f(t,s))?r(c,"value")?c.value:void 0!==c.get?c.get.call(u):void 0:o(l=i(t))?e(l,s,u):void 0}})},{33:33,41:41,51:51,7:7,75:75,79:79}],218:[function(e,t,exports){var n=e(33);n(n.S,"Reflect",{has:function(e,t){return t in e}})},{33:33}],219:[function(e,t,exports){var n=e(33),i=e(7),r=Object.isExtensible;n(n.S,"Reflect",{isExtensible:function(e){return i(e),!r||r(e)}})},{33:33,7:7}],220:[function(e,t,exports){var n=e(33);n(n.S,"Reflect",{ownKeys:e(85)})},{33:33,85:85}],221:[function(e,t,exports){var n=e(33),i=e(7),r=Object.preventExtensions;n(n.S,"Reflect",{preventExtensions:function(e){i(e);try{return r&&r(e),!0}catch(e){return!1}}})},{33:33,7:7}],222:[function(e,t,exports){var n=e(33),i=e(99);i&&n(n.S,"Reflect",{setPrototypeOf:function(e,t){i.check(e,t);try{return i.set(e,t),!0}catch(e){return!1}}})},{33:33,99:99}],223:[function(e,t,exports){var n=e(72),i=e(75),r=e(79),s=e(41),o=e(33),a=e(92),c=e(7),l=e(51);o(o.S,"Reflect",{set:function e(t,o,u){var h,d,f=arguments.length<4?t:arguments[3],p=i.f(c(t),o);if(!p){if(l(d=r(t)))return e(d,o,u,f);p=a(0)}return s(p,"value")?!(!1===p.writable||!l(f)||((h=i.f(f,o)||a(0)).value=u,n.f(f,o,h),0)):void 0!==p.set&&(p.set.call(f,u),!0)}})},{33:33,41:41,51:51,7:7,72:72,75:75,79:79,92:92}],224:[function(e,t,exports){var n=e(40),i=e(45),r=e(72).f,s=e(77).f,o=e(52),a=e(37),c=n.RegExp,l=c,u=c.prototype,h=/a/g,d=/a/g,f=new c(h)!==h;if(e(29)&&(!f||e(35)(function(){return d[e(128)("match")]=!1,c(h)!=h||c(d)==d||"/a/i"!=c(h,"i")}))){c=function(e,t){var n=this instanceof c,r=o(e),s=void 0===t;return!n&&r&&e.constructor===c&&s?e:i(f?new l(r&&!s?e.source:e,t):l((r=e instanceof c)?e.source:e,r&&s?a.call(e):t),n?this:u,c)};for(var p=function(e){e in c||r(c,e,{configurable:!0,get:function(){return l[e]},set:function(t){l[e]=t}})},g=s(l),m=0;g.length>m;)p(g[m++]);u.constructor=c,c.prototype=u,e(94)(n,"RegExp",c)}e(100)("RegExp")},{100:100,128:128,29:29,35:35,37:37,40:40,45:45,52:52,72:72,77:77,94:94}],225:[function(e,t,exports){e(29)&&"g"!=/./g.flags&&e(72).f(RegExp.prototype,"flags",{configurable:!0,get:e(37)})},{29:29,37:37,72:72}],226:[function(e,t,exports){e(36)("match",1,function(e,t,n){return[function(n){"use strict";var i=e(this),r=null==n?void 0:n[t];return void 0!==r?r.call(n,i):new RegExp(n)[t](String(i))},n]})},{36:36}],227:[function(e,t,exports){e(36)("replace",2,function(e,t,n){return[function(i,r){"use strict";var s=e(this),o=null==i?void 0:i[t];return void 0!==o?o.call(i,s,r):n.call(String(s),i,r)},n]})},{36:36}],228:[function(e,t,exports){e(36)("search",1,function(e,t,n){return[function(n){"use strict";var i=e(this),r=null==n?void 0:n[t];return void 0!==r?r.call(n,i):new RegExp(n)[t](String(i))},n]})},{36:36}],229:[function(e,t,exports){e(36)("split",2,function(t,n,i){"use strict";var r=e(52),s=i,o=[].push;if("c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||".".split(/()()/).length>1||"".split(/.?/).length){var a=void 0===/()??/.exec("")[1];i=function(e,t){var n=String(this);if(void 0===e&&0===t)return[];if(!r(e))return s.call(n,e,t);var i,c,l,u,h,d=[],f=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),p=0,g=void 0===t?4294967295:t>>>0,m=new RegExp(e.source,f+"g");for(a||(i=new RegExp("^"+m.source+"$(?!\\s)",f));(c=m.exec(n))&&!((l=c.index+c[0].length)>p&&(d.push(n.slice(p,c.index)),!a&&c.length>1&&c[0].replace(i,function(){for(h=1;h<arguments.length-2;h++)void 0===arguments[h]&&(c[h]=void 0)}),c.length>1&&c.index<n.length&&o.apply(d,c.slice(1)),u=c[0].length,p=l,d.length>=g));)m.lastIndex===c.index&&m.lastIndex++;return p===n.length?!u&&m.test("")||d.push(""):d.push(n.slice(p)),d.length>g?d.slice(0,g):d}}else"0".split(void 0,0).length&&(i=function(e,t){return void 0===e&&0===t?[]:s.call(this,e,t)});return[function(e,r){var s=t(this),o=null==e?void 0:e[n];return void 0!==o?o.call(e,s,r):i.call(String(s),e,r)},i]})},{36:36,52:52}],230:[function(e,t,exports){"use strict";e(225);var n=e(7),i=e(37),r=e(29),s=/./.toString,o=function(t){e(94)(RegExp.prototype,"toString",t,!0)};e(35)(function(){return"/a/b"!=s.call({source:"a",flags:"b"})})?o(function(){var e=n(this);return"/".concat(e.source,"/","flags"in e?e.flags:!r&&e instanceof RegExp?i.call(e):void 0)}):"toString"!=s.name&&o(function(){return s.call(this)})},{225:225,29:29,35:35,37:37,7:7,94:94}],231:[function(e,t,exports){"use strict";var n=e(19),i=e(125);t.exports=e(22)("Set",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{add:function(e){return n.def(i(this,"Set"),e=0===e?0:e,e)}},n)},{125:125,19:19,22:22}],232:[function(e,t,exports){"use strict";e(108)("anchor",function(e){return function(t){return e(this,"a","name",t)}})},{108:108}],233:[function(e,t,exports){"use strict";e(108)("big",function(e){return function(){return e(this,"big","","")}})},{108:108}],234:[function(e,t,exports){"use strict";e(108)("blink",function(e){return function(){return e(this,"blink","","")}})},{108:108}],235:[function(e,t,exports){"use strict";e(108)("bold",function(e){return function(){return e(this,"b","","")}})},{108:108}],236:[function(e,t,exports){"use strict";var n=e(33),i=e(106)(!1);n(n.P,"String",{codePointAt:function(e){return i(this,e)}})},{106:106,33:33}],237:[function(e,t,exports){"use strict";var n=e(33),i=e(118),r=e(107),s="".endsWith;n(n.P+n.F*e(34)("endsWith"),"String",{endsWith:function(e){var t=r(this,e,"endsWith"),n=arguments.length>1?arguments[1]:void 0,o=i(t.length),a=void 0===n?o:Math.min(i(n),o),c=String(e);return s?s.call(t,c,a):t.slice(a-c.length,a)===c}})},{107:107,118:118,33:33,34:34}],238:[function(e,t,exports){"use strict";e(108)("fixed",function(e){return function(){return e(this,"tt","","")}})},{108:108}],239:[function(e,t,exports){"use strict";e(108)("fontcolor",function(e){return function(t){return e(this,"font","color",t)}})},{108:108}],240:[function(e,t,exports){"use strict";e(108)("fontsize",function(e){return function(t){return e(this,"font","size",t)}})},{108:108}],241:[function(e,t,exports){var n=e(33),i=e(114),r=String.fromCharCode,s=String.fromCodePoint;n(n.S+n.F*(!!s&&1!=s.length),"String",{fromCodePoint:function(e){for(var t,n=[],s=arguments.length,o=0;s>o;){if(t=+arguments[o++],i(t,1114111)!==t)throw RangeError(t+" is not a valid code point");n.push(t<65536?r(t):r(55296+((t-=65536)>>10),t%1024+56320))}return n.join("")}})},{114:114,33:33}],242:[function(e,t,exports){"use strict";var n=e(33),i=e(107);n(n.P+n.F*e(34)("includes"),"String",{includes:function(e){return!!~i(this,e,"includes").indexOf(e,arguments.length>1?arguments[1]:void 0)}})},{107:107,33:33,34:34}],243:[function(e,t,exports){"use strict";e(108)("italics",function(e){return function(){return e(this,"i","","")}})},{108:108}],244:[function(e,t,exports){"use strict";var n=e(106)(!0);e(55)(String,"String",function(e){this._t=String(e),this._i=0},function(){var e,t=this._t,i=this._i;return i>=t.length?{value:void 0,done:!0}:(e=n(t,i),this._i+=e.length,{value:e,done:!1})})},{106:106,55:55}],245:[function(e,t,exports){"use strict";e(108)("link",function(e){return function(t){return e(this,"a","href",t)}})},{108:108}],246:[function(e,t,exports){var n=e(33),i=e(117),r=e(118);n(n.S,"String",{raw:function(e){for(var t=i(e.raw),n=r(t.length),s=arguments.length,o=[],a=0;n>a;)o.push(String(t[a++])),a<s&&o.push(String(arguments[a]));return o.join("")}})},{117:117,118:118,33:33}],247:[function(e,t,exports){var n=e(33);n(n.P,"String",{repeat:e(110)})},{110:110,33:33}],248:[function(e,t,exports){"use strict";e(108)("small",function(e){return function(){return e(this,"small","","")}})},{108:108}],249:[function(e,t,exports){"use strict";var n=e(33),i=e(118),r=e(107),s="".startsWith;n(n.P+n.F*e(34)("startsWith"),"String",{startsWith:function(e){var t=r(this,e,"startsWith"),n=i(Math.min(arguments.length>1?arguments[1]:void 0,t.length)),o=String(e);return s?s.call(t,o,n):t.slice(n,n+o.length)===o}})},{107:107,118:118,33:33,34:34}],250:[function(e,t,exports){"use strict";e(108)("strike",function(e){return function(){return e(this,"strike","","")}})},{108:108}],251:[function(e,t,exports){"use strict";e(108)("sub",function(e){return function(){return e(this,"sub","","")}})},{108:108}],252:[function(e,t,exports){"use strict";e(108)("sup",function(e){return function(){return e(this,"sup","","")}})},{108:108}],253:[function(e,t,exports){"use strict";e(111)("trim",function(e){return function(){return e(this,3)}})},{111:111}],254:[function(e,t,exports){"use strict";var n=e(40),i=e(41),r=e(29),s=e(33),o=e(94),a=e(66).KEY,c=e(35),l=e(103),u=e(101),h=e(124),d=e(128),f=e(127),p=e(126),g=e(59),m=e(32),_=e(49),v=e(7),y=e(117),b=e(120),S=e(92),C=e(71),w=e(76),T=e(75),k=e(72),E=e(81),A=T.f,x=k.f,R=w.f,I=n.Symbol,L=n.JSON,M=L&&L.stringify,P=d("_hidden"),O=d("toPrimitive"),D={}.propertyIsEnumerable,N=l("symbol-registry"),F=l("symbols"),j=l("op-symbols"),U=Object.prototype,q="function"==typeof I,V=n.QObject,B=!V||!V.prototype||!V.prototype.findChild,H=r&&c(function(){return 7!=C(x({},"a",{get:function(){return x(this,"a",{value:7}).a}})).a})?function(e,t,n){var i=A(U,t);i&&delete U[t],x(e,t,n),i&&e!==U&&x(U,t,i)}:x,W=function(e){var t=F[e]=C(I.prototype);return t._k=e,t},G=q&&"symbol"==typeof I.iterator?function(e){return"symbol"==typeof e}:function(e){return e instanceof I},z=function(e,t,n){return e===U&&z(j,t,n),v(e),t=b(t,!0),v(n),i(F,t)?(n.enumerable?(i(e,P)&&e[P][t]&&(e[P][t]=!1),n=C(n,{enumerable:S(0,!1)})):(i(e,P)||x(e,P,S(1,{})),e[P][t]=!0),H(e,t,n)):x(e,t,n)},K=function(e,t){v(e);for(var n,i=m(t=y(t)),r=0,s=i.length;s>r;)z(e,n=i[r++],t[n]);return e},Y=function(e){var t=D.call(this,e=b(e,!0));return!(this===U&&i(F,e)&&!i(j,e))&&(!(t||!i(this,e)||!i(F,e)||i(this,P)&&this[P][e])||t)},J=function(e,t){if(e=y(e),t=b(t,!0),e!==U||!i(F,t)||i(j,t)){var n=A(e,t);return!n||!i(F,t)||i(e,P)&&e[P][t]||(n.enumerable=!0),n}},Q=function(e){for(var t,n=R(y(e)),r=[],s=0;n.length>s;)i(F,t=n[s++])||t==P||t==a||r.push(t);return r},X=function(e){for(var t,n=e===U,r=R(n?j:y(e)),s=[],o=0;r.length>o;)!i(F,t=r[o++])||n&&!i(U,t)||s.push(F[t]);return s};q||(o((I=function(){if(this instanceof I)throw TypeError("Symbol is not a constructor!");var e=h(arguments.length>0?arguments[0]:void 0),t=function(n){this===U&&t.call(j,n),i(this,P)&&i(this[P],e)&&(this[P][e]=!1),H(this,e,S(1,n))};return r&&B&&H(U,e,{configurable:!0,set:t}),W(e)}).prototype,"toString",function(){return this._k}),T.f=J,k.f=z,e(77).f=w.f=Q,e(82).f=Y,e(78).f=X,r&&!e(60)&&o(U,"propertyIsEnumerable",Y,!0),f.f=function(e){return W(d(e))}),s(s.G+s.W+s.F*!q,{Symbol:I});for(var Z="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),ee=0;Z.length>ee;)d(Z[ee++]);for(var te=E(d.store),ne=0;te.length>ne;)p(te[ne++]);s(s.S+s.F*!q,"Symbol",{for:function(e){return i(N,e+="")?N[e]:N[e]=I(e)},keyFor:function(e){if(G(e))return g(N,e);throw TypeError(e+" is not a symbol!")},useSetter:function(){B=!0},useSimple:function(){B=!1}}),s(s.S+s.F*!q,"Object",{create:function(e,t){return void 0===t?C(e):K(C(e),t)},defineProperty:z,defineProperties:K,getOwnPropertyDescriptor:J,getOwnPropertyNames:Q,getOwnPropertySymbols:X}),L&&s(s.S+s.F*(!q||c(function(){var e=I();return"[null]"!=M([e])||"{}"!=M({a:e})||"{}"!=M(Object(e))})),"JSON",{stringify:function(e){if(void 0!==e&&!G(e)){for(var t,n,i=[e],r=1;arguments.length>r;)i.push(arguments[r++]);return"function"==typeof(t=i[1])&&(n=t),!n&&_(t)||(t=function(e,t){if(n&&(t=n.call(this,e,t)),!G(t))return t}),i[1]=t,M.apply(L,i)}}}),I.prototype[O]||e(42)(I.prototype,O,I.prototype.valueOf),u(I,"Symbol"),u(Math,"Math",!0),u(n.JSON,"JSON",!0)},{101:101,103:103,117:117,120:120,124:124,126:126,127:127,128:128,29:29,32:32,33:33,35:35,40:40,41:41,42:42,49:49,59:59,60:60,66:66,7:7,71:71,72:72,75:75,76:76,77:77,78:78,81:81,82:82,92:92,94:94}],255:[function(e,t,exports){"use strict";var n=e(33),i=e(123),r=e(122),s=e(7),o=e(114),a=e(118),c=e(51),l=e(40).ArrayBuffer,u=e(104),h=r.ArrayBuffer,d=r.DataView,f=i.ABV&&l.isView,p=h.prototype.slice,g=i.VIEW;n(n.G+n.W+n.F*(l!==h),{ArrayBuffer:h}),n(n.S+n.F*!i.CONSTR,"ArrayBuffer",{isView:function(e){return f&&f(e)||c(e)&&g in e}}),n(n.P+n.U+n.F*e(35)(function(){return!new h(2).slice(1,void 0).byteLength}),"ArrayBuffer",{slice:function(e,t){if(void 0!==p&&void 0===t)return p.call(s(this),e);for(var n=s(this).byteLength,i=o(e,n),r=o(void 0===t?n:t,n),c=new(u(this,h))(a(r-i)),l=new d(this),f=new d(c),g=0;i<r;)f.setUint8(g++,l.getUint8(i++));return c}}),e(100)("ArrayBuffer")},{100:100,104:104,114:114,118:118,122:122,123:123,33:33,35:35,40:40,51:51,7:7}],256:[function(e,t,exports){var n=e(33);n(n.G+n.W+n.F*!e(123).ABV,{DataView:e(122).DataView})},{122:122,123:123,33:33}],257:[function(e,t,exports){e(121)("Float32",4,function(e){return function(t,n,i){return e(this,t,n,i)}})},{121:121}],258:[function(e,t,exports){e(121)("Float64",8,function(e){return function(t,n,i){return e(this,t,n,i)}})},{121:121}],259:[function(e,t,exports){e(121)("Int16",2,function(e){return function(t,n,i){return e(this,t,n,i)}})},{121:121}],260:[function(e,t,exports){e(121)("Int32",4,function(e){return function(t,n,i){return e(this,t,n,i)}})},{121:121}],261:[function(e,t,exports){e(121)("Int8",1,function(e){return function(t,n,i){return e(this,t,n,i)}})},{121:121}],262:[function(e,t,exports){e(121)("Uint16",2,function(e){return function(t,n,i){return e(this,t,n,i)}})},{121:121}],263:[function(e,t,exports){e(121)("Uint32",4,function(e){return function(t,n,i){return e(this,t,n,i)}})},{121:121}],264:[function(e,t,exports){e(121)("Uint8",1,function(e){return function(t,n,i){return e(this,t,n,i)}})},{121:121}],265:[function(e,t,exports){e(121)("Uint8",1,function(e){return function(t,n,i){return e(this,t,n,i)}},!0)},{121:121}],266:[function(e,t,exports){"use strict";var n,i=e(12)(0),r=e(94),s=e(66),o=e(70),a=e(21),c=e(51),l=e(35),u=e(125),h=s.getWeak,d=Object.isExtensible,f=a.ufstore,p={},g=function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},m={get:function(e){if(c(e)){var t=h(e);return!0===t?f(u(this,"WeakMap")).get(e):t?t[this._i]:void 0}},set:function(e,t){return a.def(u(this,"WeakMap"),e,t)}},_=t.exports=e(22)("WeakMap",g,m,a,!0,!0);l(function(){return 7!=(new _).set((Object.freeze||Object)(p),7).get(p)})&&(o((n=a.getConstructor(g,"WeakMap")).prototype,m),s.NEED=!0,i(["delete","has","get","set"],function(e){var t=_.prototype,i=t[e];r(t,e,function(t,r){if(c(t)&&!d(t)){this._f||(this._f=new n);var s=this._f[e](t,r);return"set"==e?this:s}return i.call(this,t,r)})}))},{12:12,125:125,21:21,22:22,35:35,51:51,66:66,70:70,94:94}],267:[function(e,t,exports){"use strict";var n=e(21),i=e(125);e(22)("WeakSet",function(e){return function(){return e(this,arguments.length>0?arguments[0]:void 0)}},{add:function(e){return n.def(i(this,"WeakSet"),e,!0)}},n,!1,!0)},{125:125,21:21,22:22}],268:[function(e,t,exports){"use strict";var n=e(33),i=e(38),r=e(119),s=e(118),o=e(3),a=e(15);n(n.P,"Array",{flatMap:function(e){var t,n,c=r(this);return o(e),t=s(c.length),n=a(c,0),i(n,c,c,t,0,1,e,arguments[1]),n}}),e(5)("flatMap")},{118:118,119:119,15:15,3:3,33:33,38:38,5:5}],269:[function(e,t,exports){"use strict";var n=e(33),i=e(38),r=e(119),s=e(118),o=e(116),a=e(15);n(n.P,"Array",{flatten:function(){var e=arguments[0],t=r(this),n=s(t.length),c=a(t,0);return i(c,t,t,n,0,void 0===e?1:o(e)),c}}),e(5)("flatten")},{116:116,118:118,119:119,15:15,33:33,38:38,5:5}],270:[function(e,t,exports){"use strict";var n=e(33),i=e(11)(!0);n(n.P,"Array",{includes:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0)}}),e(5)("includes")},{11:11,33:33,5:5}],271:[function(e,t,exports){var n=e(33),i=e(68)(),r=e(40).process,s="process"==e(18)(r);n(n.G,{asap:function(e){var t=s&&r.domain;i(t?t.bind(e):e)}})},{18:18,33:33,40:40,68:68}],272:[function(e,t,exports){var n=e(33),i=e(18);n(n.S,"Error",{isError:function(e){return"Error"===i(e)}})},{18:18,33:33}],273:[function(e,t,exports){var n=e(33);n(n.G,{global:e(40)})},{33:33,40:40}],274:[function(e,t,exports){e(97)("Map")},{97:97}],275:[function(e,t,exports){e(98)("Map")},{98:98}],276:[function(e,t,exports){var n=e(33);n(n.P+n.R,"Map",{toJSON:e(20)("Map")})},{20:20,33:33}],277:[function(e,t,exports){var n=e(33);n(n.S,"Math",{clamp:function(e,t,n){return Math.min(n,Math.max(t,e))}})},{33:33}],278:[function(e,t,exports){var n=e(33);n(n.S,"Math",{DEG_PER_RAD:Math.PI/180})},{33:33}],279:[function(e,t,exports){var n=e(33),i=180/Math.PI;n(n.S,"Math",{degrees:function(e){return e*i}})},{33:33}],280:[function(e,t,exports){var n=e(33),i=e(64),r=e(62);n(n.S,"Math",{fscale:function(e,t,n,s,o){return r(i(e,t,n,s,o))}})},{33:33,62:62,64:64}],281:[function(e,t,exports){var n=e(33);n(n.S,"Math",{iaddh:function(e,t,n,i){var r=e>>>0,s=n>>>0;return(t>>>0)+(i>>>0)+((r&s|(r|s)&~(r+s>>>0))>>>31)|0}})},{33:33}],282:[function(e,t,exports){var n=e(33);n(n.S,"Math",{imulh:function(e,t){var n=+e,i=+t,r=65535&n,s=65535&i,o=n>>16,a=i>>16,c=(o*s>>>0)+(r*s>>>16);return o*a+(c>>16)+((r*a>>>0)+(65535&c)>>16)}})},{33:33}],283:[function(e,t,exports){var n=e(33);n(n.S,"Math",{isubh:function(e,t,n,i){var r=e>>>0,s=n>>>0;return(t>>>0)-(i>>>0)-((~r&s|~(r^s)&r-s>>>0)>>>31)|0}})},{33:33}],284:[function(e,t,exports){var n=e(33);n(n.S,"Math",{RAD_PER_DEG:180/Math.PI})},{33:33}],285:[function(e,t,exports){var n=e(33),i=Math.PI/180;n(n.S,"Math",{radians:function(e){return e*i}})},{33:33}],286:[function(e,t,exports){var n=e(33);n(n.S,"Math",{scale:e(64)})},{33:33,64:64}],287:[function(e,t,exports){var n=e(33);n(n.S,"Math",{signbit:function(e){return(e=+e)!=e?e:0==e?1/e==1/0:e>0}})},{33:33}],288:[function(e,t,exports){var n=e(33);n(n.S,"Math",{umulh:function(e,t){var n=+e,i=+t,r=65535&n,s=65535&i,o=n>>>16,a=i>>>16,c=(o*s>>>0)+(r*s>>>16);return o*a+(c>>>16)+((r*a>>>0)+(65535&c)>>>16)}})},{33:33}],289:[function(e,t,exports){"use strict";var n=e(33),i=e(119),r=e(3),s=e(72);e(29)&&n(n.P+e(74),"Object",{__defineGetter__:function(e,t){s.f(i(this),e,{get:r(t),enumerable:!0,configurable:!0})}})},{119:119,29:29,3:3,33:33,72:72,74:74}],290:[function(e,t,exports){"use strict";var n=e(33),i=e(119),r=e(3),s=e(72);e(29)&&n(n.P+e(74),"Object",{__defineSetter__:function(e,t){s.f(i(this),e,{set:r(t),enumerable:!0,configurable:!0})}})},{119:119,29:29,3:3,33:33,72:72,74:74}],291:[function(e,t,exports){var n=e(33),i=e(84)(!0);n(n.S,"Object",{entries:function(e){return i(e)}})},{33:33,84:84}],292:[function(e,t,exports){var n=e(33),i=e(85),r=e(117),s=e(75),o=e(24);n(n.S,"Object",{getOwnPropertyDescriptors:function(e){for(var t,n,a=r(e),c=s.f,l=i(a),u={},h=0;l.length>h;)void 0!==(n=c(a,t=l[h++]))&&o(u,t,n);return u}})},{117:117,24:24,33:33,75:75,85:85}],293:[function(e,t,exports){"use strict";var n=e(33),i=e(119),r=e(120),s=e(79),o=e(75).f;e(29)&&n(n.P+e(74),"Object",{__lookupGetter__:function(e){var t,n=i(this),a=r(e,!0);do{if(t=o(n,a))return t.get}while(n=s(n))}})},{119:119,120:120,29:29,33:33,74:74,75:75,79:79}],294:[function(e,t,exports){"use strict";var n=e(33),i=e(119),r=e(120),s=e(79),o=e(75).f;e(29)&&n(n.P+e(74),"Object",{__lookupSetter__:function(e){var t,n=i(this),a=r(e,!0);do{if(t=o(n,a))return t.set}while(n=s(n))}})},{119:119,120:120,29:29,33:33,74:74,75:75,79:79}],295:[function(e,t,exports){var n=e(33),i=e(84)(!1);n(n.S,"Object",{values:function(e){return i(e)}})},{33:33,84:84}],296:[function(e,t,exports){"use strict";var n=e(33),i=e(40),r=e(23),s=e(68)(),o=e(128)("observable"),a=e(3),c=e(7),l=e(6),u=e(93),h=e(42),d=e(39),f=d.RETURN,p=function(e){return null==e?void 0:a(e)},g=function(e){var t=e._c;t&&(e._c=void 0,t())},m=function(e){return void 0===e._o},_=function(e){m(e)||(e._o=void 0,g(e))},v=function(e,t){c(e),this._c=void 0,this._o=e,e=new y(this);try{var n=t(e),i=n;null!=n&&("function"==typeof n.unsubscribe?n=function(){i.unsubscribe()}:a(n),this._c=n)}catch(t){return void e.error(t)}m(this)&&g(this)};v.prototype=u({},{unsubscribe:function(){_(this)}});var y=function(e){this._s=e};y.prototype=u({},{next:function(e){var t=this._s;if(!m(t)){var n=t._o;try{var i=p(n.next);if(i)return i.call(n,e)}catch(e){try{_(t)}finally{throw e}}}},error:function(e){var t=this._s;if(m(t))throw e;var n=t._o;t._o=void 0;try{var i=p(n.error);if(!i)throw e;e=i.call(n,e)}catch(e){try{g(t)}finally{throw e}}return g(t),e},complete:function(e){var t=this._s;if(!m(t)){var n=t._o;t._o=void 0;try{var i=p(n.complete);e=i?i.call(n,e):void 0}catch(e){try{g(t)}finally{throw e}}return g(t),e}}});var b=function(e){l(this,b,"Observable","_f")._f=a(e)};u(b.prototype,{subscribe:function(e){return new v(e,this._f)},forEach:function(e){var t=this;return new(r.Promise||i.Promise)(function(n,i){a(e);var r=t.subscribe({next:function(t){try{return e(t)}catch(e){i(e),r.unsubscribe()}},error:i,complete:n})})}}),u(b,{from:function(e){var t="function"==typeof this?this:b,n=p(c(e)[o]);if(n){var i=c(n.call(e));return i.constructor===t?i:new t(function(e){return i.subscribe(e)})}return new t(function(t){var n=!1;return s(function(){if(!n){try{if(d(e,!1,function(e){if(t.next(e),n)return f})===f)return}catch(e){if(n)throw e;return void t.error(e)}t.complete()}}),function(){n=!0}})},of:function(){for(var e=0,t=arguments.length,n=Array(t);e<t;)n[e]=arguments[e++];return new("function"==typeof this?this:b)(function(e){var t=!1;return s(function(){if(!t){for(var i=0;i<n.length;++i)if(e.next(n[i]),t)return;e.complete()}}),function(){t=!0}})}}),h(b.prototype,o,function(){return this}),n(n.G,{Observable:b}),e(100)("Observable")},{100:100,128:128,23:23,3:3,33:33,39:39,40:40,42:42,6:6,68:68,7:7,93:93}],297:[function(e,t,exports){"use strict";var n=e(33),i=e(23),r=e(40),s=e(104),o=e(91);n(n.P+n.R,"Promise",{finally:function(e){var t=s(this,i.Promise||r.Promise),n="function"==typeof e;return this.then(n?function(n){return o(t,e()).then(function(){return n})}:e,n?function(n){return o(t,e()).then(function(){throw n})}:e)}})},{104:104,23:23,33:33,40:40,91:91}],298:[function(e,t,exports){"use strict";var n=e(33),i=e(69),r=e(90);n(n.S,"Promise",{try:function(e){var t=i.f(this),n=r(e);return(n.e?t.reject:t.resolve)(n.v),t.promise}})},{33:33,69:69,90:90}],299:[function(e,t,exports){var n=e(67),i=e(7),r=n.key,s=n.set;n.exp({defineMetadata:function(e,t,n,o){s(e,t,i(n),r(o))}})},{67:67,7:7}],300:[function(e,t,exports){var n=e(67),i=e(7),r=n.key,s=n.map,o=n.store;n.exp({deleteMetadata:function(e,t){var n=arguments.length<3?void 0:r(arguments[2]),a=s(i(t),n,!1);if(void 0===a||!a.delete(e))return!1;if(a.size)return!0;var c=o.get(t);return c.delete(n),!!c.size||o.delete(t)}})},{67:67,7:7}],301:[function(e,t,exports){var n=e(231),i=e(10),r=e(67),s=e(7),o=e(79),a=r.keys,c=r.key,l=function(e,t){var r=a(e,t),s=o(e);if(null===s)return r;var c=l(s,t);return c.length?r.length?i(new n(r.concat(c))):c:r};r.exp({getMetadataKeys:function(e){return l(s(e),arguments.length<2?void 0:c(arguments[1]))}})},{10:10,231:231,67:67,7:7,79:79}],302:[function(e,t,exports){var n=e(67),i=e(7),r=e(79),s=n.has,o=n.get,a=n.key,c=function(e,t,n){if(s(e,t,n))return o(e,t,n);var i=r(t);return null!==i?c(e,i,n):void 0};n.exp({getMetadata:function(e,t){return c(e,i(t),arguments.length<3?void 0:a(arguments[2]))}})},{67:67,7:7,79:79}],303:[function(e,t,exports){var n=e(67),i=e(7),r=n.keys,s=n.key;n.exp({getOwnMetadataKeys:function(e){return r(i(e),arguments.length<2?void 0:s(arguments[1]))}})},{67:67,7:7}],304:[function(e,t,exports){var n=e(67),i=e(7),r=n.get,s=n.key;n.exp({getOwnMetadata:function(e,t){return r(e,i(t),arguments.length<3?void 0:s(arguments[2]))}})},{67:67,7:7}],305:[function(e,t,exports){var n=e(67),i=e(7),r=e(79),s=n.has,o=n.key,a=function(e,t,n){if(s(e,t,n))return!0;var i=r(t);return null!==i&&a(e,i,n)};n.exp({hasMetadata:function(e,t){return a(e,i(t),arguments.length<3?void 0:o(arguments[2]))}})},{67:67,7:7,79:79}],306:[function(e,t,exports){var n=e(67),i=e(7),r=n.has,s=n.key;n.exp({hasOwnMetadata:function(e,t){return r(e,i(t),arguments.length<3?void 0:s(arguments[2]))}})},{67:67,7:7}],307:[function(e,t,exports){var n=e(67),i=e(7),r=e(3),s=n.key,o=n.set;n.exp({metadata:function(e,t){return function(n,a){o(e,t,(void 0!==a?i:r)(n),s(a))}}})},{3:3,67:67,7:7}],308:[function(e,t,exports){e(97)("Set")},{97:97}],309:[function(e,t,exports){e(98)("Set")},{98:98}],310:[function(e,t,exports){var n=e(33);n(n.P+n.R,"Set",{toJSON:e(20)("Set")})},{20:20,33:33}],311:[function(e,t,exports){"use strict";var n=e(33),i=e(106)(!0);n(n.P,"String",{at:function(e){return i(this,e)}})},{106:106,33:33}],312:[function(e,t,exports){"use strict";var n=e(33),i=e(28),r=e(118),s=e(52),o=e(37),a=RegExp.prototype,c=function(e,t){this._r=e,this._s=t};e(54)(c,"RegExp String",function(){var e=this._r.exec(this._s);return{value:e,done:null===e}}),n(n.P,"String",{matchAll:function(e){if(i(this),!s(e))throw TypeError(e+" is not a regexp!");var t=String(this),n="flags"in a?String(e.flags):o.call(e),l=new RegExp(e.source,~n.indexOf("g")?n:"g"+n);return l.lastIndex=r(e.lastIndex),new c(l,t)}})},{118:118,28:28,33:33,37:37,52:52,54:54}],313:[function(e,t,exports){"use strict";var n=e(33),i=e(109);n(n.P,"String",{padEnd:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0,!1)}})},{109:109,33:33}],314:[function(e,t,exports){"use strict";var n=e(33),i=e(109);n(n.P,"String",{padStart:function(e){return i(this,e,arguments.length>1?arguments[1]:void 0,!0)}})},{109:109,33:33}],315:[function(e,t,exports){"use strict";e(111)("trimLeft",function(e){return function(){return e(this,1)}},"trimStart")},{111:111}],316:[function(e,t,exports){"use strict";e(111)("trimRight",function(e){return function(){return e(this,2)}},"trimEnd")},{111:111}],317:[function(e,t,exports){e(126)("asyncIterator")},{126:126}],318:[function(e,t,exports){e(126)("observable")},{126:126}],319:[function(e,t,exports){var n=e(33);n(n.S,"System",{global:e(40)})},{33:33,40:40}],320:[function(e,t,exports){e(97)("WeakMap")},{97:97}],321:[function(e,t,exports){e(98)("WeakMap")},{98:98}],322:[function(e,t,exports){e(97)("WeakSet")},{97:97}],323:[function(e,t,exports){e(98)("WeakSet")},{98:98}],324:[function(e,t,exports){for(var n=e(141),i=e(81),r=e(94),s=e(40),o=e(42),a=e(58),c=e(128),l=c("iterator"),u=c("toStringTag"),h=a.Array,d={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},f=i(d),p=0;p<f.length;p++){var g,m=f[p],_=d[m],v=s[m],y=v&&v.prototype;if(y&&(y[l]||o(y,l,h),y[u]||o(y,u,m),a[m]=h,_))for(g in n)y[g]||r(y,g,n[g],!0)}},{128:128,141:141,40:40,42:42,58:58,81:81,94:94}],325:[function(e,t,exports){var n=e(33),i=e(113);n(n.G+n.B,{setImmediate:i.set,clearImmediate:i.clear})},{113:113,33:33}],326:[function(e,t,exports){var n=e(40),i=e(33),r=e(46),s=e(88),o=n.navigator,a=!!o&&/MSIE .\./.test(o.userAgent),c=function(e){return a?function(t,n){return e(r(s,[].slice.call(arguments,2),"function"==typeof t?t:Function(t)),n)}:e};i(i.G+i.B+i.F*a,{setTimeout:c(n.setTimeout),setInterval:c(n.setInterval)})},{33:33,40:40,46:46,88:88}],327:[function(e,t,exports){e(254),e(191),e(193),e(192),e(195),e(197),e(202),e(196),e(194),e(204),e(203),e(199),e(200),e(198),e(190),e(201),e(205),e(206),e(157),e(159),e(158),e(208),e(207),e(178),e(188),e(189),e(179),e(180),e(181),e(182),e(183),e(184),e(185),e(186),e(187),e(161),e(162),e(163),e(164),e(165),e(166),e(167),e(168),e(169),e(170),e(171),e(172),e(173),e(174),e(175),e(176),e(177),e(241),e(246),e(253),e(244),e(236),e(237),e(242),e(247),e(249),e(232),e(233),e(234),e(235),e(238),e(239),e(240),e(243),e(245),e(248),e(250),e(251),e(252),e(152),e(154),e(153),e(156),e(155),e(140),e(138),e(145),e(142),e(148),e(150),e(137),e(144),e(134),e(149),e(132),e(147),e(146),e(139),e(143),e(131),e(133),e(136),e(135),e(151),e(141),e(224),e(230),e(225),e(226),e(227),e(228),e(229),e(209),e(160),e(231),e(266),e(267),e(255),e(256),e(261),e(264),e(265),e(259),e(262),e(260),e(263),e(257),e(258),e(210),e(211),e(212),e(213),e(214),e(217),e(215),e(216),e(218),e(219),e(220),e(221),e(223),e(222),e(270),e(268),e(269),e(311),e(314),e(313),e(315),e(316),e(312),e(317),e(318),e(292),e(295),e(291),e(289),e(290),e(293),e(294),e(276),e(310),e(275),e(309),e(321),e(323),e(274),e(308),e(320),e(322),e(273),e(319),e(272),e(277),e(278),e(279),e(280),e(281),e(283),e(282),e(284),e(285),e(286),e(288),e(287),e(297),e(298),e(299),e(300),e(302),e(301),e(304),e(303),e(305),e(306),e(307),e(271),e(296),e(326),e(325),e(324),t.exports=e(23)},{131:131,132:132,133:133,134:134,135:135,136:136,137:137,138:138,139:139,140:140,141:141,142:142,143:143,144:144,145:145,146:146,147:147,148:148,149:149,150:150,151:151,152:152,153:153,154:154,155:155,156:156,157:157,158:158,159:159,160:160,161:161,162:162,163:163,164:164,165:165,166:166,167:167,168:168,169:169,170:170,171:171,172:172,173:173,174:174,175:175,176:176,177:177,178:178,179:179,180:180,181:181,182:182,183:183,184:184,185:185,186:186,187:187,188:188,189:189,190:190,191:191,192:192,193:193,194:194,195:195,196:196,197:197,198:198,199:199,200:200,201:201,202:202,203:203,204:204,205:205,206:206,207:207,208:208,209:209,210:210,211:211,212:212,213:213,214:214,215:215,216:216,217:217,218:218,219:219,220:220,221:221,222:222,223:223,224:224,225:225,226:226,227:227,228:228,229:229,23:23,230:230,231:231,232:232,233:233,234:234,235:235,236:236,237:237,238:238,239:239,240:240,241:241,242:242,243:243,244:244,245:245,246:246,247:247,248:248,249:249,250:250,251:251,252:252,253:253,254:254,255:255,256:256,257:257,258:258,259:259,260:260,261:261,262:262,263:263,264:264,265:265,266:266,267:267,268:268,269:269,270:270,271:271,272:272,273:273,274:274,275:275,276:276,277:277,278:278,279:279,280:280,281:281,282:282,283:283,284:284,285:285,286:286,287:287,288:288,289:289,290:290,291:291,292:292,293:293,294:294,295:295,296:296,297:297,298:298,299:299,300:300,301:301,302:302,303:303,304:304,305:305,306:306,307:307,308:308,309:309,310:310,311:311,312:312,313:313,314:314,315:315,316:316,317:317,318:318,319:319,320:320,321:321,322:322,323:323,324:324,325:325,326:326}],328:[function(e,t,exports){(function(e){!function(e){"use strict";var n,i=Object.prototype,r=i.hasOwnProperty,s="function"==typeof Symbol?Symbol:{},o=s.iterator||"@@iterator",a=s.asyncIterator||"@@asyncIterator",c=s.toStringTag||"@@toStringTag",l="object"==typeof t,u=e.regeneratorRuntime;if(u)l&&(t.exports=u);else{(u=e.regeneratorRuntime=l?t.exports:{}).wrap=b;var h="suspendedStart",d="suspendedYield",f="executing",p="completed",g={},m={};m[o]=function(){return this};var _=Object.getPrototypeOf,v=_&&_(_(L([])));v&&v!==i&&r.call(v,o)&&(m=v);var y=T.prototype=C.prototype=Object.create(m);w.prototype=y.constructor=T,T.constructor=w,T[c]=w.displayName="GeneratorFunction",u.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===w||"GeneratorFunction"===(t.displayName||t.name))},u.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,T):(e.__proto__=T,c in e||(e[c]="GeneratorFunction")),e.prototype=Object.create(y),e},u.awrap=function(e){return{__await:e}},k(E.prototype),E.prototype[a]=function(){return this},u.AsyncIterator=E,u.async=function(e,t,n,i){var r=new E(b(e,t,n,i));return u.isGeneratorFunction(t)?r:r.next().then(function(e){return e.done?e.value:r.next()})},k(y),y[c]="Generator",y[o]=function(){return this},y.toString=function(){return"[object Generator]"},u.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var i=t.pop();if(i in e)return n.value=i,n.done=!1,n}return n.done=!0,n}},u.values=L,I.prototype={constructor:I,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(R),!e)for(var t in this)"t"===t.charAt(0)&&r.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function i(i,r){return a.type="throw",a.arg=e,t.next=i,r&&(t.method="next",t.arg=n),!!r}for(var s=this.tryEntries.length-1;s>=0;--s){var o=this.tryEntries[s],a=o.completion;if("root"===o.tryLoc)return i("end");if(o.tryLoc<=this.prev){var c=r.call(o,"catchLoc"),l=r.call(o,"finallyLoc");if(c&&l){if(this.prev<o.catchLoc)return i(o.catchLoc,!0);if(this.prev<o.finallyLoc)return i(o.finallyLoc)}else if(c){if(this.prev<o.catchLoc)return i(o.catchLoc,!0)}else{if(!l)throw new Error("try statement without catch or finally");if(this.prev<o.finallyLoc)return i(o.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var i=this.tryEntries[n];if(i.tryLoc<=this.prev&&r.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var s=i;break}}s&&("break"===e||"continue"===e)&&s.tryLoc<=t&&t<=s.finallyLoc&&(s=null);var o=s?s.completion:{};return o.type=e,o.arg=t,s?(this.method="next",this.next=s.finallyLoc,g):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),g},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),R(n),g}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var i=n.completion;if("throw"===i.type){var r=i.arg;R(n)}return r}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,i){return this.delegate={iterator:L(e),resultName:t,nextLoc:i},"next"===this.method&&(this.arg=n),g}}}function b(e,t,n,i){var r=t&&t.prototype instanceof C?t:C,s=Object.create(r.prototype),o=new I(i||[]);return s._invoke=function(e,t,n){var i=h;return function(r,s){if(i===f)throw new Error("Generator is already running");if(i===p){if("throw"===r)throw s;return M()}for(n.method=r,n.arg=s;;){var o=n.delegate;if(o){var a=A(o,n);if(a){if(a===g)continue;return a}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===h)throw i=p,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=f;var c=S(e,t,n);if("normal"===c.type){if(i=n.done?p:d,c.arg===g)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(i=p,n.method="throw",n.arg=c.arg)}}}(e,n,o),s}function S(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function C(){}function w(){}function T(){}function k(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function E(t){function n(e,i,s,o){var a=S(t[e],t,i);if("throw"!==a.type){var c=a.arg,l=c.value;return l&&"object"==typeof l&&r.call(l,"__await")?Promise.resolve(l.__await).then(function(e){n("next",e,s,o)},function(e){n("throw",e,s,o)}):Promise.resolve(l).then(function(e){c.value=e,s(c)},o)}o(a.arg)}var i;"object"==typeof e.process&&e.process.domain&&(n=e.process.domain.bind(n)),this._invoke=function(e,t){function r(){return new Promise(function(i,r){n(e,t,i,r)})}return i=i?i.then(r,r):r()}}function A(e,t){var i=e.iterator[t.method];if(i===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=n,A(e,t),"throw"===t.method))return g;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return g}var r=S(i,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,g;var s=r.arg;return s?s.done?(t[e.resultName]=s.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,g):s:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,g)}function x(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function R(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function I(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(x,this),this.reset(!0)}function L(e){if(e){var t=e[o];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function t(){for(;++i<e.length;)if(r.call(e,i))return t.value=e[i],t.done=!1,t;return t.value=n,t.done=!0,t};return s.next=s}}return{next:M}}function M(){return{value:n,done:!0}}}("object"==typeof e?e:"object"==typeof window?window:"object"==typeof self?self:this)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1]);var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},requirejs,require,define,globals,fsutil,_lazyLoader;function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _toConsumableArray(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}!function(global){var req,s,head,baseElement,dataMain,src,interactiveScript,currentlyAddingScript,mainScript,subPath,version="2.1.20",commentRegExp=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,cjsRequireRegExp=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,jsSuffixRegExp=/\.js$/,currDirRegExp=/^\.\//,op=Object.prototype,ostring=op.toString,hasOwn=op.hasOwnProperty,ap=Array.prototype,isBrowser=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),isWebWorker=!isBrowser&&"undefined"!=typeof importScripts,readyRegExp=isBrowser&&"PLAYSTATION 3"===navigator.platform?/^complete$/:/^(complete|loaded)$/,defContextName="_",isOpera="undefined"!=typeof opera&&"[object Opera]"===opera.toString(),contexts={},cfg={},globalDefQueue=[],useInteractive=!1;function isFunction(e){return"[object Function]"===ostring.call(e)}function isArray(e){return"[object Array]"===ostring.call(e)}function each(e,t){var n;if(e)for(n=0;n<e.length&&(!e[n]||!t(e[n],n,e));n+=1);}function eachReverse(e,t){var n;if(e)for(n=e.length-1;n>-1&&(!e[n]||!t(e[n],n,e));n-=1);}function hasProp(e,t){return hasOwn.call(e,t)}function getOwn(e,t){return hasProp(e,t)&&e[t]}function eachProp(e,t){var n;for(n in e)if(hasProp(e,n)&&t(e[n],n))break}function mixin(e,t,n,i){return t&&eachProp(t,function(t,r){!n&&hasProp(e,r)||(!i||"object"!==(void 0===t?"undefined":_typeof(t))||!t||isArray(t)||isFunction(t)||t instanceof RegExp?e[r]=t:(e[r]||(e[r]={}),mixin(e[r],t,n,i)))}),e}function bind(e,t){return function(){return t.apply(e,arguments)}}function scripts(){return document.getElementsByTagName("script")}function defaultOnError(e){throw e}function getGlobal(e){if(!e)return e;var t=global;return each(e.split("."),function(e){t=t[e]}),t}function makeError(e,t,n,i){var r=new Error(t+"\nhttp://requirejs.org/docs/errors.html#"+e);return r.requireType=e,r.requireModules=i,n&&(r.originalError=n),r}if(void 0===define){if(void 0!==requirejs){if(isFunction(requirejs))return;cfg=requirejs,requirejs=void 0}void 0===require||isFunction(require)||(cfg=require,require=void 0),req=requirejs=function(e,t,n,i){var r,s,o=defContextName;return isArray(e)||"string"==typeof e||(s=e,isArray(t)?(e=t,t=n,n=i):e=[]),s&&s.context&&(o=s.context),(r=getOwn(contexts,o))||(r=contexts[o]=req.s.newContext(o)),s&&r.configure(s),r.require(e,t,n)},req.config=function(e){return req(e)},req.nextTick="undefined"!=typeof setTimeout?function(e){setTimeout(e,4)}:function(e){e()},require||(require=req),req.version=version,req.jsExtRegExp=/^\/|:|\?|\.js$/,req.isBrowser=isBrowser,s=req.s={contexts:contexts,newContext:newContext},req({}),each(["toUrl","undef","defined","specified"],function(e){req[e]=function(){var t=contexts[defContextName];return t.require[e].apply(t,arguments)}}),isBrowser&&(head=s.head=document.getElementsByTagName("head")[0],baseElement=document.getElementsByTagName("base")[0],baseElement&&(head=s.head=baseElement.parentNode)),req.onError=defaultOnError,req.createNode=function(e,t,n){var i=e.xhtml?document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):document.createElement("script");return i.type=e.scriptType||"text/javascript",i.charset="utf-8",i.async=!0,i},req.load=function(e,t,n){var i,r=e&&e.config||{};if(isBrowser)return i=req.createNode(r,t,n),r.onNodeCreated&&r.onNodeCreated(i,r,t,n),i.setAttribute("data-requirecontext",e.contextName),i.setAttribute("data-requiremodule",t),!i.attachEvent||i.attachEvent.toString&&i.attachEvent.toString().indexOf("[native code")<0||isOpera?(i.addEventListener("load",e.onScriptLoad,!1),i.addEventListener("error",e.onScriptError,!1)):(useInteractive=!0,i.attachEvent("onreadystatechange",e.onScriptLoad)),i.src=n,currentlyAddingScript=i,baseElement?head.insertBefore(i,baseElement):head.appendChild(i),currentlyAddingScript=null,i;if(isWebWorker)try{importScripts(n),e.completeLoad(t)}catch(i){e.onError(makeError("importscripts","importScripts failed for "+t+" at "+n,i,[t]))}},isBrowser&&!cfg.skipDataMain&&eachReverse(scripts(),function(e){if(head||(head=e.parentNode),dataMain=e.getAttribute("data-main"))return mainScript=dataMain,cfg.baseUrl||(src=mainScript.split("/"),mainScript=src.pop(),subPath=src.length?src.join("/")+"/":"./",cfg.baseUrl=subPath),mainScript=mainScript.replace(jsSuffixRegExp,""),req.jsExtRegExp.test(mainScript)&&(mainScript=dataMain),cfg.deps=cfg.deps?cfg.deps.concat(mainScript):[mainScript],!0}),define=function(e,t,n){var i,r;"string"!=typeof e&&(n=t,t=e,e=null),isArray(t)||(n=t,t=null),!t&&isFunction(n)&&(t=[],n.length&&(n.toString().replace(commentRegExp,"").replace(cjsRequireRegExp,function(e,n){t.push(n)}),t=(1===n.length?["require"]:["require","exports","module"]).concat(t))),useInteractive&&(i=currentlyAddingScript||getInteractiveScript())&&(e||(e=i.getAttribute("data-requiremodule")),r=contexts[i.getAttribute("data-requirecontext")]),r?(r.defQueue.push([e,t,n]),r.defQueueMap[e]=!0):globalDefQueue.push([e,t,n])},define.amd={jQuery:!0},req.exec=function(text){return eval(text)},req(cfg)}function newContext(e){var t,n,i,r,s,o={waitSeconds:7,baseUrl:"./",paths:{},bundles:{},pkgs:{},shim:{},config:{}},a={},c={},l={},u=[],h={},d={},f={},p=1,g=1;function m(e,t,n){var i,r,s,a,c,l,u,h,d,f,p=t&&t.split("/"),g=o.map,m=g&&g["*"];if(e&&(l=(e=e.split("/")).length-1,o.nodeIdCompat&&jsSuffixRegExp.test(e[l])&&(e[l]=e[l].replace(jsSuffixRegExp,"")),"."===e[0].charAt(0)&&p&&(e=p.slice(0,p.length-1).concat(e)),function(e){var t,n;for(t=0;t<e.length;t++)if("."===(n=e[t]))e.splice(t,1),t-=1;else if(".."===n){if(0===t||1===t&&".."===e[2]||".."===e[t-1])continue;t>0&&(e.splice(t-1,2),t-=2)}}(e),e=e.join("/")),n&&g&&(p||m)){e:for(s=(r=e.split("/")).length;s>0;s-=1){if(c=r.slice(0,s).join("/"),p)for(a=p.length;a>0;a-=1)if((i=getOwn(g,p.slice(0,a).join("/")))&&(i=getOwn(i,c))){u=i,h=s;break e}!d&&m&&getOwn(m,c)&&(d=getOwn(m,c),f=s)}!u&&d&&(u=d,h=f),u&&(r.splice(0,h,u),e=r.join("/"))}return getOwn(o.pkgs,e)||e}function _(e){isBrowser&&each(scripts(),function(t){if(t.getAttribute("data-requiremodule")===e&&t.getAttribute("data-requirecontext")===i.contextName)return t.parentNode.removeChild(t),!0})}function v(e){var t=getOwn(o.paths,e);if(t&&isArray(t)&&t.length>1)return t.shift(),i.require.undef(e),i.makeRequire(null,{skipMap:!0})([e]),!0}function y(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function b(e,t,n,r){var s,o,a,c,l=null,u=t?t.name:null,d=e,f=!0,_="";return e||(f=!1,e="_@r"+(p+=1)),l=(c=y(e))[0],e=c[1],l&&(l=m(l,u,r),o=getOwn(h,l)),e&&(l?_=o&&o.normalize?o.normalize(e,function(e){return m(e,u,r)}):-1===e.indexOf("!")?m(e,u,r):e:(l=(c=y(_=m(e,u,r)))[0],_=c[1],n=!0,s=i.nameToUrl(_))),{prefix:l,name:_,parentMap:t,unnormalized:!!(a=!l||o||n?"":"_unnormalized"+(g+=1)),url:s,originalName:d,isDefine:f,id:(l?l+"!"+_:_)+a}}function S(e){var t=e.id,n=getOwn(a,t);return n||(n=a[t]=new i.Module(e)),n}function C(e,t,n){var i=e.id,r=getOwn(a,i);!hasProp(h,i)||r&&!r.defineEmitComplete?(r=S(e)).error&&"error"===t?n(r.error):r.on(t,n):"defined"===t&&n(h[i])}function w(e,t){var n=e.requireModules,i=!1;t?t(e):(each(n,function(t){var n=getOwn(a,t);n&&(n.error=e,n.events.error&&(i=!0,n.emit("error",e)))}),i||req.onError(e))}function T(){globalDefQueue.length&&(each(globalDefQueue,function(e){var t=e[0];"string"==typeof t&&(i.defQueueMap[t]=!0),u.push(e)}),globalDefQueue=[])}function k(e){delete a[e],delete c[e]}function E(){var e,n,r=1e3*o.waitSeconds,l=r&&i.startTime+r<(new Date).getTime(),u=[],d=[],f=!1,p=!0;if(!t){if(t=!0,eachProp(c,function(e){var t=e.map,i=t.id;if(e.enabled&&(t.isDefine||d.push(e),!e.error))if(!e.inited&&l)v(i)?(n=!0,f=!0):(u.push(i),_(i));else if(!e.inited&&e.fetched&&t.isDefine&&(f=!0,!t.prefix))return p=!1}),l&&u.length)return(e=makeError("timeout","Load timeout for modules: "+u,null,u)).contextName=i.contextName,w(e);p&&each(d,function(e){!function e(t,n,i){var r=t.map.id;t.error?t.emit("error",t.error):(n[r]=!0,each(t.depMaps,function(r,s){var o=r.id,c=getOwn(a,o);!c||t.depMatched[s]||i[o]||(getOwn(n,o)?(t.defineDep(s,h[o]),t.check()):e(c,n,i))}),i[r]=!0)}(e,{},{})}),l&&!n||!f||!isBrowser&&!isWebWorker||s||(s=setTimeout(function(){s=0,E()},50)),t=!1}}function A(e){hasProp(h,e[0])||S(b(e[0],null,!0)).init(e[1],e[2])}function x(e,t,n,i){e.detachEvent&&!isOpera?i&&e.detachEvent(i,t):e.removeEventListener(n,t,!1)}function R(e){var t=e.currentTarget||e.srcElement;return x(t,i.onScriptLoad,"load","onreadystatechange"),x(t,i.onScriptError,"error"),{node:t,id:t&&t.getAttribute("data-requiremodule")}}function I(){var e;for(T();u.length;){if(null===(e=u.shift())[0])return w(makeError("mismatch","Mismatched anonymous define() module: "+e[e.length-1]));A(e)}i.defQueueMap={}}return r={require:function(e){return e.require?e.require:e.require=i.makeRequire(e.map)},exports:function(e){if(e.usingExports=!0,e.map.isDefine)return e.exports?h[e.map.id]=e.exports:e.exports=h[e.map.id]={}},module:function(e){return e.module?e.module:e.module={id:e.map.id,uri:e.map.url,config:function(){return getOwn(o.config,e.map.id)||{}},exports:e.exports||(e.exports={})}}},(n=function(e){this.events=getOwn(l,e.id)||{},this.map=e,this.shim=getOwn(o.shim,e.id),this.depExports=[],this.depMaps=[],this.depMatched=[],this.pluginMaps={},this.depCount=0}).prototype={init:function(e,t,n,i){i=i||{},this.inited||(this.factory=t,n?this.on("error",n):this.events.error&&(n=bind(this,function(e){this.emit("error",e)})),this.depMaps=e&&e.slice(0),this.errback=n,this.inited=!0,this.ignore=i.ignore,i.enabled||this.enabled?this.enable():this.check())},defineDep:function(e,t){this.depMatched[e]||(this.depMatched[e]=!0,this.depCount-=1,this.depExports[e]=t)},fetch:function(){if(!this.fetched){this.fetched=!0,i.startTime=(new Date).getTime();var e=this.map;if(!this.shim)return e.prefix?this.callPlugin():this.load();i.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||[],bind(this,function(){return e.prefix?this.callPlugin():this.load()}))}},load:function(){var e=this.map.url;d[e]||(d[e]=!0,i.load(this.map.id,e))},check:function(){if(this.enabled&&!this.enabling){var e,t,n=this.map.id,r=this.depExports,exports=this.exports,s=this.factory;if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){if(isFunction(s)){if(this.events.error&&this.map.isDefine||req.onError!==defaultOnError)try{exports=i.execCb(n,s,r,exports)}catch(t){e=t}else exports=i.execCb(n,s,r,exports);if(this.map.isDefine&&void 0===exports&&((t=this.module)?exports=t.exports:this.usingExports&&(exports=this.exports)),e)return e.requireMap=this.map,e.requireModules=this.map.isDefine?[this.map.id]:null,e.requireType=this.map.isDefine?"define":"require",w(this.error=e)}else exports=s;this.exports=exports,this.map.isDefine&&!this.ignore&&(h[n]=exports,req.onResourceLoad&&req.onResourceLoad(i,this.map,this.depMaps)),k(n),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else hasProp(i.defQueueMap,n)||this.fetch()}},callPlugin:function(){var e=this.map,t=e.id,n=b(e.prefix);this.depMaps.push(n),C(n,"defined",bind(this,function(n){var r,s,c,l=getOwn(f,this.map.id),u=this.map.name,h=this.map.parentMap?this.map.parentMap.name:null,d=i.makeRequire(e.parentMap,{enableBuildCallback:!0});return this.map.unnormalized?(n.normalize&&(u=n.normalize(u,function(e){return m(e,h,!0)})||""),C(s=b(e.prefix+"!"+u,this.map.parentMap),"defined",bind(this,function(e){this.init([],function(){return e},null,{enabled:!0,ignore:!0})})),void((c=getOwn(a,s.id))&&(this.depMaps.push(s),this.events.error&&c.on("error",bind(this,function(e){this.emit("error",e)})),c.enable()))):l?(this.map.url=i.nameToUrl(l),void this.load()):((r=bind(this,function(e){this.init([],function(){return e},null,{enabled:!0})})).error=bind(this,function(e){this.inited=!0,this.error=e,e.requireModules=[t],eachProp(a,function(e){0===e.map.id.indexOf(t+"_unnormalized")&&k(e.map.id)}),w(e)}),r.fromText=bind(this,function(n,s){var a=e.name,c=b(a),l=useInteractive;s&&(n=s),l&&(useInteractive=!1),S(c),hasProp(o.config,t)&&(o.config[a]=o.config[t]);try{req.exec(n)}catch(e){return w(makeError("fromtexteval","fromText eval for "+t+" failed: "+e,e,[t]))}l&&(useInteractive=!0),this.depMaps.push(c),i.completeLoad(a),d([a],r)}),void n.load(e.name,d,r,o))})),i.enable(n,this),this.pluginMaps[n.id]=n},enable:function(){c[this.map.id]=this,this.enabled=!0,this.enabling=!0,each(this.depMaps,bind(this,function(e,t){var n,s,o;if("string"==typeof e){if(e=b(e,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[t]=e,o=getOwn(r,e.id))return void(this.depExports[t]=o(this));this.depCount+=1,C(e,"defined",bind(this,function(e){this.undefed||(this.defineDep(t,e),this.check())})),this.errback?C(e,"error",bind(this,this.errback)):this.events.error&&C(e,"error",bind(this,function(e){this.emit("error",e)}))}n=e.id,s=a[n],hasProp(r,n)||!s||s.enabled||i.enable(e,this)})),eachProp(this.pluginMaps,bind(this,function(e){var t=getOwn(a,e.id);t&&!t.enabled&&i.enable(e,this)})),this.enabling=!1,this.check()},on:function(e,t){var n=this.events[e];n||(n=this.events[e]=[]),n.push(t)},emit:function(e,t){each(this.events[e],function(e){e(t)}),"error"===e&&delete this.events[e]}},(i={config:o,contextName:e,registry:a,defined:h,urlFetched:d,defQueue:u,defQueueMap:{},Module:n,makeModuleMap:b,nextTick:req.nextTick,onError:w,configure:function(e){e.baseUrl&&"/"!==e.baseUrl.charAt(e.baseUrl.length-1)&&(e.baseUrl+="/");var t=o.shim,n={paths:!0,bundles:!0,config:!0,map:!0};eachProp(e,function(e,t){n[t]?(o[t]||(o[t]={}),mixin(o[t],e,!0,!0)):o[t]=e}),e.bundles&&eachProp(e.bundles,function(e,t){each(e,function(e){e!==t&&(f[e]=t)})}),e.shim&&(eachProp(e.shim,function(e,n){isArray(e)&&(e={deps:e}),!e.exports&&!e.init||e.exportsFn||(e.exportsFn=i.makeShimExports(e)),t[n]=e}),o.shim=t),e.packages&&each(e.packages,function(e){var t;t=(e="string"==typeof e?{name:e}:e).name,e.location&&(o.paths[t]=e.location),o.pkgs[t]=e.name+"/"+(e.main||"main").replace(currDirRegExp,"").replace(jsSuffixRegExp,"")}),eachProp(a,function(e,t){e.inited||e.map.unnormalized||(e.map=b(t,null,!0))}),(e.deps||e.callback)&&i.require(e.deps||[],e.callback)},makeShimExports:function(e){return function(){var t;return e.init&&(t=e.init.apply(global,arguments)),t||e.exports&&getGlobal(e.exports)}},makeRequire:function(t,n){function s(o,c,l){var u,d;return n.enableBuildCallback&&c&&isFunction(c)&&(c.__requireJsBuild=!0),"string"==typeof o?isFunction(c)?w(makeError("requireargs","Invalid require call"),l):t&&hasProp(r,o)?r[o](a[t.id]):req.get?req.get(i,o,t,s):(u=b(o,t,!1,!0).id,hasProp(h,u)?h[u]:w(makeError("notloaded",'Module name "'+u+'" has not been loaded yet for context: '+e+(t?"":". Use require([])")))):(I(),i.nextTick(function(){I(),(d=S(b(null,t))).skipMap=n.skipMap,d.init(o,c,l,{enabled:!0}),E()}),s)}return n=n||{},mixin(s,{isBrowser:isBrowser,toUrl:function(e){var n,r=e.lastIndexOf("."),s=e.split("/")[0];return-1!==r&&(!("."===s||".."===s)||r>1)&&(n=e.substring(r,e.length),e=e.substring(0,r)),i.nameToUrl(m(e,t&&t.id,!0),n,!0)},defined:function(e){return hasProp(h,b(e,t,!1,!0).id)},specified:function(e){return e=b(e,t,!1,!0).id,hasProp(h,e)||hasProp(a,e)}}),t||(s.undef=function(e){T();var n=b(e,t,!0),r=getOwn(a,e);r.undefed=!0,_(e),delete h[e],delete d[n.url],delete l[e],eachReverse(u,function(t,n){t[0]===e&&u.splice(n,1)}),delete i.defQueueMap[e],r&&(r.events.defined&&(l[e]=r.events),k(e))}),s},enable:function(e){getOwn(a,e.id)&&S(e).enable()},completeLoad:function(e){var t,n,r,s=getOwn(o.shim,e)||{},c=s.exports;for(T();u.length;){if(null===(n=u.shift())[0]){if(n[0]=e,t)break;t=!0}else n[0]===e&&(t=!0);A(n)}if(i.defQueueMap={},r=getOwn(a,e),!t&&!hasProp(h,e)&&r&&!r.inited){if(!(!o.enforceDefine||c&&getGlobal(c)))return v(e)?void 0:w(makeError("nodefine","No define call for "+e,null,[e]));A([e,s.deps||[],s.exportsFn])}E()},nameToUrl:function(e,t,n){var r,s,a,c,l,u,h=getOwn(o.pkgs,e);if(h&&(e=h),u=getOwn(f,e))return i.nameToUrl(u,t,n);if(req.jsExtRegExp.test(e))c=e+(t||"");else{for(r=o.paths,a=(s=e.split("/")).length;a>0;a-=1)if(l=getOwn(r,s.slice(0,a).join("/"))){isArray(l)&&(l=l[0]),s.splice(0,a,l);break}c=s.join("/"),c=("/"===(c+=t||(/^data\:|\?/.test(c)||n?"":".js")).charAt(0)||c.match(/^[\w\+\.\-]+:/)?"":o.baseUrl)+c}return o.urlArgs?c+(-1===c.indexOf("?")?"?":"&")+o.urlArgs:c},load:function(e,t){req.load(i,e,t)},execCb:function(e,t,n,exports){return t.apply(exports,n)},onScriptLoad:function(e){if("load"===e.type||readyRegExp.test((e.currentTarget||e.srcElement).readyState)){interactiveScript=null;var t=R(e);i.completeLoad(t.id)}},onScriptError:function(e){var t=R(e);if(!v(t.id))return w(makeError("scripterror","Script error for: "+t.id,e,[t.id]))}}).require=i.makeRequire(),i}function getInteractiveScript(){return interactiveScript&&"interactive"===interactiveScript.readyState?interactiveScript:(eachReverse(scripts(),function(e){if("interactive"===e.readyState)return interactiveScript=e}),interactiveScript)}}(this),define("requireLib",function(){}),function(e,t){var n,i,r=e.document,s=e.location,o=e.navigator,a=e.jQuery,c=e.$,l=Array.prototype.push,u=Array.prototype.slice,h=Array.prototype.indexOf,d=Object.prototype.toString,f=Object.prototype.hasOwnProperty,p=String.prototype.trim,g=function e(t,i){return new e.fn.init(t,i,n)},m=/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source,_=/\S/,v=/\s+/,y=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,b=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,S=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,C=/^[\],:{}\s]*$/,w=/(?:^|:|,)(?:\s*\[)+/g,T=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,k=/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,E=/^-ms-/,A=/-([\da-z])/gi,x=function(e,t){return(t+"").toUpperCase()},R=function e(){r.addEventListener?(r.removeEventListener("DOMContentLoaded",e,!1),g.ready()):"complete"===r.readyState&&(r.detachEvent("onreadystatechange",e),g.ready())},I={};g.fn=g.prototype={constructor:g,init:function(e,n,i){var s,o,a;if(!e)return this;if(e.nodeType)return this.context=this[0]=e,this.length=1,this;if("string"==typeof e){if(!(s="<"===e.charAt(0)&&">"===e.charAt(e.length-1)&&e.length>=3?[null,e,null]:b.exec(e))||!s[1]&&n)return!n||n.jquery?(n||i).find(e):this.constructor(n).find(e);if(s[1])return a=(n=n instanceof g?n[0]:n)&&n.nodeType?n.ownerDocument||n:r,e=g.parseHTML(s[1],a,!0),S.test(s[1])&&g.isPlainObject(n)&&this.attr.call(e,n,!0),g.merge(this,e);if((o=r.getElementById(s[2]))&&o.parentNode){if(o.id!==s[2])return i.find(e);this.length=1,this[0]=o}return this.context=r,this.selector=e,this}return g.isFunction(e)?i.ready(e):(e.selector!==t&&(this.selector=e.selector,this.context=e.context),g.makeArray(e,this))},selector:"",jquery:"1.8.3",length:0,size:function(){return this.length},toArray:function(){return u.call(this)},get:function(e){return null==e?this.toArray():e<0?this[this.length+e]:this[e]},pushStack:function(e,t,n){var i=g.merge(this.constructor(),e);return i.prevObject=this,i.context=this.context,"find"===t?i.selector=this.selector+(this.selector?" ":"")+n:t&&(i.selector=this.selector+"."+t+"("+n+")"),i},each:function(e,t){return g.each(this,e,t)},ready:function(e){return g.ready.promise().done(e),this},eq:function(e){return-1===(e=+e)?this.slice(e):this.slice(e,e+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(u.apply(this,arguments),"slice",u.call(arguments).join(","))},map:function(e){return this.pushStack(g.map(this,function(t,n){return e.call(t,n,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:l,sort:[].sort,splice:[].splice},g.fn.init.prototype=g.fn,g.extend=g.fn.extend=function(){var e,n,i,r,s,o,a=arguments[0]||{},c=1,l=arguments.length,u=!1;for("boolean"==typeof a&&(u=a,a=arguments[1]||{},c=2),"object"===(void 0===a?"undefined":_typeof(a))||g.isFunction(a)||(a={}),l===c&&(a=this,--c);c<l;c++)if(null!=(e=arguments[c]))for(n in e)i=a[n],a!==(r=e[n])&&(u&&r&&(g.isPlainObject(r)||(s=g.isArray(r)))?(s?(s=!1,o=i&&g.isArray(i)?i:[]):o=i&&g.isPlainObject(i)?i:{},a[n]=g.extend(u,o,r)):r!==t&&(a[n]=r));return a},g.extend({noConflict:function(t){return e.$===g&&(e.$=c),t&&e.jQuery===g&&(e.jQuery=a),g},isReady:!1,readyWait:1,holdReady:function(e){e?g.readyWait++:g.ready(!0)},ready:function(e){if(!0===e?!--g.readyWait:!g.isReady){if(!r.body)return setTimeout(g.ready,1);g.isReady=!0,!0!==e&&--g.readyWait>0||(i.resolveWith(r,[g]),g.fn.trigger&&g(r).trigger("ready").off("ready"))}},isFunction:function(e){return"function"===g.type(e)},isArray:Array.isArray||function(e){return"array"===g.type(e)},isWindow:function(e){return null!=e&&e==e.window},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},type:function(e){return null==e?String(e):I[d.call(e)]||"object"},isPlainObject:function(e){if(!e||"object"!==g.type(e)||e.nodeType||g.isWindow(e))return!1;try{if(e.constructor&&!f.call(e,"constructor")&&!f.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}var n;for(n in e);return n===t||f.call(e,n)},isEmptyObject:function(e){var t;for(t in e)return!1;return!0},error:function(e){throw new Error(e)},parseHTML:function(e,t,n){var i;return e&&"string"==typeof e?("boolean"==typeof t&&(n=t,t=0),t=t||r,(i=S.exec(e))?[t.createElement(i[1])]:(i=g.buildFragment([e],t,n?null:[]),g.merge([],(i.cacheable?g.clone(i.fragment):i.fragment).childNodes))):null},parseJSON:function(t){return t&&"string"==typeof t?(t=g.trim(t),e.JSON&&e.JSON.parse?e.JSON.parse(t):C.test(t.replace(T,"@").replace(k,"]").replace(w,""))?new Function("return "+t)():void g.error("Invalid JSON: "+t)):null},parseXML:function(n){var i;if(!n||"string"!=typeof n)return null;try{e.DOMParser?i=(new DOMParser).parseFromString(n,"text/xml"):((i=new ActiveXObject("Microsoft.XMLDOM")).async="false",i.loadXML(n))}catch(e){i=t}return i&&i.documentElement&&!i.getElementsByTagName("parsererror").length||g.error("Invalid XML: "+n),i},noop:function(){},globalEval:function(t){t&&_.test(t)&&(e.execScript||function(t){e.eval.call(e,t)})(t)},camelCase:function(e){return e.replace(E,"ms-").replace(A,x)},nodeName:function(e,t){return e.nodeName&&e.nodeName.toLowerCase()===t.toLowerCase()},each:function(e,n,i){var r,s=0,o=e.length,a=o===t||g.isFunction(e);if(i)if(a){for(r in e)if(!1===n.apply(e[r],i))break}else for(;s<o&&!1!==n.apply(e[s++],i););else if(a){for(r in e)if(!1===n.call(e[r],r,e[r]))break}else for(;s<o&&!1!==n.call(e[s],s,e[s++]););return e},trim:p&&!p.call("\ufeff ")?function(e){return null==e?"":p.call(e)}:function(e){return null==e?"":(e+"").replace(y,"")},makeArray:function(e,t){var n,i=t||[];return null!=e&&(n=g.type(e),null==e.length||"string"===n||"function"===n||"regexp"===n||g.isWindow(e)?l.call(i,e):g.merge(i,e)),i},inArray:function(e,t,n){var i;if(t){if(h)return h.call(t,e,n);for(i=t.length,n=n?n<0?Math.max(0,i+n):n:0;n<i;n++)if(n in t&&t[n]===e)return n}return-1},merge:function(e,n){var i=n.length,r=e.length,s=0;if("number"==typeof i)for(;s<i;s++)e[r++]=n[s];else for(;n[s]!==t;)e[r++]=n[s++];return e.length=r,e},grep:function(e,t,n){var i=[],r=0,s=e.length;for(n=!!n;r<s;r++)n!==!!t(e[r],r)&&i.push(e[r]);return i},map:function(e,n,i){var r,s,o=[],a=0,c=e.length;if(e instanceof g||c!==t&&"number"==typeof c&&(c>0&&e[0]&&e[c-1]||0===c||g.isArray(e)))for(;a<c;a++)null!=(r=n(e[a],a,i))&&(o[o.length]=r);else for(s in e)null!=(r=n(e[s],s,i))&&(o[o.length]=r);return o.concat.apply([],o)},guid:1,proxy:function(e,n){var i,r,s;return"string"==typeof n&&(i=e[n],n=e,e=i),g.isFunction(e)?(r=u.call(arguments,2),s=function(){return e.apply(n,r.concat(u.call(arguments)))},s.guid=e.guid=e.guid||g.guid++,s):t},access:function(e,n,i,r,s,o,a){var c,l=null==i,u=0,h=e.length;if(i&&"object"===(void 0===i?"undefined":_typeof(i))){for(u in i)g.access(e,n,u,i[u],1,o,r);s=1}else if(r!==t){if(c=a===t&&g.isFunction(r),l&&(c?(c=n,n=function(e,t,n){return c.call(g(e),n)}):(n.call(e,r),n=null)),n)for(;u<h;u++)n(e[u],i,c?r.call(e[u],u,n(e[u],i)):r,a);s=1}return s?e:l?n.call(e):h?n(e[0],i):o},now:function(){return(new Date).getTime()}}),g.ready.promise=function(t){if(!i)if(i=g.Deferred(),"complete"===r.readyState)setTimeout(g.ready,1);else if(r.addEventListener)r.addEventListener("DOMContentLoaded",R,!1),e.addEventListener("load",g.ready,!1);else{r.attachEvent("onreadystatechange",R),e.attachEvent("onload",g.ready);var n=!1;try{n=null==e.frameElement&&r.documentElement}catch(e){}n&&n.doScroll&&function e(){if(!g.isReady){try{n.doScroll("left")}catch(t){return setTimeout(e,50)}g.ready()}}()}return i.promise(t)},g.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(e,t){I["[object "+t+"]"]=t.toLowerCase()}),n=g(r);var L={};g.Callbacks=function(e){e="string"==typeof e?L[e]||function(e){var t=L[e]={};return g.each(e.split(v),function(e,n){t[n]=!0}),t}(e):g.extend({},e);var n,i,r,s,o,a,c=[],l=!e.once&&[],u=function t(u){for(n=e.memory&&u,i=!0,a=s||0,s=0,o=c.length,r=!0;c&&a<o;a++)if(!1===c[a].apply(u[0],u[1])&&e.stopOnFalse){n=!1;break}r=!1,c&&(l?l.length&&t(l.shift()):n?c=[]:h.disable())},h={add:function(){if(c){var t=c.length;!function t(n){g.each(n,function(n,i){var r=g.type(i);"function"===r?e.unique&&h.has(i)||c.push(i):i&&i.length&&"string"!==r&&t(i)})}(arguments),r?o=c.length:n&&(s=t,u(n))}return this},remove:function(){return c&&g.each(arguments,function(e,t){for(var n;(n=g.inArray(t,c,n))>-1;)c.splice(n,1),r&&(n<=o&&o--,n<=a&&a--)}),this},has:function(e){return g.inArray(e,c)>-1},empty:function(){return c=[],this},disable:function(){return c=l=n=t,this},disabled:function(){return!c},lock:function(){return l=t,n||h.disable(),this},locked:function(){return!l},fireWith:function(e,t){return t=[e,(t=t||[]).slice?t.slice():t],!c||i&&!l||(r?l.push(t):u(t)),this},fire:function(){return h.fireWith(this,arguments),this},fired:function(){return!!i}};return h},g.extend({Deferred:function(e){var t=[["resolve","done",g.Callbacks("once memory"),"resolved"],["reject","fail",g.Callbacks("once memory"),"rejected"],["notify","progress",g.Callbacks("memory")]],n="pending",i={state:function(){return n},always:function(){return r.done(arguments).fail(arguments),this},then:function(){var e=arguments;return g.Deferred(function(n){g.each(t,function(t,i){var s=i[0],o=e[t];r[i[1]](g.isFunction(o)?function(){var e=o.apply(this,arguments);e&&g.isFunction(e.promise)?e.promise().done(n.resolve).fail(n.reject).progress(n.notify):n[s+"With"](this===r?n:this,[e])}:n[s])}),e=null}).promise()},promise:function(e){return null!=e?g.extend(e,i):i}},r={};return i.pipe=i.then,g.each(t,function(e,s){var o=s[2],a=s[3];i[s[1]]=o.add,a&&o.add(function(){n=a},t[1^e][2].disable,t[2][2].lock),r[s[0]]=o.fire,r[s[0]+"With"]=o.fireWith}),i.promise(r),e&&e.call(r,r),r},when:function(e){var t,n,i,r=0,s=u.call(arguments),o=s.length,a=1!==o||e&&g.isFunction(e.promise)?o:0,c=1===a?e:g.Deferred(),l=function(e,n,i){return function(r){n[e]=this,i[e]=arguments.length>1?u.call(arguments):r,i===t?c.notifyWith(n,i):--a||c.resolveWith(n,i)}};if(o>1)for(t=new Array(o),n=new Array(o),i=new Array(o);r<o;r++)s[r]&&g.isFunction(s[r].promise)?s[r].promise().done(l(r,i,s)).fail(c.reject).progress(l(r,n,t)):--a;return a||c.resolveWith(i,s),c.promise()}}),g.support=function(){var t,n,i,s,o,a,c,l,u,h,d,f=r.createElement("div");if(f.setAttribute("className","t"),f.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",n=f.getElementsByTagName("*"),i=f.getElementsByTagName("a")[0],!n||!i||!n.length)return{};o=(s=r.createElement("select")).appendChild(r.createElement("option")),a=f.getElementsByTagName("input")[0],i.style.cssText="top:1px;float:left;opacity:.5",t={leadingWhitespace:3===f.firstChild.nodeType,tbody:!f.getElementsByTagName("tbody").length,htmlSerialize:!!f.getElementsByTagName("link").length,style:/top/.test(i.getAttribute("style")),hrefNormalized:"/a"===i.getAttribute("href"),opacity:/^0.5/.test(i.style.opacity),cssFloat:!!i.style.cssFloat,checkOn:"on"===a.value,optSelected:o.selected,getSetAttribute:"t"!==f.className,enctype:!!r.createElement("form").enctype,html5Clone:"<:nav></:nav>"!==r.createElement("nav").cloneNode(!0).outerHTML,boxModel:"CSS1Compat"===r.compatMode,submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1},a.checked=!0,t.noCloneChecked=a.cloneNode(!0).checked,s.disabled=!0,t.optDisabled=!o.disabled;try{delete f.test}catch(e){t.deleteExpando=!1}if(!f.addEventListener&&f.attachEvent&&f.fireEvent&&(f.attachEvent("onclick",d=function(){t.noCloneEvent=!1}),f.cloneNode(!0).fireEvent("onclick"),f.detachEvent("onclick",d)),(a=r.createElement("input")).value="t",a.setAttribute("type","radio"),t.radioValue="t"===a.value,a.setAttribute("checked","checked"),a.setAttribute("name","t"),f.appendChild(a),(c=r.createDocumentFragment()).appendChild(f.lastChild),t.checkClone=c.cloneNode(!0).cloneNode(!0).lastChild.checked,t.appendChecked=a.checked,c.removeChild(a),c.appendChild(f),f.attachEvent)for(u in{submit:!0,change:!0,focusin:!0})(h=(l="on"+u)in f)||(f.setAttribute(l,"return;"),h="function"==typeof f[l]),t[u+"Bubbles"]=h;return g(function(){var n,i,s,o,a="padding:0;margin:0;border:0;display:block;overflow:hidden;",c=r.getElementsByTagName("body")[0];c&&((n=r.createElement("div")).style.cssText="visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px",c.insertBefore(n,c.firstChild),i=r.createElement("div"),n.appendChild(i),i.innerHTML="<table><tr><td></td><td>t</td></tr></table>",(s=i.getElementsByTagName("td"))[0].style.cssText="padding:0;margin:0;border:0;display:none",h=0===s[0].offsetHeight,s[0].style.display="",s[1].style.display="none",t.reliableHiddenOffsets=h&&0===s[0].offsetHeight,i.innerHTML="",i.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",t.boxSizing=4===i.offsetWidth,t.doesNotIncludeMarginInBodyOffset=1!==c.offsetTop,e.getComputedStyle&&(t.pixelPosition="1%"!==(e.getComputedStyle(i,null)||{}).top,t.boxSizingReliable="4px"===(e.getComputedStyle(i,null)||{width:"4px"}).width,(o=r.createElement("div")).style.cssText=i.style.cssText=a,o.style.marginRight=o.style.width="0",i.style.width="1px",i.appendChild(o),t.reliableMarginRight=!parseFloat((e.getComputedStyle(o,null)||{}).marginRight)),void 0!==i.style.zoom&&(i.innerHTML="",i.style.cssText=a+"width:1px;padding:1px;display:inline;zoom:1",t.inlineBlockNeedsLayout=3===i.offsetWidth,i.style.display="block",i.style.overflow="visible",i.innerHTML="<div></div>",i.firstChild.style.width="5px",t.shrinkWrapBlocks=3!==i.offsetWidth,n.style.zoom=1),c.removeChild(n),n=i=s=o=null)}),c.removeChild(f),n=i=s=o=a=c=f=null,t}();var M=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,P=/([A-Z])/g;function O(e,n,i){if(i===t&&1===e.nodeType){var r="data-"+n.replace(P,"-$1").toLowerCase();if("string"==typeof(i=e.getAttribute(r))){try{i="true"===i||"false"!==i&&("null"===i?null:+i+""===i?+i:M.test(i)?g.parseJSON(i):i)}catch(e){}g.data(e,n,i)}else i=t}return i}function D(e){var t;for(t in e)if(("data"!==t||!g.isEmptyObject(e[t]))&&"toJSON"!==t)return!1;return!0}g.extend({cache:{},deletedIds:[],uuid:0,expando:"jQuery"+(g.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(e){return!!(e=e.nodeType?g.cache[e[g.expando]]:e[g.expando])&&!D(e)},data:function(e,n,i,r){if(g.acceptData(e)){var s,o,a=g.expando,c="string"==typeof n,l=e.nodeType,u=l?g.cache:e,h=l?e[a]:e[a]&&a;if(h&&u[h]&&(r||u[h].data)||!c||i!==t)return h||(l?e[a]=h=g.deletedIds.pop()||g.guid++:h=a),u[h]||(u[h]={},l||(u[h].toJSON=g.noop)),"object"!==(void 0===n?"undefined":_typeof(n))&&"function"!=typeof n||(r?u[h]=g.extend(u[h],n):u[h].data=g.extend(u[h].data,n)),s=u[h],r||(s.data||(s.data={}),s=s.data),i!==t&&(s[g.camelCase(n)]=i),c?null==(o=s[n])&&(o=s[g.camelCase(n)]):o=s,o}},removeData:function(e,t,n){if(g.acceptData(e)){var i,r,s,o=e.nodeType,a=o?g.cache:e,c=o?e[g.expando]:g.expando;if(a[c]){if(t&&(i=n?a[c]:a[c].data)){g.isArray(t)||(t=t in i?[t]:(t=g.camelCase(t))in i?[t]:t.split(" "));for(r=0,s=t.length;r<s;r++)delete i[t[r]];if(!(n?D:g.isEmptyObject)(i))return}(n||(delete a[c].data,D(a[c])))&&(o?g.cleanData([e],!0):g.support.deleteExpando||a!=a.window?delete a[c]:a[c]=null)}}},_data:function(e,t,n){return g.data(e,t,n,!0)},acceptData:function(e){var t=e.nodeName&&g.noData[e.nodeName.toLowerCase()];return!t||!0!==t&&e.getAttribute("classid")===t}}),g.fn.extend({data:function(e,n){var i,r,s,o,a,c=this[0],l=0,u=null;if(e===t){if(this.length&&(u=g.data(c),1===c.nodeType&&!g._data(c,"parsedAttrs"))){for(a=(s=c.attributes).length;l<a;l++)(o=s[l].name).indexOf("data-")||(o=g.camelCase(o.substring(5)),O(c,o,u[o]));g._data(c,"parsedAttrs",!0)}return u}return"object"===(void 0===e?"undefined":_typeof(e))?this.each(function(){g.data(this,e)}):((i=e.split(".",2))[1]=i[1]?"."+i[1]:"",r=i[1]+"!",g.access(this,function(n){if(n===t)return u=this.triggerHandler("getData"+r,[i[0]]),u===t&&c&&(u=g.data(c,e),u=O(c,e,u)),u===t&&i[1]?this.data(i[0]):u;i[1]=n,this.each(function(){var t=g(this);t.triggerHandler("setData"+r,i),g.data(this,e,n),t.triggerHandler("changeData"+r,i)})},null,n,arguments.length>1,null,!1))},removeData:function(e){return this.each(function(){g.removeData(this,e)})}}),g.extend({queue:function(e,t,n){var i;if(e)return t=(t||"fx")+"queue",i=g._data(e,t),n&&(!i||g.isArray(n)?i=g._data(e,t,g.makeArray(n)):i.push(n)),i||[]},dequeue:function(e,t){t=t||"fx";var n=g.queue(e,t),i=n.length,r=n.shift(),s=g._queueHooks(e,t);"inprogress"===r&&(r=n.shift(),i--),r&&("fx"===t&&n.unshift("inprogress"),delete s.stop,r.call(e,function(){g.dequeue(e,t)},s)),!i&&s&&s.empty.fire()},_queueHooks:function(e,t){var n=t+"queueHooks";return g._data(e,n)||g._data(e,n,{empty:g.Callbacks("once memory").add(function(){g.removeData(e,t+"queue",!0),g.removeData(e,n,!0)})})}}),g.fn.extend({queue:function(e,n){var i=2;return"string"!=typeof e&&(n=e,e="fx",i--),arguments.length<i?g.queue(this[0],e):n===t?this:this.each(function(){var t=g.queue(this,e,n);g._queueHooks(this,e),"fx"===e&&"inprogress"!==t[0]&&g.dequeue(this,e)})},dequeue:function(e){return this.each(function(){g.dequeue(this,e)})},delay:function(e,t){return e=g.fx&&g.fx.speeds[e]||e,t=t||"fx",this.queue(t,function(t,n){var i=setTimeout(t,e);n.stop=function(){clearTimeout(i)}})},clearQueue:function(e){return this.queue(e||"fx",[])},promise:function(e,n){var i,r=1,s=g.Deferred(),o=this,a=this.length,c=function(){--r||s.resolveWith(o,[o])};for("string"!=typeof e&&(n=e,e=t),e=e||"fx";a--;)(i=g._data(o[a],e+"queueHooks"))&&i.empty&&(r++,i.empty.add(c));return c(),s.promise(n)}});var N,F,j,U=/[\t\r\n]/g,q=/\r/g,V=/^(?:button|input)$/i,B=/^(?:button|input|object|select|textarea)$/i,H=/^a(?:rea|)$/i,W=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,G=g.support.getSetAttribute;g.fn.extend({attr:function(e,t){return g.access(this,g.attr,e,t,arguments.length>1)},removeAttr:function(e){return this.each(function(){g.removeAttr(this,e)})},prop:function(e,t){return g.access(this,g.prop,e,t,arguments.length>1)},removeProp:function(e){return e=g.propFix[e]||e,this.each(function(){try{this[e]=t,delete this[e]}catch(e){}})},addClass:function(e){var t,n,i,r,s,o,a;if(g.isFunction(e))return this.each(function(t){g(this).addClass(e.call(this,t,this.className))});if(e&&"string"==typeof e)for(t=e.split(v),n=0,i=this.length;n<i;n++)if(1===(r=this[n]).nodeType)if(r.className||1!==t.length){for(s=" "+r.className+" ",o=0,a=t.length;o<a;o++)s.indexOf(" "+t[o]+" ")<0&&(s+=t[o]+" ");r.className=g.trim(s)}else r.className=e;return this},removeClass:function(e){var n,i,r,s,o,a,c;if(g.isFunction(e))return this.each(function(t){g(this).removeClass(e.call(this,t,this.className))});if(e&&"string"==typeof e||e===t)for(n=(e||"").split(v),a=0,c=this.length;a<c;a++)if(1===(r=this[a]).nodeType&&r.className){for(i=(" "+r.className+" ").replace(U," "),s=0,o=n.length;s<o;s++)for(;i.indexOf(" "+n[s]+" ")>=0;)i=i.replace(" "+n[s]+" "," ");r.className=e?g.trim(i):""}return this},toggleClass:function(e,t){var n=void 0===e?"undefined":_typeof(e),i="boolean"==typeof t;return g.isFunction(e)?this.each(function(n){g(this).toggleClass(e.call(this,n,this.className,t),t)}):this.each(function(){if("string"===n)for(var r,s=0,o=g(this),a=t,c=e.split(v);r=c[s++];)a=i?a:!o.hasClass(r),o[a?"addClass":"removeClass"](r);else"undefined"!==n&&"boolean"!==n||(this.className&&g._data(this,"__className__",this.className),this.className=this.className||!1===e?"":g._data(this,"__className__")||"")})},hasClass:function(e){for(var t=" "+e+" ",n=0,i=this.length;n<i;n++)if(1===this[n].nodeType&&(" "+this[n].className+" ").replace(U," ").indexOf(t)>=0)return!0;return!1},val:function(e){var n,i,r,s=this[0];return arguments.length?(r=g.isFunction(e),this.each(function(i){var s,o=g(this);1===this.nodeType&&(null==(s=r?e.call(this,i,o.val()):e)?s="":"number"==typeof s?s+="":g.isArray(s)&&(s=g.map(s,function(e){return null==e?"":e+""})),(n=g.valHooks[this.type]||g.valHooks[this.nodeName.toLowerCase()])&&"set"in n&&n.set(this,s,"value")!==t||(this.value=s))})):s?(n=g.valHooks[s.type]||g.valHooks[s.nodeName.toLowerCase()])&&"get"in n&&(i=n.get(s,"value"))!==t?i:"string"==typeof(i=s.value)?i.replace(q,""):null==i?"":i:void 0}}),g.extend({valHooks:{option:{get:function(e){var t=e.attributes.value;return!t||t.specified?e.value:e.text}},select:{get:function(e){for(var t,n,i=e.options,r=e.selectedIndex,s="select-one"===e.type||r<0,o=s?null:[],a=s?r+1:i.length,c=r<0?a:s?r:0;c<a;c++)if(((n=i[c]).selected||c===r)&&(g.support.optDisabled?!n.disabled:null===n.getAttribute("disabled"))&&(!n.parentNode.disabled||!g.nodeName(n.parentNode,"optgroup"))){if(t=g(n).val(),s)return t;o.push(t)}return o},set:function(e,t){var n=g.makeArray(t);return g(e).find("option").each(function(){this.selected=g.inArray(g(this).val(),n)>=0}),n.length||(e.selectedIndex=-1),n}}},attrFn:{},attr:function(e,n,i,r){var s,o,a,c=e.nodeType;if(e&&3!==c&&8!==c&&2!==c)return r&&g.isFunction(g.fn[n])?g(e)[n](i):void 0===e.getAttribute?g.prop(e,n,i):((a=1!==c||!g.isXMLDoc(e))&&(n=n.toLowerCase(),o=g.attrHooks[n]||(W.test(n)?F:N)),i!==t?null===i?void g.removeAttr(e,n):o&&"set"in o&&a&&(s=o.set(e,i,n))!==t?s:(e.setAttribute(n,i+""),i):o&&"get"in o&&a&&null!==(s=o.get(e,n))?s:null===(s=e.getAttribute(n))?t:s)},removeAttr:function(e,t){var n,i,r,s,o=0;if(t&&1===e.nodeType)for(i=t.split(v);o<i.length;o++)(r=i[o])&&(n=g.propFix[r]||r,(s=W.test(r))||g.attr(e,r,""),e.removeAttribute(G?r:n),s&&n in e&&(e[n]=!1))},attrHooks:{type:{set:function(e,t){if(V.test(e.nodeName)&&e.parentNode)g.error("type property can't be changed");else if(!g.support.radioValue&&"radio"===t&&g.nodeName(e,"input")){var n=e.value;return e.setAttribute("type",t),n&&(e.value=n),t}}},value:{get:function(e,t){return N&&g.nodeName(e,"button")?N.get(e,t):t in e?e.value:null},set:function(e,t,n){if(N&&g.nodeName(e,"button"))return N.set(e,t,n);e.value=t}}},propFix:{tabindex:"tabIndex",readonly:"readOnly",for:"htmlFor",class:"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(e,n,i){var r,s,o=e.nodeType;if(e&&3!==o&&8!==o&&2!==o)return(1!==o||!g.isXMLDoc(e))&&(n=g.propFix[n]||n,s=g.propHooks[n]),i!==t?s&&"set"in s&&(r=s.set(e,i,n))!==t?r:e[n]=i:s&&"get"in s&&null!==(r=s.get(e,n))?r:e[n]},propHooks:{tabIndex:{get:function(e){var n=e.getAttributeNode("tabindex");return n&&n.specified?parseInt(n.value,10):B.test(e.nodeName)||H.test(e.nodeName)&&e.href?0:t}}}}),F={get:function(e,n){var i,r=g.prop(e,n);return!0===r||"boolean"!=typeof r&&(i=e.getAttributeNode(n))&&!1!==i.nodeValue?n.toLowerCase():t},set:function(e,t,n){var i;return!1===t?g.removeAttr(e,n):((i=g.propFix[n]||n)in e&&(e[i]=!0),e.setAttribute(n,n.toLowerCase())),n}},G||(j={name:!0,id:!0,coords:!0},N=g.valHooks.button={get:function(e,n){var i;return(i=e.getAttributeNode(n))&&(j[n]?""!==i.value:i.specified)?i.value:t},set:function(e,t,n){var i=e.getAttributeNode(n);return i||(i=r.createAttribute(n),e.setAttributeNode(i)),i.value=t+""}},g.each(["width","height"],function(e,t){g.attrHooks[t]=g.extend(g.attrHooks[t],{set:function(e,n){if(""===n)return e.setAttribute(t,"auto"),n}})}),g.attrHooks.contenteditable={get:N.get,set:function(e,t,n){""===t&&(t="false"),N.set(e,t,n)}}),g.support.hrefNormalized||g.each(["href","src","width","height"],function(e,n){g.attrHooks[n]=g.extend(g.attrHooks[n],{get:function(e){var i=e.getAttribute(n,2);return null===i?t:i}})}),g.support.style||(g.attrHooks.style={get:function(e){return e.style.cssText.toLowerCase()||t},set:function(e,t){return e.style.cssText=t+""}}),g.support.optSelected||(g.propHooks.selected=g.extend(g.propHooks.selected,{get:function(e){var t=e.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}})),g.support.enctype||(g.propFix.enctype="encoding"),g.support.checkOn||g.each(["radio","checkbox"],function(){g.valHooks[this]={get:function(e){return null===e.getAttribute("value")?"on":e.value}}}),g.each(["radio","checkbox"],function(){g.valHooks[this]=g.extend(g.valHooks[this],{set:function(e,t){if(g.isArray(t))return e.checked=g.inArray(g(e).val(),t)>=0}})});var z=/^(?:textarea|input|select)$/i,K=/^([^\.]*|)(?:\.(.+)|)$/,Y=/(?:^|\s)hover(\.\S+|)\b/,J=/^key/,Q=/^(?:mouse|contextmenu)|click/,X=/^(?:focusinfocus|focusoutblur)$/,Z=function(e){return g.event.special.hover?e:e.replace(Y,"mouseenter$1 mouseleave$1")};function ee(){return!1}function te(){return!0}g.event={add:function(e,n,i,r,s){var o,a,c,l,u,h,d,f,p,m,_;if(3!==e.nodeType&&8!==e.nodeType&&n&&i&&(o=g._data(e))){for(i.handler&&(i=(p=i).handler,s=p.selector),i.guid||(i.guid=g.guid++),(c=o.events)||(o.events=c={}),(a=o.handle)||(o.handle=a=function(e){return void 0===g||e&&g.event.triggered===e.type?t:g.event.dispatch.apply(a.elem,arguments)},a.elem=e),n=g.trim(Z(n)).split(" "),l=0;l<n.length;l++)h=(u=K.exec(n[l])||[])[1],d=(u[2]||"").split(".").sort(),_=g.event.special[h]||{},h=(s?_.delegateType:_.bindType)||h,_=g.event.special[h]||{},f=g.extend({type:h,origType:u[1],data:r,handler:i,guid:i.guid,selector:s,needsContext:s&&g.expr.match.needsContext.test(s),namespace:d.join(".")},p),(m=c[h])||((m=c[h]=[]).delegateCount=0,_.setup&&!1!==_.setup.call(e,r,d,a)||(e.addEventListener?e.addEventListener(h,a,!1):e.attachEvent&&e.attachEvent("on"+h,a))),_.add&&(_.add.call(e,f),f.handler.guid||(f.handler.guid=i.guid)),s?m.splice(m.delegateCount++,0,f):m.push(f),g.event.global[h]=!0;e=null}},global:{},remove:function(e,t,n,i,r){var s,o,a,c,l,u,h,d,f,p,m,_=g.hasData(e)&&g._data(e);if(_&&(d=_.events)){for(t=g.trim(Z(t||"")).split(" "),s=0;s<t.length;s++)if(a=c=(o=K.exec(t[s])||[])[1],l=o[2],a){for(f=g.event.special[a]||{},u=(p=d[a=(i?f.delegateType:f.bindType)||a]||[]).length,l=l?new RegExp("(^|\\.)"+l.split(".").sort().join("\\.(?:.*\\.|)")+"(\\.|$)"):null,h=0;h<p.length;h++)m=p[h],!r&&c!==m.origType||n&&n.guid!==m.guid||l&&!l.test(m.namespace)||i&&i!==m.selector&&("**"!==i||!m.selector)||(p.splice(h--,1),m.selector&&p.delegateCount--,f.remove&&f.remove.call(e,m));0===p.length&&u!==p.length&&(f.teardown&&!1!==f.teardown.call(e,l,_.handle)||g.removeEvent(e,a,_.handle),delete d[a])}else for(a in d)g.event.remove(e,a+t[s],n,i,!0);g.isEmptyObject(d)&&(delete _.handle,g.removeData(e,"events",!0))}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(n,i,s,o){if(!s||3!==s.nodeType&&8!==s.nodeType){var a,c,l,u,h,d,f,p,m,_,v=n.type||n,y=[];if(!X.test(v+g.event.triggered)&&(v.indexOf("!")>=0&&(v=v.slice(0,-1),c=!0),v.indexOf(".")>=0&&(y=v.split("."),v=y.shift(),y.sort()),s&&!g.event.customEvent[v]||g.event.global[v]))if((n="object"===(void 0===n?"undefined":_typeof(n))?n[g.expando]?n:new g.Event(v,n):new g.Event(v)).type=v,n.isTrigger=!0,n.exclusive=c,n.namespace=y.join("."),n.namespace_re=n.namespace?new RegExp("(^|\\.)"+y.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,d=v.indexOf(":")<0?"on"+v:"",s){if(n.result=t,n.target||(n.target=s),(i=null!=i?g.makeArray(i):[]).unshift(n),!(f=g.event.special[v]||{}).trigger||!1!==f.trigger.apply(s,i)){if(m=[[s,f.bindType||v]],!o&&!f.noBubble&&!g.isWindow(s)){for(_=f.delegateType||v,u=X.test(_+v)?s:s.parentNode,h=s;u;u=u.parentNode)m.push([u,_]),h=u;h===(s.ownerDocument||r)&&m.push([h.defaultView||h.parentWindow||e,_])}for(l=0;l<m.length&&!n.isPropagationStopped();l++)u=m[l][0],n.type=m[l][1],(p=(g._data(u,"events")||{})[n.type]&&g._data(u,"handle"))&&p.apply(u,i),(p=d&&u[d])&&g.acceptData(u)&&p.apply&&!1===p.apply(u,i)&&n.preventDefault();return n.type=v,o||n.isDefaultPrevented()||f._default&&!1!==f._default.apply(s.ownerDocument,i)||"click"===v&&g.nodeName(s,"a")||!g.acceptData(s)||d&&s[v]&&("focus"!==v&&"blur"!==v||0!==n.target.offsetWidth)&&!g.isWindow(s)&&((h=s[d])&&(s[d]=null),g.event.triggered=v,s[v](),g.event.triggered=t,h&&(s[d]=h)),n.result}}else for(l in a=g.cache)a[l].events&&a[l].events[v]&&g.event.trigger(n,i,a[l].handle.elem,!0)}},dispatch:function(n){n=g.event.fix(n||e.event);var i,r,s,o,a,c,l,h,d,f=(g._data(this,"events")||{})[n.type]||[],p=f.delegateCount,m=u.call(arguments),_=!n.exclusive&&!n.namespace,v=g.event.special[n.type]||{},y=[];if(m[0]=n,n.delegateTarget=this,!v.preDispatch||!1!==v.preDispatch.call(this,n)){if(p&&(!n.button||"click"!==n.type))for(s=n.target;s!=this;s=s.parentNode||this)if(!0!==s.disabled||"click"!==n.type){for(a={},l=[],i=0;i<p;i++)a[d=(h=f[i]).selector]===t&&(a[d]=h.needsContext?g(d,this).index(s)>=0:g.find(d,this,null,[s]).length),a[d]&&l.push(h);l.length&&y.push({elem:s,matches:l})}for(f.length>p&&y.push({elem:this,matches:f.slice(p)}),i=0;i<y.length&&!n.isPropagationStopped();i++)for(c=y[i],n.currentTarget=c.elem,r=0;r<c.matches.length&&!n.isImmediatePropagationStopped();r++)h=c.matches[r],(_||!n.namespace&&!h.namespace||n.namespace_re&&n.namespace_re.test(h.namespace))&&(n.data=h.data,n.handleObj=h,(o=((g.event.special[h.origType]||{}).handle||h.handler).apply(c.elem,m))!==t&&(n.result=o,!1===o&&(n.preventDefault(),n.stopPropagation())));return v.postDispatch&&v.postDispatch.call(this,n),n.result}},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(e,t){return null==e.which&&(e.which=null!=t.charCode?t.charCode:t.keyCode),e}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(e,n){var i,s,o,a=n.button,c=n.fromElement;return null==e.pageX&&null!=n.clientX&&(s=(i=e.target.ownerDocument||r).documentElement,o=i.body,e.pageX=n.clientX+(s&&s.scrollLeft||o&&o.scrollLeft||0)-(s&&s.clientLeft||o&&o.clientLeft||0),e.pageY=n.clientY+(s&&s.scrollTop||o&&o.scrollTop||0)-(s&&s.clientTop||o&&o.clientTop||0)),!e.relatedTarget&&c&&(e.relatedTarget=c===e.target?n.toElement:c),e.which||a===t||(e.which=1&a?1:2&a?3:4&a?2:0),e}},fix:function(e){if(e[g.expando])return e;var t,n,i=e,s=g.event.fixHooks[e.type]||{},o=s.props?this.props.concat(s.props):this.props;for(e=g.Event(i),t=o.length;t;)e[n=o[--t]]=i[n];return e.target||(e.target=i.srcElement||r),3===e.target.nodeType&&(e.target=e.target.parentNode),e.metaKey=!!e.metaKey,s.filter?s.filter(e,i):e},special:{load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(e,t,n){g.isWindow(this)&&(this.onbeforeunload=n)},teardown:function(e,t){this.onbeforeunload===t&&(this.onbeforeunload=null)}}},simulate:function(e,t,n,i){var r=g.extend(new g.Event,n,{type:e,isSimulated:!0,originalEvent:{}});i?g.event.trigger(r,null,t):g.event.dispatch.call(t,r),r.isDefaultPrevented()&&n.preventDefault()}},g.event.handle=g.event.dispatch,g.removeEvent=r.removeEventListener?function(e,t,n){e.removeEventListener&&e.removeEventListener(t,n,!1)}:function(e,t,n){var i="on"+t;e.detachEvent&&(void 0===e[i]&&(e[i]=null),e.detachEvent(i,n))},g.Event=function(e,t){if(!(this instanceof g.Event))return new g.Event(e,t);e&&e.type?(this.originalEvent=e,this.type=e.type,this.isDefaultPrevented=e.defaultPrevented||!1===e.returnValue||e.getPreventDefault&&e.getPreventDefault()?te:ee):this.type=e,t&&g.extend(this,t),this.timeStamp=e&&e.timeStamp||g.now(),this[g.expando]=!0},g.Event.prototype={preventDefault:function(){this.isDefaultPrevented=te;var e=this.originalEvent;e&&(e.preventDefault?e.preventDefault():e.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=te;var e=this.originalEvent;e&&(e.stopPropagation&&e.stopPropagation(),e.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=te,this.stopPropagation()},isDefaultPrevented:ee,isPropagationStopped:ee,isImmediatePropagationStopped:ee},g.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(e,t){g.event.special[e]={delegateType:t,bindType:t,handle:function(e){var n,i=e.relatedTarget,r=e.handleObj;r.selector;return i&&(i===this||g.contains(this,i))||(e.type=r.origType,n=r.handler.apply(this,arguments),e.type=t),n}}}),g.support.submitBubbles||(g.event.special.submit={setup:function(){if(g.nodeName(this,"form"))return!1;g.event.add(this,"click._submit keypress._submit",function(e){var n=e.target,i=g.nodeName(n,"input")||g.nodeName(n,"button")?n.form:t;i&&!g._data(i,"_submit_attached")&&(g.event.add(i,"submit._submit",function(e){e._submit_bubble=!0}),g._data(i,"_submit_attached",!0))})},postDispatch:function(e){e._submit_bubble&&(delete e._submit_bubble,this.parentNode&&!e.isTrigger&&g.event.simulate("submit",this.parentNode,e,!0))},teardown:function(){if(g.nodeName(this,"form"))return!1;g.event.remove(this,"._submit")}}),g.support.changeBubbles||(g.event.special.change={setup:function(){if(z.test(this.nodeName))return"checkbox"!==this.type&&"radio"!==this.type||(g.event.add(this,"propertychange._change",function(e){"checked"===e.originalEvent.propertyName&&(this._just_changed=!0)}),g.event.add(this,"click._change",function(e){this._just_changed&&!e.isTrigger&&(this._just_changed=!1),g.event.simulate("change",this,e,!0)})),!1;g.event.add(this,"beforeactivate._change",function(e){var t=e.target;z.test(t.nodeName)&&!g._data(t,"_change_attached")&&(g.event.add(t,"change._change",function(e){!this.parentNode||e.isSimulated||e.isTrigger||g.event.simulate("change",this.parentNode,e,!0)}),g._data(t,"_change_attached",!0))})},handle:function(e){var t=e.target;if(this!==t||e.isSimulated||e.isTrigger||"radio"!==t.type&&"checkbox"!==t.type)return e.handleObj.handler.apply(this,arguments)},teardown:function(){return g.event.remove(this,"._change"),!z.test(this.nodeName)}}),g.support.focusinBubbles||g.each({focus:"focusin",blur:"focusout"},function(e,t){var n=0,i=function(e){g.event.simulate(t,e.target,g.event.fix(e),!0)};g.event.special[t]={setup:function(){0==n++&&r.addEventListener(e,i,!0)},teardown:function(){0==--n&&r.removeEventListener(e,i,!0)}}}),g.fn.extend({on:function(e,n,i,r,s){var o,a;if("object"===(void 0===e?"undefined":_typeof(e))){for(a in"string"!=typeof n&&(i=i||n,n=t),e)this.on(a,n,i,e[a],s);return this}if(null==i&&null==r?(r=n,i=n=t):null==r&&("string"==typeof n?(r=i,i=t):(r=i,i=n,n=t)),!1===r)r=ee;else if(!r)return this;return 1===s&&(o=r,(r=function(e){return g().off(e),o.apply(this,arguments)}).guid=o.guid||(o.guid=g.guid++)),this.each(function(){g.event.add(this,e,r,i,n)})},one:function(e,t,n,i){return this.on(e,t,n,i,1)},off:function(e,n,i){var r,s;if(e&&e.preventDefault&&e.handleObj)return r=e.handleObj,g(e.delegateTarget).off(r.namespace?r.origType+"."+r.namespace:r.origType,r.selector,r.handler),this;if("object"===(void 0===e?"undefined":_typeof(e))){for(s in e)this.off(s,n,e[s]);return this}return!1!==n&&"function"!=typeof n||(i=n,n=t),!1===i&&(i=ee),this.each(function(){g.event.remove(this,e,i,n)})},bind:function(e,t,n){return this.on(e,null,t,n)},unbind:function(e,t){return this.off(e,null,t)},live:function(e,t,n){return g(this.context).on(e,this.selector,t,n),this},die:function(e,t){return g(this.context).off(e,this.selector||"**",t),this},delegate:function(e,t,n,i){return this.on(t,e,n,i)},undelegate:function(e,t,n){return 1===arguments.length?this.off(e,"**"):this.off(t,e||"**",n)},trigger:function(e,t){return this.each(function(){g.event.trigger(e,t,this)})},triggerHandler:function(e,t){if(this[0])return g.event.trigger(e,t,this[0],!0)},toggle:function(e){var t=arguments,n=e.guid||g.guid++,i=0,r=function(n){var r=(g._data(this,"lastToggle"+e.guid)||0)%i;return g._data(this,"lastToggle"+e.guid,r+1),n.preventDefault(),t[r].apply(this,arguments)||!1};for(r.guid=n;i<t.length;)t[i++].guid=n;return this.click(r)},hover:function(e,t){return this.mouseenter(e).mouseleave(t||e)}}),g.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(e,t){g.fn[t]=function(e,n){return null==n&&(n=e,e=null),arguments.length>0?this.on(t,null,e,n):this.trigger(t)},J.test(t)&&(g.event.fixHooks[t]=g.event.keyHooks),Q.test(t)&&(g.event.fixHooks[t]=g.event.mouseHooks)}),function(e,t){var n,i,r,s,o,a,c,l,u,h,d,f,p,m,_,v,y,b,S=("sizcache"+Math.random()).replace(".",""),C=String,w=e.document,T=w.documentElement,k=0,E=0,A=[].pop,x=[].push,R=[].slice,I=[].indexOf||function(e){for(var t=0,n=this.length;t<n;t++)if(this[t]===e)return t;return-1},L=function(e,t){return e[S]=null==t||t,e},M=function(){var e={},t=[];return L(function(n,i){return t.push(n)>r.cacheLength&&delete e[t.shift()],e[n+" "]=i},e)},P=M(),O=M(),D=M(),N="[\\x20\\t\\r\\n\\f]",F="(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+",j=F.replace("w","w#"),U="\\["+N+"*("+F+")"+N+"*(?:([*^$|!~]?=)"+N+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+j+")|)|)"+N+"*\\]",q=":("+F+")(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|([^()[\\]]*|(?:(?:"+U+")|[^:]|\\\\.)*|.*))\\)|)",V=":(even|odd|eq|gt|lt|nth|first|last)(?:\\("+N+"*((?:-\\d)?\\d*)"+N+"*\\)|)(?=[^-]|$)",B=new RegExp("^"+N+"+|((?:^|[^\\\\])(?:\\\\.)*)"+N+"+$","g"),H=new RegExp("^"+N+"*,"+N+"*"),W=new RegExp("^"+N+"*([\\x20\\t\\r\\n\\f>+~])"+N+"*"),G=new RegExp(q),z=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,K=/[\x20\t\r\n\f]*[+~]/,Y=/h\d/i,J=/input|select|textarea|button/i,Q=/\\(?!\\)/g,X={ID:new RegExp("^#("+F+")"),CLASS:new RegExp("^\\.("+F+")"),NAME:new RegExp("^\\[name=['\"]?("+F+")['\"]?\\]"),TAG:new RegExp("^("+F.replace("w","w*")+")"),ATTR:new RegExp("^"+U),PSEUDO:new RegExp("^"+q),POS:new RegExp(V,"i"),CHILD:new RegExp("^:(only|nth|first|last)-child(?:\\("+N+"*(even|odd|(([+-]|)(\\d*)n|)"+N+"*(?:([+-]|)"+N+"*(\\d+)|))"+N+"*\\)|)","i"),needsContext:new RegExp("^"+N+"*[>+~]|"+V,"i")},Z=function(e){var t=w.createElement("div");try{return e(t)}catch(e){return!1}finally{t=null}},ee=Z(function(e){return e.appendChild(w.createComment("")),!e.getElementsByTagName("*").length}),te=Z(function(e){return e.innerHTML="<a href='#'></a>",e.firstChild&&"undefined"!==_typeof(e.firstChild.getAttribute)&&"#"===e.firstChild.getAttribute("href")}),ne=Z(function(e){e.innerHTML="<select></select>";var t=_typeof(e.lastChild.getAttribute("multiple"));return"boolean"!==t&&"string"!==t}),ie=Z(function(e){return e.innerHTML="<div class='hidden e'></div><div class='hidden'></div>",!(!e.getElementsByClassName||!e.getElementsByClassName("e").length)&&(e.lastChild.className="e",2===e.getElementsByClassName("e").length)}),re=Z(function(e){e.id=S+0,e.innerHTML="<a name='"+S+"'></a><div name='"+S+"'></div>",T.insertBefore(e,T.firstChild);var t=w.getElementsByName&&w.getElementsByName(S).length===2+w.getElementsByName(S+0).length;return i=!w.getElementById(S),T.removeChild(e),t});try{R.call(T.childNodes,0)[0].nodeType}catch(e){R=function(e){for(var t,n=[];t=this[e];e++)n.push(t);return n}}function se(e,t,n,i){n=n||[];var r,s,c,l,u=(t=t||w).nodeType;if(!e||"string"!=typeof e)return n;if(1!==u&&9!==u)return[];if(!(c=o(t))&&!i&&(r=z.exec(e)))if(l=r[1]){if(9===u){if(!(s=t.getElementById(l))||!s.parentNode)return n;if(s.id===l)return n.push(s),n}else if(t.ownerDocument&&(s=t.ownerDocument.getElementById(l))&&a(t,s)&&s.id===l)return n.push(s),n}else{if(r[2])return x.apply(n,R.call(t.getElementsByTagName(e),0)),n;if((l=r[3])&&ie&&t.getElementsByClassName)return x.apply(n,R.call(t.getElementsByClassName(l),0)),n}return me(e.replace(B,"$1"),t,n,i,c)}function oe(e){return function(t){return"input"===t.nodeName.toLowerCase()&&t.type===e}}function ae(e){return function(t){var n=t.nodeName.toLowerCase();return("input"===n||"button"===n)&&t.type===e}}function ce(e){return L(function(t){return t=+t,L(function(n,i){for(var r,s=e([],n.length,t),o=s.length;o--;)n[r=s[o]]&&(n[r]=!(i[r]=n[r]))})})}function le(e,t,n){if(e===t)return n;for(var i=e.nextSibling;i;){if(i===t)return-1;i=i.nextSibling}return 1}function ue(e,t){var n,i,s,o,a,c,l,u=O[S][e+" "];if(u)return t?0:u.slice(0);for(a=e,c=[],l=r.preFilter;a;){for(o in n&&!(i=H.exec(a))||(i&&(a=a.slice(i[0].length)||a),c.push(s=[])),n=!1,(i=W.exec(a))&&(s.push(n=new C(i.shift())),a=a.slice(n.length),n.type=i[0].replace(B," ")),r.filter)!(i=X[o].exec(a))||l[o]&&!(i=l[o](i))||(s.push(n=new C(i.shift())),a=a.slice(n.length),n.type=o,n.matches=i);if(!n)break}return t?a.length:a?se.error(e):O(e,c).slice(0)}function he(e,t,i){var r=t.dir,s=i&&"parentNode"===t.dir,o=E++;return t.first?function(t,n,i){for(;t=t[r];)if(s||1===t.nodeType)return e(t,n,i)}:function(t,i,a){if(a){for(;t=t[r];)if((s||1===t.nodeType)&&e(t,i,a))return t}else for(var c,l=k+" "+o+" ",u=l+n;t=t[r];)if(s||1===t.nodeType){if((c=t[S])===u)return t.sizset;if("string"==typeof c&&0===c.indexOf(l)){if(t.sizset)return t}else{if(t[S]=u,e(t,i,a))return t.sizset=!0,t;t.sizset=!1}}}}function de(e){return e.length>1?function(t,n,i){for(var r=e.length;r--;)if(!e[r](t,n,i))return!1;return!0}:e[0]}function fe(e,t,n,i,r){for(var s,o=[],a=0,c=e.length,l=null!=t;a<c;a++)(s=e[a])&&(n&&!n(s,i,r)||(o.push(s),l&&t.push(a)));return o}function pe(e,t,n,i,r,s){return i&&!i[S]&&(i=pe(i)),r&&!r[S]&&(r=pe(r,s)),L(function(s,o,a,c){var l,u,h,d=[],f=[],p=o.length,g=s||function(e,t,n){for(var i=0,r=t.length;i<r;i++)se(e,t[i],n);return n}(t||"*",a.nodeType?[a]:a,[]),m=!e||!s&&t?g:fe(g,d,e,a,c),_=n?r||(s?e:p||i)?[]:o:m;if(n&&n(m,_,a,c),i)for(l=fe(_,f),i(l,[],a,c),u=l.length;u--;)(h=l[u])&&(_[f[u]]=!(m[f[u]]=h));if(s){if(r||e){if(r){for(l=[],u=_.length;u--;)(h=_[u])&&l.push(m[u]=h);r(null,_=[],l,c)}for(u=_.length;u--;)(h=_[u])&&(l=r?I.call(s,h):d[u])>-1&&(s[l]=!(o[l]=h))}}else _=fe(_===o?_.splice(p,_.length):_),r?r(null,o,_,c):x.apply(o,_)})}function ge(e){for(var t,n,i,s=e.length,o=r.relative[e[0].type],a=o||r.relative[" "],c=o?1:0,l=he(function(e){return e===t},a,!0),u=he(function(e){return I.call(t,e)>-1},a,!0),d=[function(e,n,i){return!o&&(i||n!==h)||((t=n).nodeType?l(e,n,i):u(e,n,i))}];c<s;c++)if(n=r.relative[e[c].type])d=[he(de(d),n)];else{if((n=r.filter[e[c].type].apply(null,e[c].matches))[S]){for(i=++c;i<s&&!r.relative[e[i].type];i++);return pe(c>1&&de(d),c>1&&e.slice(0,c-1).join("").replace(B,"$1"),n,c<i&&ge(e.slice(c,i)),i<s&&ge(e=e.slice(i)),i<s&&e.join(""))}d.push(n)}return de(d)}function me(e,t,n,i,s){var o,a,l,u,h,d=ue(e);d.length;if(!i&&1===d.length){if((a=d[0]=d[0].slice(0)).length>2&&"ID"===(l=a[0]).type&&9===t.nodeType&&!s&&r.relative[a[1].type]){if(!(t=r.find.ID(l.matches[0].replace(Q,""),t,s)[0]))return n;e=e.slice(a.shift().length)}for(o=X.POS.test(e)?-1:a.length-1;o>=0&&(l=a[o],!r.relative[u=l.type]);o--)if((h=r.find[u])&&(i=h(l.matches[0].replace(Q,""),K.test(a[0].type)&&t.parentNode||t,s))){if(a.splice(o,1),!(e=i.length&&a.join("")))return x.apply(n,R.call(i,0)),n;break}}return c(e,d)(i,t,s,n,K.test(e)),n}function _e(){}se.matches=function(e,t){return se(e,null,null,t)},se.matchesSelector=function(e,t){return se(t,null,null,[e]).length>0},s=se.getText=function(e){var t,n="",i=0,r=e.nodeType;if(r){if(1===r||9===r||11===r){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)n+=s(e)}else if(3===r||4===r)return e.nodeValue}else for(;t=e[i];i++)n+=s(t);return n},o=se.isXML=function(e){var t=e&&(e.ownerDocument||e).documentElement;return!!t&&"HTML"!==t.nodeName},a=se.contains=T.contains?function(e,t){var n=9===e.nodeType?e.documentElement:e,i=t&&t.parentNode;return e===i||!!(i&&1===i.nodeType&&n.contains&&n.contains(i))}:T.compareDocumentPosition?function(e,t){return t&&!!(16&e.compareDocumentPosition(t))}:function(e,t){for(;t=t.parentNode;)if(t===e)return!0;return!1},se.attr=function(e,t){var n,i=o(e);return i||(t=t.toLowerCase()),(n=r.attrHandle[t])?n(e):i||ne?e.getAttribute(t):(n=e.getAttributeNode(t))?"boolean"==typeof e[t]?e[t]?t:null:n.specified?n.value:null:null},r=se.selectors={cacheLength:50,createPseudo:L,match:X,attrHandle:te?{}:{href:function(e){return e.getAttribute("href",2)},type:function(e){return e.getAttribute("type")}},find:{ID:i?function(e,t,n){if("undefined"!==_typeof(t.getElementById)&&!n){var i=t.getElementById(e);return i&&i.parentNode?[i]:[]}}:function(e,t,n){if("undefined"!==_typeof(t.getElementById)&&!n){var i=t.getElementById(e);return i?i.id===e||"undefined"!==_typeof(i.getAttributeNode)&&i.getAttributeNode("id").value===e?[i]:void 0:[]}},TAG:ee?function(e,t){if("undefined"!==_typeof(t.getElementsByTagName))return t.getElementsByTagName(e)}:function(e,t){var n=t.getElementsByTagName(e);if("*"===e){for(var i,r=[],s=0;i=n[s];s++)1===i.nodeType&&r.push(i);return r}return n},NAME:re&&function(e,t){if("undefined"!==_typeof(t.getElementsByName))return t.getElementsByName(name)},CLASS:ie&&function(e,t,n){if("undefined"!==_typeof(t.getElementsByClassName)&&!n)return t.getElementsByClassName(e)}},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(e){return e[1]=e[1].replace(Q,""),e[3]=(e[4]||e[5]||"").replace(Q,""),"~="===e[2]&&(e[3]=" "+e[3]+" "),e.slice(0,4)},CHILD:function(e){return e[1]=e[1].toLowerCase(),"nth"===e[1]?(e[2]||se.error(e[0]),e[3]=+(e[3]?e[4]+(e[5]||1):2*("even"===e[2]||"odd"===e[2])),e[4]=+(e[6]+e[7]||"odd"===e[2])):e[2]&&se.error(e[0]),e},PSEUDO:function(e){var t,n;return X.CHILD.test(e[0])?null:(e[3]?e[2]=e[3]:(t=e[4])&&(G.test(t)&&(n=ue(t,!0))&&(n=t.indexOf(")",t.length-n)-t.length)&&(t=t.slice(0,n),e[0]=e[0].slice(0,n)),e[2]=t),e.slice(0,3))}},filter:{ID:i?function(e){return e=e.replace(Q,""),function(t){return t.getAttribute("id")===e}}:function(e){return e=e.replace(Q,""),function(t){var n="undefined"!==_typeof(t.getAttributeNode)&&t.getAttributeNode("id");return n&&n.value===e}},TAG:function(e){return"*"===e?function(){return!0}:(e=e.replace(Q,"").toLowerCase(),function(t){return t.nodeName&&t.nodeName.toLowerCase()===e})},CLASS:function(e){var t=P[S][e+" "];return t||(t=new RegExp("(^|"+N+")"+e+"("+N+"|$)"))&&P(e,function(e){return t.test(e.className||"undefined"!==_typeof(e.getAttribute)&&e.getAttribute("class")||"")})},ATTR:function(e,t,n){return function(i,r){var s=se.attr(i,e);return null==s?"!="===t:!t||(s+="","="===t?s===n:"!="===t?s!==n:"^="===t?n&&0===s.indexOf(n):"*="===t?n&&s.indexOf(n)>-1:"$="===t?n&&s.substr(s.length-n.length)===n:"~="===t?(" "+s+" ").indexOf(n)>-1:"|="===t&&(s===n||s.substr(0,n.length+1)===n+"-"))}},CHILD:function(e,t,n,i){return"nth"===e?function(e){var t,r,s=e.parentNode;if(1===n&&0===i)return!0;if(s)for(r=0,t=s.firstChild;t&&(1!==t.nodeType||(r++,e!==t));t=t.nextSibling);return(r-=i)===n||r%n==0&&r/n>=0}:function(t){var n=t;switch(e){case"only":case"first":for(;n=n.previousSibling;)if(1===n.nodeType)return!1;if("first"===e)return!0;n=t;case"last":for(;n=n.nextSibling;)if(1===n.nodeType)return!1;return!0}}},PSEUDO:function(e,t){var n,i=r.pseudos[e]||r.setFilters[e.toLowerCase()]||se.error("unsupported pseudo: "+e);return i[S]?i(t):i.length>1?(n=[e,e,"",t],r.setFilters.hasOwnProperty(e.toLowerCase())?L(function(e,n){for(var r,s=i(e,t),o=s.length;o--;)e[r=I.call(e,s[o])]=!(n[r]=s[o])}):function(e){return i(e,0,n)}):i}},pseudos:{not:L(function(e){var t=[],n=[],i=c(e.replace(B,"$1"));return i[S]?L(function(e,t,n,r){for(var s,o=i(e,null,r,[]),a=e.length;a--;)(s=o[a])&&(e[a]=!(t[a]=s))}):function(e,r,s){return t[0]=e,i(t,null,s,n),!n.pop()}}),has:L(function(e){return function(t){return se(e,t).length>0}}),contains:L(function(e){return function(t){return(t.textContent||t.innerText||s(t)).indexOf(e)>-1}}),enabled:function(e){return!1===e.disabled},disabled:function(e){return!0===e.disabled},checked:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&!!e.checked||"option"===t&&!!e.selected},selected:function(e){return e.parentNode&&e.parentNode.selectedIndex,!0===e.selected},parent:function(e){return!r.pseudos.empty(e)},empty:function(e){var t;for(e=e.firstChild;e;){if(e.nodeName>"@"||3===(t=e.nodeType)||4===t)return!1;e=e.nextSibling}return!0},header:function(e){return Y.test(e.nodeName)},text:function(e){var t,n;return"input"===e.nodeName.toLowerCase()&&"text"===(t=e.type)&&(null==(n=e.getAttribute("type"))||n.toLowerCase()===t)},radio:oe("radio"),checkbox:oe("checkbox"),file:oe("file"),password:oe("password"),image:oe("image"),submit:ae("submit"),reset:ae("reset"),button:function(e){var t=e.nodeName.toLowerCase();return"input"===t&&"button"===e.type||"button"===t},input:function(e){return J.test(e.nodeName)},focus:function(e){var t=e.ownerDocument;return e===t.activeElement&&(!t.hasFocus||t.hasFocus())&&!!(e.type||e.href||~e.tabIndex)},active:function(e){return e===e.ownerDocument.activeElement},first:ce(function(){return[0]}),last:ce(function(e,t){return[t-1]}),eq:ce(function(e,t,n){return[n<0?n+t:n]}),even:ce(function(e,t){for(var n=0;n<t;n+=2)e.push(n);return e}),odd:ce(function(e,t){for(var n=1;n<t;n+=2)e.push(n);return e}),lt:ce(function(e,t,n){for(var i=n<0?n+t:n;--i>=0;)e.push(i);return e}),gt:ce(function(e,t,n){for(var i=n<0?n+t:n;++i<t;)e.push(i);return e})}},l=T.compareDocumentPosition?function(e,t){return e===t?(u=!0,0):(e.compareDocumentPosition&&t.compareDocumentPosition?4&e.compareDocumentPosition(t):e.compareDocumentPosition)?-1:1}:function(e,t){if(e===t)return u=!0,0;if(e.sourceIndex&&t.sourceIndex)return e.sourceIndex-t.sourceIndex;var n,i,r=[],s=[],o=e.parentNode,a=t.parentNode,c=o;if(o===a)return le(e,t);if(!o)return-1;if(!a)return 1;for(;c;)r.unshift(c),c=c.parentNode;for(c=a;c;)s.unshift(c),c=c.parentNode;n=r.length,i=s.length;for(var l=0;l<n&&l<i;l++)if(r[l]!==s[l])return le(r[l],s[l]);return l===n?le(e,s[l],-1):le(r[l],t,1)},[0,0].sort(l),d=!u,se.uniqueSort=function(e){var t,n=[],i=1,r=0;if(u=d,e.sort(l),u){for(;t=e[i];i++)t===e[i-1]&&(r=n.push(i));for(;r--;)e.splice(n[r],1)}return e},se.error=function(e){throw new Error("Syntax error, unrecognized expression: "+e)},c=se.compile=function(e,t){var i,s=[],o=[],a=D[S][e+" "];if(!a){for(t||(t=ue(e)),i=t.length;i--;)(a=ge(t[i]))[S]?s.push(a):o.push(a);a=D(e,function(e,t){var i=t.length>0,s=e.length>0,o=function o(a,c,l,u,d){var f,p,g,m=[],_=0,v="0",y=a&&[],b=null!=d,S=h,C=a||s&&r.find.TAG("*",d&&c.parentNode||c),T=k+=null==S?1:Math.E;for(b&&(h=c!==w&&c,n=o.el);null!=(f=C[v]);v++){if(s&&f){for(p=0;g=e[p];p++)if(g(f,c,l)){u.push(f);break}b&&(k=T,n=++o.el)}i&&((f=!g&&f)&&_--,a&&y.push(f))}if(_+=v,i&&v!==_){for(p=0;g=t[p];p++)g(y,m,c,l);if(a){if(_>0)for(;v--;)y[v]||m[v]||(m[v]=A.call(u));m=fe(m)}x.apply(u,m),b&&!a&&m.length>0&&_+t.length>1&&se.uniqueSort(u)}return b&&(k=T,h=S),y};return o.el=0,i?L(o):o}(o,s))}return a},w.querySelectorAll&&(p=me,m=/'|\\/g,_=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,v=[":focus"],y=[":active"],b=T.matchesSelector||T.mozMatchesSelector||T.webkitMatchesSelector||T.oMatchesSelector||T.msMatchesSelector,Z(function(e){e.innerHTML="<select><option selected=''></option></select>",e.querySelectorAll("[selected]").length||v.push("\\["+N+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)"),e.querySelectorAll(":checked").length||v.push(":checked")}),Z(function(e){e.innerHTML="<p test=''></p>",e.querySelectorAll("[test^='']").length&&v.push("[*^$]="+N+"*(?:\"\"|'')"),e.innerHTML="<input type='hidden'/>",e.querySelectorAll(":enabled").length||v.push(":enabled",":disabled")}),v=new RegExp(v.join("|")),me=function(e,t,n,i,r){if(!i&&!r&&!v.test(e)){var s,o,a=!0,c=S,l=t,u=9===t.nodeType&&e;if(1===t.nodeType&&"object"!==t.nodeName.toLowerCase()){for(s=ue(e),(a=t.getAttribute("id"))?c=a.replace(m,"\\$&"):t.setAttribute("id",c),c="[id='"+c+"'] ",o=s.length;o--;)s[o]=c+s[o].join("");l=K.test(e)&&t.parentNode||t,u=s.join(",")}if(u)try{return x.apply(n,R.call(l.querySelectorAll(u),0)),n}catch(e){}finally{a||t.removeAttribute("id")}}return p(e,t,n,i,r)},b&&(Z(function(e){f=b.call(e,"div");try{b.call(e,"[test!='']:sizzle"),y.push("!=",q)}catch(e){}}),y=new RegExp(y.join("|")),se.matchesSelector=function(e,t){if(t=t.replace(_,"='$1']"),!o(e)&&!y.test(t)&&!v.test(t))try{var n=b.call(e,t);if(n||f||e.document&&11!==e.document.nodeType)return n}catch(e){}return se(t,null,null,[e]).length>0})),r.pseudos.nth=r.pseudos.eq,r.filters=_e.prototype=r.pseudos,r.setFilters=new _e,se.attr=g.attr,g.find=se,g.expr=se.selectors,g.expr[":"]=g.expr.pseudos,g.unique=se.uniqueSort,g.text=se.getText,g.isXMLDoc=se.isXML,g.contains=se.contains}(e);var ne=/Until$/,ie=/^(?:parents|prev(?:Until|All))/,re=/^.[^:#\[\.,]*$/,se=g.expr.match.needsContext,oe={children:!0,contents:!0,next:!0,prev:!0};function ae(e){return!e||!e.parentNode||11===e.parentNode.nodeType}function ce(e,t){do{e=e[t]}while(e&&1!==e.nodeType);return e}function le(e,t,n){if(t=t||0,g.isFunction(t))return g.grep(e,function(e,i){return!!t.call(e,i,e)===n});if(t.nodeType)return g.grep(e,function(e,i){return e===t===n});if("string"==typeof t){var i=g.grep(e,function(e){return 1===e.nodeType});if(re.test(t))return g.filter(t,i,!n);t=g.filter(t,i)}return g.grep(e,function(e,i){return g.inArray(e,t)>=0===n})}function ue(e){var t=fe.split("|"),n=e.createDocumentFragment();if(n.createElement)for(;t.length;)n.createElement(t.pop());return n}g.fn.extend({find:function(e){var t,n,i,r,s,o,a=this;if("string"!=typeof e)return g(e).filter(function(){for(t=0,n=a.length;t<n;t++)if(g.contains(a[t],this))return!0});for(o=this.pushStack("","find",e),t=0,n=this.length;t<n;t++)if(i=o.length,g.find(e,this[t],o),t>0)for(r=i;r<o.length;r++)for(s=0;s<i;s++)if(o[s]===o[r]){o.splice(r--,1);break}return o},has:function(e){var t,n=g(e,this),i=n.length;return this.filter(function(){for(t=0;t<i;t++)if(g.contains(this,n[t]))return!0})},not:function(e){return this.pushStack(le(this,e,!1),"not",e)},filter:function(e){return this.pushStack(le(this,e,!0),"filter",e)},is:function(e){return!!e&&("string"==typeof e?se.test(e)?g(e,this.context).index(this[0])>=0:g.filter(e,this).length>0:this.filter(e).length>0)},closest:function(e,t){for(var n,i=0,r=this.length,s=[],o=se.test(e)||"string"!=typeof e?g(e,t||this.context):0;i<r;i++)for(n=this[i];n&&n.ownerDocument&&n!==t&&11!==n.nodeType;){if(o?o.index(n)>-1:g.find.matchesSelector(n,e)){s.push(n);break}n=n.parentNode}return s=s.length>1?g.unique(s):s,this.pushStack(s,"closest",e)},index:function(e){return e?"string"==typeof e?g.inArray(this[0],g(e)):g.inArray(e.jquery?e[0]:e,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(e,t){var n="string"==typeof e?g(e,t):g.makeArray(e&&e.nodeType?[e]:e),i=g.merge(this.get(),n);return this.pushStack(ae(n[0])||ae(i[0])?i:g.unique(i))},addBack:function(e){return this.add(null==e?this.prevObject:this.prevObject.filter(e))}}),g.fn.andSelf=g.fn.addBack,g.each({parent:function(e){var t=e.parentNode;return t&&11!==t.nodeType?t:null},parents:function(e){return g.dir(e,"parentNode")},parentsUntil:function(e,t,n){return g.dir(e,"parentNode",n)},next:function(e){return ce(e,"nextSibling")},prev:function(e){return ce(e,"previousSibling")},nextAll:function(e){return g.dir(e,"nextSibling")},prevAll:function(e){return g.dir(e,"previousSibling")},nextUntil:function(e,t,n){return g.dir(e,"nextSibling",n)},prevUntil:function(e,t,n){return g.dir(e,"previousSibling",n)},siblings:function(e){return g.sibling((e.parentNode||{}).firstChild,e)},children:function(e){return g.sibling(e.firstChild)},contents:function(e){return g.nodeName(e,"iframe")?e.contentDocument||e.contentWindow.document:g.merge([],e.childNodes)}},function(e,t){g.fn[e]=function(n,i){var r=g.map(this,t,n);return ne.test(e)||(i=n),i&&"string"==typeof i&&(r=g.filter(i,r)),r=this.length>1&&!oe[e]?g.unique(r):r,this.length>1&&ie.test(e)&&(r=r.reverse()),this.pushStack(r,e,u.call(arguments).join(","))}}),g.extend({filter:function(e,t,n){return n&&(e=":not("+e+")"),1===t.length?g.find.matchesSelector(t[0],e)?[t[0]]:[]:g.find.matches(e,t)},dir:function(e,n,i){for(var r=[],s=e[n];s&&9!==s.nodeType&&(i===t||1!==s.nodeType||!g(s).is(i));)1===s.nodeType&&r.push(s),s=s[n];return r},sibling:function(e,t){for(var n=[];e;e=e.nextSibling)1===e.nodeType&&e!==t&&n.push(e);return n}});var he,de,fe="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",pe=/ jQuery\d+="(?:null|\d+)"/g,ge=/^\s+/,me=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,_e=/<([\w:]+)/,ve=/<tbody/i,ye=/<|&#?\w+;/,be=/<(?:script|style|link)/i,Se=/<(?:script|object|embed|option|style)/i,Ce=new RegExp("<(?:"+fe+")[\\s/>]","i"),we=/^(?:checkbox|radio)$/,Te=/checked\s*(?:[^=]|=\s*.checked.)/i,ke=/\/(java|ecma)script/i,Ee=/^\s*<!(?:\[CDATA\[|\-\-)|[\]\-]{2}>\s*$/g,Ae={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]},xe=ue(r),Re=xe.appendChild(r.createElement("div"));function Ie(e,t){if(1===t.nodeType&&g.hasData(e)){var n,i,r,s=g._data(e),o=g._data(t,s),a=s.events;if(a)for(n in delete o.handle,o.events={},a)for(i=0,r=a[n].length;i<r;i++)g.event.add(t,n,a[n][i]);o.data&&(o.data=g.extend({},o.data))}}function Le(e,t){var n;1===t.nodeType&&(t.clearAttributes&&t.clearAttributes(),t.mergeAttributes&&t.mergeAttributes(e),"object"===(n=t.nodeName.toLowerCase())?(t.parentNode&&(t.outerHTML=e.outerHTML),g.support.html5Clone&&e.innerHTML&&!g.trim(t.innerHTML)&&(t.innerHTML=e.innerHTML)):"input"===n&&we.test(e.type)?(t.defaultChecked=t.checked=e.checked,t.value!==e.value&&(t.value=e.value)):"option"===n?t.selected=e.defaultSelected:"input"===n||"textarea"===n?t.defaultValue=e.defaultValue:"script"===n&&t.text!==e.text&&(t.text=e.text),t.removeAttribute(g.expando))}function Me(e){return void 0!==e.getElementsByTagName?e.getElementsByTagName("*"):void 0!==e.querySelectorAll?e.querySelectorAll("*"):[]}function Pe(e){we.test(e.type)&&(e.defaultChecked=e.checked)}Ae.optgroup=Ae.option,Ae.tbody=Ae.tfoot=Ae.colgroup=Ae.caption=Ae.thead,Ae.th=Ae.td,g.support.htmlSerialize||(Ae._default=[1,"X<div>","</div>"]),g.fn.extend({text:function(e){return g.access(this,function(e){return e===t?g.text(this):this.empty().append((this[0]&&this[0].ownerDocument||r).createTextNode(e))},null,e,arguments.length)},wrapAll:function(e){if(g.isFunction(e))return this.each(function(t){g(this).wrapAll(e.call(this,t))});if(this[0]){var t=g(e,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]),t.map(function(){for(var e=this;e.firstChild&&1===e.firstChild.nodeType;)e=e.firstChild;return e}).append(this)}return this},wrapInner:function(e){return g.isFunction(e)?this.each(function(t){g(this).wrapInner(e.call(this,t))}):this.each(function(){var t=g(this),n=t.contents();n.length?n.wrapAll(e):t.append(e)})},wrap:function(e){var t=g.isFunction(e);return this.each(function(n){g(this).wrapAll(t?e.call(this,n):e)})},unwrap:function(){return this.parent().each(function(){g.nodeName(this,"body")||g(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(e){1!==this.nodeType&&11!==this.nodeType||this.appendChild(e)})},prepend:function(){return this.domManip(arguments,!0,function(e){1!==this.nodeType&&11!==this.nodeType||this.insertBefore(e,this.firstChild)})},before:function(){if(!ae(this[0]))return this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this)});if(arguments.length){var e=g.clean(arguments);return this.pushStack(g.merge(e,this),"before",this.selector)}},after:function(){if(!ae(this[0]))return this.domManip(arguments,!1,function(e){this.parentNode.insertBefore(e,this.nextSibling)});if(arguments.length){var e=g.clean(arguments);return this.pushStack(g.merge(this,e),"after",this.selector)}},remove:function(e,t){for(var n,i=0;null!=(n=this[i]);i++)e&&!g.filter(e,[n]).length||(t||1!==n.nodeType||(g.cleanData(n.getElementsByTagName("*")),g.cleanData([n])),n.parentNode&&n.parentNode.removeChild(n));return this},empty:function(){for(var e,t=0;null!=(e=this[t]);t++)for(1===e.nodeType&&g.cleanData(e.getElementsByTagName("*"));e.firstChild;)e.removeChild(e.firstChild);return this},clone:function(e,t){return e=null!=e&&e,t=null==t?e:t,this.map(function(){return g.clone(this,e,t)})},html:function(e){return g.access(this,function(e){var n=this[0]||{},i=0,r=this.length;if(e===t)return 1===n.nodeType?n.innerHTML.replace(pe,""):t;if("string"==typeof e&&!be.test(e)&&(g.support.htmlSerialize||!Ce.test(e))&&(g.support.leadingWhitespace||!ge.test(e))&&!Ae[(_e.exec(e)||["",""])[1].toLowerCase()]){e=e.replace(me,"<$1></$2>");try{for(;i<r;i++)1===(n=this[i]||{}).nodeType&&(g.cleanData(n.getElementsByTagName("*")),n.innerHTML=e);n=0}catch(e){}}n&&this.empty().append(e)},null,e,arguments.length)},replaceWith:function(e){return ae(this[0])?this.length?this.pushStack(g(g.isFunction(e)?e():e),"replaceWith",e):this:g.isFunction(e)?this.each(function(t){var n=g(this),i=n.html();n.replaceWith(e.call(this,t,i))}):("string"!=typeof e&&(e=g(e).detach()),this.each(function(){var t=this.nextSibling,n=this.parentNode;g(this).remove(),t?g(t).before(e):g(n).append(e)}))},detach:function(e){return this.remove(e,!0)},domManip:function(e,n,i){var r,s,o,a,c,l,u=0,h=(e=[].concat.apply([],e))[0],d=[],f=this.length;if(!g.support.checkClone&&f>1&&"string"==typeof h&&Te.test(h))return this.each(function(){g(this).domManip(e,n,i)});if(g.isFunction(h))return this.each(function(r){var s=g(this);e[0]=h.call(this,r,n?s.html():t),s.domManip(e,n,i)});if(this[0]){if(s=(o=(r=g.buildFragment(e,this,d)).fragment).firstChild,1===o.childNodes.length&&(o=s),s)for(n=n&&g.nodeName(s,"tr"),a=r.cacheable||f-1;u<f;u++)i.call(n&&g.nodeName(this[u],"table")?(c=this[u],l="tbody",c.getElementsByTagName(l)[0]||c.appendChild(c.ownerDocument.createElement(l))):this[u],u===a?o:g.clone(o,!0,!0));o=s=null,d.length&&g.each(d,function(e,t){t.src?g.ajax?g.ajax({url:t.src,type:"GET",dataType:"script",async:!1,global:!1,throws:!0}):g.error("no ajax"):g.globalEval((t.text||t.textContent||t.innerHTML||"").replace(Ee,"")),t.parentNode&&t.parentNode.removeChild(t)})}return this}}),g.buildFragment=function(e,n,i){var s,o,a,c=e[0];return n=(n=!(n=n||r).nodeType&&n[0]||n).ownerDocument||n,!(1===e.length&&"string"==typeof c&&c.length<512&&n===r&&"<"===c.charAt(0))||Se.test(c)||!g.support.checkClone&&Te.test(c)||!g.support.html5Clone&&Ce.test(c)||(o=!0,a=(s=g.fragments[c])!==t),s||(s=n.createDocumentFragment(),g.clean(e,n,s,i),o&&(g.fragments[c]=a&&s)),{fragment:s,cacheable:o}},g.fragments={},g.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(e,t){g.fn[e]=function(n){var i,r=0,s=[],o=g(n),a=o.length,c=1===this.length&&this[0].parentNode;if((null==c||c&&11===c.nodeType&&1===c.childNodes.length)&&1===a)return o[t](this[0]),this;for(;r<a;r++)i=(r>0?this.clone(!0):this).get(),g(o[r])[t](i),s=s.concat(i);return this.pushStack(s,e,o.selector)}}),g.extend({clone:function(e,t,n){var i,r,s,o;if(g.support.html5Clone||g.isXMLDoc(e)||!Ce.test("<"+e.nodeName+">")?o=e.cloneNode(!0):(Re.innerHTML=e.outerHTML,Re.removeChild(o=Re.firstChild)),!(g.support.noCloneEvent&&g.support.noCloneChecked||1!==e.nodeType&&11!==e.nodeType||g.isXMLDoc(e)))for(Le(e,o),i=Me(e),r=Me(o),s=0;i[s];++s)r[s]&&Le(i[s],r[s]);if(t&&(Ie(e,o),n))for(i=Me(e),r=Me(o),s=0;i[s];++s)Ie(i[s],r[s]);return i=r=null,o},clean:function(e,t,n,i){var s,o,a,c,l,u,h,d,f,p,m,_=t===r&&xe,v=[];for(t&&void 0!==t.createDocumentFragment||(t=r),s=0;null!=(a=e[s]);s++)if("number"==typeof a&&(a+=""),a){if("string"==typeof a)if(ye.test(a)){for(_=_||ue(t),h=t.createElement("div"),_.appendChild(h),a=a.replace(me,"<$1></$2>"),c=(_e.exec(a)||["",""])[1].toLowerCase(),u=(l=Ae[c]||Ae._default)[0],h.innerHTML=l[1]+a+l[2];u--;)h=h.lastChild;if(!g.support.tbody)for(d=ve.test(a),o=(f="table"!==c||d?"<table>"!==l[1]||d?[]:h.childNodes:h.firstChild&&h.firstChild.childNodes).length-1;o>=0;--o)g.nodeName(f[o],"tbody")&&!f[o].childNodes.length&&f[o].parentNode.removeChild(f[o]);!g.support.leadingWhitespace&&ge.test(a)&&h.insertBefore(t.createTextNode(ge.exec(a)[0]),h.firstChild),a=h.childNodes,h.parentNode.removeChild(h)}else a=t.createTextNode(a);a.nodeType?v.push(a):g.merge(v,a)}if(h&&(a=h=_=null),!g.support.appendChecked)for(s=0;null!=(a=v[s]);s++)g.nodeName(a,"input")?Pe(a):void 0!==a.getElementsByTagName&&g.grep(a.getElementsByTagName("input"),Pe);if(n)for(p=function(e){if(!e.type||ke.test(e.type))return i?i.push(e.parentNode?e.parentNode.removeChild(e):e):n.appendChild(e)},s=0;null!=(a=v[s]);s++)g.nodeName(a,"script")&&p(a)||(n.appendChild(a),void 0!==a.getElementsByTagName&&(m=g.grep(g.merge([],a.getElementsByTagName("script")),p),v.splice.apply(v,[s+1,0].concat(m)),s+=m.length));return v},cleanData:function(e,t){for(var n,i,r,s,o=0,a=g.expando,c=g.cache,l=g.support.deleteExpando,u=g.event.special;null!=(r=e[o]);o++)if((t||g.acceptData(r))&&(n=(i=r[a])&&c[i])){if(n.events)for(s in n.events)u[s]?g.event.remove(r,s):g.removeEvent(r,s,n.handle);c[i]&&(delete c[i],l?delete r[a]:r.removeAttribute?r.removeAttribute(a):r[a]=null,g.deletedIds.push(i))}}}),g.uaMatch=function(e){e=e.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return{browser:t[1]||"",version:t[2]||"0"}},de={},(he=g.uaMatch(o.userAgent)).browser&&(de[he.browser]=!0,de.version=he.version),de.chrome?de.webkit=!0:de.webkit&&(de.safari=!0),g.browser=de,g.sub=function(){function e(t,n){return new e.fn.init(t,n)}g.extend(!0,e,this),e.superclass=this,e.fn=e.prototype=this(),e.fn.constructor=e,e.sub=this.sub,e.fn.init=function(n,i){return i&&i instanceof g&&!(i instanceof e)&&(i=e(i)),g.fn.init.call(this,n,i,t)},e.fn.init.prototype=e.fn;var t=e(r);return e};var Oe,De,Ne,Fe=/alpha\([^)]*\)/i,je=/opacity=([^)]*)/,Ue=/^(top|right|bottom|left)$/,qe=/^(none|table(?!-c[ea]).+)/,Ve=/^margin/,Be=new RegExp("^("+m+")(.*)$","i"),He=new RegExp("^("+m+")(?!px)[a-z%]+$","i"),We=new RegExp("^([-+])=("+m+")","i"),Ge={BODY:"block"},ze={position:"absolute",visibility:"hidden",display:"block"},$e={letterSpacing:0,fontWeight:400},Ke=["Top","Right","Bottom","Left"],Ye=["Webkit","O","Moz","ms"],Je=g.fn.toggle;function Qe(e,t){if(t in e)return t;for(var n=t.charAt(0).toUpperCase()+t.slice(1),i=t,r=Ye.length;r--;)if((t=Ye[r]+n)in e)return t;return i}function Xe(e,t){return e=t||e,"none"===g.css(e,"display")||!g.contains(e.ownerDocument,e)}function Ze(e,t){for(var n,i,r=[],s=0,o=e.length;s<o;s++)(n=e[s]).style&&(r[s]=g._data(n,"olddisplay"),t?(r[s]||"none"!==n.style.display||(n.style.display=""),""===n.style.display&&Xe(n)&&(r[s]=g._data(n,"olddisplay",it(n.nodeName)))):(i=Oe(n,"display"),r[s]||"none"===i||g._data(n,"olddisplay",i)));for(s=0;s<o;s++)(n=e[s]).style&&(t&&"none"!==n.style.display&&""!==n.style.display||(n.style.display=t?r[s]||"":"none"));return e}function et(e,t,n){var i=Be.exec(t);return i?Math.max(0,i[1]-(n||0))+(i[2]||"px"):t}function tt(e,t,n,i){for(var r=n===(i?"border":"content")?4:"width"===t?1:0,s=0;r<4;r+=2)"margin"===n&&(s+=g.css(e,n+Ke[r],!0)),i?("content"===n&&(s-=parseFloat(Oe(e,"padding"+Ke[r]))||0),"margin"!==n&&(s-=parseFloat(Oe(e,"border"+Ke[r]+"Width"))||0)):(s+=parseFloat(Oe(e,"padding"+Ke[r]))||0,"padding"!==n&&(s+=parseFloat(Oe(e,"border"+Ke[r]+"Width"))||0));return s}function nt(e,t,n){var i="width"===t?e.offsetWidth:e.offsetHeight,r=!0,s=g.support.boxSizing&&"border-box"===g.css(e,"boxSizing");if(i<=0||null==i){if(((i=Oe(e,t))<0||null==i)&&(i=e.style[t]),He.test(i))return i;r=s&&(g.support.boxSizingReliable||i===e.style[t]),i=parseFloat(i)||0}return i+tt(e,t,n||(s?"border":"content"),r)+"px"}function it(e){if(Ge[e])return Ge[e];var t=g("<"+e+">").appendTo(r.body),n=t.css("display");return t.remove(),"none"!==n&&""!==n||(De=r.body.appendChild(De||g.extend(r.createElement("iframe"),{frameBorder:0,width:0,height:0})),Ne&&De.createElement||((Ne=(De.contentWindow||De.contentDocument).document).write("<!doctype html><html><body>"),Ne.close()),t=Ne.body.appendChild(Ne.createElement(e)),n=Oe(t,"display"),r.body.removeChild(De)),Ge[e]=n,n}g.fn.extend({css:function(e,n){return g.access(this,function(e,n,i){return i!==t?g.style(e,n,i):g.css(e,n)},e,n,arguments.length>1)},show:function(){return Ze(this,!0)},hide:function(){return Ze(this)},toggle:function(e,t){var n="boolean"==typeof e;return g.isFunction(e)&&g.isFunction(t)?Je.apply(this,arguments):this.each(function(){(n?e:Xe(this))?g(this).show():g(this).hide()})}}),g.extend({cssHooks:{opacity:{get:function(e,t){if(t){var n=Oe(e,"opacity");return""===n?"1":n}}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:g.support.cssFloat?"cssFloat":"styleFloat"},style:function(e,n,i,r){if(e&&3!==e.nodeType&&8!==e.nodeType&&e.style){var s,o,a,c=g.camelCase(n),l=e.style;if(n=g.cssProps[c]||(g.cssProps[c]=Qe(l,c)),a=g.cssHooks[n]||g.cssHooks[c],i===t)return a&&"get"in a&&(s=a.get(e,!1,r))!==t?s:l[n];if(!("string"===(o=void 0===i?"undefined":_typeof(i))&&(s=We.exec(i))&&(i=(s[1]+1)*s[2]+parseFloat(g.css(e,n)),o="number"),null==i||"number"===o&&isNaN(i)||("number"!==o||g.cssNumber[c]||(i+="px"),a&&"set"in a&&(i=a.set(e,i,r))===t)))try{l[n]=i}catch(e){}}},css:function(e,n,i,r){var s,o,a,c=g.camelCase(n);return n=g.cssProps[c]||(g.cssProps[c]=Qe(e.style,c)),(a=g.cssHooks[n]||g.cssHooks[c])&&"get"in a&&(s=a.get(e,!0,r)),s===t&&(s=Oe(e,n)),"normal"===s&&n in $e&&(s=$e[n]),i||r!==t?(o=parseFloat(s),i||g.isNumeric(o)?o||0:s):s},swap:function(e,t,n){var i,r,s={};for(r in t)s[r]=e.style[r],e.style[r]=t[r];for(r in i=n.call(e),t)e.style[r]=s[r];return i}}),e.getComputedStyle?Oe=function(t,n){var i,r,s,o,a=e.getComputedStyle(t,null),c=t.style;return a&&(""!==(i=a.getPropertyValue(n)||a[n])||g.contains(t.ownerDocument,t)||(i=g.style(t,n)),He.test(i)&&Ve.test(n)&&(r=c.width,s=c.minWidth,o=c.maxWidth,c.minWidth=c.maxWidth=c.width=i,i=a.width,c.width=r,c.minWidth=s,c.maxWidth=o)),i}:r.documentElement.currentStyle&&(Oe=function(e,t){var n,i,r=e.currentStyle&&e.currentStyle[t],s=e.style;return null==r&&s&&s[t]&&(r=s[t]),He.test(r)&&!Ue.test(t)&&(n=s.left,(i=e.runtimeStyle&&e.runtimeStyle.left)&&(e.runtimeStyle.left=e.currentStyle.left),s.left="fontSize"===t?"1em":r,r=s.pixelLeft+"px",s.left=n,i&&(e.runtimeStyle.left=i)),""===r?"auto":r}),g.each(["height","width"],function(e,t){g.cssHooks[t]={get:function(e,n,i){if(n)return 0===e.offsetWidth&&qe.test(Oe(e,"display"))?g.swap(e,ze,function(){return nt(e,t,i)}):nt(e,t,i)},set:function(e,n,i){return et(0,n,i?tt(e,t,i,g.support.boxSizing&&"border-box"===g.css(e,"boxSizing")):0)}}}),g.support.opacity||(g.cssHooks.opacity={get:function(e,t){return je.test((t&&e.currentStyle?e.currentStyle.filter:e.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(e,t){var n=e.style,i=e.currentStyle,r=g.isNumeric(t)?"alpha(opacity="+100*t+")":"",s=i&&i.filter||n.filter||"";n.zoom=1,t>=1&&""===g.trim(s.replace(Fe,""))&&n.removeAttribute&&(n.removeAttribute("filter"),i&&!i.filter)||(n.filter=Fe.test(s)?s.replace(Fe,r):s+" "+r)}}),g(function(){g.support.reliableMarginRight||(g.cssHooks.marginRight={get:function(e,t){return g.swap(e,{display:"inline-block"},function(){if(t)return Oe(e,"marginRight")})}}),!g.support.pixelPosition&&g.fn.position&&g.each(["top","left"],function(e,t){g.cssHooks[t]={get:function(e,n){if(n){var i=Oe(e,t);return He.test(i)?g(e).position()[t]+"px":i}}}})}),g.expr&&g.expr.filters&&(g.expr.filters.hidden=function(e){return 0===e.offsetWidth&&0===e.offsetHeight||!g.support.reliableHiddenOffsets&&"none"===(e.style&&e.style.display||Oe(e,"display"))},g.expr.filters.visible=function(e){return!g.expr.filters.hidden(e)}),g.each({margin:"",padding:"",border:"Width"},function(e,t){g.cssHooks[e+t]={expand:function(n){var i,r="string"==typeof n?n.split(" "):[n],s={};for(i=0;i<4;i++)s[e+Ke[i]+t]=r[i]||r[i-2]||r[0];return s}},Ve.test(e)||(g.cssHooks[e+t].set=et)});var rt=/%20/g,st=/\[\]$/,ot=/\r?\n/g,at=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,ct=/^(?:select|textarea)/i;function lt(e,t,n,i){var r;if(g.isArray(t))g.each(t,function(t,r){n||st.test(e)?i(e,r):lt(e+"["+("object"===(void 0===r?"undefined":_typeof(r))?t:"")+"]",r,n,i)});else if(n||"object"!==g.type(t))i(e,t);else for(r in t)lt(e+"["+r+"]",t[r],n,i)}g.fn.extend({serialize:function(){return g.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?g.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||ct.test(this.nodeName)||at.test(this.type))}).map(function(e,t){var n=g(this).val();return null==n?null:g.isArray(n)?g.map(n,function(e,n){return{name:t.name,value:e.replace(ot,"\r\n")}}):{name:t.name,value:n.replace(ot,"\r\n")}}).get()}}),g.param=function(e,n){var i,r=[],s=function(e,t){t=g.isFunction(t)?t():null==t?"":t,r[r.length]=encodeURIComponent(e)+"="+encodeURIComponent(t)};if(n===t&&(n=g.ajaxSettings&&g.ajaxSettings.traditional),g.isArray(e)||e.jquery&&!g.isPlainObject(e))g.each(e,function(){s(this.name,this.value)});else for(i in e)lt(i,e[i],n,s);return r.join("&").replace(rt,"+")};var ut,ht,dt=/#.*$/,ft=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,pt=/^(?:GET|HEAD)$/,gt=/^\/\//,mt=/\?/,_t=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,vt=/([?&])_=[^&]*/,yt=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,bt=g.fn.load,St={},Ct={},wt=["*/"]+["*"];try{ht=s.href}catch(e){(ht=r.createElement("a")).href="",ht=ht.href}function Tt(e){return function(t,n){"string"!=typeof t&&(n=t,t="*");var i,r,s=t.toLowerCase().split(v),o=0,a=s.length;if(g.isFunction(n))for(;o<a;o++)i=s[o],(r=/^\+/.test(i))&&(i=i.substr(1)||"*"),(e[i]=e[i]||[])[r?"unshift":"push"](n)}}function kt(e,n,i,r,s,o){(o=o||{})[s=s||n.dataTypes[0]]=!0;for(var a,c=e[s],l=0,u=c?c.length:0,h=e===St;l<u&&(h||!a);l++)"string"==typeof(a=c[l](n,i,r))&&(!h||o[a]?a=t:(n.dataTypes.unshift(a),a=kt(e,n,i,r,a,o)));return!h&&a||o["*"]||(a=kt(e,n,i,r,"*",o)),a}function Et(e,n){var i,r,s=g.ajaxSettings.flatOptions||{};for(i in n)n[i]!==t&&((s[i]?e:r||(r={}))[i]=n[i]);r&&g.extend(!0,e,r)}ut=yt.exec(ht.toLowerCase())||[],g.fn.load=function(e,n,i){if("string"!=typeof e&&bt)return bt.apply(this,arguments);if(!this.length)return this;var r,s,o,a=this,c=e.indexOf(" ");return c>=0&&(r=e.slice(c,e.length),e=e.slice(0,c)),g.isFunction(n)?(i=n,n=t):n&&"object"===(void 0===n?"undefined":_typeof(n))&&(s="POST"),g.ajax({url:e,type:s,dataType:"html",data:n,complete:function(e,t){i&&a.each(i,o||[e.responseText,t,e])}}).done(function(e){o=arguments,a.html(r?g("<div>").append(e.replace(_t,"")).find(r):e)}),this},g.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(e,t){g.fn[t]=function(e){return this.on(t,e)}}),g.each(["get","post"],function(e,n){g[n]=function(e,i,r,s){return g.isFunction(i)&&(s=s||r,r=i,i=t),g.ajax({type:n,url:e,data:i,success:r,dataType:s})}}),g.extend({getScript:function(e,n){return g.get(e,t,n,"script")},getJSON:function(e,t,n){return g.get(e,t,n,"json")},ajaxSetup:function(e,t){return t?Et(e,g.ajaxSettings):(t=e,e=g.ajaxSettings),Et(e,t),e},ajaxSettings:{url:ht,isLocal:/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/.test(ut[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":wt},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":e.String,"text html":!0,"text json":g.parseJSON,"text xml":g.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:Tt(St),ajaxTransport:Tt(Ct),ajax:function(e,n){"object"===(void 0===e?"undefined":_typeof(e))&&(n=e,e=t),n=n||{};var i,r,s,o,a,c,l,u,h=g.ajaxSetup({},n),d=h.context||h,f=d!==h&&(d.nodeType||d instanceof g)?g(d):g.event,p=g.Deferred(),m=g.Callbacks("once memory"),_=h.statusCode||{},y={},b={},S=0,C="canceled",w={readyState:0,setRequestHeader:function(e,t){if(!S){var n=e.toLowerCase();e=b[n]=b[n]||e,y[e]=t}return this},getAllResponseHeaders:function(){return 2===S?r:null},getResponseHeader:function(e){var n;if(2===S){if(!s)for(s={};n=ft.exec(r);)s[n[1].toLowerCase()]=n[2];n=s[e.toLowerCase()]}return n===t?null:n},overrideMimeType:function(e){return S||(h.mimeType=e),this},abort:function(e){return e=e||C,o&&o.abort(e),T(0,e),this}};function T(e,n,s,c){var u,v,y,b,C,T=n;2!==S&&(S=2,a&&clearTimeout(a),o=t,r=c||"",w.readyState=e>0?4:0,s&&(b=function(e,n,i){var r,s,o,a,c=e.contents,l=e.dataTypes,u=e.responseFields;for(s in u)s in i&&(n[u[s]]=i[s]);for(;"*"===l[0];)l.shift(),r===t&&(r=e.mimeType||n.getResponseHeader("content-type"));if(r)for(s in c)if(c[s]&&c[s].test(r)){l.unshift(s);break}if(l[0]in i)o=l[0];else{for(s in i){if(!l[0]||e.converters[s+" "+l[0]]){o=s;break}a||(a=s)}o=o||a}if(o)return o!==l[0]&&l.unshift(o),i[o]}(h,w,s)),e>=200&&e<300||304===e?(h.ifModified&&((C=w.getResponseHeader("Last-Modified"))&&(g.lastModified[i]=C),(C=w.getResponseHeader("Etag"))&&(g.etag[i]=C)),304===e?(T="notmodified",u=!0):(T=(u=function(e,t){var n,i,r,s,o=e.dataTypes.slice(),a=o[0],c={},l=0;e.dataFilter&&(t=e.dataFilter(t,e.dataType));if(o[1])for(n in e.converters)c[n.toLowerCase()]=e.converters[n];for(;r=o[++l];)if("*"!==r){if("*"!==a&&a!==r){if(!(n=c[a+" "+r]||c["* "+r]))for(i in c)if((s=i.split(" "))[1]===r&&(n=c[a+" "+s[0]]||c["* "+s[0]])){!0===n?n=c[i]:!0!==c[i]&&(r=s[0],o.splice(l--,0,r));break}if(!0!==n)if(n&&e.throws)t=n(t);else try{t=n(t)}catch(e){return{state:"parsererror",error:n?e:"No conversion from "+a+" to "+r}}}a=r}return{state:"success",data:t}}(h,b)).state,v=u.data,u=!(y=u.error))):(y=T,T&&!e||(T="error",e<0&&(e=0))),w.status=e,w.statusText=(n||T)+"",u?p.resolveWith(d,[v,T,w]):p.rejectWith(d,[w,T,y]),w.statusCode(_),_=t,l&&f.trigger("ajax"+(u?"Success":"Error"),[w,h,u?v:y]),m.fireWith(d,[w,T]),l&&(f.trigger("ajaxComplete",[w,h]),--g.active||g.event.trigger("ajaxStop")))}if(p.promise(w),w.success=w.done,w.error=w.fail,w.complete=m.add,w.statusCode=function(e){var t;if(e)if(S<2)for(t in e)_[t]=[_[t],e[t]];else t=e[w.status],w.always(t);return this},h.url=((e||h.url)+"").replace(dt,"").replace(gt,ut[1]+"//"),h.dataTypes=g.trim(h.dataType||"*").toLowerCase().split(v),null==h.crossDomain&&(c=yt.exec(h.url.toLowerCase()),h.crossDomain=!(!c||c[1]===ut[1]&&c[2]===ut[2]&&(c[3]||("http:"===c[1]?80:443))==(ut[3]||("http:"===ut[1]?80:443)))),h.data&&h.processData&&"string"!=typeof h.data&&(h.data=g.param(h.data,h.traditional)),kt(St,h,n,w),2===S)return w;if(l=h.global,h.type=h.type.toUpperCase(),h.hasContent=!pt.test(h.type),l&&0==g.active++&&g.event.trigger("ajaxStart"),!h.hasContent&&(h.data&&(h.url+=(mt.test(h.url)?"&":"?")+h.data,delete h.data),i=h.url,!1===h.cache)){var k=g.now(),E=h.url.replace(vt,"$1_="+k);h.url=E+(E===h.url?(mt.test(h.url)?"&":"?")+"_="+k:"")}for(u in(h.data&&h.hasContent&&!1!==h.contentType||n.contentType)&&w.setRequestHeader("Content-Type",h.contentType),h.ifModified&&(i=i||h.url,g.lastModified[i]&&w.setRequestHeader("If-Modified-Since",g.lastModified[i]),g.etag[i]&&w.setRequestHeader("If-None-Match",g.etag[i])),w.setRequestHeader("Accept",h.dataTypes[0]&&h.accepts[h.dataTypes[0]]?h.accepts[h.dataTypes[0]]+("*"!==h.dataTypes[0]?", "+wt+"; q=0.01":""):h.accepts["*"]),h.headers)w.setRequestHeader(u,h.headers[u]);if(h.beforeSend&&(!1===h.beforeSend.call(d,w,h)||2===S))return w.abort();for(u in C="abort",{success:1,error:1,complete:1})w[u](h[u]);if(o=kt(Ct,h,n,w)){w.readyState=1,l&&f.trigger("ajaxSend",[w,h]),h.async&&h.timeout>0&&(a=setTimeout(function(){w.abort("timeout")},h.timeout));try{S=1,o.send(y,T)}catch(e){if(!(S<2))throw e;T(-1,e)}}else T(-1,"No Transport");return w},active:0,lastModified:{},etag:{}});var At=[],xt=/\?/,Rt=/(=)\?(?=&|$)|\?\?/,It=g.now();g.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var e=At.pop()||g.expando+"_"+It++;return this[e]=!0,e}}),g.ajaxPrefilter("json jsonp",function(n,i,r){var s,o,a,c=n.data,l=n.url,u=!1!==n.jsonp,h=u&&Rt.test(l),d=u&&!h&&"string"==typeof c&&!(n.contentType||"").indexOf("application/x-www-form-urlencoded")&&Rt.test(c);if("jsonp"===n.dataTypes[0]||h||d)return s=n.jsonpCallback=g.isFunction(n.jsonpCallback)?n.jsonpCallback():n.jsonpCallback,o=e[s],h?n.url=l.replace(Rt,"$1"+s):d?n.data=c.replace(Rt,"$1"+s):u&&(n.url+=(xt.test(l)?"&":"?")+n.jsonp+"="+s),n.converters["script json"]=function(){return a||g.error(s+" was not called"),a[0]},n.dataTypes[0]="json",e[s]=function(){a=arguments},r.always(function(){e[s]=o,n[s]&&(n.jsonpCallback=i.jsonpCallback,At.push(s)),a&&g.isFunction(o)&&o(a[0]),a=o=t}),"script"}),g.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(e){return g.globalEval(e),e}}}),g.ajaxPrefilter("script",function(e){e.cache===t&&(e.cache=!1),e.crossDomain&&(e.type="GET",e.global=!1)}),g.ajaxTransport("script",function(e){if(e.crossDomain){var n,i=r.head||r.getElementsByTagName("head")[0]||r.documentElement;return{send:function(s,o){(n=r.createElement("script")).async="async",e.scriptCharset&&(n.charset=e.scriptCharset),n.src=e.url,n.onload=n.onreadystatechange=function(e,r){(r||!n.readyState||/loaded|complete/.test(n.readyState))&&(n.onload=n.onreadystatechange=null,i&&n.parentNode&&i.removeChild(n),n=t,r||o(200,"success"))},i.insertBefore(n,i.firstChild)},abort:function(){n&&n.onload(0,1)}}}});var Lt,Mt,Pt=!!e.ActiveXObject&&function(){for(var e in Lt)Lt[e](0,1)},Ot=0;function Dt(){try{return new e.XMLHttpRequest}catch(e){}}g.ajaxSettings.xhr=e.ActiveXObject?function(){return!this.isLocal&&Dt()||function(){try{return new e.ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}()}:Dt,Mt=g.ajaxSettings.xhr(),g.extend(g.support,{ajax:!!Mt,cors:!!Mt&&"withCredentials"in Mt}),g.support.ajax&&g.ajaxTransport(function(n){var i;if(!n.crossDomain||g.support.cors)return{send:function(r,s){var o,a,c=n.xhr();if(n.username?c.open(n.type,n.url,n.async,n.username,n.password):c.open(n.type,n.url,n.async),n.xhrFields)for(a in n.xhrFields)c[a]=n.xhrFields[a];n.mimeType&&c.overrideMimeType&&c.overrideMimeType(n.mimeType),n.crossDomain||r["X-Requested-With"]||(r["X-Requested-With"]="XMLHttpRequest");try{for(a in r)c.setRequestHeader(a,r[a])}catch(e){}c.send(n.hasContent&&n.data||null),i=function(e,r){var a,l,u,h,d;try{if(i&&(r||4===c.readyState))if(i=t,o&&(c.onreadystatechange=g.noop,Pt&&delete Lt[o]),r)4!==c.readyState&&c.abort();else{a=c.status,u=c.getAllResponseHeaders(),h={},(d=c.responseXML)&&d.documentElement&&(h.xml=d);try{h.text=c.responseText}catch(e){}try{l=c.statusText}catch(e){l=""}a||!n.isLocal||n.crossDomain?1223===a&&(a=204):a=h.text?200:404}}catch(e){r||s(-1,e)}h&&s(a,l,h,u)},n.async?4===c.readyState?setTimeout(i,0):(o=++Ot,Pt&&(Lt||(Lt={},g(e).unload(Pt)),Lt[o]=i),c.onreadystatechange=i):i()},abort:function(){i&&i(0,1)}}});var Nt,Ft,jt=/^(?:toggle|show|hide)$/,Ut=new RegExp("^(?:([-+])=|)("+m+")([a-z%]*)$","i"),qt=/queueHooks$/,Vt=[function(e,t,n){var i,r,s,o,a,c,l,u,h,d=this,f=e.style,p={},m=[],_=e.nodeType&&Xe(e);n.queue||(null==(u=g._queueHooks(e,"fx")).unqueued&&(u.unqueued=0,h=u.empty.fire,u.empty.fire=function(){u.unqueued||h()}),u.unqueued++,d.always(function(){d.always(function(){u.unqueued--,g.queue(e,"fx").length||u.empty.fire()})}));1===e.nodeType&&("height"in t||"width"in t)&&(n.overflow=[f.overflow,f.overflowX,f.overflowY],"inline"===g.css(e,"display")&&"none"===g.css(e,"float")&&(g.support.inlineBlockNeedsLayout&&"inline"!==it(e.nodeName)?f.zoom=1:f.display="inline-block"));n.overflow&&(f.overflow="hidden",g.support.shrinkWrapBlocks||d.done(function(){f.overflow=n.overflow[0],f.overflowX=n.overflow[1],f.overflowY=n.overflow[2]}));for(i in t)if(s=t[i],jt.exec(s)){if(delete t[i],c=c||"toggle"===s,s===(_?"hide":"show"))continue;m.push(i)}if(o=m.length){"hidden"in(a=g._data(e,"fxshow")||g._data(e,"fxshow",{}))&&(_=a.hidden),c&&(a.hidden=!_),_?g(e).show():d.done(function(){g(e).hide()}),d.done(function(){var t;for(t in g.removeData(e,"fxshow",!0),p)g.style(e,t,p[t])});for(i=0;i<o;i++)r=m[i],l=d.createTween(r,_?a[r]:0),p[r]=a[r]||g.style(e,r),r in a||(a[r]=l.start,_&&(l.end=l.start,l.start="width"===r||"height"===r?1:0))}}],Bt={"*":[function(e,t){var n,i,r=this.createTween(e,t),s=Ut.exec(t),o=r.cur(),a=+o||0,c=1,l=20;if(s){if(n=+s[2],"px"!==(i=s[3]||(g.cssNumber[e]?"":"px"))&&a){a=g.css(r.elem,e,!0)||n||1;do{a/=c=c||".5",g.style(r.elem,e,a+i)}while(c!==(c=r.cur()/o)&&1!==c&&--l)}r.unit=i,r.start=a,r.end=s[1]?a+(s[1]+1)*n:n}return r}]};function Ht(){return setTimeout(function(){Nt=t},0),Nt=g.now()}function Wt(e,t,n){var i,r=0,s=Vt.length,o=g.Deferred().always(function(){delete a.elem}),a=function(){for(var t=Nt||Ht(),n=Math.max(0,c.startTime+c.duration-t),i=1-(n/c.duration||0),r=0,s=c.tweens.length;r<s;r++)c.tweens[r].run(i);return o.notifyWith(e,[c,i,n]),i<1&&s?n:(o.resolveWith(e,[c]),!1)},c=o.promise({elem:e,props:g.extend({},t),opts:g.extend(!0,{specialEasing:{}},n),originalProperties:t,originalOptions:n,startTime:Nt||Ht(),duration:n.duration,tweens:[],createTween:function(t,n,i){var r=g.Tween(e,c.opts,t,n,c.opts.specialEasing[t]||c.opts.easing);return c.tweens.push(r),r},stop:function(t){for(var n=0,i=t?c.tweens.length:0;n<i;n++)c.tweens[n].run(1);return t?o.resolveWith(e,[c,t]):o.rejectWith(e,[c,t]),this}}),l=c.props;for(!function(e,t){var n,i,r,s,o;for(n in e)if(i=g.camelCase(n),r=t[i],s=e[n],g.isArray(s)&&(r=s[1],s=e[n]=s[0]),n!==i&&(e[i]=s,delete e[n]),(o=g.cssHooks[i])&&"expand"in o)for(n in s=o.expand(s),delete e[i],s)n in e||(e[n]=s[n],t[n]=r);else t[i]=r}(l,c.opts.specialEasing);r<s;r++)if(i=Vt[r].call(c,e,l,c.opts))return i;return function(e,t){g.each(t,function(t,n){for(var i=(Bt[t]||[]).concat(Bt["*"]),r=0,s=i.length;r<s;r++)if(i[r].call(e,t,n))return})}(c,l),g.isFunction(c.opts.start)&&c.opts.start.call(e,c),g.fx.timer(g.extend(a,{anim:c,queue:c.opts.queue,elem:e})),c.progress(c.opts.progress).done(c.opts.done,c.opts.complete).fail(c.opts.fail).always(c.opts.always)}function Gt(e,t,n,i,r){return new Gt.prototype.init(e,t,n,i,r)}function zt(e,t){var n,i={height:e},r=0;for(t=t?1:0;r<4;r+=2-t)i["margin"+(n=Ke[r])]=i["padding"+n]=e;return t&&(i.opacity=i.width=e),i}g.Animation=g.extend(Wt,{tweener:function(e,t){g.isFunction(e)?(t=e,e=["*"]):e=e.split(" ");for(var n,i=0,r=e.length;i<r;i++)n=e[i],Bt[n]=Bt[n]||[],Bt[n].unshift(t)},prefilter:function(e,t){t?Vt.unshift(e):Vt.push(e)}}),g.Tween=Gt,Gt.prototype={constructor:Gt,init:function(e,t,n,i,r,s){this.elem=e,this.prop=n,this.easing=r||"swing",this.options=t,this.start=this.now=this.cur(),this.end=i,this.unit=s||(g.cssNumber[n]?"":"px")},cur:function(){var e=Gt.propHooks[this.prop];return e&&e.get?e.get(this):Gt.propHooks._default.get(this)},run:function(e){var t,n=Gt.propHooks[this.prop];return this.options.duration?this.pos=t=g.easing[this.easing](e,this.options.duration*e,0,1,this.options.duration):this.pos=t=e,this.now=(this.end-this.start)*t+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),n&&n.set?n.set(this):Gt.propHooks._default.set(this),this}},Gt.prototype.init.prototype=Gt.prototype,Gt.propHooks={_default:{get:function(e){var t;return null==e.elem[e.prop]||e.elem.style&&null!=e.elem.style[e.prop]?(t=g.css(e.elem,e.prop,!1,""))&&"auto"!==t?t:0:e.elem[e.prop]},set:function(e){g.fx.step[e.prop]?g.fx.step[e.prop](e):e.elem.style&&(null!=e.elem.style[g.cssProps[e.prop]]||g.cssHooks[e.prop])?g.style(e.elem,e.prop,e.now+e.unit):e.elem[e.prop]=e.now}}},Gt.propHooks.scrollTop=Gt.propHooks.scrollLeft={set:function(e){e.elem.nodeType&&e.elem.parentNode&&(e.elem[e.prop]=e.now)}},g.each(["toggle","show","hide"],function(e,t){var n=g.fn[t];g.fn[t]=function(i,r,s){return null==i||"boolean"==typeof i||!e&&g.isFunction(i)&&g.isFunction(r)?n.apply(this,arguments):this.animate(zt(t,!0),i,r,s)}}),g.fn.extend({fadeTo:function(e,t,n,i){return this.filter(Xe).css("opacity",0).show().end().animate({opacity:t},e,n,i)},animate:function(e,t,n,i){var r=g.isEmptyObject(e),s=g.speed(t,n,i),o=function(){var t=Wt(this,g.extend({},e),s);r&&t.stop(!0)};return r||!1===s.queue?this.each(o):this.queue(s.queue,o)},stop:function(e,n,i){var r=function(e){var t=e.stop;delete e.stop,t(i)};return"string"!=typeof e&&(i=n,n=e,e=t),n&&!1!==e&&this.queue(e||"fx",[]),this.each(function(){var t=!0,n=null!=e&&e+"queueHooks",s=g.timers,o=g._data(this);if(n)o[n]&&o[n].stop&&r(o[n]);else for(n in o)o[n]&&o[n].stop&&qt.test(n)&&r(o[n]);for(n=s.length;n--;)s[n].elem!==this||null!=e&&s[n].queue!==e||(s[n].anim.stop(i),t=!1,s.splice(n,1));!t&&i||g.dequeue(this,e)})}}),g.each({slideDown:zt("show"),slideUp:zt("hide"),slideToggle:zt("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(e,t){g.fn[e]=function(e,n,i){return this.animate(t,e,n,i)}}),g.speed=function(e,t,n){var i=e&&"object"===(void 0===e?"undefined":_typeof(e))?g.extend({},e):{complete:n||!n&&t||g.isFunction(e)&&e,duration:e,easing:n&&t||t&&!g.isFunction(t)&&t};return i.duration=g.fx.off?0:"number"==typeof i.duration?i.duration:i.duration in g.fx.speeds?g.fx.speeds[i.duration]:g.fx.speeds._default,null!=i.queue&&!0!==i.queue||(i.queue="fx"),i.old=i.complete,i.complete=function(){g.isFunction(i.old)&&i.old.call(this),i.queue&&g.dequeue(this,i.queue)},i},g.easing={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2}},g.timers=[],g.fx=Gt.prototype.init,g.fx.tick=function(){var e,n=g.timers,i=0;for(Nt=g.now();i<n.length;i++)(e=n[i])()||n[i]!==e||n.splice(i--,1);n.length||g.fx.stop(),Nt=t},g.fx.timer=function(e){e()&&g.timers.push(e)&&!Ft&&(Ft=setInterval(g.fx.tick,g.fx.interval))},g.fx.interval=13,g.fx.stop=function(){clearInterval(Ft),Ft=null},g.fx.speeds={slow:600,fast:200,_default:400},g.fx.step={},g.expr&&g.expr.filters&&(g.expr.filters.animated=function(e){return g.grep(g.timers,function(t){return e===t.elem}).length});var $t=/^(?:body|html)$/i;function Kt(e){return g.isWindow(e)?e:9===e.nodeType&&(e.defaultView||e.parentWindow)}g.fn.offset=function(e){if(arguments.length)return e===t?this:this.each(function(t){g.offset.setOffset(this,e,t)});var n,i,r,s,o,a,c,l={top:0,left:0},u=this[0],h=u&&u.ownerDocument;return h?(i=h.body)===u?g.offset.bodyOffset(u):(n=h.documentElement,g.contains(n,u)?(void 0!==u.getBoundingClientRect&&(l=u.getBoundingClientRect()),r=Kt(h),s=n.clientTop||i.clientTop||0,o=n.clientLeft||i.clientLeft||0,a=r.pageYOffset||n.scrollTop,c=r.pageXOffset||n.scrollLeft,{top:l.top+a-s,left:l.left+c-o}):l):void 0},g.offset={bodyOffset:function(e){var t=e.offsetTop,n=e.offsetLeft;return g.support.doesNotIncludeMarginInBodyOffset&&(t+=parseFloat(g.css(e,"marginTop"))||0,n+=parseFloat(g.css(e,"marginLeft"))||0),{top:t,left:n}},setOffset:function(e,t,n){var i=g.css(e,"position");"static"===i&&(e.style.position="relative");var r,s,o=g(e),a=o.offset(),c=g.css(e,"top"),l=g.css(e,"left"),u=(("absolute"===i||"fixed"===i)&&g.inArray("auto",[c,l]),{}),h={};r=(h=o.position()).top,s=h.left,g.isFunction(t)&&(t=t.call(e,n,a)),null!=t.top&&(u.top=t.top-a.top+r),null!=t.left&&(u.left=t.left-a.left+s),"using"in t?t.using.call(e,u):o.css(u)}},g.fn.extend({position:function(){if(this[0]){var e=this[0],t=this.offsetParent(),n=this.offset(),i=$t.test(t[0].nodeName)?{top:0,left:0}:t.offset();return n.top-=parseFloat(g.css(e,"marginTop"))||0,n.left-=parseFloat(g.css(e,"marginLeft"))||0,i.top+=parseFloat(g.css(t[0],"borderTopWidth"))||0,i.left+=parseFloat(g.css(t[0],"borderLeftWidth"))||0,{top:n.top-i.top,left:n.left-i.left}}},offsetParent:function(){return this.map(function(){for(var e=this.offsetParent||r.body;e&&!$t.test(e.nodeName)&&"static"===g.css(e,"position");)e=e.offsetParent;return e||r.body})}}),g.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,n){var i=/Y/.test(n);g.fn[e]=function(r){return g.access(this,function(e,r,s){var o=Kt(e);if(s===t)return o?n in o?o[n]:o.document.documentElement[r]:e[r];o?o.scrollTo(i?g(o).scrollLeft():s,i?s:g(o).scrollTop()):e[r]=s},e,r,arguments.length,null)}}),g.each({Height:"height",Width:"width"},function(e,n){g.each({padding:"inner"+e,content:n,"":"outer"+e},function(i,r){g.fn[r]=function(r,s){var o=arguments.length&&(i||"boolean"!=typeof r),a=i||(!0===r||!0===s?"margin":"border");return g.access(this,function(n,i,r){var s;return g.isWindow(n)?n.document.documentElement["client"+e]:9===n.nodeType?(s=n.documentElement,Math.max(n.body["scroll"+e],s["scroll"+e],n.body["offset"+e],s["offset"+e],s["client"+e])):r===t?g.css(n,i,r,a):g.style(n,i,r,a)},n,o?r:t,o,null)}})}),e.jQuery=e.$=g,"function"==typeof define&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return g})}(window),function(){var e=this,t=e._,n={},i=Array.prototype,r=Object.prototype,s=Function.prototype,o=i.push,a=i.slice,c=i.concat,l=r.toString,u=r.hasOwnProperty,h=i.forEach,d=i.map,f=i.reduce,p=i.reduceRight,g=i.filter,m=i.every,_=i.some,v=i.indexOf,y=i.lastIndexOf,b=Array.isArray,S=Object.keys,C=s.bind,w=function e(t){return t instanceof e?t:this instanceof e?void(this._wrapped=t):new e(t)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=w),exports._=w):e._=w,w.VERSION="1.4.4";var T=w.each=w.forEach=function(e,t,i){if(null!=e)if(h&&e.forEach===h)e.forEach(t,i);else if(e.length===+e.length){for(var r=0,s=e.length;r<s;r++)if(t.call(i,e[r],r,e)===n)return}else for(var o in e)if(w.has(e,o)&&t.call(i,e[o],o,e)===n)return};w.map=w.collect=function(e,t,n){var i=[];return null==e?i:d&&e.map===d?e.map(t,n):(T(e,function(e,r,s){i[i.length]=t.call(n,e,r,s)}),i)};var k="Reduce of empty array with no initial value";w.reduce=w.foldl=w.inject=function(e,t,n,i){var r=arguments.length>2;if(null==e&&(e=[]),f&&e.reduce===f)return i&&(t=w.bind(t,i)),r?e.reduce(t,n):e.reduce(t);if(T(e,function(e,s,o){r?n=t.call(i,n,e,s,o):(n=e,r=!0)}),!r)throw new TypeError(k);return n},w.reduceRight=w.foldr=function(e,t,n,i){var r=arguments.length>2;if(null==e&&(e=[]),p&&e.reduceRight===p)return i&&(t=w.bind(t,i)),r?e.reduceRight(t,n):e.reduceRight(t);var s=e.length;if(s!==+s){var o=w.keys(e);s=o.length}if(T(e,function(a,c,l){c=o?o[--s]:--s,r?n=t.call(i,n,e[c],c,l):(n=e[c],r=!0)}),!r)throw new TypeError(k);return n},w.find=w.detect=function(e,t,n){var i;return E(e,function(e,r,s){if(t.call(n,e,r,s))return i=e,!0}),i},w.filter=w.select=function(e,t,n){var i=[];return null==e?i:g&&e.filter===g?e.filter(t,n):(T(e,function(e,r,s){t.call(n,e,r,s)&&(i[i.length]=e)}),i)},w.reject=function(e,t,n){return w.filter(e,function(e,i,r){return!t.call(n,e,i,r)},n)},w.every=w.all=function(e,t,i){t||(t=w.identity);var r=!0;return null==e?r:m&&e.every===m?e.every(t,i):(T(e,function(e,s,o){if(!(r=r&&t.call(i,e,s,o)))return n}),!!r)};var E=w.some=w.any=function(e,t,i){t||(t=w.identity);var r=!1;return null==e?r:_&&e.some===_?e.some(t,i):(T(e,function(e,s,o){if(r||(r=t.call(i,e,s,o)))return n}),!!r)};w.contains=w.include=function(e,t){return null!=e&&(v&&e.indexOf===v?-1!=e.indexOf(t):E(e,function(e){return e===t}))},w.invoke=function(e,t){var n=a.call(arguments,2),i=w.isFunction(t);return w.map(e,function(e){return(i?t:e[t]).apply(e,n)})},w.pluck=function(e,t){return w.map(e,function(e){return e[t]})},w.where=function(e,t,n){return w.isEmpty(t)?n?null:[]:w[n?"find":"filter"](e,function(e){for(var n in t)if(t[n]!==e[n])return!1;return!0})},w.findWhere=function(e,t){return w.where(e,t,!0)},w.max=function(e,t,n){if(!t&&w.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.max.apply(Math,e);if(!t&&w.isEmpty(e))return-1/0;var i={computed:-1/0,value:-1/0};return T(e,function(e,r,s){var o=t?t.call(n,e,r,s):e;o>=i.computed&&(i={value:e,computed:o})}),i.value},w.min=function(e,t,n){if(!t&&w.isArray(e)&&e[0]===+e[0]&&e.length<65535)return Math.min.apply(Math,e);if(!t&&w.isEmpty(e))return 1/0;var i={computed:1/0,value:1/0};return T(e,function(e,r,s){var o=t?t.call(n,e,r,s):e;o<i.computed&&(i={value:e,computed:o})}),i.value},w.shuffle=function(e){var t,n=0,i=[];return T(e,function(e){t=w.random(n++),i[n-1]=i[t],i[t]=e}),i};var A=function(e){return w.isFunction(e)?e:function(t){return t[e]}};w.sortBy=function(e,t,n){var i=A(t);return w.pluck(w.map(e,function(e,t,r){return{value:e,index:t,criteria:i.call(n,e,t,r)}}).sort(function(e,t){var n=e.criteria,i=t.criteria;if(n!==i){if(n>i||void 0===n)return 1;if(n<i||void 0===i)return-1}return e.index<t.index?-1:1}),"value")};var x=function(e,t,n,i){var r={},s=A(t||w.identity);return T(e,function(t,o){var a=s.call(n,t,o,e);i(r,a,t)}),r};w.groupBy=function(e,t,n){return x(e,t,n,function(e,t,n){(w.has(e,t)?e[t]:e[t]=[]).push(n)})},w.countBy=function(e,t,n){return x(e,t,n,function(e,t){w.has(e,t)||(e[t]=0),e[t]++})},w.sortedIndex=function(e,t,n,i){for(var r=(n=null==n?w.identity:A(n)).call(i,t),s=0,o=e.length;s<o;){var a=s+o>>>1;n.call(i,e[a])<r?s=a+1:o=a}return s},w.toArray=function(e){return e?w.isArray(e)?a.call(e):e.length===+e.length?w.map(e,w.identity):w.values(e):[]},w.size=function(e){return null==e?0:e.length===+e.length?e.length:w.keys(e).length},w.first=w.head=w.take=function(e,t,n){if(null!=e)return null==t||n?e[0]:a.call(e,0,t)},w.initial=function(e,t,n){return a.call(e,0,e.length-(null==t||n?1:t))},w.last=function(e,t,n){if(null!=e)return null==t||n?e[e.length-1]:a.call(e,Math.max(e.length-t,0))},w.rest=w.tail=w.drop=function(e,t,n){return a.call(e,null==t||n?1:t)},w.compact=function(e){return w.filter(e,w.identity)};w.flatten=function(e,t){return function e(t,n,i){return T(t,function(t){w.isArray(t)?n?o.apply(i,t):e(t,n,i):i.push(t)}),i}(e,t,[])},w.without=function(e){return w.difference(e,a.call(arguments,1))},w.uniq=w.unique=function(e,t,n,i){w.isFunction(t)&&(i=n,n=t,t=!1);var r=n?w.map(e,n,i):e,s=[],o=[];return T(r,function(n,i){(t?i&&o[o.length-1]===n:w.contains(o,n))||(o.push(n),s.push(e[i]))}),s},w.union=function(){return w.uniq(c.apply(i,arguments))},w.intersection=function(e){var t=a.call(arguments,1);return w.filter(w.uniq(e),function(e){return w.every(t,function(t){return w.indexOf(t,e)>=0})})},w.difference=function(e){var t=c.apply(i,a.call(arguments,1));return w.filter(e,function(e){return!w.contains(t,e)})},w.zip=function(){for(var e=a.call(arguments),t=w.max(w.pluck(e,"length")),n=new Array(t),i=0;i<t;i++)n[i]=w.pluck(e,""+i);return n},w.object=function(e,t){if(null==e)return{};for(var n={},i=0,r=e.length;i<r;i++)t?n[e[i]]=t[i]:n[e[i][0]]=e[i][1];return n},w.indexOf=function(e,t,n){if(null==e)return-1;var i=0,r=e.length;if(n){if("number"!=typeof n)return e[i=w.sortedIndex(e,t)]===t?i:-1;i=n<0?Math.max(0,r+n):n}if(v&&e.indexOf===v)return e.indexOf(t,n);for(;i<r;i++)if(e[i]===t)return i;return-1},w.lastIndexOf=function(e,t,n){if(null==e)return-1;var i=null!=n;if(y&&e.lastIndexOf===y)return i?e.lastIndexOf(t,n):e.lastIndexOf(t);for(var r=i?n:e.length;r--;)if(e[r]===t)return r;return-1},w.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;for(var i=Math.max(Math.ceil((t-e)/n),0),r=0,s=new Array(i);r<i;)s[r++]=e,e+=n;return s},w.bind=function(e,t){if(e.bind===C&&C)return C.apply(e,a.call(arguments,1));var n=a.call(arguments,2);return function(){return e.apply(t,n.concat(a.call(arguments)))}},w.partial=function(e){var t=a.call(arguments,1);return function(){return e.apply(this,t.concat(a.call(arguments)))}},w.bindAll=function(e){var t=a.call(arguments,1);return 0===t.length&&(t=w.functions(e)),T(t,function(t){e[t]=w.bind(e[t],e)}),e},w.memoize=function(e,t){var n={};return t||(t=w.identity),function(){var i=t.apply(this,arguments);return w.has(n,i)?n[i]:n[i]=e.apply(this,arguments)}},w.delay=function(e,t){var n=a.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},w.defer=function(e){return w.delay.apply(w,[e,1].concat(a.call(arguments,1)))},w.throttle=function(e,t){var n,i,r,s,o=0,a=function(){o=new Date,r=null,s=e.apply(n,i)};return function(){var c=new Date,l=t-(c-o);return n=this,i=arguments,l<=0?(clearTimeout(r),r=null,o=c,s=e.apply(n,i)):r||(r=setTimeout(a,l)),s}},w.debounce=function(e,t,n){var i,r;return function(){var s=this,o=arguments,a=n&&!i;return clearTimeout(i),i=setTimeout(function(){i=null,n||(r=e.apply(s,o))},t),a&&(r=e.apply(s,o)),r}},w.once=function(e){var t,n=!1;return function(){return n?t:(n=!0,t=e.apply(this,arguments),e=null,t)}},w.wrap=function(e,t){return function(){var n=[e];return o.apply(n,arguments),t.apply(this,n)}},w.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},w.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},w.keys=S||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)w.has(e,n)&&(t[t.length]=n);return t},w.values=function(e){var t=[];for(var n in e)w.has(e,n)&&t.push(e[n]);return t},w.pairs=function(e){var t=[];for(var n in e)w.has(e,n)&&t.push([n,e[n]]);return t},w.invert=function(e){var t={};for(var n in e)w.has(e,n)&&(t[e[n]]=n);return t},w.functions=w.methods=function(e){var t=[];for(var n in e)w.isFunction(e[n])&&t.push(n);return t.sort()},w.extend=function(e){return T(a.call(arguments,1),function(t){if(t)for(var n in t)e[n]=t[n]}),e},w.pick=function(e){var t={},n=c.apply(i,a.call(arguments,1));return T(n,function(n){n in e&&(t[n]=e[n])}),t},w.omit=function(e){var t={},n=c.apply(i,a.call(arguments,1));for(var r in e)w.contains(n,r)||(t[r]=e[r]);return t},w.defaults=function(e){return T(a.call(arguments,1),function(t){if(t)for(var n in t)null==e[n]&&(e[n]=t[n])}),e},w.clone=function(e){return w.isObject(e)?w.isArray(e)?e.slice():w.extend({},e):e},w.tap=function(e,t){return t(e),e};w.isEqual=function(e,t){return function e(t,n,i,r){if(t===n)return 0!==t||1/t==1/n;if(null==t||null==n)return t===n;t instanceof w&&(t=t._wrapped),n instanceof w&&(n=n._wrapped);var s=l.call(t);if(s!=l.call(n))return!1;switch(s){case"[object String]":return t==String(n);case"[object Number]":return t!=+t?n!=+n:0==t?1/t==1/n:t==+n;case"[object Date]":case"[object Boolean]":return+t==+n;case"[object RegExp]":return t.source==n.source&&t.global==n.global&&t.multiline==n.multiline&&t.ignoreCase==n.ignoreCase}if("object"!=(void 0===t?"undefined":_typeof(t))||"object"!=(void 0===n?"undefined":_typeof(n)))return!1;for(var o=i.length;o--;)if(i[o]==t)return r[o]==n;i.push(t),r.push(n);var a=0,c=!0;if("[object Array]"==s){if(c=(a=t.length)==n.length)for(;a--&&(c=e(t[a],n[a],i,r)););}else{var u=t.constructor,h=n.constructor;if(u!==h&&!(w.isFunction(u)&&u instanceof u&&w.isFunction(h)&&h instanceof h))return!1;for(var d in t)if(w.has(t,d)&&(a++,!(c=w.has(n,d)&&e(t[d],n[d],i,r))))break;if(c){for(d in n)if(w.has(n,d)&&!a--)break;c=!a}}return i.pop(),r.pop(),c}(e,t,[],[])},w.isEmpty=function(e){if(null==e)return!0;if(w.isArray(e)||w.isString(e))return 0===e.length;for(var t in e)if(w.has(e,t))return!1;return!0},w.isElement=function(e){return!(!e||1!==e.nodeType)},w.isArray=b||function(e){return"[object Array]"==l.call(e)},w.isObject=function(e){return e===Object(e)},T(["Arguments","Function","String","Number","Date","RegExp"],function(e){w["is"+e]=function(t){return l.call(t)=="[object "+e+"]"}}),w.isArguments(arguments)||(w.isArguments=function(e){return!(!e||!w.has(e,"callee"))}),"function"!=typeof/./&&(w.isFunction=function(e){return"function"==typeof e}),w.isFinite=function(e){return isFinite(e)&&!isNaN(parseFloat(e))},w.isNaN=function(e){return w.isNumber(e)&&e!=+e},w.isBoolean=function(e){return!0===e||!1===e||"[object Boolean]"==l.call(e)},w.isNull=function(e){return null===e},w.isUndefined=function(e){return void 0===e},w.has=function(e,t){return u.call(e,t)},w.noConflict=function(){return e._=t,this},w.identity=function(e){return e},w.times=function(e,t,n){for(var i=Array(e),r=0;r<e;r++)i[r]=t.call(n,r);return i},w.random=function(e,t){return null==t&&(t=e,e=0),e+Math.floor(Math.random()*(t-e+1))};var R={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};R.unescape=w.invert(R.escape);var I={escape:new RegExp("["+w.keys(R.escape).join("")+"]","g"),unescape:new RegExp("("+w.keys(R.unescape).join("|")+")","g")};w.each(["escape","unescape"],function(e){w[e]=function(t){return null==t?"":(""+t).replace(I[e],function(t){return R[e][t]})}}),w.result=function(e,t){if(null==e)return null;var n=e[t];return w.isFunction(n)?n.call(e):n},w.mixin=function(e){T(w.functions(e),function(t){var n=w[t]=e[t];w.prototype[t]=function(){var e=[this._wrapped];return o.apply(e,arguments),D.call(this,n.apply(w,e))}})};var L=0;w.uniqueId=function(e){var t=++L+"";return e?e+t:t},w.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var M=/(.)^/,P={"'":"'","\\":"\\","\r":"r","\n":"n","\t":"t","\u2028":"u2028","\u2029":"u2029"},O=/\\|'|\r|\n|\t|\u2028|\u2029/g;w.template=function(e,t,n){var i;n=w.defaults({},n,w.templateSettings);var r=new RegExp([(n.escape||M).source,(n.interpolate||M).source,(n.evaluate||M).source].join("|")+"|$","g"),s=0,o="__p+='";e.replace(r,function(t,n,i,r,a){return o+=e.slice(s,a).replace(O,function(e){return"\\"+P[e]}),n&&(o+="'+\n((__t=("+n+"))==null?'':_.escape(__t))+\n'"),i&&(o+="'+\n((__t=("+i+"))==null?'':__t)+\n'"),r&&(o+="';\n"+r+"\n__p+='"),s=a+t.length,t}),o+="';\n",n.variable||(o="with(obj||{}){\n"+o+"}\n"),o="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+o+"return __p;\n";try{i=new Function(n.variable||"obj","_",o)}catch(e){throw e.source=o,e}if(t)return i(t,w);var a=function(e){return i.call(this,e,w)};return a.source="function("+(n.variable||"obj")+"){\n"+o+"}",a},w.chain=function(e){return w(e).chain()};var D=function(e){return this._chain?w(e).chain():e};w.mixin(w),T(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=i[e];w.prototype[e]=function(){var n=this._wrapped;return t.apply(n,arguments),"shift"!=e&&"splice"!=e||0!==n.length||delete n[0],D.call(this,n)}}),T(["concat","join","slice"],function(e){var t=i[e];w.prototype[e]=function(){return D.call(this,t.apply(this._wrapped,arguments))}}),w.extend(w.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return w})}.call(this),function(e,t){"undefined"!=typeof exports?t(e,exports,require("underscore")):"function"==typeof define&&define.amd?define("backbone",["underscore","jquery","exports"],function(n,$,exports){e.Backbone=t(e,exports,n,$)}):e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender||e.$)}(this,function(e,t,n,$){var i=e.Backbone,r=[],s=r.push,o=r.slice,a=r.splice;t.VERSION="1.0.0",t.$=$,t.noConflict=function(){return e.Backbone=i,this},t.emulateHTTP=!1,t.emulateJSON=!1;var c=t.Events={on:function(e,t,n){return u(this,"on",e,[t,n])&&t?(this._events||(this._events={}),(this._events[e]||(this._events[e]=[])).push({callback:t,context:n,ctx:n||this}),this):this},once:function(e,t,i){if(!u(this,"once",e,[t,i])||!t)return this;var r=this,s=n.once(function(){r.off(e,s),t.apply(this,arguments)});return s._callback=t,this.on(e,s,i)},off:function(e,t,i){var r,s,o,a,c,l,h,d;if(!this._events||!u(this,"off",e,[t,i]))return this;if(!e&&!t&&!i)return this._events={},this;for(c=0,l=(a=e?[e]:n.keys(this._events)).length;c<l;c++)if(e=a[c],o=this._events[e]){if(this._events[e]=r=[],t||i)for(h=0,d=o.length;h<d;h++)s=o[h],(t&&t!==s.callback&&t!==s.callback._callback||i&&i!==s.context)&&r.push(s);r.length||delete this._events[e]}return this},trigger:function(e){if(!this._events)return this;var t=o.call(arguments,1);if(!u(this,"trigger",e,t))return this;var n=this._events[e],i=this._events.all;return n&&h(n,t),i&&h(i,arguments),this},stopListening:function(e,t,n){var i=this._listeners;if(!i)return this;var r=!t&&!n;for(var s in"object"===(void 0===t?"undefined":_typeof(t))&&(n=this),e&&((i={})[e._listenerId]=e),i)i[s].off(t,n,this),r&&delete this._listeners[s];return this}},l=/\s+/,u=function(e,t,n,i){if(!n)return!0;if("object"===(void 0===n?"undefined":_typeof(n))){for(var r in n)e[t].apply(e,[r,n[r]].concat(i));return!1}if(l.test(n)){for(var s=n.split(l),o=0,a=s.length;o<a;o++)e[t].apply(e,[s[o]].concat(i));return!1}return!0},h=function(e,t){var n,i=-1,r=e.length,s=t[0],o=t[1],a=t[2];switch(t.length){case 0:for(;++i<r;)(n=e[i]).callback.call(n.ctx);return;case 1:for(;++i<r;)(n=e[i]).callback.call(n.ctx,s);return;case 2:for(;++i<r;)(n=e[i]).callback.call(n.ctx,s,o);return;case 3:for(;++i<r;)(n=e[i]).callback.call(n.ctx,s,o,a);return;default:for(;++i<r;)(n=e[i]).callback.apply(n.ctx,t)}};n.each({listenTo:"on",listenToOnce:"once"},function(e,t){c[t]=function(t,i,r){return(this._listeners||(this._listeners={}))[t._listenerId||(t._listenerId=n.uniqueId("l"))]=t,"object"===(void 0===i?"undefined":_typeof(i))&&(r=this),t[e](i,r,this),this}}),c.bind=c.on,c.unbind=c.off,n.extend(t,c);var d=t.Model=function(e,t){var i,r=e||{};t||(t={}),this.cid=n.uniqueId("c"),this.attributes={},n.extend(this,n.pick(t,f)),t.parse&&(r=this.parse(r,t)||{}),(i=n.result(this,"defaults"))&&(r=n.defaults({},r,i)),this.set(r,t),this.changed={},this.initialize.apply(this,arguments)},f=["url","urlRoot","collection"];n.extend(d.prototype,c,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return n.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return n.escape(this.get(e))},has:function(e){return null!=this.get(e)},set:function(e,t,i){var r,s,o,a,c,l,u,h;if(null==e)return this;if("object"===(void 0===e?"undefined":_typeof(e))?(s=e,i=t):(s={})[e]=t,i||(i={}),!this._validate(s,i))return!1;for(r in o=i.unset,c=i.silent,a=[],l=this._changing,this._changing=!0,l||(this._previousAttributes=n.clone(this.attributes),this.changed={}),h=this.attributes,u=this._previousAttributes,this.idAttribute in s&&(this.id=s[this.idAttribute]),s)t=s[r],n.isEqual(h[r],t)||a.push(r),n.isEqual(u[r],t)?delete this.changed[r]:this.changed[r]=t,o?delete h[r]:h[r]=t;if(!c){a.length&&(this._pending=!0);for(var d=0,f=a.length;d<f;d++)this.trigger("change:"+a[d],this,h[a[d]],i)}if(l)return this;if(!c)for(;this._pending;)this._pending=!1,this.trigger("change",this,i);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,n.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var i in this.attributes)t[i]=void 0;return this.set(t,n.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!n.isEmpty(this.changed):n.has(this.changed,e)},changedAttributes:function(e){if(!e)return!!this.hasChanged()&&n.clone(this.changed);var t,i=!1,r=this._changing?this._previousAttributes:this.attributes;for(var s in e)n.isEqual(r[s],t=e[s])||((i||(i={}))[s]=t);return i},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return n.clone(this._previousAttributes)},fetch:function(e){void 0===(e=e?n.clone(e):{}).parse&&(e.parse=!0);var t=this,i=e.success;return e.success=function(n){if(!t.set(t.parse(n,e),e))return!1;i&&i(t,n,e),t.trigger("sync",t,n,e)},M(this,e),this.sync("read",this,e)},save:function(e,t,i){var r,s,o,a=this.attributes;if(null==e||"object"===(void 0===e?"undefined":_typeof(e))?(r=e,i=t):(r={})[e]=t,r&&(!i||!i.wait)&&!this.set(r,i))return!1;if(i=n.extend({validate:!0},i),!this._validate(r,i))return!1;r&&i.wait&&(this.attributes=n.extend({},a,r)),void 0===i.parse&&(i.parse=!0);var c=this,l=i.success;return i.success=function(e){c.attributes=a;var t=c.parse(e,i);if(i.wait&&(t=n.extend(r||{},t)),n.isObject(t)&&!c.set(t,i))return!1;l&&l(c,e,i),c.trigger("sync",c,e,i)},M(this,i),"patch"===(s=this.isNew()?"create":i.patch?"patch":"update")&&(i.attrs=r),o=this.sync(s,this,i),r&&i.wait&&(this.attributes=a),o},destroy:function(e){e=e?n.clone(e):{};var t=this,i=e.success,r=function(){t.trigger("destroy",t,t.collection,e)};if(e.success=function(n){(e.wait||t.isNew())&&r(),i&&i(t,n,e),t.isNew()||t.trigger("sync",t,n,e)},this.isNew())return e.success(),!1;M(this,e);var s=this.sync("delete",this,e);return e.wait||r(),s},url:function(){var e=n.result(this,"urlRoot")||n.result(this.collection,"url")||L();return this.isNew()?e:e+("/"===e.charAt(e.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(e){return this._validate({},n.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=n.extend({},this.attributes,e);var i=this.validationError=this.validate(e,t)||null;return!i||(this.trigger("invalid",this,i,n.extend(t||{},{validationError:i})),!1)}});n.each(["keys","values","pairs","invert","pick","omit"],function(e){d.prototype[e]=function(){var t=o.call(arguments);return t.unshift(this.attributes),n[e].apply(n,t)}});var p=t.Collection=function(e,t){t||(t={}),t.url&&(this.url=t.url),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,n.extend({silent:!0},t))},g={add:!0,remove:!0,merge:!0},m={add:!0,merge:!1,remove:!1};n.extend(p.prototype,c,{model:d,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,n.defaults(t||{},m))},remove:function(e,t){var i,r,s,o;for(t||(t={}),i=0,r=(e=n.isArray(e)?e.slice():[e]).length;i<r;i++)(o=this.get(e[i]))&&(delete this._byId[o.id],delete this._byId[o.cid],s=this.indexOf(o),this.models.splice(s,1),this.length--,t.silent||(t.index=s,o.trigger("remove",o,this,t)),this._removeReference(o));return this},set:function(e,t){var i,r,o,c,l;(t=n.defaults(t||{},g)).parse&&(e=this.parse(e,t)),n.isArray(e)||(e=e?[e]:[]);var u=t.at,h=this.comparator&&null==u&&!1!==t.sort,d=n.isString(this.comparator)?this.comparator:null,f=[],p=[],m={};for(i=0,r=e.length;i<r;i++)(o=this._prepareModel(e[i],t))&&((c=this.get(o))?(t.remove&&(m[c.cid]=!0),t.merge&&(c.set(o.attributes,t),h&&!l&&c.hasChanged(d)&&(l=!0))):t.add&&(f.push(o),o.on("all",this._onModelEvent,this),this._byId[o.cid]=o,null!=o.id&&(this._byId[o.id]=o)));if(t.remove){for(i=0,r=this.length;i<r;++i)m[(o=this.models[i]).cid]||p.push(o);p.length&&this.remove(p,t)}if(f.length&&(h&&(l=!0),this.length+=f.length,null!=u?a.apply(this.models,[u,0].concat(f)):s.apply(this.models,f)),l&&this.sort({silent:!0}),t.silent)return this;for(i=0,r=f.length;i<r;i++)(o=f[i]).trigger("add",o,this,t);return l&&this.trigger("sort",this,t),this},reset:function(e,t){t||(t={});for(var i=0,r=this.models.length;i<r;i++)this._removeReference(this.models[i]);return t.previousModels=this.models,this._reset(),this.add(e,n.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),this},push:function(e,t){return e=this._prepareModel(e,t),this.add(e,n.extend({at:this.length},t)),e},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return e=this._prepareModel(e,t),this.add(e,n.extend({at:0},t)),e},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(e,t){return this.models.slice(e,t)},get:function(e){if(null!=e)return this._byId[null!=e.id?e.id:e.cid||e]},at:function(e){return this.models[e]},where:function(e,t){return n.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),n.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(n.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},sortedIndex:function(e,t,i){t||(t=this.comparator);var r=n.isFunction(t)?t:function(e){return e.get(t)};return n.sortedIndex(this.models,e,r,i)},pluck:function(e){return n.invoke(this.models,"get",e)},fetch:function(e){void 0===(e=e?n.clone(e):{}).parse&&(e.parse=!0);var t=e.success,i=this;return e.success=function(n){var r=e.reset?"reset":"set";i[r](n,e),t&&t(i,n,e),i.trigger("sync",i,n,e)},M(this,e),this.sync("read",this,e)},create:function(e,t){if(t=t?n.clone(t):{},!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var i=this,r=t.success;return t.success=function(n){t.wait&&i.add(e,t),r&&r(e,n,t)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof d)return e.collection||(e.collection=this),e;t||(t={}),t.collection=this;var n=new this.model(e,t);return n._validate(e,t)?n:(this.trigger("invalid",this,e,t),!1)},_removeReference:function(e){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,i){("add"!==e&&"remove"!==e||n===this)&&("destroy"===e&&this.remove(t,i),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],null!=t.id&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments))}});n.each(["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","indexOf","shuffle","lastIndexOf","isEmpty","chain"],function(e){p.prototype[e]=function(){var t=o.call(arguments);return t.unshift(this.models),n[e].apply(n,t)}});n.each(["groupBy","countBy","sortBy"],function(e){p.prototype[e]=function(t,i){var r=n.isFunction(t)?t:function(e){return e.get(t)};return n[e](this.models,r,i)}});var _=t.View=function(e){this.cid=n.uniqueId("view"),this._configure(e||{}),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},v=/^(\S+)\s*(.*)$/,y=["model","collection","el","id","attributes","className","tagName","events"];n.extend(_.prototype,c,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,n){return this.$el&&this.undelegateEvents(),this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0],!1!==n&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=n.result(this,"events")))return this;for(var t in this.undelegateEvents(),e){var i=e[t];if(n.isFunction(i)||(i=this[e[t]]),i){var r=t.match(v),s=r[1],o=r[2];i=n.bind(i,this),s+=".delegateEvents"+this.cid,""===o?this.$el.on(s,i):this.$el.on(s,o,i)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_configure:function(e){this.options&&(e=n.extend({},n.result(this,"options"),e)),n.extend(this,n.pick(e,y)),this.options=e},_ensureElement:function(){if(this.el)this.setElement(n.result(this,"el"),!1);else{var e=n.extend({},n.result(this,"attributes"));this.id&&(e.id=n.result(this,"id")),this.className&&(e.class=n.result(this,"className"));var i=t.$("<"+n.result(this,"tagName")+">").attr(e);this.setElement(i,!1)}}}),t.sync=function(e,i,r){var s=b[e];n.defaults(r||(r={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var o={type:s,dataType:"json"};if(r.url||(o.url=n.result(i,"url")||L()),null!=r.data||!i||"create"!==e&&"update"!==e&&"patch"!==e||(o.contentType="application/json",o.data=JSON.stringify(r.attrs||i.toJSON(r))),r.emulateJSON&&(o.contentType="application/x-www-form-urlencoded",o.data=o.data?{model:o.data}:{}),r.emulateHTTP&&("PUT"===s||"DELETE"===s||"PATCH"===s)){o.type="POST",r.emulateJSON&&(o.data._method=s);var a=r.beforeSend;r.beforeSend=function(e){if(e.setRequestHeader("X-HTTP-Method-Override",s),a)return a.apply(this,arguments)}}"GET"===o.type||r.emulateJSON||(o.processData=!1),"PATCH"!==o.type||!window.ActiveXObject||window.external&&window.external.msActiveXFilteringEnabled||(o.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var c=r.xhr=t.ajax(n.extend(o,r));return i.trigger("request",i,c,r),c};var b={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var S=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},C=/\((.*?)\)/g,w=/(\(\?)?:\w+/g,T=/\*\w+/g,k=/[\-{}\[\]+?.,\\\^$|#\s]/g;n.extend(S.prototype,c,{initialize:function(){},route:function(e,i,r){n.isRegExp(e)||(e=this._routeToRegExp(e)),n.isFunction(i)&&(r=i,i=""),r||(r=this[i]);var s=this;return t.history.route(e,function(n){var o=s._extractParameters(e,n);r&&r.apply(s,o),s.trigger.apply(s,["route:"+i].concat(o)),s.trigger("route",i,o),t.history.trigger("route",s,i,o)}),this},navigate:function(e,n){return t.history.navigate(e,n),this},_bindRoutes:function(){if(this.routes){this.routes=n.result(this,"routes");for(var e,t=n.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])}},_routeToRegExp:function(e){return e=e.replace(k,"\\$&").replace(C,"(?:$1)?").replace(w,function(e,t){return t?e:"([^/]+)"}).replace(T,"(.*?)"),new RegExp("^"+e+"$")},_extractParameters:function(e,t){var i=e.exec(t).slice(1);return n.map(i,function(e){return e?decodeURIComponent(e):null})}});var E=t.History=function(){this.handlers=[],n.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},A=/^[#\/]|\s+$/g,x=/^\/+|\/+$/g,R=/msie [\w.]+/,I=/\/$/;E.started=!1,n.extend(E.prototype,c,{interval:50,getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(null==e)if(this._hasPushState||!this._wantsHashChange||t){e=this.location.pathname;var n=this.root.replace(I,"");e.indexOf(n)||(e=e.substr(n.length))}else e=this.getHash();return e.replace(A,"")},start:function(e){if(E.started)throw new Error("Backbone.history has already been started");E.started=!0,this.options=n.extend({},{root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var i=this.getFragment(),r=document.documentMode,s=R.exec(navigator.userAgent.toLowerCase())&&(!r||r<=7);this.root=("/"+this.root+"/").replace(x,"/"),s&&this._wantsHashChange&&(this.iframe=t.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(i)),this._hasPushState?t.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!s?t.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=i;var o=this.location,a=o.pathname.replace(/[^\/]$/,"$&/")===this.root;return this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!a?(this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0):(this._wantsPushState&&this._hasPushState&&a&&o.hash&&(this.fragment=this.getHash().replace(A,""),this.history.replaceState({},document.title,this.root+this.fragment+o.search)),this.options.silent?void 0:this.loadUrl())},stop:function(){t.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),E.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();if(t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe))),t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(e){var t=this.fragment=this.getFragment(e);return n.any(this.handlers,function(e){if(e.route.test(t))return e.callback(t),!0})},navigate:function(e,t){if(!E.started)return!1;if(t&&!0!==t||(t={trigger:t}),e=this.getFragment(e||""),this.fragment!==e){this.fragment=e;var n=this.root+e;if(this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}t.trigger&&this.loadUrl(e)}},_updateHash:function(e,t,n){if(n){var i=e.href.replace(/(javascript:|#).*$/,"");e.replace(i+"#"+t)}else e.hash="#"+t}}),t.history=new E;d.extend=p.extend=S.extend=_.extend=E.extend=function(e,t){var i,r=this;i=e&&n.has(e,"constructor")?e.constructor:function(){return r.apply(this,arguments)},n.extend(i,r,t);var s=function(){this.constructor=i};return s.prototype=r.prototype,i.prototype=new s,e&&n.extend(i.prototype,e),i.__super__=r.prototype,i};var L=function(){throw new Error('A "url" property or function must be specified')},M=function(e,t){var n=t.error;t.error=function(i){n&&n(e,i,t),e.trigger("error",e,i,t)}};return t}),function(e){var t=!1;if("function"==typeof define&&define.amd&&(define("js-cookie",e),t=!0),"object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&(module.exports=e(),t=!0),!t){var n=window.Cookies,i=window.Cookies=e();i.noConflict=function(){return window.Cookies=n,i}}}(function(){function e(){for(var e=0,t={};e<arguments.length;e++){var n=arguments[e];for(var i in n)t[i]=n[i]}return t}return function t(n){function i(t,r,s){var o;if("undefined"!=typeof document){if(arguments.length>1){if("number"==typeof(s=e({path:"/"},i.defaults,s)).expires){var a=new Date;a.setMilliseconds(a.getMilliseconds()+864e5*s.expires),s.expires=a}try{o=JSON.stringify(r),/^[\{\[]/.test(o)&&(r=o)}catch(e){}return r=n.write?n.write(r,t):encodeURIComponent(String(r)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=(t=(t=encodeURIComponent(String(t))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape),document.cookie=[t,"=",r,s.expires?"; expires="+s.expires.toUTCString():"",s.path?"; path="+s.path:"",s.domain?"; domain="+s.domain:"",s.secure?"; secure":""].join("")}t||(o={});for(var c=document.cookie?document.cookie.split("; "):[],l=/(%[0-9A-Z]{2})+/g,u=0;u<c.length;u++){var h=c[u].split("="),d=h.slice(1).join("=");'"'===d.charAt(0)&&(d=d.slice(1,-1));try{var f=h[0].replace(l,decodeURIComponent);if(d=n.read?n.read(d,f):n(d,f)||d.replace(l,decodeURIComponent),this.json)try{d=JSON.parse(d)}catch(e){}if(t===f){o=d;break}t||(o[f]=d)}catch(e){}}return o}}return i.set=i,i.get=function(e){return i.call(i,e)},i.getJSON=function(){return i.apply({json:!0},[].slice.call(arguments))},i.defaults={},i.remove=function(t,n){i(t,"",e(n,{expires:-1}))},i.withConverter=t,i}(function(){})}),function(e,t){"undefined"!=typeof module&&module.exports?module.exports=t():"function"==typeof define&&define.amd?define("scriptjs",t):this.$script=t()}(0,function(){var e,t,n=document,i=n.getElementsByTagName("head")[0],r=!1,s="push",o="readyState",a="onreadystatechange",c={},l={},u={},h={};function d(e,t){for(var n=0,i=e.length;n<i;++n)if(!t(e[n]))return r;return 1}function f(e,t){d(e,function(e){return t(e),1})}function p(t,n,i){t=t[s]?t:[t];var r=n&&n.call,o=r?n:i,a=r?t.join(""):n,m=t.length;function _(e){return e.call?e():c[e]}function v(){if(!--m)for(var e in c[a]=1,o&&o(),u)d(e.split("|"),_)&&!f(u[e],_)&&(u[e]=[])}return setTimeout(function(){f(t,function t(n,i){return null===n?v():(i||/^https?:\/\//.test(n)||!e||(n=-1===n.indexOf(".js")?e+n+".js":e+n),h[n]?(a&&(l[a]=1),2==h[n]?v():setTimeout(function(){t(n,!0)},0)):(h[n]=1,a&&(l[a]=1),void g(n,v)))})},0),p}function g(e,r){var s,c=n.createElement("script");c.onload=c.onerror=c[a]=function(){c[o]&&!/^c|loade/.test(c[o])||s||(c.onload=c[a]=null,s=1,h[e]=2,r())},c.async=1,c.src=t?e+(-1===e.indexOf("?")?"?":"&")+t:e,i.insertBefore(c,i.lastChild)}return p.get=g,p.order=function(e,t,n){!function i(r){r=e.shift(),e.length?p(r,i):p(r,t,n)}()},p.path=function(t){e=t},p.urlArgs=function(e){t=e},p.ready=function(e,t,n){e=e[s]?e:[e];var i,r=[];return!f(e,function(e){c[e]||r[s](e)})&&d(e,function(e){return c[e]})?t():(i=e.join("|"),u[i]=u[i]||[],u[i][s](t),n&&n(r)),p},p.done=function(e){p([null],e)},p}),define("config",["module"],function(e){return{REQUEST_URL:"/api/",appsLoginUrl:e.config().appsLoginUrl,isWeb:!0,dev:e.config().dev,domain:e.config().domain,lang:e.config().lang,disableWebrtc:e.config().disableWebrtc,city:e.config().city,region:e.config().region,country:e.config().country,currency:e.config().currency,uvid:e.config().uvid,accountType:e.config().accountType,isSystem:e.config().isSystem||!1,webRtcTestPw:e.config().webrtc_test_password,sipRealm:e.config().sip_realm}}),define("constants",["config"],function(e){return{COOKIE:{NAME:"dp_mktg",DOMAIN:".dialpad.com"},DOMAIN:e.dev?"http://devbox:8085":"https://dialpad.com",GTM:{ID:e.dev?"GTM-T3SMKZ":"GTM-M4QWTC"},OAUTH:{DOMAINS:["accounts.google.com","login.windows.net"]},REFERRAL_BLACKLIST:{DOMAINS:["butchershop.okta.com"]},SOCIAL:{FACEBOOK:{ID:"401753310021084"}},THIRD_PARTY:{MARKETO:{SCRIPT:"/js/forms2/js/forms2.min.js",REGION:"//app-sj16.marketo.com",ACCT:"838-ZLQ-213"},GA:{UTM_PARAMS:["medium","source","term","content","campaign"]}},WEB_PROPERTIES:{DOMAINS:["dialpad.com","blog.dialpad.com","japan.blog.dialpad.com","support.dialpad.com","help.dialpad.com","status.dialpad.com","status-japan.dialpad.com","get.dialpad.com","uberconference.com","www.uberconference.com","support.uberconference.com","help.uberconference.com","status.uberconference.com"]}}}),define("marketo",["backbone","underscore","js-cookie","scriptjs","constants","config"],function(e,t,n,i,r,s){var o=r.COOKIE.NAME,a=r.THIRD_PARTY.MARKETO.ACCT,c=r.THIRD_PARTY.MARKETO.REGION,l=r.THIRD_PARTY.MARKETO.SCRIPT,u=r.WEB_PROPERTIES.DOMAINS,h=r.OAUTH.DOMAINS,d=r.REFERRAL_BLACKLIST.DOMAINS,f=function(e){i(c+l,function(){MktoForms2.loadForm(c,a,e)})},p=function(i,r){r.formid=i;var a=n(o);(a=a?JSON.parse(a):null)&&a.u&&t.each(a.u,function(e,t){r["demandramp_rm__"+t+"__c"]=e}),a&&(r.demandramp_rm__referring_url__c=a.r,r.demandramp_rm__destination_url__c=a.e,r.demandramp_rm__form_fill_out_url__c=r.demandramp_rm__landing_page_url__c=window.location.href);if(t.each(["utm_medium","utm_source","utm_campaign","utm_term","utm_content","referer","_bm","_bn","gclid","lead_source"],function(e){var t=n("dp_mkt_"+e);t&&("_bn"==e?r.Network__c=t:"_bm"==e?r.Match_Type__c=t:"lead_source"==e?r.LeadSource=t:"gclid"==e?r.GCLID__c=t:"referer"==e?r.Website_Path__c=g(t):r["demandramp_rm__"+e+"__c"]=t)}),r.LeadSource||(r.LeadSource="Website",e.trigger("track:event","lead source missing")),"undefined"!=typeof MktoForms2){var c=MktoForms2.getForm(i).setValues(r).onSuccess(function(){return!1});s.dev?console.log(c.vals()):c.submit()}},g=function(e){var t=e.match(/\/\/([^\/]+)/),n=t&&t[1];return m(n)?e:""},m=function(e){return h.concat(u,d).join(",").indexOf(e)>-1};return{initialize:function(){var n=document.querySelectorAll('form[id^="mktoForm_"]');e.on("track:marketo",this.deferredSubmit),0!==n.length&&t.each(n,function(e){var t=e.id.slice(-4);f(t)})},load:f,deferredSubmit:function(e,n){console.log("Deferring form "+e),t.defer(function(){p(e,n)})},submit:p}});try{globals=window.globals,globals=globals||window.parent.globals}catch(e){}globals=globals||{vars:{}},define("fslib/globals",[],function(){return globals}),define("fslib/fsutil",["fslib/globals","jquery","underscore","backbone"],function(e,$,t,n){var i=new RegExp(/(^|\s)((\+?1?\W*([2-9][0-8][0-9])\W*([2-9][0-9]{2})\W*([0-9]{4})(\se?x?t?(\d*))?)(?!\d))($|\W)/g),r={};fsutil={UC_URL_REGEXES:[/http(?:s)?:\/\/(?:www.)?uberconference(?:beta)?.com\/([a-zA-Z0-9_\-\/]+)/,/http(?:s)?:\/\/(?:[a-zA-Z0-9_\-\.]+)?(?:uberconf|uc-beta|ucstaging).appspot.com\/([a-zA-Z0-9_\-\/]+)/],SHORT_KEY_REGEX:/([^:]+):(.+)/,executeUcUrlRegex:function(e){var n;return e&&t.each(this.UC_URL_REGEXES,function(t){if((n=t.exec(e))&&n.length>1)return!1}),n},extractUcRoomPath:function(e){var t=this.executeUcUrlRegex(e);if(t)return t[1]},extractUcRoomUrl:function(e){var t=this.executeUcUrlRegex(e);if(t)return t[0]},randomInt:function(){return 1e19*Math.random()},compare:function(e,t,n){return Math.abs(e-t)<=n},copyRect:function(e,t){return(t=t||{}).top=e.top,t.left=e.left,t.right=e.right,t.bottom=e.bottom,t.width=e.width,t.height=e.height,t},rectContainsPoint:function(e,t,n){return t>=e.left&&t<=e.right&&n>=e.top&&n<=e.bottom},getUrlArgs:function(e){var n={};try{var i=(e||window.location&&window.location.href||"").split("?");if(i.length<=1)return n;var r=t.last(i);return t.each(r.split("&"),function(e){if(""!==e){var i=e.split("="),r=i[1]&&decodeURIComponent(i[1].replace(/\+/g," "));r&&t.isString(r)&&t.contains(["0","false","no","null","nil"],r.toLowerCase())&&(r=!1),n[i[0]]=r}}),n}catch(e){console.error("Failed to parse urlArgs"),console.error(e)}finally{return n}},toUrlArgStr:function(e){var n=[];return t.each(e,function(e,t){n.push(t+"="+e)}),n.join("&")},removeEmptyFragment:function(e){return"#"==e.charAt(e.length-1)?e.slice(0,e.length-1):e},getFragmentMinusQueryString:function(){return n.history.fragment.split("?")[0]},formToObject:function(e){var n=e.serializeArray(),i={};return t.each(n,function(e){var t=e.name,n=e.value;"[]"==t.slice(-2)?(t=t.substr(0,t.length-2),i[t]?i[t].push(n):i[t]=[n]):i[t]=n}),i},doReflowHack:function(e){if(e&&e.length){e[0].offsetHeight;0}},formReset:function(e){t.each(e,function(e){e.reset()})},getChrome:function(e,n){window||n&&console.log("no window"),window.chrome||n&&console.log("no chrome"),e||n&&console.log("no package name");var i=window.chrome,r=e.split(".");return t.each(r,function(e){if(i)return i[e]?void(i=i[e]):(i=null,void(n&&console.log("no subpackage: "+e)))}),i||n&&console.log("Failed to get package: "+e),i},elipsis:function(e,t){if(e)return t=t||40,e.length>t&&(e=e.slice(0,t-3)+"..."),e},ellipsis:function(e,t){return this.elipsis(e,t)},setLocal:function(e,n,i){e="fsutil:"+e,this.memory=this.memory||{};var r=this.getChrome("storage.local");if(r){var s={};s[e]=n,t.isUndefined(i)&&(i=t.noop),r.set(s,i),this.memory[e]=n}else window.localStorage&&(window.localStorage[e]=JSON.stringify(n))},getLocal:function(e,n,i){e="fsutil:"+e,this.memory=this.memory||{};var r=n||function(e){},s=s||void 0,o=this.getChrome("storage.local");if(o)return(s=this.memory[e])?(i?r(s):t.defer(function(){r(s)}),s):(o.get(e,t.bind(function(t){var n=t[e];this.memory[e]=n,r(n)},this)),s);if(window.localStorage){s=window.localStorage[e];try{s=JSON.parse(s)}catch(e){}return t.defer(function(){r(s)}),s}},getLocalUrl:function(e){if(e&&(e=e.replace("//uber-voice.appspot.com","//dialpad.com")),e&&e.length&&e.match(/^\/[^\/]/))return window&&window.nativeApp?"."+e:e;if(!this.isChromeApp()||!e||!e.length)return e;"dev"==window.environment&&(e=e.replace("https://","http://"));var n=this.getLocal(e);return t.isString(n)?n:e},getBackgroundUrl:function(e){var t=e.style.backgroundImage.match(/url\((.*)\)/);if(t&&2==t.length)return t[1]},isImageBlob:function(e){return 0===e.indexOf("blob:")||0===e.indexOf("data:")},getCachedImage:function(e){if(this.isImageBlob(e))return e;var t=this.getLocalUrl(e);return this.isChromeApp()?this.isImageBlob(t)?t:null:t},loadImage:function(e,t){var n=this.getCachedImage(e),i=function(e,n,i){return t&&t(e,n,i),e};if(this.isChromeApp())n?i(n):this.fetchImageBlob(e,i);else{var r=new Image;r.onload=function(){r.onload=null,r=null,i(n,this.width,this.height)},r.setAttribute("src",n)}},_fetchingImages:{},fetchImageBlob:function(e,n){if(e&&!this.isImageBlob(e))if(this._fetchingImages[e])this._fetchingImages[e].push(n);else{this._fetchingImages[e]=[n];var i=new XMLHttpRequest;'"'===e.substr(0,1)&&(e=e.substr(1,e.length-2)),i.open("GET",e,!0),i.responseType="blob",i.onload=t.bind(function(n){var i=n.target.status;if(i>=200&&i<300){var r=new FileReader,s=n.target.response;r.onloadend=t.bind(function(t){for(var n=r.result,i=this._fetchingImages[e],s=0;s<i.length;s++)i[s]&&i[s](n);this.setLocal(e,n),this._fetchingImages[e]=null},this),r.readAsDataURL(s)}else{this._fetchingImages[e]=null;for(var o=this._fetchingImages[e],a=0;a<o.length;a++)o[a]&&o[a](null)}},this),i.send()}else n(e)},setImage:function(e){function n(t){if(0==(""+e).indexOf("http"))return t;$(e).is("img")?e.src=t:e.style.backgroundImage="url("+t+")"}if(window&&window.chrome&&window.chrome.storage){var i=function(){if(e){if(0==(""+e).indexOf("http"))return e;if($(e).is("img"))return $(e).attr("data-url")||e.src;var t=e.style.backgroundImage.match(/url\((.*)\)/);return t&&2==t.length?t[1]:void 0}}()||"";if(i&&0!=i.indexOf("blob:")&&0!=i.indexOf("data:")){if(i.match(/^\/[^\/]/))return i;"dev"==window.environment&&(i=i.replace("https","http"));this.getLocal(i,t.bind(function(r){var s=(new Date).getTime();if(r&&parseInt(r)){if(s-15e3<parseInt(r)){var o=this;return void setTimeout(function(){o.setImage(e)},2e3)}r=null,this.setLocal(i,s)}if(r)n(r);else{this.setLocal(i,s);var a=i&&i.length>1024?"[clipped from "+i.length+" to 1024 chars] : "+i.substr(0,1024):i;console.log("Fetching url =",a);var c=new XMLHttpRequest;'"'===i.substr(0,1)&&(i=i.substr(1,i.length-2)),c.open("GET",i,!0),c.responseType="blob",c.onload=t.bind(function(e){var s=e.target.status;if(s>=200&&s<300){var o=e.target.response,a=new FileReader;a.onloadend=t.bind(function(e){r=a.result,this.setLocal(i,r),n(r)},this),a.readAsDataURL(o)}},this),c.send()}},this),!0)}}},bindAll:function(e){var n=Array.prototype.slice.call(arguments,1),i=["arguments","caller","callee"];return 0===n.length&&(n=t.functions(e)),t.each(n,function(n){var r=e[n],s=Object.getOwnPropertyNames(r);e[n]=t.bind(e[n],e),e[n].srcFunc=r,t.each(s,function(s,o,a){t.contains(i,s)||(e[n][s]=r[s])})}),e},extendEvents:function(e){t.each(n.Events,function(t,n,i){"function"!=typeof t||e[n]||(e[n]=t)}),e.prototype.getClass=function(){return e}},supportsWebRtc:function(){return!t.isUndefined(window.getUserMedia||window.navigator.getUserMedia||window.navigator.webkitGetUserMedia||window.navigator.mozGetUserMedia)},supportsMediaDevices:function(){return!!(navigator&&navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices)},supportsGetDisplayMedia:function(){return!!(navigator&&navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)},isProd:function(e){if(e&&e.domain)return e.domain.includes("dialpad.com")||e.domain.includes("uberconference.com")},isChrome:function(){try{return chrome}catch(e){}return null},isFirefox:function(){return-1!==this.getRawUserAgent().indexOf("Firefox")},isIE:function(){var e=this.getRawUserAgent();return-1!==e.indexOf("MSIE")||-1!==e.indexOf("Trident")},isEdge:function(){return-1!==this.getRawUserAgent().indexOf("Edge")},isElectron:function(){return-1!==this.getRawUserAgent().indexOf("Electron")},isSafari:function(){var e=this.getRawUserAgent();return-1!==e.indexOf("Safari")&&-1==e.indexOf("Chrome")},isOpera:function(){var e=this.getRawUserAgent();return-1!==e.indexOf("Opera")&&-1==e.indexOf("OPR")},isMacOSX:function(){return-1!==this.getRawUserAgent().indexOf("Mac OS X")},isLinux:function(){return-1!==this.getPlatform().toLowerCase().indexOf("linux")},isChromeApp:function(){return!!this.getAppVersion()},isChromeExtension:function(){return!!(window&&window.chrome&&chrome&&chrome.app&&chrome.app.getDetails&&chrome.app.getDetails())},isBrowser:function(){return!this.isElectron()&&!this.isChromeApp()&&!this.isChromeExtension()},getChromeVersion:function(e){return this.isEdge()||!this.isChrome()&&!this.isElectron()?null:this._getUaVersion(/Chrome\/(\d+)/,1,e,this.getNavigatorAppVersion())},getFirefoxVersion:function(e){return this.isFirefox()?this._getUaVersion(/Firefox\/(\d+(\.\d+(\.\d+)?)?)/,1,e):null},getIeVersion:function(e){return this.isIE()?this._getUaVersion(/(rv:|MSIE )(\d+(\.\d+(\.\d+)?)?)/,2,e):null},getEdgeVersion:function(e){return this.isEdge()?this._getUaVersion(/Edge\/(\d+(\.\d+(\.\d+)?)?)/,1,e):null},getSafariVersion:function(e){return this.isSafari()?this._getUaVersion(/Version\/(\d+(\.\d+(\.\d+)?)?)/,1,e):null},getOperaVersion:function(e){return this.isOpera()?this._getUaVersion(/(Opera|OPR)\/(\d+(\.\d+(\.\d+)?)?)/,2,e):null},_getUaVersion:function(e,t,n,i){var r=(i||this.getRawUserAgent()).match(e);return r=r&&r.length>t?r[t]:"",n&&(r=parseInt(r.split(".")[0]||0,10)),r},getAppVersion:function(){try{return this.getChrome("runtime").getManifest().version}catch(e){}},isVersionGreater:function(e,n){if(e==n)return!1;if(!e)return!1;if(!n)return!0;var i=e.split("."),r=n.split("."),s=!1,o=!1;return t.each(t.zip(i,r),function(e){var t=parseInt(e[0]),n=parseInt(e[1]);s||(t>n&&(s=!0,o=!0),t<n&&(s=!0,o=!1))}),o||i.length>r.length},isMinorUpdate:function(e,n){if(!e||!n)return!1;if(!this.isVersionGreater(n,e))return!1;if(!t.contains(n,"."))return!1;var i=e.split("."),r=n.split("."),s=i.slice(0,i.length),o=r.slice(0,r.length),a=r.length;return t.each(t.zip(s,o),function(e,t){var n=parseInt(e[0]);parseInt(e[1])>n&&t<a&&(a=t)}),a>=i.length-1},getRawUserAgent:function(){return!!window&&!!window.navigator&&window.navigator.userAgent||""},getNavigatorAppVersion:function(){return!!window&&!!window.navigator&&window.navigator.appVersion||""},getPlatform:function(){return!!window&&!!window.navigator&&window.navigator.platform||""},getUserAgent:function(){var t="";try{var n=this.getChrome("runtime");if(n){var i=n.getManifest();i&&(t=i.name+"/"+i.version+" ")}}catch(e){}return t+="Chrome/"+this.getChromeVersion()+" ",e.os&&(t+="OS/"+e.os+" "),this.getChrome("app")&&(t+="app=1 "),t=t.trim()},isWindows:function(){return-1!=window.navigator.appVersion.indexOf("Windows NT")},isWindows10:function(){return-1!=window.navigator.appVersion.indexOf("Windows NT 10")},isWindows81:function(){return-1!=window.navigator.appVersion.indexOf("Windows NT 6.3")},limitAjax:function(e,t,n){var i=this,r="_"+t;e[r]=e[t],e.abortCurrentRequest=function(){this.currentRequest?this.currentRequest.abort():i.cancelThrottled(this)},e[t]=function(){var e=this[r],t=n;return this.abortCurrentRequest(),t?i.throttle(this,r,t,{arguments:arguments,callback:function(e){this.currentRequest=e}}):this.currentRequest=e.apply(this,arguments),this.currentRequest}},supportsSvgExternalXLink:function(){return!1},escapeRegExp:function(e){return e.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},throttle:function(e,t,n,i){e.throttled=e.throttled||{},e.throttled[t]=e.throttled[t]||{};var r=i.arguments||[],s=i.callback||function(){},o=e.throttled[t];o&&window.clearTimeout(o),o=window.setTimeout(function(){var n=e[t].apply(e,r);s.call(e,n)},n),e.throttled[t]=o},cancelThrottled:function(e,t){if(e.throttled)if(t&&e.throttled[t])window.clearTimeout(e.throttled[t]);else if(!t)for(var n in e.throttled)window.clearTimeout(e.throttled[n])},isSSExtensionInstalled:function(){return $("#uc-ss-extension").length},installExtension:function(e,t,n){if(window.chrome)try{chrome.webstore.install(e,t,n)}catch(e){n()}},convertDataURIToBlob:function(e,t){if(t=t||"image/jpeg",!e)return new Uint8Array(0);for(var n=e.indexOf(";base64,")+";base64,".length,i=e.substring(n),r=window.atob(i),s=new Uint8Array(r.length),o=0;o<s.length;++o)s[o]=r.charCodeAt(o);return new Blob([s],{type:t})},anchorBottom:function(e,t){if(e=$(e),t=$(t),e&&t){var n=e.position();if(n){var i=n.top,r=t.height();e.css("height",r-i)}}},toggleInputs:function(e,n){var i=$(e).find("input, button, textarea");t.each(i,function(e){var t=$(e);t.prop("disabled",!n),t.hasClass("button")&&t.toggleClass("disabled",!n)})},enableInputs:function(e){this.toggleInputs(e,!0)},disableInputs:function(e){this.toggleInputs(e,!1)},selectAllText:function(e){var t,n;document.body.createTextRange?((t=document.body.createTextRange()).moveToElementText(e),t.select()):window.getSelection&&(n=window.getSelection(),(t=document.createRange()).selectNodeContents(e),n.removeAllRanges(),n.addRange(t))},getMapImageUrl:function(e,t){var n,i=t.width||518,r=t.height||196;if(t.latLong)n=t.latLong;else if(t.city&&t.region){n=t.city.replace(" ","+")+","+t.region.replace(" ","+")}return"http://maps.googleapis.com/maps/api/staticmap?sensor=false&center="+n+"&zoom=12&size="+i+"x"+r+"&key="+e},copyToClipboard:function(e){var t=$("<textarea/>");$("body").append(t),t.val(e),t.select(),document.execCommand("copy"),t.remove()},diffDays:function(e,t,n){var i=new Date(e),r=new Date(t),s=Math.abs((i.getTime()-r.getTime())/864e5);return n?Math.round(s):s},getOffsetDateObj:function(e,t){var n=new Date(e+24*t*60*60*1e3);return new Date(n.getFullYear(),n.getMonth(),n.getDate())},todayYesterday:function(e){var n=new Date,i=new Date(e),r=n.getFullYear(),s=n.getMonth(),o=n.getDate(),a=i.getFullYear(),c=i.getMonth(),l=i.getDate();if(r==a&&s==c&&o==l)return"TODAY";if(r==a&&s==c&&o-1==l)return"YESTERDAY";var u=30;return t.contains([1,3,5,7,8,10,12],c)?u=31:2==c&&(u=28),r==a&&s-1==c&&1==o&&l==u?"YESTERDAY":r-1==a&&0==s&&11==c&&1==o&&31==l?"YESTERDAY":""},getDayAsString:function(e){return(e?new Date(e):new Date).toLocaleDateString()},trimPhone:function(e){return e.replace(/(?!^[\+\*])\D+/g,"")},formatPhone:function(e){if(e){var t=e.toString();if(11===(t=t.replace("+","")).length){var n=t.substr(0,1);if("1"===n)return n+" ("+t.substr(1,3)+") "+t.substr(4,3)+"-"+t.substr(7,4)}else{if(10===t.length)return"("+t.substr(0,3)+") "+t.substr(3,3)+"-"+t.substr(6,4);if(7===t.length)return t.substr(0,3)+"-"+t.substr(3,4)}}return e},lettersToDigits:function(e){var n="";return t.each(e.split(""),function(e){e.match(/[a-zA-Z]/)&&(e=function(e){switch(e){case"a":case"b":case"c":return"2";case"d":case"e":case"f":return"3";case"g":case"h":case"i":return"4";case"j":case"k":case"l":return"5";case"m":case"n":case"o":return"6";case"p":case"q":case"r":case"s":return"7";case"t":case"u":case"v":return"8";case"w":case"x":case"y":case"z":return"9"}}(e.toLowerCase())),n+=e}),n},isEmail:function(e){return/^([a-zA-Z0-9_.\'+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(e)},emailMatchesDomain:function(e,t){t="@"+t;var n=e.lastIndexOf(t);return-1!=n&&e.length==t.length+n},findEmailThatMatchesDomain:function(e,n){return t.find(e,t.bind(function(e){return this.emailMatchesDomain(e,n)},this))},_getTermRegex:function(e){if(!r[e]){var n=t.map(e,function(e){return(e=e.match(/^[a-z0-9]+$/i)?e:"\\"+e)+"[\\(\\)\\s-]*"}).join("");n="[\\(\\)\\s-]*"+n;var i=new RegExp(n,"ig");r[e]=i}return r[e]},parseShortKey:function(e){if(!e)return null;var t=e.match(this.SHORT_KEY_REGEX);return t<3?null:{type:t[1],key:t[2]}},highlight:function(e,t,n){if(!t)return e;var i=this._getTermRegex(t);return e.replace(i,function(e,t){return n?n(e,t)||e:'<span class="highlight">'+e+"</span>"})},linkifyPhoneNumbers:function(e,n){var i=e,r=this.getPhoneNumbers(e);return n||(n=function(e,t){return"<a>"+e+"</a>"}),t.each(r,t.bind(function(e){var t=this.trimPhone(e);i=i.replace(e,n(e,t))},this)),i},getPhoneNumbers:function(e){return e.match(i)},getMappedSetting:function(e,n){if("object"!==(void 0===e?"undefined":_typeof(e)))return e;var i=n?n.overrideEnvKey:void 0;!i&&n&&((n.isDev||n.isStaging)&&(i="dev"),!e[i]&&n.isUnitTest&&(i="unittest"),e[i]||(i="prod"));var r=e[i||"prod"];return t.isUndefined(r)?(console.error('No mapped setting for "'+i+'"!'),0):r},readableMsec:function(e){var t=e/1e3;return t<60?t+" sec":t/60+" min"},firstName:function(e){return e?e.split(" ")[0]:e},firstNameOrPhone:function(e,t){return t&&t==e?e:e?this.getPhoneNumbers(e)?e:e.split(" ")[0]:e},firstNameLastInitial:function(e){if(e){if(this.getPhoneNumbers(e))return e;var t=e.split(" "),n=t.length;n>1&&(e=t[0]+" "+t[n-1][0]+".")}return e},minutes:function(e){return Math.ceil(parseInt(e,10)/60)},formatPercent:function(e){for(;e.startsWith(".")||e.startsWith("0");)e=e.slice(1,e.length);return"1.00"===e?"100":e},numToLocaleString:function(e,t){try{return e.toLocaleString(t)}catch(t){try{return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}catch(e){}}return e},ip2num:function(e){for(var t=e.split("."),n=0,i=t.length,r=0;r<i;r++)n+=parseInt(t[r])*Math.pow(256,i-1-r);return n},isPrivateIp:function(e){for(var t=this.ip2num(e),n=0;n<o.length;n++)if(o[n].inRange(t))return!0;return!1},TIME_UNITS:[{name:"ms",value:1},{name:"secs",value:1e3},{name:"mins",value:60},{name:"hrs",value:60},{name:"days",value:24},{name:"years",value:365},{name:"millenia",value:1e3}],formatTime:function(e,t){for(var n={},i=e,r="ns",s=this.TIME_UNITS,o=0;o<s.length;o++){var a=parseInt(i/s[o].value);n[r]=i-a*s[o].value,r=s[o].name,i=a}var c=n.secs;return t&&!n.mins||(c=n.mins+":"+c),t&&(c+="."+n.ms),(n.hrs||n.days||n.years)&&(c=n.hrs+":"+c),(n.days||n.years)&&(c=n.days+":"+c),n.years&&(c=n.years+":"+c),c.replace(/(\d+)/g,function(e){return e.length<2?"0"+e:e})},typeOf:function(e){var t=void 0===e?"undefined":_typeof(e),n=t;switch(t){case"object":case"function":var i=s.call(e);n=i.substring(8,i.length-1)}return n.toLowerCase()},sum:function(e,n){return t.reduce(Array.from(e),function(e,t){return"object"===(void 0===t?"undefined":_typeof(t))&&n&&t[n]?e+t[n]:e+t},0)},isPhone:function(e){return/^[0-9-+s() ]*$/.test(e)},bindAllExcept:function(e){var n=Array.prototype.slice.call(arguments,1);if(0===n.length)return t.bindAll(e);var i={};return t.each(n,function(e){i[e]=1}),t.each(t.functions(e),function(n){i[n]||(e[n]=t.bind(e[n],e))}),e}};var s=Object.prototype.toString,o=[{"0.0.0.0":"0.255.255.255"},{"10.0.0.0":"10.255.255.255"},{"100.64.0.0":"100.127.255.255"},{"127.0.0.0":"127.255.255.255"},{"169.254.0.0":"169.254.255.255"},{"172.16.0.0":"172.31.255.255"},{"192.0.0.0":"192.0.0.255"},{"192.0.2.0":"192.0.2.255"},{"192.88.99.0":"192.88.99.255"},{"192.168.0.0":"192.168.255.255"},{"198.18.0.0":"198.19.255.255"},{"198.51.100.0":"198.51.100.255"},{"203.0.113.0":"203.0.113.255"},{"224.0.0.0":"239.255.255.255"},{"240.0.0.0":"255.255.255.255"}];return o=t.map(o,function(e){var n={};return t.each(e,function(e,t){n.minIp=t,n.maxIp=e,n.min=fsutil.ip2num(t),n.max=fsutil.ip2num(e),n.inRange=function(e){return(e="string"==typeof e?fsutil.ip2num(e):e)>=this.min&&e<=this.max}}),n}),t.bindAll(fsutil),fsutil}),define("fslib/lazy_loader",["backbone","fslib/fsutil"],function(t,n){var i=t.View.extend({initialize:function(){t.View.prototype.initialize.apply(this,arguments),_.bindAll(this),this.modules={},this.errorModules={}},load:function(e,t,n){var i=e instanceof Array?e:[e],r=i.join(":"),s=_.bind(function(){this.modules[r]="loaded",t.apply(n,arguments)},this);this.modulesLoading(r)||(this.modules[r]||(this.modules[r]="loading"),require(i,s.bind(this),this._requireError))},loadAlternate:function(e,t,n){this.load(e+(window.ucLoadAlt?"Alt":""),t,n)},modulesLoading:function(e){return"loading"===this.modules[e]},_requireError:function(t){_.each(t.requireModules,_.bind(function(n){this.errorModules[n]=!0;try{this.trigger("error:"+n,t)}catch(t){try{console.error("Exception triggering loader error for module %s = %o",n,e)}catch(e){}}},this))}});n.extendEvents(i);var r=new i;return _lazyLoader=r,r}),define("build_vars",[],function(){return{appType:"guest"}});var Handlebars={},_i18n,_router,sdpUtil,_webrtc;!function(e,t){e.VERSION="1.0.0",e.COMPILER_REVISION=4,e.REVISION_CHANGES={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:">= 1.0.0"},e.helpers={},e.partials={};var n=Object.prototype.toString;e.registerHelper=function(t,i,r){if("[object Object]"===n.call(t)){if(r||i)throw new e.Exception("Arg not supported with multiple helpers");e.Utils.extend(this.helpers,t)}else r&&(i.not=r),this.helpers[t]=i},e.registerPartial=function(t,i){"[object Object]"===n.call(t)?e.Utils.extend(this.partials,t):this.partials[t]=i},e.registerHelper("helperMissing",function(e){if(2===arguments.length)return t;throw new Error("Missing helper: '"+e+"'")}),e.registerHelper("blockHelperMissing",function(t,i){var r=i.inverse||function(){},s=i.fn,o=n.call(t);return"[object Function]"===o&&(t=t.call(this)),!0===t?s(this):!1===t||null==t?r(this):"[object Array]"===o?t.length>0?e.helpers.each(t,i):r(this):s(t)}),e.K=function(){},e.createFrame=Object.create||function(t){e.K.prototype=t;var n=new e.K;return e.K.prototype=null,n},e.logger={DEBUG:0,INFO:1,WARN:2,ERROR:3,level:3,methodMap:{0:"debug",1:"info",2:"warn",3:"error"},log:function(t,n){if(e.logger.level<=t){var i=e.logger.methodMap[t];"undefined"!=typeof console&&console[i]&&console[i].call(console,n)}}},e.log=function(t,n){e.logger.log(t,n)},e.registerHelper("each",function(t,i){var r,s=i.fn,o=i.inverse,a=0,c="";if("[object Function]"===n.call(t)&&(t=t.call(this)),i.data&&(r=e.createFrame(i.data)),t&&"object"===(void 0===t?"undefined":_typeof(t)))if(t instanceof Array)for(var l=t.length;a<l;a++)r&&(r.index=a),c+=s(t[a],{data:r});else for(var u in t)t.hasOwnProperty(u)&&(r&&(r.key=u),c+=s(t[u],{data:r}),a++);return 0===a&&(c=o(this)),c}),e.registerHelper("if",function(t,i){return"[object Function]"===n.call(t)&&(t=t.call(this)),!t||e.Utils.isEmpty(t)?i.inverse(this):i.fn(this)}),e.registerHelper("unless",function(t,n){return e.helpers.if.call(this,t,{fn:n.inverse,inverse:n.fn})}),e.registerHelper("with",function(t,i){if("[object Function]"===n.call(t)&&(t=t.call(this)),!e.Utils.isEmpty(t))return i.fn(t)}),e.registerHelper("log",function(t,n){var i=n.data&&null!=n.data.level?parseInt(n.data.level,10):1;e.log(i,t)});var i=function(){var e={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,simpleInverse:6,statements:7,statement:8,openInverse:9,closeBlock:10,openBlock:11,mustache:12,partial:13,CONTENT:14,COMMENT:15,OPEN_BLOCK:16,inMustache:17,CLOSE:18,OPEN_INVERSE:19,OPEN_ENDBLOCK:20,path:21,OPEN:22,OPEN_UNESCAPED:23,CLOSE_UNESCAPED:24,OPEN_PARTIAL:25,partialName:26,params:27,hash:28,dataName:29,param:30,STRING:31,INTEGER:32,BOOLEAN:33,hashSegments:34,hashSegment:35,ID:36,EQUALS:37,DATA:38,pathSegments:39,SEP:40,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",14:"CONTENT",15:"COMMENT",16:"OPEN_BLOCK",18:"CLOSE",19:"OPEN_INVERSE",20:"OPEN_ENDBLOCK",22:"OPEN",23:"OPEN_UNESCAPED",24:"CLOSE_UNESCAPED",25:"OPEN_PARTIAL",31:"STRING",32:"INTEGER",33:"BOOLEAN",36:"ID",37:"EQUALS",38:"DATA",40:"SEP"},productions_:[0,[3,2],[4,2],[4,3],[4,2],[4,1],[4,1],[4,0],[7,1],[7,2],[8,3],[8,3],[8,1],[8,1],[8,1],[8,1],[11,3],[9,3],[10,3],[12,3],[12,3],[13,3],[13,4],[6,2],[17,3],[17,2],[17,2],[17,1],[17,1],[27,2],[27,1],[30,1],[30,1],[30,1],[30,1],[30,1],[28,1],[34,2],[34,1],[35,3],[35,3],[35,3],[35,3],[35,3],[26,1],[26,1],[26,1],[29,2],[21,1],[39,3],[39,1]],performAction:function(e,t,n,i,r,s,o){var a=s.length-1;switch(r){case 1:return s[a-1];case 2:this.$=new i.ProgramNode([],s[a]);break;case 3:this.$=new i.ProgramNode(s[a-2],s[a]);break;case 4:this.$=new i.ProgramNode(s[a-1],[]);break;case 5:this.$=new i.ProgramNode(s[a]);break;case 6:this.$=new i.ProgramNode([],[]);break;case 7:this.$=new i.ProgramNode([]);break;case 8:this.$=[s[a]];break;case 9:s[a-1].push(s[a]),this.$=s[a-1];break;case 10:this.$=new i.BlockNode(s[a-2],s[a-1].inverse,s[a-1],s[a]);break;case 11:this.$=new i.BlockNode(s[a-2],s[a-1],s[a-1].inverse,s[a]);break;case 12:case 13:this.$=s[a];break;case 14:this.$=new i.ContentNode(s[a]);break;case 15:this.$=new i.CommentNode(s[a]);break;case 16:case 17:this.$=new i.MustacheNode(s[a-1][0],s[a-1][1]);break;case 18:this.$=s[a-1];break;case 19:this.$=new i.MustacheNode(s[a-1][0],s[a-1][1],"&"===s[a-2][2]);break;case 20:this.$=new i.MustacheNode(s[a-1][0],s[a-1][1],!0);break;case 21:this.$=new i.PartialNode(s[a-1]);break;case 22:this.$=new i.PartialNode(s[a-2],s[a-1]);break;case 23:break;case 24:this.$=[[s[a-2]].concat(s[a-1]),s[a]];break;case 25:this.$=[[s[a-1]].concat(s[a]),null];break;case 26:this.$=[[s[a-1]],s[a]];break;case 27:case 28:this.$=[[s[a]],null];break;case 29:s[a-1].push(s[a]),this.$=s[a-1];break;case 30:this.$=[s[a]];break;case 31:this.$=s[a];break;case 32:this.$=new i.StringNode(s[a]);break;case 33:this.$=new i.IntegerNode(s[a]);break;case 34:this.$=new i.BooleanNode(s[a]);break;case 35:this.$=s[a];break;case 36:this.$=new i.HashNode(s[a]);break;case 37:s[a-1].push(s[a]),this.$=s[a-1];break;case 38:this.$=[s[a]];break;case 39:this.$=[s[a-2],s[a]];break;case 40:this.$=[s[a-2],new i.StringNode(s[a])];break;case 41:this.$=[s[a-2],new i.IntegerNode(s[a])];break;case 42:this.$=[s[a-2],new i.BooleanNode(s[a])];break;case 43:this.$=[s[a-2],s[a]];break;case 44:this.$=new i.PartialNameNode(s[a]);break;case 45:this.$=new i.PartialNameNode(new i.StringNode(s[a]));break;case 46:this.$=new i.PartialNameNode(new i.IntegerNode(s[a]));break;case 47:this.$=new i.DataNode(s[a]);break;case 48:this.$=new i.IdNode(s[a]);break;case 49:s[a-2].push({part:s[a],separator:s[a-1]}),this.$=s[a-2];break;case 50:this.$=[{part:s[a]}]}},table:[{3:1,4:2,5:[2,7],6:3,7:4,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],22:[1,14],23:[1,15],25:[1,16]},{1:[3]},{5:[1,17]},{5:[2,6],7:18,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,6],22:[1,14],23:[1,15],25:[1,16]},{5:[2,5],6:20,8:21,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],20:[2,5],22:[1,14],23:[1,15],25:[1,16]},{17:23,18:[1,22],21:24,29:25,36:[1,28],38:[1,27],39:26},{5:[2,8],14:[2,8],15:[2,8],16:[2,8],19:[2,8],20:[2,8],22:[2,8],23:[2,8],25:[2,8]},{4:29,6:3,7:4,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],20:[2,7],22:[1,14],23:[1,15],25:[1,16]},{4:30,6:3,7:4,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,5],20:[2,7],22:[1,14],23:[1,15],25:[1,16]},{5:[2,12],14:[2,12],15:[2,12],16:[2,12],19:[2,12],20:[2,12],22:[2,12],23:[2,12],25:[2,12]},{5:[2,13],14:[2,13],15:[2,13],16:[2,13],19:[2,13],20:[2,13],22:[2,13],23:[2,13],25:[2,13]},{5:[2,14],14:[2,14],15:[2,14],16:[2,14],19:[2,14],20:[2,14],22:[2,14],23:[2,14],25:[2,14]},{5:[2,15],14:[2,15],15:[2,15],16:[2,15],19:[2,15],20:[2,15],22:[2,15],23:[2,15],25:[2,15]},{17:31,21:24,29:25,36:[1,28],38:[1,27],39:26},{17:32,21:24,29:25,36:[1,28],38:[1,27],39:26},{17:33,21:24,29:25,36:[1,28],38:[1,27],39:26},{21:35,26:34,31:[1,36],32:[1,37],36:[1,28],39:26},{1:[2,1]},{5:[2,2],8:21,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,2],22:[1,14],23:[1,15],25:[1,16]},{17:23,21:24,29:25,36:[1,28],38:[1,27],39:26},{5:[2,4],7:38,8:6,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,4],22:[1,14],23:[1,15],25:[1,16]},{5:[2,9],14:[2,9],15:[2,9],16:[2,9],19:[2,9],20:[2,9],22:[2,9],23:[2,9],25:[2,9]},{5:[2,23],14:[2,23],15:[2,23],16:[2,23],19:[2,23],20:[2,23],22:[2,23],23:[2,23],25:[2,23]},{18:[1,39]},{18:[2,27],21:44,24:[2,27],27:40,28:41,29:48,30:42,31:[1,45],32:[1,46],33:[1,47],34:43,35:49,36:[1,50],38:[1,27],39:26},{18:[2,28],24:[2,28]},{18:[2,48],24:[2,48],31:[2,48],32:[2,48],33:[2,48],36:[2,48],38:[2,48],40:[1,51]},{21:52,36:[1,28],39:26},{18:[2,50],24:[2,50],31:[2,50],32:[2,50],33:[2,50],36:[2,50],38:[2,50],40:[2,50]},{10:53,20:[1,54]},{10:55,20:[1,54]},{18:[1,56]},{18:[1,57]},{24:[1,58]},{18:[1,59],21:60,36:[1,28],39:26},{18:[2,44],36:[2,44]},{18:[2,45],36:[2,45]},{18:[2,46],36:[2,46]},{5:[2,3],8:21,9:7,11:8,12:9,13:10,14:[1,11],15:[1,12],16:[1,13],19:[1,19],20:[2,3],22:[1,14],23:[1,15],25:[1,16]},{14:[2,17],15:[2,17],16:[2,17],19:[2,17],20:[2,17],22:[2,17],23:[2,17],25:[2,17]},{18:[2,25],21:44,24:[2,25],28:61,29:48,30:62,31:[1,45],32:[1,46],33:[1,47],34:43,35:49,36:[1,50],38:[1,27],39:26},{18:[2,26],24:[2,26]},{18:[2,30],24:[2,30],31:[2,30],32:[2,30],33:[2,30],36:[2,30],38:[2,30]},{18:[2,36],24:[2,36],35:63,36:[1,64]},{18:[2,31],24:[2,31],31:[2,31],32:[2,31],33:[2,31],36:[2,31],38:[2,31]},{18:[2,32],24:[2,32],31:[2,32],32:[2,32],33:[2,32],36:[2,32],38:[2,32]},{18:[2,33],24:[2,33],31:[2,33],32:[2,33],33:[2,33],36:[2,33],38:[2,33]},{18:[2,34],24:[2,34],31:[2,34],32:[2,34],33:[2,34],36:[2,34],38:[2,34]},{18:[2,35],24:[2,35],31:[2,35],32:[2,35],33:[2,35],36:[2,35],38:[2,35]},{18:[2,38],24:[2,38],36:[2,38]},{18:[2,50],24:[2,50],31:[2,50],32:[2,50],33:[2,50],36:[2,50],37:[1,65],38:[2,50],40:[2,50]},{36:[1,66]},{18:[2,47],24:[2,47],31:[2,47],32:[2,47],33:[2,47],36:[2,47],38:[2,47]},{5:[2,10],14:[2,10],15:[2,10],16:[2,10],19:[2,10],20:[2,10],22:[2,10],23:[2,10],25:[2,10]},{21:67,36:[1,28],39:26},{5:[2,11],14:[2,11],15:[2,11],16:[2,11],19:[2,11],20:[2,11],22:[2,11],23:[2,11],25:[2,11]},{14:[2,16],15:[2,16],16:[2,16],19:[2,16],20:[2,16],22:[2,16],23:[2,16],25:[2,16]},{5:[2,19],14:[2,19],15:[2,19],16:[2,19],19:[2,19],20:[2,19],22:[2,19],23:[2,19],25:[2,19]},{5:[2,20],14:[2,20],15:[2,20],16:[2,20],19:[2,20],20:[2,20],22:[2,20],23:[2,20],25:[2,20]},{5:[2,21],14:[2,21],15:[2,21],16:[2,21],19:[2,21],20:[2,21],22:[2,21],23:[2,21],25:[2,21]},{18:[1,68]},{18:[2,24],24:[2,24]},{18:[2,29],24:[2,29],31:[2,29],32:[2,29],33:[2,29],36:[2,29],38:[2,29]},{18:[2,37],24:[2,37],36:[2,37]},{37:[1,65]},{21:69,29:73,31:[1,70],32:[1,71],33:[1,72],36:[1,28],38:[1,27],39:26},{18:[2,49],24:[2,49],31:[2,49],32:[2,49],33:[2,49],36:[2,49],38:[2,49],40:[2,49]},{18:[1,74]},{5:[2,22],14:[2,22],15:[2,22],16:[2,22],19:[2,22],20:[2,22],22:[2,22],23:[2,22],25:[2,22]},{18:[2,39],24:[2,39],36:[2,39]},{18:[2,40],24:[2,40],36:[2,40]},{18:[2,41],24:[2,41],36:[2,41]},{18:[2,42],24:[2,42],36:[2,42]},{18:[2,43],24:[2,43],36:[2,43]},{5:[2,18],14:[2,18],15:[2,18],16:[2,18],19:[2,18],20:[2,18],22:[2,18],23:[2,18],25:[2,18]}],defaultActions:{17:[2,1]},parseError:function(e,t){throw new Error(e)},parse:function(e){var t=this,n=[0],i=[null],r=[],s=this.table,o="",a=0,c=0,l=0;this.lexer.setInput(e),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,void 0===this.lexer.yylloc&&(this.lexer.yylloc={});var u=this.lexer.yylloc;r.push(u);var h=this.lexer.options&&this.lexer.options.ranges;"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var d,f,p,g,m,_,v,y,b,S,C={};;){if(p=n[n.length-1],this.defaultActions[p]?g=this.defaultActions[p]:(null==d&&(S=void 0,"number"!=typeof(S=t.lexer.lex()||1)&&(S=t.symbols_[S]||S),d=S),g=s[p]&&s[p][d]),void 0===g||!g.length||!g[0]){var w="";if(!l){for(_ in b=[],s[p])this.terminals_[_]&&_>2&&b.push("'"+this.terminals_[_]+"'");w=this.lexer.showPosition?"Parse error on line "+(a+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+b.join(", ")+", got '"+(this.terminals_[d]||d)+"'":"Parse error on line "+(a+1)+": Unexpected "+(1==d?"end of input":"'"+(this.terminals_[d]||d)+"'"),this.parseError(w,{text:this.lexer.match,token:this.terminals_[d]||d,line:this.lexer.yylineno,loc:u,expected:b})}}if(g[0]instanceof Array&&g.length>1)throw new Error("Parse Error: multiple actions possible at state: "+p+", token: "+d);switch(g[0]){case 1:n.push(d),i.push(this.lexer.yytext),r.push(this.lexer.yylloc),n.push(g[1]),d=null,f?(d=f,f=null):(c=this.lexer.yyleng,o=this.lexer.yytext,a=this.lexer.yylineno,u=this.lexer.yylloc,l>0&&l--);break;case 2:if(v=this.productions_[g[1]][1],C.$=i[i.length-v],C._$={first_line:r[r.length-(v||1)].first_line,last_line:r[r.length-1].last_line,first_column:r[r.length-(v||1)].first_column,last_column:r[r.length-1].last_column},h&&(C._$.range=[r[r.length-(v||1)].range[0],r[r.length-1].range[1]]),void 0!==(m=this.performAction.call(C,o,c,a,this.yy,g[1],i,r)))return m;v&&(n=n.slice(0,-1*v*2),i=i.slice(0,-1*v),r=r.slice(0,-1*v)),n.push(this.productions_[g[1]][0]),i.push(C.$),r.push(C._$),y=s[n[n.length-2]][n[n.length-1]],n.push(y);break;case 3:return!0}}return!0}},t=function(){var e={EOF:1,parseError:function(e,t){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,t)},setInput:function(e){return this._input=e,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];return this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e,e.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,n=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t-1),this.offset-=t;var i=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),n.length-1&&(this.yylineno-=n.length-1);var r=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===i.length?this.yylloc.first_column:0)+i[i.length-n.length].length-n[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[r[0],r[0]+this.yyleng-t]),this},more:function(){return this._more=!0,this},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},next:function(){if(this.done)return this.EOF;var e,t,n,i,r;this._input||(this.done=!0),this._more||(this.yytext="",this.match="");for(var s=this._currentRules(),o=0;o<s.length&&(!(n=this._input.match(this.rules[s[o]]))||t&&!(n[0].length>t[0].length)||(t=n,i=o,this.options.flex));o++);return t?((r=t[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=r.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:r?r[r.length-1].length-r[r.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],e=this.performAction.call(this,this.yy,this,s[i],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),e||void 0):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return void 0!==e?e:this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(e){this.begin(e)},options:{},performAction:function(e,t,n,i){switch(n){case 0:return t.yytext="\\",14;case 1:if("\\"!==t.yytext.slice(-1)&&this.begin("mu"),"\\"===t.yytext.slice(-1)&&(t.yytext=t.yytext.substr(0,t.yyleng-1),this.begin("emu")),t.yytext)return 14;break;case 2:return 14;case 3:return"\\"!==t.yytext.slice(-1)&&this.popState(),"\\"===t.yytext.slice(-1)&&(t.yytext=t.yytext.substr(0,t.yyleng-1)),14;case 4:return t.yytext=t.yytext.substr(0,t.yyleng-4),this.popState(),15;case 5:return 25;case 6:return 16;case 7:return 20;case 8:case 9:return 19;case 10:return 23;case 11:return 22;case 12:this.popState(),this.begin("com");break;case 13:return t.yytext=t.yytext.substr(3,t.yyleng-5),this.popState(),15;case 14:return 22;case 15:return 37;case 16:case 17:return 36;case 18:return 40;case 19:break;case 20:return this.popState(),24;case 21:return this.popState(),18;case 22:return t.yytext=t.yytext.substr(1,t.yyleng-2).replace(/\\"/g,'"'),31;case 23:return t.yytext=t.yytext.substr(1,t.yyleng-2).replace(/\\'/g,"'"),31;case 24:return 38;case 25:case 26:return 33;case 27:return 32;case 28:return 36;case 29:return t.yytext=t.yytext.substr(1,t.yyleng-2),36;case 30:return"INVALID";case 31:return 5}},rules:[/^(?:\\\\(?=(\{\{)))/,/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|$)))/,/^(?:[\s\S]*?--\}\})/,/^(?:\{\{>)/,/^(?:\{\{#)/,/^(?:\{\{\/)/,/^(?:\{\{\^)/,/^(?:\{\{\s*else\b)/,/^(?:\{\{\{)/,/^(?:\{\{&)/,/^(?:\{\{!--)/,/^(?:\{\{![\s\S]*?\}\})/,/^(?:\{\{)/,/^(?:=)/,/^(?:\.(?=[}\/ ]))/,/^(?:\.\.)/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}\}\})/,/^(?:\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=[}\s]))/,/^(?:false(?=[}\s]))/,/^(?:-?[0-9]+(?=[}\s]))/,/^(?:[^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=[=}\s\/.]))/,/^(?:\[[^\]]*\])/,/^(?:.)/,/^(?:$)/],conditions:{mu:{rules:[5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31],inclusive:!1},emu:{rules:[3],inclusive:!1},com:{rules:[4],inclusive:!1},INITIAL:{rules:[0,1,2,31],inclusive:!0}}};return e}();function n(){this.yy={}}return e.lexer=t,n.prototype=e,e.Parser=n,new n}();e.Parser=i,e.parse=function(t){return t.constructor===e.AST.ProgramNode?t:(e.Parser.yy=e.AST,e.Parser.parse(t))},e.AST={},e.AST.ProgramNode=function(t,n){this.type="program",this.statements=t,n&&(this.inverse=new e.AST.ProgramNode(n))},e.AST.MustacheNode=function(e,t,n){this.type="mustache",this.escaped=!n,this.hash=t;var i=this.id=e[0],r=this.params=e.slice(1),s=this.eligibleHelper=i.isSimple;this.isHelper=s&&(r.length||t)},e.AST.PartialNode=function(e,t){this.type="partial",this.partialName=e,this.context=t},e.AST.BlockNode=function(t,n,i,r){!function(t,n){if(t.original!==n.original)throw new e.Exception(t.original+" doesn't match "+n.original)}(t.id,r),this.type="block",this.mustache=t,this.program=n,this.inverse=i,this.inverse&&!this.program&&(this.isInverse=!0)},e.AST.ContentNode=function(e){this.type="content",this.string=e},e.AST.HashNode=function(e){this.type="hash",this.pairs=e},e.AST.IdNode=function(t){this.type="ID";for(var n="",i=[],r=0,s=0,o=t.length;s<o;s++){var a=t[s].part;if(n+=(t[s].separator||"")+a,".."===a||"."===a||"this"===a){if(i.length>0)throw new e.Exception("Invalid path: "+n);".."===a?r++:this.isScoped=!0}else i.push(a)}this.original=n,this.parts=i,this.string=i.join("."),this.depth=r,this.isSimple=1===t.length&&!this.isScoped&&0===r,this.stringModeValue=this.string},e.AST.PartialNameNode=function(e){this.type="PARTIAL_NAME",this.name=e.original},e.AST.DataNode=function(e){this.type="DATA",this.id=e},e.AST.StringNode=function(e){this.type="STRING",this.original=this.string=this.stringModeValue=e},e.AST.IntegerNode=function(e){this.type="INTEGER",this.original=this.integer=e,this.stringModeValue=Number(e)},e.AST.BooleanNode=function(e){this.type="BOOLEAN",this.bool=e,this.stringModeValue="true"===e},e.AST.CommentNode=function(e){this.type="comment",this.comment=e};var r=["description","fileName","lineNumber","message","name","number","stack"];e.Exception=function(e){for(var t=Error.prototype.constructor.apply(this,arguments),n=0;n<r.length;n++)this[r[n]]=t[r[n]]},e.Exception.prototype=new Error,e.SafeString=function(e){this.string=e},e.SafeString.prototype.toString=function(){return this.string.toString()};var s={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},o=/[&<>"'`]/g,a=/[&<>"'`]/,c=function(e){return s[e]||"&amp;"};e.Utils={extend:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},escapeExpression:function(t){return t instanceof e.SafeString?t.toString():null==t||!1===t?"":(t=t.toString(),a.test(t)?t.replace(o,c):t)},isEmpty:function(e){return!e&&0!==e||"[object Array]"===n.call(e)&&0===e.length}};var l=e.Compiler=function(){},u=e.JavaScriptCompiler=function(){};l.prototype={compiler:l,disassemble:function(){for(var e,t,n,i=this.opcodes,r=[],s=0,o=i.length;s<o;s++)if("DECLARE"===(e=i[s]).opcode)r.push("DECLARE "+e.name+"="+e.value);else{t=[];for(var a=0;a<e.args.length;a++)"string"==typeof(n=e.args[a])&&(n='"'+n.replace("\n","\\n")+'"'),t.push(n);r.push(e.opcode+" "+t.join(" "))}return r.join("\n")},equals:function(e){var t=this.opcodes.length;if(e.opcodes.length!==t)return!1;for(var n=0;n<t;n++){var i=this.opcodes[n],r=e.opcodes[n];if(i.opcode!==r.opcode||i.args.length!==r.args.length)return!1;for(var s=0;s<i.args.length;s++)if(i.args[s]!==r.args[s])return!1}if(t=this.children.length,e.children.length!==t)return!1;for(n=0;n<t;n++)if(!this.children[n].equals(e.children[n]))return!1;return!0},guid:0,compile:function(e,t){this.children=[],this.depths={list:[]},this.options=t;var n=this.options.knownHelpers;if(this.options.knownHelpers={helperMissing:!0,blockHelperMissing:!0,each:!0,if:!0,unless:!0,with:!0,log:!0},n)for(var i in n)this.options.knownHelpers[i]=n[i];return this.program(e)},accept:function(e){return this[e.type](e)},program:function(e){var t,n=e.statements;this.opcodes=[];for(var i=0,r=n.length;i<r;i++)this[(t=n[i]).type](t);return this.isSimple=1===r,this.depths.list=this.depths.list.sort(function(e,t){return e-t}),this},compileProgram:function(e){var t,n=(new this.compiler).compile(e,this.options),i=this.guid++;this.usePartial=this.usePartial||n.usePartial,this.children[i]=n;for(var r=0,s=n.depths.list.length;r<s;r++)(t=n.depths.list[r])<2||this.addDepth(t-1);return i},block:function(e){var t=e.mustache,n=e.program,i=e.inverse;n&&(n=this.compileProgram(n)),i&&(i=this.compileProgram(i));var r=this.classifyMustache(t);"helper"===r?this.helperMustache(t,n,i):"simple"===r?(this.simpleMustache(t),this.opcode("pushProgram",n),this.opcode("pushProgram",i),this.opcode("emptyHash"),this.opcode("blockValue")):(this.ambiguousMustache(t,n,i),this.opcode("pushProgram",n),this.opcode("pushProgram",i),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},hash:function(e){var t,n,i=e.pairs;this.opcode("pushHash");for(var r=0,s=i.length;r<s;r++)n=(t=i[r])[1],this.options.stringParams?(n.depth&&this.addDepth(n.depth),this.opcode("getContext",n.depth||0),this.opcode("pushStringParam",n.stringModeValue,n.type)):this.accept(n),this.opcode("assignToHash",t[0]);this.opcode("popHash")},partial:function(e){var t=e.partialName;this.usePartial=!0,e.context?this.ID(e.context):this.opcode("push","depth0"),this.opcode("invokePartial",t.name),this.opcode("append")},content:function(e){this.opcode("appendContent",e.string)},mustache:function(e){var t=this.options,n=this.classifyMustache(e);"simple"===n?this.simpleMustache(e):"helper"===n?this.helperMustache(e):this.ambiguousMustache(e),e.escaped&&!t.noEscape?this.opcode("appendEscaped"):this.opcode("append")},ambiguousMustache:function(e,t,n){var i=e.id,r=i.parts[0],s=null!=t||null!=n;this.opcode("getContext",i.depth),this.opcode("pushProgram",t),this.opcode("pushProgram",n),this.opcode("invokeAmbiguous",r,s)},simpleMustache:function(e){var t=e.id;"DATA"===t.type?this.DATA(t):t.parts.length?this.ID(t):(this.addDepth(t.depth),this.opcode("getContext",t.depth),this.opcode("pushContext")),this.opcode("resolvePossibleLambda")},helperMustache:function(e,t,n){var i=this.setupFullMustacheParams(e,t,n),r=e.id.parts[0];if(this.options.knownHelpers[r])this.opcode("invokeKnownHelper",i.length,r);else{if(this.options.knownHelpersOnly)throw new Error("You specified knownHelpersOnly, but used the unknown helper "+r);this.opcode("invokeHelper",i.length,r)}},ID:function(e){this.addDepth(e.depth),this.opcode("getContext",e.depth),e.parts[0]?this.opcode("lookupOnContext",e.parts[0]):this.opcode("pushContext");for(var t=1,n=e.parts.length;t<n;t++)this.opcode("lookup",e.parts[t])},DATA:function(t){if(this.options.data=!0,t.id.isScoped||t.id.depth)throw new e.Exception("Scoped data references are not supported: "+t.original);this.opcode("lookupData");for(var n=t.id.parts,i=0,r=n.length;i<r;i++)this.opcode("lookup",n[i])},STRING:function(e){this.opcode("pushString",e.string)},INTEGER:function(e){this.opcode("pushLiteral",e.integer)},BOOLEAN:function(e){this.opcode("pushLiteral",e.bool)},comment:function(){},opcode:function(e){this.opcodes.push({opcode:e,args:[].slice.call(arguments,1)})},declare:function(e,t){this.opcodes.push({opcode:"DECLARE",name:e,value:t})},addDepth:function(e){if(isNaN(e))throw new Error("EWOT");0!==e&&(this.depths[e]||(this.depths[e]=!0,this.depths.list.push(e)))},classifyMustache:function(e){var t=e.isHelper,n=e.eligibleHelper,i=this.options;if(n&&!t){var r=e.id.parts[0];i.knownHelpers[r]?t=!0:i.knownHelpersOnly&&(n=!1)}return t?"helper":n?"ambiguous":"simple"},pushParams:function(e){for(var t,n=e.length;n--;)t=e[n],this.options.stringParams?(t.depth&&this.addDepth(t.depth),this.opcode("getContext",t.depth||0),this.opcode("pushStringParam",t.stringModeValue,t.type)):this[t.type](t)},setupMustacheParams:function(e){var t=e.params;return this.pushParams(t),e.hash?this.hash(e.hash):this.opcode("emptyHash"),t},setupFullMustacheParams:function(e,t,n){var i=e.params;return this.pushParams(i),this.opcode("pushProgram",t),this.opcode("pushProgram",n),e.hash?this.hash(e.hash):this.opcode("emptyHash"),i}};var h=function(e){this.value=e};u.prototype={nameLookup:function(e,t){return/^[0-9]+$/.test(t)?e+"["+t+"]":u.isValidJavaScriptVariableName(t)?e+"."+t:e+"['"+t+"']"},appendToBuffer:function(e){return this.environment.isSimple?"return "+e+";":{appendToBuffer:!0,content:e,toString:function(){return"buffer += "+e+";"}}},initializeBuffer:function(){return this.quotedString("")},namespace:"Handlebars",compile:function(t,n,i,r){this.environment=t,this.options=n||{},e.log(e.logger.DEBUG,this.environment.disassemble()+"\n\n"),this.name=this.environment.name,this.isChild=!!i,this.context=i||{programs:[],environments:[],aliases:{}},this.preamble(),this.stackSlot=0,this.stackVars=[],this.registers={list:[]},this.compileStack=[],this.inlineStack=[],this.compileChildren(t,n);var s,o=t.opcodes;for(this.i=0,g=o.length;this.i<g;this.i++)"DECLARE"===(s=o[this.i]).opcode?this[s.name]=s.value:this[s.opcode].apply(this,s.args);return this.createFunctionContext(r)},nextOpcode:function(){return this.environment.opcodes[this.i+1]},eat:function(){this.i=this.i+1},preamble:function(){var e=[];if(this.isChild)e.push("");else{var t=this.namespace,n="helpers = this.merge(helpers, "+t+".helpers);";this.environment.usePartial&&(n=n+" partials = this.merge(partials, "+t+".partials);"),this.options.data&&(n+=" data = data || {};"),e.push(n)}this.environment.isSimple?e.push(""):e.push(", buffer = "+this.initializeBuffer()),this.lastContext=0,this.source=e},createFunctionContext:function(t){var n=this.stackVars.concat(this.registers.list);if(n.length>0&&(this.source[1]=this.source[1]+", "+n.join(", ")),!this.isChild)for(var i in this.context.aliases)this.context.aliases.hasOwnProperty(i)&&(this.source[1]=this.source[1]+", "+i+"="+this.context.aliases[i]);this.source[1]&&(this.source[1]="var "+this.source[1].substring(2)+";"),this.isChild||(this.source[1]+="\n"+this.context.programs.join("\n")+"\n"),this.environment.isSimple||this.source.push("return buffer;");for(var r=this.isChild?["depth0","data"]:["Handlebars","depth0","helpers","partials","data"],s=0,o=this.environment.depths.list.length;s<o;s++)r.push("depth"+this.environment.depths.list[s]);var a=this.mergeSource();if(!this.isChild){var c=e.COMPILER_REVISION;a="this.compilerInfo = ["+c+",'"+e.REVISION_CHANGES[c]+"'];\n"+a}if(t)return r.push(a),Function.apply(this,r);var l="function "+(this.name||"")+"("+r.join(",")+") {\n  "+a+"}";return e.log(e.logger.DEBUG,l+"\n\n"),l},mergeSource:function(){for(var e,n="",i=0,r=this.source.length;i<r;i++){var s=this.source[i];s.appendToBuffer?e=e?e+"\n    + "+s.content:s.content:(e&&(n+="buffer += "+e+";\n  ",e=t),n+=s+"\n  ")}return n},blockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var e=["depth0"];this.setupParams(0,e),this.replaceStack(function(t){return e.splice(1,0,t),"blockHelperMissing.call("+e.join(", ")+")"})},ambiguousBlockValue:function(){this.context.aliases.blockHelperMissing="helpers.blockHelperMissing";var e=["depth0"];this.setupParams(0,e);var t=this.topStack();e.splice(1,0,t),e[e.length-1]="options",this.source.push("if (!"+this.lastHelper+") { "+t+" = blockHelperMissing.call("+e.join(", ")+"); }")},appendContent:function(e){this.source.push(this.appendToBuffer(this.quotedString(e)))},append:function(){this.flushInline();var e=this.popStack();this.source.push("if("+e+" || "+e+" === 0) { "+this.appendToBuffer(e)+" }"),this.environment.isSimple&&this.source.push("else { "+this.appendToBuffer("''")+" }")},appendEscaped:function(){this.context.aliases.escapeExpression="this.escapeExpression",this.source.push(this.appendToBuffer("escapeExpression("+this.popStack()+")"))},getContext:function(e){this.lastContext!==e&&(this.lastContext=e)},lookupOnContext:function(e){this.push(this.nameLookup("depth"+this.lastContext,e,"context"))},pushContext:function(){this.pushStackLiteral("depth"+this.lastContext)},resolvePossibleLambda:function(){this.context.aliases.functionType='"function"',this.replaceStack(function(e){return"typeof "+e+" === functionType ? "+e+".apply(depth0) : "+e})},lookup:function(e){this.replaceStack(function(t){return t+" == null || "+t+" === false ? "+t+" : "+this.nameLookup(t,e,"context")})},lookupData:function(e){this.push("data")},pushStringParam:function(e,t){this.pushStackLiteral("depth"+this.lastContext),this.pushString(t),"string"==typeof e?this.pushString(e):this.pushStackLiteral(e)},emptyHash:function(){this.pushStackLiteral("{}"),this.options.stringParams&&(this.register("hashTypes","{}"),this.register("hashContexts","{}"))},pushHash:function(){this.hash={values:[],types:[],contexts:[]}},popHash:function(){var e=this.hash;this.hash=t,this.options.stringParams&&(this.register("hashContexts","{"+e.contexts.join(",")+"}"),this.register("hashTypes","{"+e.types.join(",")+"}")),this.push("{\n    "+e.values.join(",\n    ")+"\n  }")},pushString:function(e){this.pushStackLiteral(this.quotedString(e))},push:function(e){return this.inlineStack.push(e),e},pushLiteral:function(e){this.pushStackLiteral(e)},pushProgram:function(e){null!=e?this.pushStackLiteral(this.programExpression(e)):this.pushStackLiteral(null)},invokeHelper:function(e,t){this.context.aliases.helperMissing="helpers.helperMissing";var n=this.lastHelper=this.setupHelper(e,t,!0),i=this.nameLookup("depth"+this.lastContext,t,"context");this.push(n.name+" || "+i),this.replaceStack(function(e){return e+" ? "+e+".call("+n.callParams+") : helperMissing.call("+n.helperMissingParams+")"})},invokeKnownHelper:function(e,t){var n=this.setupHelper(e,t);this.push(n.name+".call("+n.callParams+")")},invokeAmbiguous:function(e,t){this.context.aliases.functionType='"function"',this.pushStackLiteral("{}");var n=this.setupHelper(0,e,t),i=this.lastHelper=this.nameLookup("helpers",e,"helper"),r=this.nameLookup("depth"+this.lastContext,e,"context"),s=this.nextStack();this.source.push("if ("+s+" = "+i+") { "+s+" = "+s+".call("+n.callParams+"); }"),this.source.push("else { "+s+" = "+r+"; "+s+" = typeof "+s+" === functionType ? "+s+".apply(depth0) : "+s+"; }")},invokePartial:function(e){var t=[this.nameLookup("partials",e,"partial"),"'"+e+"'",this.popStack(),"helpers","partials"];this.options.data&&t.push("data"),this.context.aliases.self="this",this.push("self.invokePartial("+t.join(", ")+")")},assignToHash:function(e){var t,n,i=this.popStack();this.options.stringParams&&(n=this.popStack(),t=this.popStack());var r=this.hash;t&&r.contexts.push("'"+e+"': "+t),n&&r.types.push("'"+e+"': "+n),r.values.push("'"+e+"': ("+i+")")},compiler:u,compileChildren:function(e,t){for(var n,i,r=e.children,s=0,o=r.length;s<o;s++){n=r[s],i=new this.compiler;var a=this.matchExistingProgram(n);null==a?(this.context.programs.push(""),a=this.context.programs.length,n.index=a,n.name="program"+a,this.context.programs[a]=i.compile(n,t,this.context),this.context.environments[a]=n):(n.index=a,n.name="program"+a)}},matchExistingProgram:function(e){for(var t=0,n=this.context.environments.length;t<n;t++){var i=this.context.environments[t];if(i&&i.equals(e))return t}},programExpression:function(e){if(this.context.aliases.self="this",null==e)return"self.noop";for(var t,n=this.environment.children[e],i=n.depths.list,r=[n.index,n.name,"data"],s=0,o=i.length;s<o;s++)1===(t=i[s])?r.push("depth0"):r.push("depth"+(t-1));return(0===i.length?"self.program(":"self.programWithDepth(")+r.join(", ")+")"},register:function(e,t){this.useRegister(e),this.source.push(e+" = "+t+";")},useRegister:function(e){this.registers[e]||(this.registers[e]=!0,this.registers.list.push(e))},pushStackLiteral:function(e){return this.push(new h(e))},pushStack:function(e){this.flushInline();var t=this.incrStack();return e&&this.source.push(t+" = "+e+";"),this.compileStack.push(t),t},replaceStack:function(e){var t,n="",i=this.isInline();if(i){var r=this.popStack(!0);if(r instanceof h)t=r.value;else{var s=this.stackSlot?this.topStackName():this.incrStack();n="("+this.push(s)+" = "+r+"),",t=this.topStack()}}else t=this.topStack();var o=e.call(this,t);return i?((this.inlineStack.length||this.compileStack.length)&&this.popStack(),this.push("("+n+o+")")):(/^stack/.test(t)||(t=this.nextStack()),this.source.push(t+" = ("+n+o+");")),t},nextStack:function(){return this.pushStack()},incrStack:function(){return this.stackSlot++,this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var e=this.inlineStack;if(e.length){this.inlineStack=[];for(var t=0,n=e.length;t<n;t++){var i=e[t];i instanceof h?this.compileStack.push(i):this.pushStack(i)}}},isInline:function(){return this.inlineStack.length},popStack:function(e){var t=this.isInline(),n=(t?this.inlineStack:this.compileStack).pop();return!e&&n instanceof h?n.value:(t||this.stackSlot--,n)},topStack:function(e){var t=this.isInline()?this.inlineStack:this.compileStack,n=t[t.length-1];return!e&&n instanceof h?n.value:n},quotedString:function(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},setupHelper:function(e,t,n){var i=[];return this.setupParams(e,i,n),{params:i,name:this.nameLookup("helpers",t,"helper"),callParams:["depth0"].concat(i).join(", "),helperMissingParams:n&&["depth0",this.quotedString(t)].concat(i).join(", ")}},setupParams:function(e,t,n){var i,r,s,o=[],a=[],c=[];o.push("hash:"+this.popStack()),r=this.popStack(),((s=this.popStack())||r)&&(s||(this.context.aliases.self="this",s="self.noop"),r||(this.context.aliases.self="this",r="self.noop"),o.push("inverse:"+r),o.push("fn:"+s));for(var l=0;l<e;l++)i=this.popStack(),t.push(i),this.options.stringParams&&(c.push(this.popStack()),a.push(this.popStack()));return this.options.stringParams&&(o.push("contexts:["+a.join(",")+"]"),o.push("types:["+c.join(",")+"]"),o.push("hashContexts:hashContexts"),o.push("hashTypes:hashTypes")),this.options.data&&o.push("data:data"),o="{"+o.join(",")+"}",n?(this.register("options",o),t.push("options")):t.push(o),t.join(", ")}};for(var d="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield".split(" "),f=u.RESERVED_WORDS={},p=0,g=d.length;p<g;p++)f[d[p]]=!0;u.isValidJavaScriptVariableName=function(e){return!(u.RESERVED_WORDS[e]||!/^[a-zA-Z_$][0-9a-zA-Z_$]+$/.test(e))},e.precompile=function(t,n){if(null==t||"string"!=typeof t&&t.constructor!==e.AST.ProgramNode)throw new e.Exception("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+t);"data"in(n=n||{})||(n.data=!0);var i=e.parse(t),r=(new l).compile(i,n);return(new u).compile(r,n)},e.compile=function(n,i){if(null==n||"string"!=typeof n&&n.constructor!==e.AST.ProgramNode)throw new e.Exception("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+n);var r;function s(){var r=e.parse(n),s=(new l).compile(r,i),o=(new u).compile(s,i,t,!0);return e.template(o)}return"data"in(i=i||{})||(i.data=!0),function(e,t){return r||(r=s()),r.call(this,e,t)}},e.VM={template:function(t){var n={escapeExpression:e.Utils.escapeExpression,invokePartial:e.VM.invokePartial,programs:[],program:function(t,n,i){var r=this.programs[t];return i?r=e.VM.program(t,n,i):r||(r=this.programs[t]=e.VM.program(t,n)),r},merge:function(t,n){var i=t||n;return t&&n&&(i={},e.Utils.extend(i,n),e.Utils.extend(i,t)),i},programWithDepth:e.VM.programWithDepth,noop:e.VM.noop,compilerInfo:null};return function(i,r){r=r||{};var s=t.call(n,e,i,r.helpers,r.partials,r.data),o=n.compilerInfo||[],a=o[0]||1,c=e.COMPILER_REVISION;if(a!==c){if(a<c)throw"Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+e.REVISION_CHANGES[c]+") or downgrade your runtime to an older version ("+e.REVISION_CHANGES[a]+").";throw"Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+o[1]+")."}return s}},programWithDepth:function(e,t,n){var i=Array.prototype.slice.call(arguments,3),r=function(e,r){return r=r||{},t.apply(this,[e,r.data||n].concat(i))};return r.program=e,r.depth=i.length,r},program:function(e,t,n){var i=function(e,i){return t(e,(i=i||{}).data||n)};return i.program=e,i.depth=0,i},noop:function(){return""},invokePartial:function(n,i,r,s,o,a){var c={helpers:s,partials:o,data:a};if(n===t)throw new e.Exception("The partial "+i+" could not be found");if(n instanceof Function)return n(r,c);if(e.compile)return o[i]=e.compile(n,{data:a!==t}),o[i](r,c);throw new e.Exception("The partial "+i+" could not be compiled when running in runtime-only mode")}},e.template=e.VM.template}(Handlebars),define("handlebars",function(e){return function(){return e.Handlebars}}(this)),function(e){var t,n,i=Math.round,r={},s="undefined"!=typeof module&&module.exports,o=/^\/?Date\((\-?\d+)/i,a=/(\-)?(\d*)?\.?(\d+)\:(\d+)\:(\d+)\.?(\d{3})?/,c=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|SS?S?|X|zz?|ZZ?|.)/g,l=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,u=/\d\d?/,h=/\d{1,3}/,d=/\d{3}/,f=/\d{1,4}/,p=/[+\-]?\d{1,6}/,g=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,m=/Z|[\+\-]\d\d:?\d\d/i,_=/T/i,v=/[\+\-]?\d+(\.\d{1,3})?/,y=/^\s*\d{4}-\d\d-\d\d((T| )(\d\d(:\d\d(:\d\d(\.\d\d?\d?)?)?)?)?([\+\-]\d\d:?\d\d)?)?/,b=[["HH:mm:ss.S",/(T| )\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],S=/([\+\-]|\d\d)/gi,C="Date|Hours|Minutes|Seconds|Milliseconds".split("|"),w={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},T={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",w:"week",M:"month",y:"year"},k={},E="DDD w W M D d".split(" "),A="M D H h m s w W".split(" "),x={M:function(){return this.month()+1},MMM:function(e){return this.lang().monthsShort(this,e)},MMMM:function(e){return this.lang().months(this,e)},D:function(){return this.lang().dayOfMonth?this.lang().dayOfMonth(this):this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(e){return this.lang().weekdaysMin(this,e)},ddd:function(e){return this.lang().weekdaysShort(this,e)},dddd:function(e){return this.lang().weekdays(this,e)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return N(this.year()%100,2)},YYYY:function(){return N(this.year(),4)},YYYYY:function(){return N(this.year(),5)},gg:function(){return N(this.weekYear()%100,2)},gggg:function(){return this.weekYear()},ggggg:function(){return N(this.weekYear(),5)},GG:function(){return N(this.isoWeekYear()%100,2)},GGGG:function(){return this.isoWeekYear()},GGGGG:function(){return N(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return~~(this.milliseconds()/100)},SS:function(){return N(~~(this.milliseconds()/10),2)},SSS:function(){return N(this.milliseconds(),3)},Z:function(){var e=-this.zone(),t="+";return e<0&&(e=-e,t="-"),t+N(~~(e/60),2)+":"+N(~~e%60,2)},ZZ:function(){var e=-this.zone(),t="+";return e<0&&(e=-e,t="-"),t+N(~~(10*e/6),4)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},X:function(){return this.unix()}};function R(e,t){return function(n){return N(e.call(this,n),t)}}function I(e,t){return function(n){return this.lang().ordinal(e.call(this,n),t)}}for(;E.length;)n=E.pop(),x[n+"o"]=I(x[n],n);for(;A.length;)n=A.pop(),x[n+n]=R(x[n],2);function L(){}function M(e){O(this,e)}function P(e){var t=e.years||e.year||e.y||0,n=e.months||e.month||e.M||0,i=e.weeks||e.week||e.w||0,r=e.days||e.day||e.d||0,s=e.hours||e.hour||e.h||0,o=e.minutes||e.minute||e.m||0,a=e.seconds||e.second||e.s||0,c=e.milliseconds||e.millisecond||e.ms||0;this._input=e,this._milliseconds=c+1e3*a+6e4*o+36e5*s,this._days=r+7*i,this._months=n+12*t,this._data={},this._bubble()}function O(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function D(e){return e<0?Math.ceil(e):Math.floor(e)}function N(e,t){for(var n=e+"";n.length<t;)n="0"+n;return n}function F(e,n,i,r){var s,o,a=n._milliseconds,c=n._days,l=n._months;a&&e._d.setTime(+e._d+a*i),(c||l)&&(s=e.minute(),o=e.hour()),c&&e.date(e.date()+c*i),l&&e.month(e.month()+l*i),a&&!r&&t.updateOffset(e),(c||l)&&(e.minute(s),e.hour(o))}function j(e){return"[object Array]"===Object.prototype.toString.call(e)}function U(e,t){var n,i=Math.min(e.length,t.length),r=Math.abs(e.length-t.length),s=0;for(n=0;n<i;n++)~~e[n]!=~~t[n]&&s++;return s+r}function q(e){return e?T[e]||e.toLowerCase().replace(/(.)s$/,"$1"):e}function V(e){if(!e)return t.fn._lang;if(!r[e]&&s)try{require("./lang/"+e)}catch(e){return t.fn._lang}return r[e]}function B(e,t){var n=5;function i(t){return e.lang().longDateFormat(t)||t}for(;n--&&l.test(t);)t=t.replace(l,i);return k[t]||(k[t]=function(e){var t,n,i,r=e.match(c);for(t=0,n=r.length;t<n;t++)x[r[t]]?r[t]=x[r[t]]:r[t]=(i=r[t]).match(/\[.*\]/)?i.replace(/^\[|\]$/g,""):i.replace(/\\/g,"");return function(i){var s="";for(t=0;t<n;t++)s+=r[t]instanceof Function?r[t].call(i,e):r[t];return s}}(t)),k[t](e)}function H(e,t){switch(e){case"DDDD":return d;case"YYYY":return f;case"YYYYY":return p;case"S":case"SS":case"SSS":case"DDD":return h;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return g;case"a":case"A":return V(t._l)._meridiemParse;case"X":return v;case"Z":case"ZZ":return m;case"T":return _;case"MM":case"DD":case"YY":case"HH":case"hh":case"mm":case"ss":case"M":case"D":case"d":case"H":case"h":case"m":case"s":return u;default:return new RegExp(e.replace("\\",""))}}function W(e){var t=((m.exec(e)||[])[0]+"").match(S)||["-",0,0],n=60*t[1]+~~t[2];return"+"===t[0]?-n:n}function G(e,t,n){var i,r=n._a;switch(e){case"M":case"MM":r[1]=null==t?0:~~t-1;break;case"MMM":case"MMMM":null!=(i=V(n._l).monthsParse(t))?r[1]=i:n._isValid=!1;break;case"D":case"DD":case"DDD":case"DDDD":null!=t&&(r[2]=~~t);break;case"YY":r[0]=~~t+(~~t>68?1900:2e3);break;case"YYYY":case"YYYYY":r[0]=~~t;break;case"a":case"A":n._isPm=V(n._l).isPM(t);break;case"H":case"HH":case"h":case"hh":r[3]=~~t;break;case"m":case"mm":r[4]=~~t;break;case"s":case"ss":r[5]=~~t;break;case"S":case"SS":case"SSS":r[6]=~~(1e3*("0."+t));break;case"X":n._d=new Date(1e3*parseFloat(t));break;case"Z":case"ZZ":n._useUTC=!0,n._tzm=W(t)}null==t&&(n._isValid=!1)}function z(e){var t,n,i=[];if(!e._d){for(t=0;t<7;t++)e._a[t]=i[t]=null==e._a[t]?2===t?1:0:e._a[t];i[3]+=~~((e._tzm||0)/60),i[4]+=~~((e._tzm||0)%60),n=new Date(0),e._useUTC?(n.setUTCFullYear(i[0],i[1],i[2]),n.setUTCHours(i[3],i[4],i[5],i[6])):(n.setFullYear(i[0],i[1],i[2]),n.setHours(i[3],i[4],i[5],i[6])),e._d=n}}function K(e){var t,n,i=e._f.match(c),r=e._i;for(e._a=[],t=0;t<i.length;t++)(n=(H(i[t],e).exec(r)||[])[0])&&(r=r.slice(r.indexOf(n)+n.length)),x[i[t]]&&G(i[t],n,e);r&&(e._il=r),e._isPm&&e._a[3]<12&&(e._a[3]+=12),!1===e._isPm&&12===e._a[3]&&(e._a[3]=0),z(e)}function Y(t){var n=t._i,i=o.exec(n);n===e?t._d=new Date:i?t._d=new Date(+i[1]):"string"==typeof n?function(e){var t,n=e._i,i=y.exec(n);if(i){for(e._f="YYYY-MM-DD"+(i[2]||" "),t=0;t<4;t++)if(b[t][1].exec(n)){e._f+=b[t][0];break}m.exec(n)&&(e._f+=" Z"),K(e)}else e._d=new Date(n)}(t):j(n)?(t._a=n.slice(0),z(t)):t._d=n instanceof Date?new Date(+n):new Date(n)}function J(e,n,i){var r,s=i-n,o=i-e.day();return o>s&&(o-=7),o<s-7&&(o+=7),r=t(e).add("d",o),{week:Math.ceil(r.dayOfYear()/7),year:r.year()}}function Q(e){var n=e._i,i=e._f;return null===n||""===n?null:("string"==typeof n&&(e._i=n=V().preparse(n)),t.isMoment(n)?(e=O({},n))._d=new Date(+n._d):i?j(i)?function(e){var t,n,i,r,s,o=99;for(r=0;r<e._f.length;r++)(t=O({},e))._f=e._f[r],K(t),n=new M(t),s=U(t._a,n.toArray()),n._il&&(s+=n._il.length),s<o&&(o=s,i=n);O(e,i)}(e):K(e):Y(e),new M(e))}function X(e,n){t.fn[e]=t.fn[e+"s"]=function(e){var i=this._isUTC?"UTC":"";return null!=e?(this._d["set"+i+n](e),t.updateOffset(this),this):this._d["get"+i+n]()}}for(x.DDDD=R(x.DDD,3),L.prototype={set:function(e){var t,n;for(n in e)"function"==typeof(t=e[n])?this[n]=t:this["_"+n]=t},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(e){return this._months[e.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(e){return this._monthsShort[e.month()]},monthsParse:function(e){var n,i,r;for(this._monthsParse||(this._monthsParse=[]),n=0;n<12;n++)if(this._monthsParse[n]||(i=t([2e3,n]),r="^"+this.months(i,"")+"|^"+this.monthsShort(i,""),this._monthsParse[n]=new RegExp(r.replace(".",""),"i")),this._monthsParse[n].test(e))return n},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(e){return this._weekdays[e.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(e){return this._weekdaysShort[e.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(e){return this._weekdaysMin[e.day()]},dayOfMonth:function(e){return e.date()},weekdaysParse:function(e){var n,i,r;for(this._weekdaysParse||(this._weekdaysParse=[]),n=0;n<7;n++)if(this._weekdaysParse[n]||(i=t([2e3,1]).day(n),r="^"+this.weekdays(i,"")+"|^"+this.weekdaysShort(i,"")+"|^"+this.weekdaysMin(i,""),this._weekdaysParse[n]=new RegExp(r.replace(".",""),"i")),this._weekdaysParse[n].test(e))return n},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(e){var t=this._longDateFormat[e];return!t&&this._longDateFormat[e.toUpperCase()]&&(t=this._longDateFormat[e.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)}),this._longDateFormat[e]=t),t},isPM:function(e){return"p"===(e+"").toLowerCase()[0]},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(e,t,n){return e>11?n?"pm":"PM":n?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(e,t){var n=this._calendar[e];return"function"==typeof n?n.apply(t):n},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(e,t,n,i){var r=this._relativeTime[n];return"function"==typeof r?r(e,t,n,i):r.replace(/%d/i,e)},pastFuture:function(e,t){var n=this._relativeTime[e>0?"future":"past"];return"function"==typeof n?n(t):n.replace(/%s/i,t)},ordinal:function(e){return this._ordinal.replace("%d",e)},_ordinal:"%d",preparse:function(e){return e},postformat:function(e){return e},week:function(e){return J(e,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6}},(t=function(e,t,n){return Q({_i:e,_f:t,_l:n,_isUTC:!1})}).utc=function(e,t,n){return Q({_useUTC:!0,_isUTC:!0,_l:n,_i:e,_f:t})},t.unix=function(e){return t(1e3*e)},t.duration=function(e,n){var i,r,s=t.isDuration(e),o="number"==typeof e,c=s?e._input:o?{}:e,l=a.exec(e);return o?n?c[n]=e:c.milliseconds=e:l&&(i="-"===l[1]?-1:1,c={y:0,d:~~l[2]*i,h:~~l[3]*i,m:~~l[4]*i,s:~~l[5]*i,ms:~~l[6]*i}),r=new P(c),s&&e.hasOwnProperty("_lang")&&(r._lang=e._lang),r},t.version="2.1.0",t.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",t.updateOffset=function(){},t.lang=function(e,n){if(!e)return t.fn._lang._abbr;n?function(e,t){t.abbr=e,r[e]||(r[e]=new L),r[e].set(t),r[e]}(e,n):r[e]||V(e),t.duration.fn._lang=t.fn._lang=V(e)},t.langData=function(e){return e&&e._lang&&e._lang._abbr&&(e=e._lang._abbr),V(e)},t.isMoment=function(e){return e instanceof M},t.isDuration=function(e){return e instanceof P},t.fn=M.prototype={clone:function(){return t(this)},valueOf:function(){return+this._d+6e4*(this._offset||0)},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){return B(t(this).utc(),"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var e=this;return[e.year(),e.month(),e.date(),e.hours(),e.minutes(),e.seconds(),e.milliseconds()]},isValid:function(){return null==this._isValid&&(this._a?this._isValid=!U(this._a,(this._isUTC?t.utc(this._a):t(this._a)).toArray()):this._isValid=!isNaN(this._d.getTime())),!!this._isValid},utc:function(){return this.zone(0)},local:function(){return this.zone(0),this._isUTC=!1,this},format:function(e){var n=B(this,e||t.defaultFormat);return this.lang().postformat(n)},add:function(e,n){return F(this,"string"==typeof e?t.duration(+n,e):t.duration(e,n),1),this},subtract:function(e,n){return F(this,"string"==typeof e?t.duration(+n,e):t.duration(e,n),-1),this},diff:function(e,n,i){var r,s,o=this._isUTC?t(e).zone(this._offset||0):t(e).local(),a=6e4*(this.zone()-o.zone());return"year"===(n=q(n))||"month"===n?(r=432e5*(this.daysInMonth()+o.daysInMonth()),s=12*(this.year()-o.year())+(this.month()-o.month()),s+=(this-t(this).startOf("month")-(o-t(o).startOf("month")))/r,s-=6e4*(this.zone()-t(this).startOf("month").zone()-(o.zone()-t(o).startOf("month").zone()))/r,"year"===n&&(s/=12)):(r=this-o,s="second"===n?r/1e3:"minute"===n?r/6e4:"hour"===n?r/36e5:"day"===n?(r-a)/864e5:"week"===n?(r-a)/6048e5:r),i?s:D(s)},from:function(e,n){return t.duration(this.diff(e)).lang(this.lang()._abbr).humanize(!n)},fromNow:function(e){return this.from(t(),e)},calendar:function(){var e=this.diff(t().startOf("day"),"days",!0),n=e<-6?"sameElse":e<-1?"lastWeek":e<0?"lastDay":e<1?"sameDay":e<2?"nextDay":e<7?"nextWeek":"sameElse";return this.format(this.lang().calendar(n,this))},isLeapYear:function(){var e=this.year();return e%4==0&&e%100!=0||e%400==0},isDST:function(){return this.zone()<this.clone().month(0).zone()||this.zone()<this.clone().month(5).zone()},day:function(e){var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=e?"string"==typeof e&&"number"!=typeof(e=this.lang().weekdaysParse(e))?this:this.add({d:e-t}):t},month:function(e){var n,i=this._isUTC?"UTC":"";return null!=e?"string"==typeof e&&"number"!=typeof(e=this.lang().monthsParse(e))?this:(n=this.date(),this.date(1),this._d["set"+i+"Month"](e),this.date(Math.min(n,this.daysInMonth())),t.updateOffset(this),this):this._d["get"+i+"Month"]()},startOf:function(e){switch(e=q(e)){case"year":this.month(0);case"month":this.date(1);case"week":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===e&&this.weekday(0),this},endOf:function(e){return this.startOf(e).add(e,1).subtract("ms",1)},isAfter:function(e,n){return n=void 0!==n?n:"millisecond",+this.clone().startOf(n)>+t(e).startOf(n)},isBefore:function(e,n){return n=void 0!==n?n:"millisecond",+this.clone().startOf(n)<+t(e).startOf(n)},isSame:function(e,n){return n=void 0!==n?n:"millisecond",+this.clone().startOf(n)==+t(e).startOf(n)},min:function(e){return(e=t.apply(null,arguments))<this?this:e},max:function(e){return(e=t.apply(null,arguments))>this?this:e},zone:function(e){var n=this._offset||0;return null==e?this._isUTC?n:this._d.getTimezoneOffset():("string"==typeof e&&(e=W(e)),Math.abs(e)<16&&(e*=60),this._offset=e,this._isUTC=!0,n!==e&&F(this,t.duration(n-e,"m"),1,!0),this)},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},daysInMonth:function(){return t.utc([this.year(),this.month()+1,0]).date()},dayOfYear:function(e){var n=i((t(this).startOf("day")-t(this).startOf("year"))/864e5)+1;return null==e?n:this.add("d",e-n)},weekYear:function(e){var t=J(this,this.lang()._week.dow,this.lang()._week.doy).year;return null==e?t:this.add("y",e-t)},isoWeekYear:function(e){var t=J(this,1,4).year;return null==e?t:this.add("y",e-t)},week:function(e){var t=this.lang().week(this);return null==e?t:this.add("d",7*(e-t))},isoWeek:function(e){var t=J(this,1,4).week;return null==e?t:this.add("d",7*(e-t))},weekday:function(e){var t=(this._d.getDay()+7-this.lang()._week.dow)%7;return null==e?t:this.add("d",e-t)},isoWeekday:function(e){return null==e?this.day()||7:this.day(this.day()%7?e:e-7)},lang:function(t){return t===e?this._lang:(this._lang=V(t),this)}},n=0;n<C.length;n++)X(C[n].toLowerCase().replace(/s$/,""),C[n]);function Z(e){t.duration.fn[e]=function(){return this._data[e]}}function ee(e,n){t.duration.fn["as"+e]=function(){return+this/n}}for(n in X("year","FullYear"),t.fn.days=t.fn.day,t.fn.months=t.fn.month,t.fn.weeks=t.fn.week,t.fn.isoWeeks=t.fn.isoWeek,t.fn.toJSON=t.fn.toISOString,t.duration.fn=P.prototype={_bubble:function(){var e,t,n,i,r=this._milliseconds,s=this._days,o=this._months,a=this._data;a.milliseconds=r%1e3,e=D(r/1e3),a.seconds=e%60,t=D(e/60),a.minutes=t%60,n=D(t/60),a.hours=n%24,s+=D(n/24),a.days=s%30,o+=D(s/30),a.months=o%12,i=D(o/12),a.years=i},weeks:function(){return D(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*~~(this._months/12)},humanize:function(e){var t,n,r,s,o,a,c,l,u,h=+this,d=(t=h,n=!e,r=this.lang(),s=i(Math.abs(t)/1e3),o=i(s/60),a=i(o/60),c=i(a/24),l=i(c/365),(u=s<45&&["s",s]||1===o&&["m"]||o<45&&["mm",o]||1===a&&["h"]||a<22&&["hh",a]||1===c&&["d"]||c<=25&&["dd",c]||c<=45&&["M"]||c<345&&["MM",i(c/30)]||1===l&&["y"]||["yy",l])[2]=n,u[3]=t>0,u[4]=r,function(e,t,n,i,r){return r.relativeTime(t||1,!!n,e,i)}.apply({},u));return e&&(d=this.lang().pastFuture(h,d)),this.lang().postformat(d)},add:function(e,n){var i=t.duration(e,n);return this._milliseconds+=i._milliseconds,this._days+=i._days,this._months+=i._months,this._bubble(),this},subtract:function(e,n){var i=t.duration(e,n);return this._milliseconds-=i._milliseconds,this._days-=i._days,this._months-=i._months,this._bubble(),this},get:function(e){return this[(e=q(e)).toLowerCase()+"s"]()},as:function(e){return this["as"+(e=q(e)).charAt(0).toUpperCase()+e.slice(1)+"s"]()},lang:t.fn.lang},w)w.hasOwnProperty(n)&&(ee(n,w[n]),Z(n.toLowerCase()));function te(e,t,n,i){var r={m:["eine Minute","einer Minute"],h:["eine Stunde","einer Stunde"],d:["ein Tag","einem Tag"],dd:[e+" Tage",e+" Tagen"],M:["ein Monat","einem Monat"],MM:[e+" Monate",e+" Monaten"],y:["ein Jahr","einem Jahr"],yy:[e+" Jahre",e+" Jahren"]};return t?r[n][0]:r[n][1]}ee("Weeks",6048e5),t.duration.fn.asMonths=function(){return(+this-31536e6*this.years())/2592e6+12*this.years()},t.lang("ja",{months:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),weekdays:"日曜日_月曜日_火曜日_水曜日_木曜日_金曜日_土曜日".split("_"),weekdaysShort:"日_月_火_水_木_金_土".split("_"),weekdaysMin:"日_月_火_水_木_金_土".split("_"),dayOfMonth:function(e){return e.date()+"日"},longDateFormat:{LT:"Ah時m分",LTS:"Ah時m分s秒",L:"YYYY/MM/DD",LL:"YYYY年M月D日",LLL:"YYYY年M月D日Ah時m分",LLLL:"YYYY年M月D日Ah時m分 dddd"},meridiemParse:/午前|午後/i,isPM:function(e){return"午後"===e},meridiem:function(e,t,n){return e<12?"午前":"午後"},calendar:{sameDay:"[今日] LT",nextDay:"[明日] LT",nextWeek:"[来週]dddd LT",lastDay:"[昨日] LT",lastWeek:"[前週]dddd LT",sameElse:"L"},relativeTime:{future:"%s後",past:"%s前",s:"数秒",m:"1分",mm:"%d分",h:"1時間",hh:"%d時間",d:"1日",dd:"%d日",D:"%d日",M:"1ヶ月",MM:"%dヶ月",y:"1年",yy:"%d年"}}),t.lang("de",{months:"Januar_Februar_März_April_Mai_Juni_Juli_August_September_Oktober_November_Dezember".split("_"),monthsShort:"Jan._Febr._Mrz._Apr._Mai_Jun._Jul._Aug._Sept._Okt._Nov._Dez.".split("_"),monthsParseExact:!0,weekdays:"Sonntag_Montag_Dienstag_Mittwoch_Donnerstag_Freitag_Samstag".split("_"),weekdaysShort:"So._Mo._Di._Mi._Do._Fr._Sa.".split("_"),weekdaysMin:"So_Mo_Di_Mi_Do_Fr_Sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD.MM.YYYY",LL:"D. MMMM YYYY",LLL:"D. MMMM YYYY HH:mm",LLLL:"dddd, D. MMMM YYYY HH:mm"},calendar:{sameDay:"[heute um] LT [Uhr]",sameElse:"L",nextDay:"[morgen um] LT [Uhr]",nextWeek:"dddd [um] LT [Uhr]",lastDay:"[gestern um] LT [Uhr]",lastWeek:"[letzten] dddd [um] LT [Uhr]"},relativeTime:{future:"in %s",past:"vor %s",s:"ein paar Sekunden",m:te,mm:"%d Minuten",h:te,hh:"%d Stunden",d:te,dd:te,M:te,MM:te,y:te,yy:te},ordinalParse:/\d{1,2}\./,ordinal:"%d.",week:{dow:1,doy:4}});var ne="ene._feb._mar._abr._may._jun._jul._ago._sep._oct._nov._dic.".split("_"),ie="ene_feb_mar_abr_may_jun_jul_ago_sep_oct_nov_dic".split("_");t.lang("es",{months:"enero_febrero_marzo_abril_mayo_junio_julio_agosto_septiembre_octubre_noviembre_diciembre".split("_"),monthsShort:function(e,t){return/-MMM-/.test(t)?ie[e.month()]:ne[e.month()]},monthsParseExact:!0,weekdays:"domingo_lunes_martes_miércoles_jueves_viernes_sábado".split("_"),weekdaysShort:"dom._lun._mar._mié._jue._vie._sáb.".split("_"),weekdaysMin:"do_lu_ma_mi_ju_vi_sá".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"H:mm",LTS:"H:mm:ss",L:"DD/MM/YYYY",LL:"D [de] MMMM [de] YYYY",LLL:"D [de] MMMM [de] YYYY H:mm",LLLL:"dddd, D [de] MMMM [de] YYYY H:mm"},calendar:{sameDay:function(){return"[hoy a la"+(1!==this.hours()?"s":"")+"] LT"},nextDay:function(){return"[mañana a la"+(1!==this.hours()?"s":"")+"] LT"},nextWeek:function(){return"dddd [a la"+(1!==this.hours()?"s":"")+"] LT"},lastDay:function(){return"[ayer a la"+(1!==this.hours()?"s":"")+"] LT"},lastWeek:function(){return"[el] dddd [pasado a la"+(1!==this.hours()?"s":"")+"] LT"},sameElse:"L"},relativeTime:{future:"en %s",past:"hace %s",s:"unos segundos",m:"un minuto",mm:"%d minutos",h:"una hora",hh:"%d horas",d:"un día",dd:"%d días",M:"un mes",MM:"%d meses",y:"un año",yy:"%d años"},ordinalParse:/\d{1,2}º/,ordinal:"%dº",week:{dow:1,doy:4}}),t.lang("fr",{months:"janvier_février_mars_avril_mai_juin_juillet_août_septembre_octobre_novembre_décembre".split("_"),monthsShort:"janv._févr._mars_avr._mai_juin_juil._août_sept._oct._nov._déc.".split("_"),monthsParseExact:!0,weekdays:"dimanche_lundi_mardi_mercredi_jeudi_vendredi_samedi".split("_"),weekdaysShort:"dim._lun._mar._mer._jeu._ven._sam.".split("_"),weekdaysMin:"Di_Lu_Ma_Me_Je_Ve_Sa".split("_"),weekdaysParseExact:!0,longDateFormat:{LT:"HH:mm",LTS:"HH:mm:ss",L:"DD/MM/YYYY",LL:"D MMMM YYYY",LLL:"D MMMM YYYY HH:mm",LLLL:"dddd D MMMM YYYY HH:mm"},calendar:{sameDay:"[Aujourd'hui à] LT",nextDay:"[Demain à] LT",nextWeek:"dddd [à] LT",lastDay:"[Hier à] LT",lastWeek:"dddd [dernier à] LT",sameElse:"L"},relativeTime:{future:"dans %s",past:"il y a %s",s:"quelques secondes",m:"une minute",mm:"%d minutes",h:"une heure",hh:"%d heures",d:"un jour",dd:"%d jours",M:"un mois",MM:"%d mois",y:"un an",yy:"%d ans"},ordinalParse:/\d{1,2}(er|)/,ordinal:function(e){return e+(1===e?"er":"")},week:{dow:1,doy:4}}),t.lang("dp",{ordinal:function(e){var t=e%10;return e+(1==~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")}}),t.lang("en",{ordinal:function(e){var t=e%10;return e+(1==~~(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")}}),s&&(module.exports=t),"undefined"==typeof ender&&(this.moment=t),"function"==typeof define&&define.amd&&define("moment",[],function(){return t})}.call(this),define("fslib/i18n",["build_vars","underscore","backbone","handlebars","jquery","config","moment","fslib/lazy_loader"],function(e,t,n,i,$,r,s,o){return new(n.View.extend({initialize:function(){this.baseStrings={},this.lang="en",$("#app").addClass("lang-"+this.lang),i.registerHelper("i18n",t.bind(function(e){var n=t.last(arguments),i=n&&n.fn&&n.fn(this);return arguments.length>2&&(e=(e=Array.prototype.slice.call(arguments)).slice(0,arguments.length-1)),1==arguments.length&&(e=null),!t.isEmpty(n.hash)&&e&&console.warn("i18n (handlebars): You have an options.hash (key/value pairs) AND positional arguments for your translation: what are you doing? Ignoring positional arguments for:",i),this.get(i,t.isEmpty(n.hash)?e:n.hash)},this)),_i18n=this,this.moment=s,this.changeLanguage(r.lang)},get:function(e,n){if(e){var i=e.replace(/\n/g," ").replace(/ {2,}/g," ").toLowerCase().trim(),r=this.baseStrings[i]||this.baseStrings[e.toLowerCase().trim()]||this.baseStrings[e]||e;t.isObject(n)&&arguments.length>2&&console.warn("i18n (javascript): You have an options.hash (key/value pairs) AND positional arguments for your translation: what are you doing? Ignoring positional arguments for:",e);var s={};if(t.isObject(n))for(var o in n)s[o.toLowerCase()]=n[o];else s=Array.prototype.slice.call(arguments,1);this._lastKeys=null;var a=this._formatString(r,s);return this._escape(a)}console.log("Calling i18n.get without a key...")},_bracketReg:/(?:\[)([^\]]+)(?:\])/gi,ESCAPE_CHARS:{"[":"&#91;","]":"&#93;","%":"&#37;",$:"&#36;"},TEMP_ESCAPE:{"[":"[OPEN_"+(new Date).getTime(),"]":"[CLOSE_"+(new Date).getTime()},_formatString:function(e,n){if(!e)return"";var i=0,r=t.isArray(n),s=t.isObject(n);return e.replace(this._bracketReg,t.bind(function(e,t){var o=r?i++:t.toLowerCase();return!s||n.hasOwnProperty(o)?this._getSafeValue(n,o,t):e},this))},_getSafeValue:function(e,n,r){var s=!!t.isString(r)&&0===r.indexOf("safe"),o=t.isObject(e);this._lastKeys=this._lastKeys||[];var a=o?e[n]:e;this._lastKeys.indexOf(r)>-1&&t.isString(a)?t.each(this._lastKeys,t.bind(function(e){a=a.replace(new RegExp("\\["+e+"\\]","g"),this.TEMP_ESCAPE["["]+e+this.TEMP_ESCAPE["]"])},this)):this._lastKeys.push(r);var c=a;return c=o&&c&&t.isString(c)?this._formatString(c,e):c,s?c:i.Utils.escapeExpression(c)},_escape:function(e){return"string"!=typeof e?e:(this.TEMP_ESCAPE_REG||this._buildTempEscapeReg(),t.each(this.TEMP_ESCAPE_REG,t.bind(function(t,n){e=e.replace(t,this.ESCAPE_CHARS[n])},this)),e)},_buildTempEscapeReg:function(){this.TEMP_ESCAPE_REG={},t.each(this.TEMP_ESCAPE,t.bind(function(e,t){var n=new RegExp("\\"+e,"g");this.TEMP_ESCAPE_REG[t]=n},this))},changeLanguage:function(i){if(this.lang!=i){if($("#app").removeClass("lang-"+this.lang),$("#app").addClass("lang-"+i),console.info("Changing language to: "+i),this.lang=i,r.lang=i,s.locale?s.locale(i):s.lang&&s.lang(i),"en"==i)return this.baseStrings={},void n.trigger("lang",i);var a=e.langFile||e.appType;t.isString(a)&&(a=[a]);var c=[];t.each(a,function(e){c.push("locale/"+i+"/"+e)}),o.load(c,function(){this.baseStrings={},t.each(arguments,t.bind(function(e){this.baseStrings=t.extend(this.baseStrings,e)},this)),n.trigger("lang",i)},this)}else console.log("Already %s",i)}}))}),define("views/base",["backbone","fslib/fsutil"],function(e,t){return e.View.extend({animationDuration:250,preloadDelay:0,animationClass:"snappy",loadingHtml:'<div class="preloader"><div class="swoosh"></div></div>',getWebLoadingHtml:function(){return'<div class="preloader"><div class="swoosh"></div><div class="preloader-text">'+this.translate("Loading...")+"</div></div>"},events:{"click a.noop":"_noClick"},autoImageDownload:"img.avatar[data-url]",beforeChildRender:function(e){},postRender:function(){this.windowsRender&&globals&&"win"==globals.os&&_.defer(_.bind(function(){t.isWindows81()?$("body").hide().show():e.trigger("window:resize",window.name)},this))},selectPhone:function(t){t.stopPropagation();var n=$(t.currentTarget).text().trim();e.trigger("phone",n)},linkClick:function(t){var n=t.currentTarget;t.preventDefault();var i=$.trim(n.getAttribute("href")||""),r="_blank"==n.getAttribute("target"),s=0!=$(n).data("closeOverlay");return e.trigger("navigate",i,{trigger:!0,blank:r,closeOverlay:s}),!1},getLink:function(e){if(e)return $(e.currentTarget).attr("class").match(/a-(\w+)/)[1]},removeLink:function(e){if(e){var t,n=e.currentTarget;_.each(n.classList,function(e){0==e.indexOf("a-")&&(t=e)}),(n=$(n)).removeClass(t),n.addClass("disabled")}},_noClick:function(e){e.preventDefault()},_toggleVisibility:function(e,t){var n=$(e.currentTarget);return _.isUndefined(t)?(n.toggleClass("expanded"),n.next().toggleClass("hide")):(n.toggleClass("expanded",t),n.next().toggleClass("hide",!t)),n.hasClass("expanded")}})}),define("views/common/view",["config","fslib/fsutil","fslib/i18n","views/base"],function(e,t,n,i){var r=i.extend({constructor:function(e){this.options=e||{},Backbone.View.apply(this,arguments)},initialize:function(){i.prototype.initialize.apply(this,arguments),this._bindAll(),this.rendered,this.removed,this.createClass=this.options.createClass,this.destroyClass=this.options.destroyClass,this.cacheTemplate&&this.__cacheTemplateData__(),this.disableAnimationFrame},getTemplateData:function(){return this.model?this.model.toJSON():{}},getLoadingHtml:function(){return this.loadingHtml||'<div class="loading"></div>'},template:function(e){return""},update:function(e){this.options=e},addChild:function(e,t){this.children=this.children||[],this.children.push({view:e,selector:t}),this._addChildRenderListeners(e)},hasChildView:function(e){for(var t=!1,n=this.children||[],i=0;i<n.length;i++)t=n[i].view===e||(t||n[i].view.hasChildView(e));return t},removeChild:function(e){var t=this;this.children=_.filter(this.children,function(n){return!(!e||n.view==e)||(t.stopListening(n.view),n.view.remove(),!1)})},remove:function(){if((!this.disableAnimationFrame&&requestAnimationFrame?cancelAnimationFrame:clearTimeout)(this.postRenderCompleteId),delete this.__parentView__,this.fadeOut&&!this.destroyClass&&(this.destroyClass="fade-out",this.fadeOut=!1),this.destroyClass)return _.defer(_.bind(function(){this.$el.addClass(this.animationClass),this.$el.addClass(this.destroyClass),this.destroyClass=null},this)),void _.delay(_.bind(function(){this._remove()},this),this.animationDuration);this._remove()},_remove:function(){this.stopListening(),_.each(this.children,function(e){e.view.remove()},this),i.prototype.remove.call(this),this.removed||(this.removed=!0,this._onRemoved&&this._onRemoved(),this.trigger("removed",this))},onLoad:function(){this.preload=!1,this.preloadRendered&&this.render()},renderPreloader:function(){this.preloadRendered||(this.preloadRendered=!0,_.delay(_.bind(function(){this.rendered||this.$el.html(this.getLoadingHtml())},this),this.preloadDelay))},render:function(){if(!window||this.disableRender)return this;if(this.preload)return this.renderPreloader(),this;if(!this._renderBeforeAfterLocked&&this._triggerBeforeRender(),this.preloadRendered=!1,this.fadeIn&&!this.createClass&&(this.createClass="fade-out",this.fadeIn=!1),this.createClass&&this.$el.addClass(this.createClass),this.children)if(e.isWidget)this.$el.html(this.template(this.getTemplateData())),this.beforeChildRender(),_.each(this.children||[],_.bind(function(e){e.view._renderBeforeAfterLocked=!0,e.selector?this.$(e.selector).html(e.view.render().el):this.$el.append(e.view.render().el),e.view._renderBeforeAfterLocked=!1},this));else{var t=document.createDocumentFragment(),i=$(this.template(this.getTemplateData()));_.each(i,function(e){t.appendChild(e)}),this.beforeChildRender(t),_.each(this.children||[],function(e){e.view._renderBeforeAfterLocked=!0;var n=e.selector?t.querySelector(e.selector):t;n&&n.appendChild($(e.view.render().el)[0]),e.view._renderBeforeAfterLocked=!1}),this.$el.html(t)}else this.$el.html(this.template(this.getTemplateData())),this.beforeChildRender();return this.rendered=!0,this.renderedLanguage=n.lang,this.delegateEvents(this.events),this.postRenderCompleteId=(!this.disableAnimationFrame&&requestAnimationFrame||_.defer)(_.bind(this.postRender,this)),!this._renderBeforeAfterLocked&&this._triggerAfterRender(),this},beforeChildRender:function(e){if(this.autoImageDownload){var t=this.autoImageDownload;this._toDownload=e?$(e.querySelector(t)):this.$(t)}i.prototype.beforeChildRender.call(this,e)},postRender:function(){this._toDownload&&this._toDownload.length&&(e.logDownloads&&console.log(this._toDownload),e.totalImageDownloads=(e.totalImageDownloads||0)+this._toDownload.length,_.each(this._toDownload,t.setImage),this._toDownload=null),clearTimeout(this.renderCompleteId),this.createClass?(this.$el.addClass(this.animationClass),this.$el.removeClass(this.createClass),this.createClass=null,this.renderCompleteId=_.delay(this.renderAnimationComplete,this.animationDuration)):this.postRendered=!0,i.prototype.postRender.call(this),this.trigger("rendered")},renderAnimationComplete:function(){this.postRendered=!0},translate:function(){return n.get.apply(n,arguments)},trackEvent:function(){var e=Array.prototype.slice.call(arguments);return Backbone.trigger.apply(Backbone,["track:event"].concat(e))},detach:function(e){delete this.__parentView__,this._detached=!0,this.stopListening(),_.each(this.children,function(e){e.view.detach()},this),e&&this.$el.remove()},isDetached:function(){return this._detached},reattach:function(){this._detached&&(this.resumeListening(),_.each(this.children,_.bind(function(e){this._addChildRenderListeners(e.view),e.view.reattach()},this)))},resumeListening:function(){this.delegateEvents(this.events),_.each(this.children,function(e){e.view.resumeListening()})},__cacheTemplateData__:function(){this.__getTemplateData__=this.getTemplateData,this.getTemplateData=_.bind(function(){return this.__computedTemplateData__},this),this.__computeData__=_.bind(function(){this.__computedTemplateData__=this.__getTemplateData__();var e=JSON.stringify(this.__computedTemplateData__);this.__rerender__=this.__rerender__||e!==this.__lastTemplateData__,this.__lastTemplateData__=e},this),this.listenTo(this.model,"sync",this.__computeData__),this.__render__=this.render,this.render=_.bind(function(){return this.rendered&&!this.__rerender__||(this.__render__.apply(this,arguments),this.__rerender__=!1),this},this),this.forceTemplateDataCache()},forceTemplateDataCache:function(){this.cacheTemplate&&this.__computeData__()},needsToReRender:function(){return!this.cacheTemplate||this.__rerender__},getInputValue:function(e){return this.$(e).val()},_addChildRenderListeners:function(e){this.options.listenToRender&&(e.__parentView__=this,this.listenTo(e,"render:before",this._onBeforeChildRender),this.listenTo(e,"render:after",this._onAfterChildRender))},_triggerBeforeRender:function(e){var t=e||[];t.unshift(this),this.trigger("render:before",t);var n=this.options.parent&&this.options.parent.trigger&&!this._renderBeforeAfterLocked,i=!this.__parentView__||this.options.parent==this.__parentView__;n&&i&&this.options.parent.trigger("render:before",t)},_triggerAfterRender:function(e){var t=e||[];t.unshift(this),this.trigger("render:after",t);var n=this.options.parent&&this.options.parent.trigger&&!this._renderBeforeAfterLocked,i=!this.__parentView__||this.options.parent==this.__parentView__;n&&i&&this.options.parent.trigger("render:after",t)},_onBeforeChildRender:function(e){this._triggerBeforeRender(e)},_onAfterChildRender:function(e){this._triggerAfterRender(e)},_bindAll:function(){_.bindAll(this)}});return t.extendEvents(r),r}),define("fslib/base_router",["backbone","fslib/lazy_loader","module","config","fslib/i18n","fslib/fsutil","views/common/view"],function(e,t,n,i,r,s,o){return e.Router.extend({routes:{"":"home",debug:"debug"},accessRequiredRoutes:{debug:"dev"},initialize:function(){_.bindAll(this),this.urlArgs=n.config()&&n.config().urlArgs||s.getUrlArgs(),(_router=this).config=i,_router.module=n,_router.user=this.currentUser(),e.on("navigate",this.onNavigate),e.on("back",this.onBack),e.on("forward",this.onForward),e.on("oauth",this.onOauth),this.createAppView(),this.getPrerequisites()},destroy:function(){e.off("navigate",this.onNavigate),e.off("back",this.onBack),e.off("forward",this.onForward),e.off("oauth",this.onOauth),this.appView.remove()},getClass:function(e){switch(e){case"AppView":return o;default:throw new Error("Class not found: "+e)}},createAppView:function(){var e=this.getClass("AppView");this.appView=new e({el:document.getElementById("app")})},getPrerequisites:function(){this.start()},start:function(e){this.started||(this.started=!0,this.intro=!0,this.startApp(),this.startNotifications(),this.startHistory(e),this.onStarted(),this.intro=!1)},startApp:function(){this.intro="/"==e.history.location.pathname},startNotifications:function(){},startHistory:function(t){t=t||{};var r=e.history.location.pathname+e.history.location.search;r=r.replace("/","");var s=this.validatedRoute(r),o=s==r,a=_.extend({pushState:!0,silent:!o},t);if(e.history.start(a),"_=_"==e.history.fragment)return this.onNavigate((i.continuePath||"").replace(/^\//,""));var c=n.config()||{};return c.route?this.onNavigate(c.route):o?void 0:this.onNavigate(s)},onStarted:function(){},currentUser:function(){return{isLoggedIn:function(){return!1}}},isLoggedIn:function(){var e=this.currentUser();return e&&e.isLoggedIn()},isEnterpriseAdmin:function(){return!1},validatedRoute:function(e){var t=this.accessRequiredRoutes[_.first(e.split("/"))];if(t)switch(t){case"enterprise_admin":if(!this.isEnterpriseAdmin())return"";break;case"user":if(!this.isLoggedIn())return i.continuePath=e,"login";break;case"dev":if(!i.isDev)return""}return e},navigateExternal:function(e,t){(e=e.replace(/chrome-extension\:\/\/[a-z]+/,i.domain),t)?i.isNative?_electron.shell.openExternal(e):window.open(e,"_blank"):window.location.href=e},onNavigate:function(t,n){if(t=t||"",(n=n||{}).trigger=!!_.isUndefined(n.trigger)||n.trigger,t.match(/^(\/|chrome-extension|mailto|https?\:)/i))this.navigateExternal(t,n.blank);else{t=this.validatedRoute(t);try{var r=_.first(t.split("?")).split("/"),o=_.first(r),a=_.rest(r,1);e.trigger("navigated:before",t,o,a,s.getUrlArgs(t),t&&this.lastRoute==t),_.defer(function(){e.trigger("navigated",t,o,a)})}catch(e){console.error("Tracking failed",e)}n.forceDeepReload&&(window.location="//"+i.host+(t.match(/^\//g)?t:"/"+t)),this.currentRoute=t,this.navigate(t,n)}},onOauth:function(e,t,n,i,r){this.closeOauthPopup(e);var s=screen.width?.5*(screen.width-r):0,o="height="+i+",width="+r+",top="+(screen.height?.45*(screen.height-i):0)+",left="+s;n&&(-1!=t.indexOf("?")?t+="&":t+="?",t+="action="+n),this.oauthPopups=this.oauthPopups||{},this.oauthPopups[e]=window.open(t,"",o)},closeOauthPopup:function(e){var t=this.oauthPopups?this.oauthPopups[e]:null;t&&t.window&&t.window.close()},loadView:function(n,i,r){i=i||{};var s=r||function(t){var n=new t(i);i.lightbox?e.trigger("lightbox",{title:n.title,view:n,iconClass:n.iconClass,animate:!0}):i.overlay?e.trigger("overlay","dialog",n,{centered:!0}):this.appView.showView(n,{cssClass:i.cssClass})};t.load([n],_.bind(s,this))},onBack:function(){if(this._history){if(this._historyIndex=Math.max(this._historyIndex-1,0),this.updateBackForwardButtons(),this._historyIndex<this._history.length){var t=this._history[this._historyIndex];e.trigger("navigate",t,{silent:!0})}}else window.history.back()},onForward:function(){if(this._history){this._historyIndex=Math.min(this._historyIndex+1,this._history.length-1),this.updateBackForwardButtons();var t=this._history[this._historyIndex];e.trigger("navigate",t,{silent:!0})}else window.history.forward()},_simpleNavigate:function(t,n){if(n=n||{},this._history=this._history||[],this._historyIndex=null==this._historyIndex?-1:this._historyIndex,!t||this.lastRoute!=t||n.force){var i=t.split("/"),r=i[0],s=this.routes[r];if(!s)return this.home();this._lastSimpleRoute=t,e.history.fragment=t;var o=_.rest(i).join("/");!n.silent&&r&&"loading"!=r&&(this._historyIndex=this._historyIndex+1,this.updateBackForwardButtons(),this._history=this._history.slice(0,this._historyIndex),this._history.push(t)),console.log("Simple Navigate: "+t),this[s](o)}},updateBackForwardButtons:function(){var t={};this._historyIndex<=0?t.backBtn=!1:t.backBtn=!0,this._historyIndex>=this._history.length-1?t.forwardBtn=!1:t.forwardBtn=!0,e.trigger("navbuttons:update",t)},debug:function(){this.loadView(this.urlArgs.view,this.urlArgs)},home:function(){},translate:function(){return r.get.apply(r,arguments)}})}),define("fslib/object",["backbone","fslib/fsutil","fslib/i18n"],function(e,t,n){var i=e.View.extend({initialize:function(){e.View.prototype.initialize.apply(this,arguments),_.bindAll(this)},translate:function(){return n.get.apply(n,arguments)},_ensureElement:function(){},remove:function(){return this.stopListening(),this}});return t.extendEvents(i),i}),define("fslib/singleton",["require","fslib/globals","fslib/object"],function(require){var e=require("fslib/globals");return new(require("fslib/object").extend({initialize:function(){this.registeredSingletons=[]},create:function(t,n){if(e&&e.vars&&e.vars[n])return e.vars[n];var i=new t;return i.getPrototype=function(){return t}.bind(i),i.startGarbageCollection&&i.startGarbageCollection(),e&&(e.vars=e.vars||{},e.vars[n]=i),this._registerSingleton(n,i),i},_registerSingleton:function(e,t){this.registeredSingletons.push({name:e,instance:t}),this.trigger("registered",_.last(this.registeredSingletons))},currentWindow:function(){return e&&e.background?(e.background.log("current window:"),e.background.log(window.windowName)):console.log("current window:",window.name),window}}))}),define("fslib/keycode",[],function(){var e={ENTER:13,LEFT:37,UP:38,RIGHT:39,DOWN:40,ESCAPE:27,BACKSPACE:8,DIRECTIONAL:[37,38,39,40],SPACE:[32],COMMAND:[91,93],TAB:9,isNumberKey:function(e){var t=e.keyCode;return t>=48&&t<=57},isSpecialKey:function(e){if(!e)return!1;if(e.metaKey||e.altKey||e.ctrlKey)return!0;var t=e.keyCode;return 91==t||93==t},getLowerChar:function(e){try{return String.fromCharCode(e.which).toLowerCase()}catch(e){}return""},isAlphaNumeric:function(e){return/[a-z0-9]/.test(this.getLowerChar(e))},getDialPadMapping:function(e){if(!(e.altKey||e.ctrlKey||e.metaKey)){var t,n=e.keyCode;switch(n>=48&&n<=57&&(t=""+(e.keyCode-48)),n>=96&&n<=105&&(t=""+(e.keyCode-96)),n){case 65:case 66:case 67:t="2";break;case 68:case 69:case 70:t="3";break;case 71:case 72:case 73:t="4";break;case 74:case 75:case 76:t="5";break;case 77:case 78:case 79:t="6";break;case 80:case 81:case 82:case 83:t="7";break;case 84:case 85:case 86:t="8";break;case 87:case 88:case 89:case 90:t="9";break;case 51:e.shiftKey&&(t="#");break;case 56:e.shiftKey&&(t="*");break;case 106:t="*"}return t}}};return e}),define("hbs",["handlebars"],function(e){var t={};return{load:function(n,i,r,s){if(s.isBuild){var o=nodeRequire("fs"),a=s.dirBaseUrl+"/"+n+".handlebars";t[n]=o.readFileSync(a).toString(),r()}else if(window.globals&&window.globals.compileTemplates){var c,l=n.lastIndexOf("/"),u=n;n.startsWith("single/templates")?c="single/templates/compiled/all":(c="compiled/all",-1!=l&&(c=n.slice(0,l)+"/"+c)),-1!=l&&(u=n.slice(l+1)),i([c],function(e){r(e[u]),e[u]||console.log(n+" not found. Did you compile the templates?")})}else i(["text!"+n+".handlebars"],function(t){r(e.compile(t))})},write:function(n,i,r){r("define('hbs!"+i+"', ['handlebars'], function(Handlebars){ \nreturn Handlebars.template("+e.precompile(t[i]).toString()+");\n});\n")}}}),define("hbs!templates/common/dialog",["handlebars"],function(e){return e.template(function(e,t,n,i,r){this.compilerInfo=[4,">= 1.0.0"],r=r||{};var s,o="";function a(e,t){return'class="iblock left" '}return o+="<table ",((s=(n=this.merge(n,e.helpers)).if.call(t,t.centered,{hash:{},inverse:this.noop,fn:this.program(1,function(e,t){return'class="h100" '},r),data:r}))||0===s)&&(o+=s),o+=" ",((s=n.if.call(t,t.bottom,{hash:{},inverse:this.noop,fn:this.program(3,function(e,t){return'class="bottom" '},r),data:r}))||0===s)&&(o+=s),o+='>\n  <tr>\n    <td id="dialog-holder" class="',((s=n.if.call(t,t.centered,{hash:{},inverse:this.noop,fn:this.program(5,function(e,t){return"center "},r),data:r}))||0===s)&&(o+=s),((s=n.if.call(t,t.dialogV2,{hash:{},inverse:this.noop,fn:this.program(7,function(e,t){return"dialog-v2"},r),data:r}))||0===s)&&(o+=s),o+='">\n      <div id="dialog-wrapper" ',((s=n.if.call(t,t.centered,{hash:{},inverse:this.noop,fn:this.program(9,a,r),data:r}))||0===s)&&(o+=s),o+=" ",((s=n.if.call(t,t.longDialog,{hash:{},inverse:this.noop,fn:this.program(11,function(e,t){return'style="margin-top: 0%;" '},r),data:r}))||0===s)&&(o+=s),o+='>\n        <div class="web-icon-xs web-icon-xs-x dialog-close signup2017"></div>\n        <div id="dialog-main" ',((s=n.if.call(t,t.centered,{hash:{},inverse:this.noop,fn:this.program(9,a,r),data:r}))||0===s)&&(o+=s),o+='></div>\n        <div id="dialog-loading" ',((s=n.unless.call(t,t.autoLoad,{hash:{},inverse:this.noop,fn:this.program(13,function(e,t){return' style="display: none;" '},r),data:r}))||0===s)&&(o+=s),o+='>\n          <div class="dialog-loading-bg"></div>\n          <div class="dialog-loading-img"></div>\n        </div>\n      </div>\n    </td>\n  </tr>\n</table>'})}),define("views/common/dialog_view",["backbone","views/common/view","fslib/keycode","hbs!templates/common/dialog"],function(e,t,n,i){return t.extend({id:"dialog",template:i,events:{"click #dialog-wrapper":"_onContentClick","click .dialog-close":"_close",click:"_onClick"},initialize:function(){t.prototype.initialize.apply(this,arguments),this.addChild(this.options.view,"#dialog-main"),this.listenTo(e,"dialog:update:options",this._onUpdateOptionsForView),e.on("dialog:loading",this.showLoading,this),$(window).on("keyup",this._onKeyUp)},getTemplateData:function(){return{centered:this.options.centered&&!this.options.bottom&&!this.options.top,bottom:this.options.bottom,dialogV2:this.options.dialogV2||!1,longDialog:!!this.options.longDialog}},close:function(t){e.trigger("overlay")},remove:function(){$(window).off("keyup",this._onKeyUp),this.options.onClose&&this.options.onClose(),t.prototype.remove.call(this)},showLoading:function(e){this.$("#dialog-loading").toggle(e)},_onContentClick:function(t){t.stopPropagation(),e.trigger("dialog:click")},_onClick:function(e){e.stopPropagation(),0!=this.options.close&&this.close()},_onKeyUp:function(e){e.stopPropagation(),0!=this.options.close&&(e.keyCode==n.ESCAPE&&0!=this.options.closeOnEscape?this.close():e.keyCode==n.ESCAPE&&0==this.options.closeOnEscape&&(this.options.closeOnEscape=!0))},_onUpdateOptionsForView:function(e,t){e===this.options.view&&_.extend(this.options,t)},_close:function(t){t.stopPropagation(),e.trigger("overlay")}})}),define("views/common/flow_view",["views/common/view"],function(e){var t=e.extend({initialize:function(t,n,i){e.prototype.initialize.apply(this,arguments),t=_.extend(t||{},this.options),this._views=n,this._index=t.index||0,this._childOptions=_.extend({},i,t.childOptionsExt),t.slide?this.setSlideTransition():t.animate&&this.setFadeTransition(),this.transitionCss=this.transitionCss||{},this._setView(this._childOptions),this.title=this._getTitle(),this.description=this._getDescription(),this.iconClass=this._getIconClass()},_getTitle:function(){return this.currentView.title},_getDescription:function(){return this.currentView.description},_showHeader:function(){return!this.currentView.hideHeader},_getIconClass:function(){return this.currentView.iconClass},setView:function(e,t){t=_.extend(_.clone(this._childOptions),t||{}),this._index=e,this._setView(t),this._showView()},getIndex:function(){return this._index},getCount:function(){return this._views.length},setSlideTransition:function(){this.transitionCss={lastNext:"fade-out",lastPrev:"fade-out",next:"slide-right",prev:"slide-left"}},setFadeTransition:function(){this.transitionCss={lastNext:"fade-out",lastPrev:"fade-out",next:"fade-in",prev:"fade-in"}},render:function(){return e.prototype.render.call(this),this._showView(),this},remove:function(){this._index=0,this._removeCurrentView(!0),e.prototype.remove.call(this)},setChildOptions:function(e){this._childOptions=e},_setView:function(e){this._removeCurrentView(),this.currentView=new this._views[this._index](e),_.isArray(this._views)&&(this.listenTo(this.currentView,"next",this._onNext),this.listenTo(this.currentView,"previous",this._onPrevious)),this.listenTo(this.currentView,"index",this._onIndex),this.listenTo(this.currentView,"close",this.remove),this.listenTo(this.currentView,"error",this._onError),this.trigger("FlowView:updated_view",this._getTitle(),this._getDescription(),this._showHeader(),this.getIndex())},_showView:function(){this.$el.append(this.currentView.render().el)},_removeCurrentView:function(e){if(this.currentView){var t=this.currentView;this.currentView=null,e||(this.$last=this.$el.children().first(),this.$last.removeClass(this.animationClass),this.$last.css("position","absolute"),this.$last.css("width","100%")),this.stopListening(t),t.remove()}},_onNext:function(e){e=e||{},this.currentView.destroyClass=this.transitionCss.lastNext,e.createClass=this.transitionCss.next,this._index=Math.min(this._views.length-1,this._index+1),this.setView(this._index,e)},_onPrevious:function(e){e=e||{},this.currentView.destroyClass=this.transitionCss.lastPrev,e.createClass=this.transitionCss.prev,this._index=Math.max(0,this._index-1),this.setView(this._index,e)},_onIndex:function(e,t){this.setView(e,t)},_onError:function(e){this.trigger("FlowView:error",e)},isFlowView:!0});return t.isFlowView=!0,t}),define("hbs!templates/common/select_menu",["handlebars"],function(e){return e.template(function(e,t,n,i,r){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=r||{};var s,o="",a=this,c="function",l=this.escapeExpression;function u(e,t){return"fi-has-content "}function h(e,t){var i;return i=(i=n.selectedTitle)?i.call(e,{hash:{},data:t}):(void 0===(i=e.selectedTitle)?"undefined":_typeof(i))===c?i.apply(e):i,l(i)}function d(e,t){var i;return i=(i=n.displayText)?i.call(e,{hash:{},data:t}):(void 0===(i=e.displayText)?"undefined":_typeof(i))===c?i.apply(e):i,l(i)}function f(e,t){var i,r="";return r+=" ",i=(i=n.labelClasses)?i.call(e,{hash:{},data:t}):(void 0===(i=e.labelClasses)?"undefined":_typeof(i))===c?i.apply(e):i,r+=l(i)}function p(e,t){var i;return i=(i=n.errorMsg)?i.call(e,{hash:{},data:t}):(void 0===(i=e.errorMsg)?"undefined":_typeof(i))===c?i.apply(e):i,l(i)}function g(e,t){var i;return i=(i=n.label)?i.call(e,{hash:{},data:t}):(void 0===(i=e.label)?"undefined":_typeof(i))===c?i.apply(e):i,l(i)}function m(e,t){return"unselected "}function _(e,t){return" italic-font"}function v(e,t){return" sm-item-disabled"}function y(e,t){return'data-no-select="true"'}function b(e,t){return'data-off="true"'}function S(e,t){var i,r="";return r+='<div class="sm-optgroup">',i=(i=n.optgroup)?i.call(e,{hash:{},data:t}):(void 0===(i=e.optgroup)?"undefined":_typeof(i))===c?i.apply(e):i,r+=l(i)+"</div>"}function C(e,t){var i;return(i=n.unless.call(e,e.noItalic,{hash:{},inverse:a.noop,fn:a.program(43,_,t),data:t}))||0===i?i:""}function w(e,t){var i;return i=(i=n.title)?i.call(e,{hash:{},data:t}):(void 0===(i=e.title)?"undefined":_typeof(i))===c?i.apply(e):i,l(i)}function T(e,t){var i;return i=(i=n.name)?i.call(e,{hash:{},data:t}):(void 0===(i=e.name)?"undefined":_typeof(i))===c?i.apply(e):i,l(i)}function k(e,t){var i;return(i=(i=n.icon_html)?i.call(e,{hash:{},data:t}):(void 0===(i=e.icon_html)?"undefined":_typeof(i))===c?i.apply(e):i)||0===i?i:""}return o+='<div class="',((s=n.if.call(t,t.isFancy,{hash:{},inverse:a.noop,fn:a.program(1,function(e,t){var i,r="";return r+="fi-container ",((i=n.if.call(e,e.selected,{hash:{},inverse:a.noop,fn:a.program(2,u,t),data:t}))||0===i)&&(r+=i),r+="fi-blurred "},r),data:r}))||0===s)&&(o+=s),o+="select-menu ",((s=n.unless.call(t,t.autoSize,{hash:{},inverse:a.noop,fn:a.program(4,function(e,t){return"snappy"},r),data:r}))||0===s)&&(o+=s),((s=n.if.call(t,t.disabled,{hash:{},inverse:a.noop,fn:a.program(6,function(e,t){return" select-menu-disabled"},r),data:r}))||0===s)&&(o+=s),o+=" ",((s=n.if.call(t,t.isExclusive,{hash:{},inverse:a.noop,fn:a.program(8,function(e,t){return" exclusive"},r),data:r}))||0===s)&&(o+=s),o+=" closed",((s=n.if.call(t,t.errored,{hash:{},inverse:a.noop,fn:a.program(10,function(e,t){return" fi-errored"},r),data:r}))||0===s)&&(o+=s),((s=n.if.call(t,t.noInput,{hash:{},inverse:a.noop,fn:a.program(12,function(e,t){return" sm-no-input"},r),data:r}))||0===s)&&(o+=s),o+=" ",s=(s=n.wrapperClass)?s.call(t,{hash:{},data:r}):(void 0===(s=t.wrapperClass)?"undefined":_typeof(s))===c?s.apply(t):s,o+=l(s)+'">\n  <div class="sm-input-shim" tabindex="',((s=n.if.call(t,t.tabindex,{hash:{},inverse:a.program(16,function(e,t){return"0"},r),fn:a.program(14,function(e,t){var i;return i=(i=n.tabindex)?i.call(e,{hash:{},data:t}):(void 0===(i=e.tabindex)?"undefined":_typeof(i))===c?i.apply(e):i,l(i)},r),data:r}))||0===s)&&(o+=s),o+='" ',((s=n.if.call(t,t.title,{hash:{},inverse:a.noop,fn:a.program(18,function(e,t){var i,r="";return r+='title="',((i=n.if.call(e,e.selectedTitle,{hash:{},inverse:a.program(21,d,t),fn:a.program(19,h,t),data:t}))||0===i)&&(r+=i),r+='"'},r),data:r}))||0===s)&&(o+=s),o+=">\n    ",((s=n.if.call(t,t.callout_icon_html,{hash:{},inverse:a.noop,fn:a.program(23,function(e,t){var i;return(i=(i=n.callout_icon_html)?i.call(e,{hash:{},data:t}):(void 0===(i=e.callout_icon_html)?"undefined":_typeof(i))===c?i.apply(e):i)||0===i?i:""},r),data:r}))||0===s)&&(o+=s),o+="\n    ",((s=n.if.call(t,t.isFancy,{hash:{},inverse:a.noop,fn:a.program(25,function(e,t){var i,r="";return r+='<label class="fi-label snappy uppercase',((i=n.if.call(e,e.labelClasses,{hash:{},inverse:a.noop,fn:a.program(26,f,t),data:t}))||0===i)&&(r+=i),r+='">',((i=n.if.call(e,e.errorMsg,{hash:{},inverse:a.program(30,g,t),fn:a.program(28,p,t),data:t}))||0===i)&&(r+=i),r+="</label>"},r),data:r}))||0===s)&&(o+=s),o+="\n    <input ",((s=n.if.call(t,t.name,{hash:{},inverse:a.noop,fn:a.program(32,function(e,t){var i,r="";return r+='id="',i=(i=n.name)?i.call(e,{hash:{},data:t}):(void 0===(i=e.name)?"undefined":_typeof(i))===c?i.apply(e):i,r+=l(i)+'"'},r),data:r}))||0===s)&&(o+=s),o+="\n         ",((s=n.if.call(t,t.name,{hash:{},inverse:a.noop,fn:a.program(34,function(e,t){var i,r="";return r+='name="',i=(i=n.name)?i.call(e,{hash:{},data:t}):(void 0===(i=e.name)?"undefined":_typeof(i))===c?i.apply(e):i,r+=l(i)+'"'},r),data:r}))||0===s)&&(o+=s),o+='\n           type="text"\n           value="',s=(s=n.displayText)?s.call(t,{hash:{},data:r}):(void 0===(s=t.displayText)?"undefined":_typeof(s))===c?s.apply(t):s,o+=l(s)+'"\n           class="',((s=n.unless.call(t,t.autoSize,{hash:{},inverse:a.noop,fn:a.program(36,function(e,t){return"snappy "},r),data:r}))||0===s)&&(o+=s),o+="sm-input sm-item-value-",s=(s=n.selected)?s.call(t,{hash:{},data:r}):(void 0===(s=t.selected)?"undefined":_typeof(s))===c?s.apply(t):s,o+=l(s)+" ",((s=n.unless.call(t,t.selectedName,{hash:{},inverse:a.noop,fn:a.program(38,function(e,t){var i;return(i=n.if.call(e,e.unselected,{hash:{},inverse:a.noop,fn:a.program(39,m,t),data:t}))||0===i?i:""},r),data:r}))||0===s)&&(o+=s),((s=n.if.call(t,t.off,{hash:{},inverse:a.noop,fn:a.program(41,function(e,t){return"off "},r),data:r}))||0===s)&&(o+=s),s=(s=n.cssClass)?s.call(t,{hash:{},data:r}):(void 0===(s=t.cssClass)?"undefined":_typeof(s))===c?s.apply(t):s,o+=l(s),((s=n.if.call(t,t.isSelectedItalic,{hash:{},inverse:a.noop,fn:a.program(43,_,r),data:r}))||0===s)&&(o+=s),o+='"\n           ',((s=n.if.call(t,t.title,{hash:{},inverse:a.noop,fn:a.program(45,function(e,t){var i,r="";return r+='title="',i=(i=n.displayText)?i.call(e,{hash:{},data:t}):(void 0===(i=e.displayText)?"undefined":_typeof(i))===c?i.apply(e):i,r+=l(i)+'"'},r),data:r}))||0===s)&&(o+=s),o+="\n           ",((s=n.if.call(t,t.placeholder,{hash:{},inverse:a.noop,fn:a.program(47,function(e,t){var i,r="";return r+='placeholder="',i=(i=n.placeholder)?i.call(e,{hash:{},data:t}):(void 0===(i=e.placeholder)?"undefined":_typeof(i))===c?i.apply(e):i,r+=l(i)+'"'},r),data:r}))||0===s)&&(o+=s),o+="\n           ",((s=n.if.call(t,t.dataEncryptedName,{hash:{},inverse:a.noop,fn:a.program(49,function(e,t){var i,r="";return r+='data-encrypted-name="',i=(i=n.dataEncryptedName)?i.call(e,{hash:{},data:t}):(void 0===(i=e.dataEncryptedName)?"undefined":_typeof(i))===c?i.apply(e):i,r+=l(i)+'"'},r),data:r}))||0===s)&&(o+=s),o+="\n           ",((s=n.if.call(t,t.autocomplete,{hash:{},inverse:a.noop,fn:a.program(51,function(e,t){var i,r="";return r+='autocomplete="',i=(i=n.autocomplete)?i.call(e,{hash:{},data:t}):(void 0===(i=e.autocomplete)?"undefined":_typeof(i))===c?i.apply(e):i,r+=l(i)+'"'},r),data:r}))||0===s)&&(o+=s),o+=' tabindex="-1" />\n  </div>\n  <div class="sm-menu"><div></div>\n    <ul class="sm-list">\n      ',((s=n.each.call(t,t.items,{hash:{},inverse:a.noop,fn:a.programWithDepth(53,function(e,t,i){var r,s,o="";return o+='\n        <li class="sm-item',((r=n.if.call(e,e.noSelect,{hash:{},inverse:a.noop,fn:a.program(54,v,t),data:t}))||0===r)&&(o+=r),o+='" id="sm-item-'+l((void 0===(r=i.name)?"undefined":_typeof(r))===c?r.apply(e):r)+"-",s=(s=n.value)?s.call(e,{hash:{},data:t}):(void 0===(s=e.value)?"undefined":_typeof(s))===c?s.apply(e):s,o+=l(s)+'" data-value="',s=(s=n.value)?s.call(e,{hash:{},data:t}):(void 0===(s=e.value)?"undefined":_typeof(s))===c?s.apply(e):s,o+=l(s)+'" ',((s=n.if.call(e,e.noSelect,{hash:{},inverse:a.noop,fn:a.program(56,y,t),data:t}))||0===s)&&(o+=s),o+=" ",((s=n.if.call(e,e.off,{hash:{},inverse:a.noop,fn:a.program(58,b,t),data:t}))||0===s)&&(o+=s),o+=">\n          ",((s=n.if.call(e,e.optgroup,{hash:{},inverse:a.noop,fn:a.program(60,S,t),data:t}))||0===s)&&(o+=s),o+='\n          <a class="sm-text sm-item-value-',s=(s=n.value)?s.call(e,{hash:{},data:t}):(void 0===(s=e.value)?"undefined":_typeof(s))===c?s.apply(e):s,o+=l(s)+" ",((s=n.if.call(e,i.italicFont,{hash:{},inverse:a.noop,fn:a.program(62,C,t),data:t}))||0===s)&&(o+=s),o+='" href="javascript:void(0)" title="',((s=n.if.call(e,e.title,{hash:{},inverse:a.program(66,T,t),fn:a.program(64,w,t),data:t}))||0===s)&&(o+=s),o+='">\n            ',((s=n.if.call(e,e.icon_html,{hash:{},inverse:a.noop,fn:a.program(68,k,t),data:t}))||0===s)&&(o+=s),o+="\n            ",s=(s=n.name)?s.call(e,{hash:{},data:t}):(void 0===(s=e.name)?"undefined":_typeof(s))===c?s.apply(e):s,o+=l(s)+"\n          </a>\n        </li>\n      "},r,t),data:r}))||0===s)&&(o+=s),o+="\n    </ul>\n  </div>\n</div>\n"})}),define("views/common/select_menu_view",["underscore","fslib/keycode","views/common/view","hbs!templates/common/select_menu"],function(e,t,n,i){return n.extend({className:"select-menu-view",template:i,events:{"click .sm-input-shim":"_onInputClick","focus input":"_onInputFocus","focus .sm-input-shim":"_onShimFocus","blur .sm-input-shim":"_onShimBlur","click li":"_onSelect",keydown:"_onKeyPress","input input":"_onAutoInput"},initialize:function(){n.prototype.initialize.apply(this,arguments),this.name=this.options.name,this.items=this.options.items||[],this.selected=this.options.selected,this.unselected=this.options.unselected,this.noSelect=!!this.options.noSelect,this.autoClose=!!this.options.autoClose,this.valueScroll=!!this.options.valueScroll,this.disabled=!e.isUndefined(this.options.disabled)&&this.options.disabled,this.tabindex=this.options.tabindex,this.callout=this.options.callout,this.isExclusive=!!this.options.isExclusive,this.autoFlipMenu=!!this.options.autoFlipMenu,this.disabledText=this.options.disabledText,this.italicFont=!!this.options.italicFont,this.cssClass=this.options.cssClass,this.wrapperClass=this.options.wrapperClass,this.placeholder=this.options.placeholder,this.dataEncryptedName=this.options.dataEncryptedName,this.autocomplete=this.options.autocomplete,this._searchTerm="",this._searchTermUpdated=(new Date).getTime(),this._useCapture=!!this.options.capture,this.isFancy=this.options.fancy,this.label=this.options.label,this.valid=null==this.options.valid||this.options.valid,this.$el.toggleClass("ms-selection-with-icon",!!this.options.calloutIconHtml),this.listenTo(Backbone,this._useCapture?"app:click:capture":"app:click",this._onBodyClick)},getTemplateData:function(){var t={selected:this.selected,items:this.items,name:this.name,unselected:this.unselected,disabled:this.disabled,tabindex:this.tabindex,callout:this.callout,callout_icon_html:this.options.calloutIconHtml,isExclusive:this.isExclusive,title:this.options.title,autoSize:this.options.autoSize,cssClass:this.cssClass,wrapperClass:this.wrapperClass,placeholder:this.placeholder,disabledText:this.disabledText,italicFont:this.italicFont,dataEncryptedName:this.dataEncryptedName,autocomplete:this.autocomplete,isFancy:this.isFancy,label:this.label,isValid:this.isValid(),errored:!1===this.valid,errorMsg:this.errorMsg};this.italicFont&&(t.isSelectedItalic=!0);var n=e.findWhere(this.items,{value:this.selected});return n&&(t.selectedName=n.name,t.selectedTitle=n.title,n.off&&(t.off=!0),n.noItalic&&(t.isSelectedItalic=!1)),this.disabled&&this.disabledText?t.displayText=this.disabledText:t.selectedName?t.displayText=t.selectedName:t.displayText=t.unselected,this.disabled&&(t.tabindex=-1),t},render:function(){if(n.prototype.render.call(this),this.$input=this.$("input"),this.$shim=this.$(".sm-input-shim"),this.options.autoSize&&this.$input){var e=8*(this.$input.val().length+1);e+=this.options.autoSizeAdj||0,this.$input.width(e)}return this.isFancy&&(this.$container=this.$(".fi-container")),this},postRender:function(){n.prototype.postRender.call(this),this.isFancy&&(this._fancyToggleBlurred(!0),this._fancyToggleContent())},setSelected:function(e,t){this.selected!=e&&(this.selected=e,t&&this.trigger("changed",{name:this.name,value:e,menu:this})),this.rendered&&this.render()},addItem:function(e){this.items.push(e),this.rendered&&this.render()},clearItems:function(){this.items=[]},setItems:function(e){this.items=e,this.rendered&&this.render()},setValid:function(e,t,n){this.valid=e,this.valid?this.errorMsg="":this.errorMsg=t,n||this.render()},show:function(e){Backbone.trigger("app:click",e),this.$(".select-menu").removeClass("closed"),this.isExclusive&&this.$("ul").find('[data-value="'+this.selected+'"]').hide(),this._setValueScroll(),this._checkAutoFlip()},_checkAutoFlip:function(){var e=this.$(".select-menu");if(this.autoFlipMenu){var t=this.$(".sm-list")[0].getBoundingClientRect().height,n=e[0].getBoundingClientRect().bottom+t;e.toggleClass("sm-inverse-menu",n>window.innerHeight)}},hide:function(e){this.$(".select-menu").addClass("closed")},changeItemName:function(t,n){var i=e.findWhere(this.items,{value:t});i&&i.name!=n&&(i.name=n,this.render())},getSelectedName:function(){var e=this.getSelectedObject();return e?e.name:null},getSelectedObject:function(){return this.selected?e.findWhere(this.items,{value:this.selected}):null},itemValueExists:function(t){return e.findWhere(this.items,{value:t})},getValue:function(){return this.selected},getName:function(){return this.name},isValid:function(){return this.valid},_onInputClick:function(e){e.stopPropagation(),e.preventDefault(),this.disabled||(this._isClosed()?this.show(e):this.hide(e),this.isFancy&&this._fancyToggleBlurred(!1))},_isClosed:function(){return this.$(".select-menu").is(".closed")},_onInputFocus:function(){this.$shim.focus()},_onAutoInput:function(e){e.preventDefault(),e.stopPropagation();var t=e.target.value,n=this.itemValueExists(parseFloat(t)||t);n&&this.setSelected(n.value)},_onShimFocus:function(){this.isFancy&&this._fancyToggleBlurred(!1)},_onShimBlur:function(){this.isFancy&&this._fancyToggleBlurred(!0)},_onSelect:function(e){e.stopPropagation(),e.preventDefault();var t=$(e.currentTarget),n=t.data("value"),i=this.selected;this.selected!=n&&(this.noSelect||t.data("noSelect")||(this.selected=n),this.trigger("changed",{name:this.name,value:n,previousValue:i,menu:this})),this.noSelect||t.data("noSelect")||this.render(),this.autoClose&&this.hide(),this.$shim.focus()},_onBodyClick:function(e){(this._useCapture?$(e.target).closest("."+this.className).is(this.$el):this.$el.is(e.delegateTarget))||this.hide()},_setValueScroll:function(){var e=this.$("ul");if(0==e.scrollTop()&&this.selected&&this.valueScroll){var t=this.$("ul").find('[data-value="'+this.selected+'"]');if(this.isExclusive){var n=this.$("a:visible"),i=n.index(t);i<n.length-1?i++:i--,t=n.eq(i)}e.scrollTop(e.scrollTop()+t.position().top)}},_onKeyPress:function(e){if((-1!==[13,9,38,40,27,32].indexOf(e.keyCode)||t.isAlphaNumeric(e))&&(9!=e.keyCode||!this.$shim.is(":focus"))){(38===e.keyCode||40===e.keyCode||t.isAlphaNumeric(e))&&this.$("ul").is(":hidden")&&this._onInputClick(e);var n=this.isExclusive?this.$("a:visible"):this.$("a"),i=n.filter(":focus"),r=n.index(i);this.$("input").focus();var s=t.isAlphaNumeric(e);if(s||this._searchTerm&&32==e.keyCode?this._setSearchTerm(t.getLowerChar(e)):this._clearSearchTerm(),13==e.keyCode||9==e.keyCode||32==e.keyCode&&!$.trim(this._searchTerm))return 13===e.keyCode&&(e.stopPropagation(),!this._isClosed()&&e.preventDefault()),32==e.keyCode&&e.preventDefault(),i.trigger("click"),void this.hide();if(27==e.keyCode)return this.hide(),void this.$("input").focus();e.preventDefault(),e.stopPropagation(),38==e.keyCode&&r>0?r--:40==e.keyCode&&r<n.length-1?r++:s&&(r=this._getNextIndexStartingWith(this._searchTerm,n,r)),r=r<0?0:r,n.eq(r).focus()}},_getNextIndexStartingWith:function(e,t,n){var i=0,r=this._elementStartsWith(e,t[n]);for(r&&(i=e.length>1?n:n+1);i<t.length;i++)if(this._elementStartsWith(e,t[i]))return i;return 1==e.length&&r&&0!=n?this._getNextIndexStartingWith(e,t,0):n},_elementStartsWith:function(e,t){return 0===this._getNameFromElement(t).indexOf(e)},_getNameFromElement:function(e){return $(e).text().toLowerCase()},_setSearchTerm:function(e){var t=(new Date).getTime();(t-this._searchTermUpdated>400||e==this._searchTerm)&&this._clearSearchTerm(),this._searchTerm+=e,this._searchTermUpdated=t},_clearSearchTerm:function(){this._searchTerm=""},_fancyToggleContent:function(){this.$container.toggleClass("fi-has-content",!!this.getValue())},_fancyToggleBlurred:function(e){this.$container.toggleClass("fi-blurred",!!e&&this._isClosed())},setEnabled:function(e){this.disabled=!e,this.render()}})}),define("email",[],function(){return{isEmail:function(e){return/^([a-zA-Z0-9_.\'+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})+$/.test(e)}}}),define("fslib/company_sizes",{COMPANY_SIZES:[{name:"1 - 5",value:"1 - 5"},{name:"6 - 10",value:"6 - 10"},{name:"11 - 50",value:"11 - 50"},{name:"51 - 99",value:"51 - 99"},{name:"100 - 499",value:"100 - 499"},{name:"500 - 750",value:"500 - 750"},{name:"751 - 1,000",value:"751 - 1,000"},{name:"1,001 - 10,000",value:"1,001 - 10,000"},{name:"10,001+",value:"10,001+"}]}),define("form_verify",[],function(){return{checkRequired:function(e,t){this.removeRequired(e);var n=this;$(e+" .required").each(function(){"waitlist-area-code"===$(this).attr("id")&&$(this).val()<99&&$(this).val()>1e3?n.flag(this):$(this).val()?t&&("company-size"!==$(this).attr("id")||"Company size*"!==$(this).val()&&"COMPANY SIZE"!==$(this).val()||n.flag(this)):n.flag(this)})},flag:function(e){$(e).addClass("required-flagged"),$(e).closest("div").addClass("show-label").addClass("error-label")},removeRequired:function(e){$(e+" .required").removeClass("required-flagged"),$(e+" .required").closest("div").removeClass("show-label").removeClass("error-label")}}}),define("text",["module"],function(e){"use strict";var t,n,i,r,s,o=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],a=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,c=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,l="undefined"!=typeof location&&location.href,u=l&&location.protocol&&location.protocol.replace(/\:/,""),h=l&&location.hostname,d=l&&(location.port||void 0),f={},p=e.config&&e.config()||{};return t={version:"2.0.14",strip:function(e){if(e){var t=(e=e.replace(a,"")).match(c);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:p.createXhr||function(){var e,t,n;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;t<3;t+=1){n=o[t];try{e=new ActiveXObject(n)}catch(e){}if(e){o=[n];break}}return e},parseName:function(e){var t,n,i,r=!1,s=e.lastIndexOf("."),o=0===e.indexOf("./")||0===e.indexOf("../");return-1!==s&&(!o||s>1)?(t=e.substring(0,s),n=e.substring(s+1)):t=e,-1!==(s=(i=n||t).indexOf("!"))&&(r="strip"===i.substring(s+1),i=i.substring(0,s),n?n=i:t=i),{moduleName:t,ext:n,strip:r}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,i,r){var s,o,a,c=t.xdRegExp.exec(e);return!c||(s=c[2],a=(o=(o=c[3]).split(":"))[1],o=o[0],!(s&&s!==n||o&&o.toLowerCase()!==i.toLowerCase()||(a||o)&&a!==r))},finishLoad:function(e,n,i,r){i=n?t.strip(i):i,p.isBuild&&(f[e]=i),r(i)},load:function(e,n,i,r){if(r&&r.isBuild&&!r.inlineText)i();else{p.isBuild=r&&r.isBuild;var s=t.parseName(e),o=s.moduleName+(s.ext?"."+s.ext:""),a=n.toUrl(o),c=p.useXhr||t.useXhr;0!==a.indexOf("empty:")?!l||c(a,u,h,d)?t.get(a,function(n){t.finishLoad(e,s.strip,n,i)},function(e){i.error&&i.error(e)}):n([o],function(e){t.finishLoad(s.moduleName+"."+s.ext,s.strip,e,i)}):i()}},write:function(e,n,i,r){if(f.hasOwnProperty(n)){var s=t.jsEscape(f[n]);i.asModule(e+"!"+n,"define(function () { return '"+s+"';});\n")}},writeFile:function(e,n,i,r,s){var o=t.parseName(n),a=o.ext?"."+o.ext:"",c=o.moduleName+a,l=i.toUrl(o.moduleName+a)+".js";t.load(c,i,function(n){var i=function(e){return r(l,e)};i.asModule=function(e,t){return r.asModule(e,l,t)},t.write(e,c,i,s)},s)}},"node"===p.env||!p.env&&"undefined"!=typeof process&&process.versions&&process.versions.node&&!process.versions["node-webkit"]&&!process.versions["atom-shell"]?(n=require.nodeRequire("fs"),t.get=function(e,t,i){try{var r=n.readFileSync(e,"utf8");"\ufeff"===r[0]&&(r=r.substring(1)),t(r)}catch(e){i&&i(e)}}):"xhr"===p.env||!p.env&&t.createXhr()?t.get=function(e,n,i,r){var s,o=t.createXhr();if(o.open("GET",e,!0),r)for(s in r)r.hasOwnProperty(s)&&o.setRequestHeader(s.toLowerCase(),r[s]);p.onXhr&&p.onXhr(o,e),o.onreadystatechange=function(t){var r,s;4===o.readyState&&((r=o.status||0)>399&&r<600?((s=new Error(e+" HTTP status: "+r)).xhr=o,i&&i(s)):n(o.responseText),p.onXhrComplete&&p.onXhrComplete(o,e))},o.send(null)}:"rhino"===p.env||!p.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java?t.get=function(e,t){var n,i,r=new java.io.File(e),s=java.lang.System.getProperty("line.separator"),o=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(r),"utf-8")),a="";try{for(n=new java.lang.StringBuffer,(i=o.readLine())&&i.length()&&65279===i.charAt(0)&&(i=i.substring(1)),null!==i&&n.append(i);null!==(i=o.readLine());)n.append(s),n.append(i);a=String(n.toString())}finally{o.close()}t(a)}:("xpconnect"===p.env||!p.env&&"undefined"!=typeof Components&&Components.classes&&Components.interfaces)&&(i=Components.classes,r=Components.interfaces,Components.utils.import("resource://gre/modules/FileUtils.jsm"),s="@mozilla.org/windows-registry-key;1"in i,t.get=function(e,t){var n,o,a,c={};s&&(e=e.replace(/\//g,"\\")),a=new FileUtils.File(e);try{(n=i["@mozilla.org/network/file-input-stream;1"].createInstance(r.nsIFileInputStream)).init(a,1,0,!1),(o=i["@mozilla.org/intl/converter-input-stream;1"].createInstance(r.nsIConverterInputStream)).init(n,"utf-8",n.available(),r.nsIConverterInputStream.DEFAULT_REPLACEMENT_CHARACTER),o.readString(n.available(),c),o.close(),n.close(),t(c.value)}catch(e){throw new Error((a&&a.path||"")+": "+e)}}),t}),define("text!fslib/all_countries.json",[],function(){return'{"countries": {\n  "US": {"name":"United States", "value":"United_States"},\n  "AF": {"name":"Afghanistan", "value":"Afghanistan"},\n  "AL": {"name":"Albania", "value":"Albania"},\n  "DZ": {"name":"Algeria", "value":"Algeria"},\n  "AD": {"name":"Andorra", "value":"Andorra"},\n  "AO": {"name":"Angola", "value":"Angola"},\n  "AI": {"name":"Anguilla", "value":"Anguilla"},\n  "AQ": {"name":"Antarctica", "value":"Antarctica"},\n  "AG": {"name":"Antigua and Barbuda", "value":"Antigua_Barbuda"},\n  "AR": {"name":"Argentina", "value":"Argentina"},\n  "AM": {"name":"Armenia", "value":"Armenia"},\n  "AW": {"name":"Aruba", "value":"Aruba"},\n  "AU": {"name":"Australia", "value":"Australia"},\n  "AT": {"name":"Austria", "value":"Austria"},\n  "AZ": {"name":"Azerbaijan", "value":"Azerbaijan"},\n  "BS": {"name":"Bahamas", "value":"Bahamas"},\n  "BH": {"name":"Bahrain", "value":"Bahrain"},\n  "BD": {"name":"Bangladesh", "value":"Bangladesh"},\n  "BB": {"name":"Barbados", "value":"Barbados"},\n  "BY": {"name":"Belarus", "value":"Belarus"},\n  "BE": {"name":"Belgium", "value":"Belgium"},\n  "BZ": {"name":"Belize", "value":"Belize"},\n  "BJ": {"name":"Benin", "value":"Benin"},\n  "BM": {"name":"Bermuda", "value":"Bermuda"},\n  "BT": {"name":"Bhutan", "value":"Bhutan"},\n  "BO": {"name":"Bolivia", "value":"Bolivia"},\n  "BQ": {"name":"Bonaire", "value":"Bonaire"},\n  "BA": {"name":"Bosnia and Herzegovina", "value":"Bosnia_Herzegovina"},\n  "BW": {"name":"Botswana", "value":"Botswana"},\n  "BV": {"name":"Bouvet Island", "value":"BouvetIsland"},\n  "BR": {"name":"Brazil", "value":"Brazil"},\n  "BN": {"name":"Brunei", "value":"Brunei"},\n  "BG": {"name":"Bulgaria", "value":"Bulgaria"},\n  "BF": {"name":"Burkina Faso", "value":"BurkinaFaso"},\n  "MM": {"name":"Burma", "value":"Burma"},\n  "BI": {"name":"Burundi", "value":"Burundi"},\n  "CV": {"name":"Cabo Verde", "value":"CaboVerde"},\n  "KH": {"name":"Cambodia", "value":"Cambodia"},\n  "CM": {"name":"Cameroon", "value":"Cameroon"},\n  "CA": {"name":"Canada", "value":"Canada"},\n  "CF": {"name":"Central African Republic", "value":"CentralAfricanRepublic"},\n  "TD": {"name":"Chad", "value":"Chad"},\n  "CL": {"name":"Chile", "value":"Chile"},\n  "CN": {"name":"China", "value":"China"},\n  "CO": {"name":"Colombia", "value":"Colombia"},\n  "KM": {"name":"Comoros", "value":"Comoros"},\n  "CD": {"name":"Congo, Democratic Republic of the", "value":"Congo_DemocraticRepublic"},\n  "CG": {"name":"Congo, Republic of the", "value":"Congo_Republic"},\n  "CK": {"name":"Cook Islands", "value":"CookIslands"},\n  "CR": {"name":"Costa Rica", "value":"CostaRica"},\n  "HR": {"name":"Croatia", "value":"Croatia"},\n  "CU": {"name":"Cuba", "value":"Cuba"},\n  "CY": {"name":"Cyprus", "value":"Cyprus"},\n  "CZ": {"name":"Czech Republic", "value":"CzechRepublic"},\n  "DK": {"name":"Denmark", "value":"Denmark"},\n  "DJ": {"name":"Djibouti", "value":"Djibouti"},\n  "DM": {"name":"Dominica", "value":"Dominica"},\n  "DO": {"name":"Dominican Republic", "value":"DominicanRepublic"},\n  "EC": {"name":"Ecuador", "value":"Ecuador"},\n  "EG": {"name":"Egypt", "value":"Egypt"},\n  "SV": {"name":"El Salvador", "value":"ElSalvador"},\n  "GQ": {"name":"Equatorial Guinea", "value":"EquatorialGuinea"},\n  "ER": {"name":"Eritrea", "value":"Eritrea"},\n  "EW": {"name":"Estonia", "value":"Estonia"},\n  "ET": {"name":"Ethiopia", "value":"Ethiopia"},\n  "FJ": {"name":"Fiji", "value":"Fiji"},\n  "FI": {"name":"Finland", "value":"Finland"},\n  "FR": {"name":"France", "value":"France"},\n  "GA": {"name":"Gabon", "value":"Gabon"},\n  "GM": {"name":"Gambia", "value":"Gambia"},\n  "GE": {"name":"Georgia", "value":"Georgia"},\n  "DE": {"name":"Germany", "value":"Germany"},\n  "GH": {"name":"Ghana", "value":"Ghana"},\n  "GI": {"name":"Gibraltar", "value":"Gibraltar"},\n  "GR": {"name":"Greece", "value":"Greece"},\n  "GL": {"name":"Greenland", "value":"Greenland"},\n  "GD": {"name":"Grenada", "value":"Grenada"},\n  "GT": {"name":"Guatemala", "value":"Guatemala"},\n  "GN": {"name":"Guinea", "value":"Guinea"},\n  "GW": {"name":"Guinea-Bissau", "value":"Guinea-Bissau"},\n  "GY": {"name":"Guyana", "value":"Guyana"},\n  "HT": {"name":"Haiti", "value":"Haiti"},\n  "HN": {"name":"Honduras", "value":"Honduras"},\n  "HU": {"name":"Hungary", "value":"Hungary"},\n  "IS": {"name":"Iceland", "value":"Iceland"},\n  "IN": {"name":"India", "value":"India"},\n  "ID": {"name":"Indonesia", "value":"Indonesia"},\n  "IR": {"name":"Iran", "value":"Iran"},\n  "IQ": {"name":"Iraq", "value":"Iraq"},\n  "IE": {"name":"Ireland", "value":"Ireland"},\n  "IL": {"name":"Israel", "value":"Israel"},\n  "IT": {"name":"Italy", "value":"Italy"},\n  "JM": {"name":"Jamaica", "value":"Jamaica"},\n  "JP": {"name":"Japan", "value":"Japan"},\n  "JO": {"name":"Jordan", "value":"Jordan"},\n  "KZ": {"name":"Kazakhstan", "value":"Kazakhstan"},\n  "KE": {"name":"Kenya", "value":"Kenya"},\n  "KI": {"name":"Kiribati", "value":"Kiribati"},\n  "XK": {"name":"Kosovo", "value":"Kosovo"},\n  "KW": {"name":"Kuwait", "value":"Kuwait"},\n  "KG": {"name":"Kyrgyzstan", "value":"Kyrgyzstan"},\n  "LA": {"name":"Laos", "value":"Laos"},\n  "LV": {"name":"Latvia", "value":"Latvia"},\n  "LB": {"name":"Lebanon", "value":"Lebanon"},\n  "LS": {"name":"Lesotho", "value":"Lesotho"},\n  "LR": {"name":"Liberia", "value":"Liberia"},\n  "LY": {"name":"Libya", "value":"Libya"},\n  "LI": {"name":"Liechtenstein", "value":"Liechtenstein"},\n  "LT": {"name":"Lithuania", "value":"Lithuania"},\n  "LU": {"name":"Luxembourg", "value":"Luxembourg"},\n  "MK": {"name":"Macedonia", "value":"Macedonia"},\n  "MG": {"name":"Madagascar", "value":"Madagascar"},\n  "MW": {"name":"Malawi", "value":"Malawi"},\n  "MY": {"name":"Malaysia", "value":"Malaysia"},\n  "MV": {"name":"Maldives", "value":"Maldives"},\n  "ML": {"name":"Mali", "value":"Mali"},\n  "MT": {"name":"Malta", "value":"Malta"},\n  "MH": {"name":"Marshall Islands", "value":"MarshallIslands"},\n  "MR": {"name":"Mauritania", "value":"Mauritania"},\n  "MU": {"name":"Mauritius", "value":"Mauritius"},\n  "MX": {"name":"Mexico", "value":"Mexico"},\n  "FM": {"name":"Micronesia, Federated States of", "value":"Micronesia_FederatedStates"},\n  "MD": {"name":"Moldova", "value":"Moldova"},\n  "MC": {"name":"Monaco", "value":"Monaco"},\n  "MN": {"name":"Mongolia", "value":"Mongolia"},\n  "ME": {"name":"Montenegro", "value":"Montenegro"},\n  "MA": {"name":"Morocco", "value":"Morocco"},\n  "MZ": {"name":"Mozambique", "value":"Mozambique"},\n  "NA": {"name":"Namibia", "value":"Namibia"},\n  "NR": {"name":"Nauru", "value":"Nauru"},\n  "NP": {"name":"Nepal", "value":"Nepal"},\n  "NL": {"name":"Netherlands", "value":"Netherlands"},\n  "NZ": {"name":"New Zealand", "value":"NewZealand"},\n  "NI": {"name":"Nicaragua", "value":"Nicaragua"},\n  "NE": {"name":"Niger", "value":"Niger"},\n  "NG": {"name":"Nigeria", "value":"Nigeria"},\n  "NU": {"name":"Niue", "value":"Niue"},\n  "KP": {"name":"North Korea", "value":"NorthKorea"},\n  "NO": {"name":"Norway", "value":"Norway"},\n  "OM": {"name":"Oman", "value":"Oman"},\n  "PK": {"name":"Pakistan", "value":"Pakistan"},\n  "PW": {"name":"Palau", "value":"Palau"},\n  "PS": {"name":"Palestine", "value":"Palestine"},\n  "PA": {"name":"Panama", "value":"Panama"},\n  "PG": {"name":"Papua New Guinea", "value":"PapuaNewGuinea"},\n  "PY": {"name":"Paraguay", "value":"Paraguay"},\n  "PE": {"name":"Peru", "value":"Peru"},\n  "PH": {"name":"Philippines", "value":"Philippines"},\n  "PL": {"name":"Poland", "value":"Poland"},\n  "PT": {"name":"Portugal", "value":"Portugal"},\n  "QA": {"name":"Qatar", "value":"Qatar"},\n  "RO": {"name":"Romania", "value":"Romania"},\n  "RU": {"name":"Russia", "value":"Russia"},\n  "RW": {"name":"Rwanda", "value":"Rwanda"},\n  "BL": {"name":"Saint Barthelemy", "value":"SaintBarthelemy"},\n  "KN": {"name":"Saint Kitts and Nevis", "value":"SaintKitts_Nevis"},\n  "LC": {"name":"Saint Lucia", "value":"SaintLucia"},\n  "MF": {"name":"Saint Martin", "value":"SaintMartin"},\n  "VC": {"name":"Saint Vincent and the Grenadines", "value":"SaintVincent_Grenadines"},\n  "AS": {"name":"Samoa", "value":"Samoa"},\n  "SM": {"name":"San Marino", "value":"SanMarino"},\n  "ST": {"name":"São Tomé and Príncipe", "value":"SãoTomé_Príncipe"},\n  "SA": {"name":"Saudi Arabia", "value":"SaudiArabia"},\n  "SN": {"name":"Senegal", "value":"Senegal"},\n  "RS": {"name":"Serbia", "value":"Serbia"},\n  "SC": {"name":"Seychelles", "value":"Seychelles"},\n  "SL": {"name":"Sierra Leone", "value":"SierraLeone"},\n  "SG": {"name":"Singapore", "value":"Singapore"},\n  "SK": {"name":"Slovakia", "value":"Slovakia"},\n  "SI": {"name":"Slovenia", "value":"Slovenia"},\n  "SB": {"name":"Solomon Islands", "value":"SolomonIslands"},\n  "SO": {"name":"Somalia", "value":"Somalia"},\n  "ZA": {"name":"South Africa", "value":"SouthAfrica"},\n  "KR": {"name":"South Korea", "value":"SouthKorea"},\n  "SS": {"name":"South Sudan", "value":"SouthSudan"},\n  "ES": {"name":"Spain", "value":"Spain"},\n  "LK": {"name":"Sri Lanka", "value":"SriLanka"},\n  "SD": {"name":"Sudan", "value":"Sudan"},\n  "SU": {"name":"Suriname", "value":"Suriname"},\n  "SZ": {"name":"Swaziland", "value":"Swaziland"},\n  "SE": {"name":"Sweden", "value":"Sweden"},\n  "CH": {"name":"Switzerland", "value":"Switzerland"},\n  "SY": {"name":"Syria", "value":"Syria"},\n  "TW": {"name":"Taiwan", "value":"Taiwan"},\n  "TJ": {"name":"Tajikistan", "value":"Tajikistan"},\n  "TZ": {"name":"Tanzania", "value":"Tanzania"},\n  "TH": {"name":"Thailand", "value":"Thailand"},\n  "TL": {"name":"Timor-Leste", "value":"Timor-Leste"},\n  "TG": {"name":"Togo", "value":"Togo"},\n  "TO": {"name":"Tonga", "value":"Tonga"},\n  "TT": {"name":"Trinidad and Tobago", "value":"Trinidad_Tobago"},\n  "TN": {"name":"Tunisia", "value":"Tunisia"},\n  "TR": {"name":"Turkey", "value":"Turkey"},\n  "TM": {"name":"Turkmenistan", "value":"Turkmenistan"},\n  "TV": {"name":"Tuvalu", "value":"Tuvalu"},\n  "UG": {"name":"Uganda", "value":"Uganda"},\n  "UA": {"name":"Ukraine", "value":"Ukraine"},\n  "AE": {"name":"United Arab Emirates", "value":"UnitedArabEmirates"},\n  "UK": {"name":"United Kingdom", "value":"UnitedKingdom"},\n  "UY": {"name":"Uruguay", "value":"Uruguay"},\n  "UZ": {"name":"Uzbekistan", "value":"Uzbekistan"},\n  "VU": {"name":"Vanuatu", "value":"Vanuatu"},\n  "VA": {"name":"Vatican City", "value":"VaticanCity"},\n  "VE": {"name":"Venezuela", "value":"Venezuela"},\n  "VN": {"name":"Vietnam", "value":"Vietnam"},\n  "EH": {"name":"Western Sahara", "value":"WesternSahara"},\n  "YE": {"name":"Yemen", "value":"Yemen"},\n  "ZM": {"name":"Zambia", "value":"Zambia"},\n  "ZW": {"name":"Zimbabwe", "value":"Zimbabwe"}\n}}\n'}),define("text!fslib/all_states.json",[],function(){return'{"states": {\n  "AL": {"name":"Alabama", "value":"AL"},\n  "AK": {"name":"Alaska", "value":"AK"},\n  "AZ": {"name":"Arizona", "value":"AZ"},\n  "AR": {"name":"Arkansas", "value":"AR"},\n  "CA": {"name":"California", "value":"CA"},\n  "CO": {"name":"Colorado", "value":"CO"},\n  "CT": {"name":"Connecticut", "value":"CT"},\n  "DE": {"name":"Delaware", "value":"DE"},\n  "DC": {"name":"District of Columbia", "value":"DC"},\n  "FL": {"name":"Florida", "value":"FL"},\n  "GA": {"name":"Georgia", "value":"GA"},\n  "HI": {"name":"Hawaii", "value":"HI"},\n  "ID": {"name":"Idaho", "value":"ID"},\n  "IL": {"name":"Illinois", "value":"IL"},\n  "IN": {"name":"Indiana", "value":"IN"},\n  "IA": {"name":"Iowa", "value":"IA"},\n  "KS": {"name":"Kansas", "value":"KS"},\n  "KY": {"name":"Kentucky", "value":"KY"},\n  "LA": {"name":"Louisiana", "value":"LA"},\n  "ME": {"name":"Maine", "value":"ME"},\n  "MD": {"name":"Maryland", "value":"MD"},\n  "MA": {"name":"Massachusetts", "value":"MA"},\n  "MI": {"name":"Michigan", "value":"MI"},\n  "MN": {"name":"Minnesota", "value":"MN"},\n  "MS": {"name":"Mississippi", "value":"MS"},\n  "MO": {"name":"Missouri", "value":"MO"},\n  "MT": {"name":"Montana", "value":"MT"},\n  "NE": {"name":"Nebraska", "value":"NE"},\n  "NV": {"name":"Nevada", "value":"NV"},\n  "NH": {"name":"New Hampshire", "value":"NH"},\n  "NJ": {"name":"New Jersey", "value":"NJ"},\n  "NM": {"name":"New Mexico", "value":"NM"},\n  "NY": {"name":"New York", "value":"NY"},\n  "NC": {"name":"North Carolina", "value":"NC"},\n  "ND": {"name":"North Dakota", "value":"ND"},\n  "OH": {"name":"Ohio", "value":"OH"},\n  "OK": {"name":"Oklahoma", "value":"OK"},\n  "OR": {"name":"Oregon", "value":"OR"},\n  "PA": {"name":"Pennsylvania", "value":"PA"},\n  "RI": {"name":"Rhode Island", "value":"RI"},\n  "SC": {"name":"South Carolina", "value":"SC"},\n  "SD": {"name":"South Dakota", "value":"SD"},\n  "TN": {"name":"Tennessee", "value":"TN"},\n  "TX": {"name":"Texas", "value":"TX"},\n  "UT": {"name":"Utah", "value":"UT"},\n  "VT": {"name":"Vermont", "value":"VT"},\n  "VA": {"name":"Virginia", "value":"VA"},\n  "WA": {"name":"Washington", "value":"WA"},\n  "WV": {"name":"West Virginia", "value":"WV"},\n  "WI": {"name":"Wisconsin", "value":"WI"},\n  "WY": {"name":"Wyoming", "value":"WY"}\n}}\n'}),define("hbs!guest/templates/contact_dialog_form",["handlebars"],function(e){return e.template(function(e,t,n,i,r){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=r||{},'<div class="dialog-top"><div id="dialog-close">&times;</div></div>\n<h4>Interested in Dialpad for your business?<br>Get in touch with our team.</h4>\n<p>Complete this form and we will get back to you as soon as we can.</p>\n<form id="signup-form" class="form form-1" method="post">\n  <input type="hidden" id="source" name="source" value="contact-sales">\n  <input type="text" id="first_name" name="first_name" value="" placeholder="FIRST NAME" title="first_name" class="iblock required" required aria-required="true">\n  <input type="text" id="last_name" name="last_name" value="" placeholder="LAST NAME" title="last_name" class="iblock required" required aria-required="true">\n  <input type="text" id="company" name="company" value="" placeholder="COMPANY" title="Company" class="required" required aria-required="true">\n  <div id="co-size"></div>\n  <input type="email" id="email" name="email" value="" placeholder="EMAIL" title="Email" class="required" required aria-required="true">\n  <input type="tel" id="phone" name="phone" value="" placeholder="PHONE" title="Phone" class="required" required aria-required="true">\n  <div id="contact-country" class="iblock float simple-trans"></div>\n  <div id="contact-state" class="iblock float simple-trans"></div>\n  <textarea id="notes" name="notes" value="" title="Telephony needs" placeholder="TELL US MORE ABOUT YOUR COMPANY\'S TELEPHONY NEEDS"></textarea>\n  <div id="signup-btn" class="btn s-btn-inv">Submit</div>\n</form>'})}),define("guest/views/contact_dialog_form_view",["views/common/view","views/common/select_menu_view","email","fslib/company_sizes","form_verify","text!fslib/all_countries.json","text!fslib/all_states.json","hbs!guest/templates/contact_dialog_form","marketo"],function(e,t,n,i,r,s,o,a,c){return e.extend({template:a,events:{"click #signup-btn":"_formSubmit","click #dialog-close":"_close"},initialize:function(t){e.prototype.initialize.call(this),t.pricingPlanClick&&(this.pricingPlanClick=t.pricingPlanClick),this._createMenu(),this.listenTo(this._contactCountryMenu,"changed",this._checkCountry),this.listenTo(this._contactStateMenu,"changed",this._setUSstate)},_createMenu:function(){this._coSizeMenu=new t({name:"company-size",items:i.COMPANY_SIZES,unselected:"COMPANY SIZE"}),this.addChild(this._coSizeMenu,"#co-size");var e=JSON.parse(s);this._contactCountryMenu=new t({name:"contact-selected-country",items:e.countries,unselected:"COUNTRY"}),this.addChild(this._contactCountryMenu,"#contact-country");var n=JSON.parse(o);this._contactStateMenu=new t({name:"contact-selected-state",items:n.states,unselected:"STATE"}),this.addChild(this._contactStateMenu,"#contact-state")},_checkCountry:function(e){"United_States"===e.value?this._stateMenuDisplay(!0):this._stateMenuDisplay(!1)},_stateMenuDisplay:function(e){e?$("#contact-country, #contact-state").addClass("in-us"):$("#contact-country, #contact-state").removeClass("in-us")},_setUSstate:function(e){$("#contact-state").data("stateAbbr",e.value)},_dataLayerPush:function(e,t,n){dataLayer.push({event:"inbound_message",type:"overlay",company:e,company_size:t,user_email:n})},_formSubmit:function(){var e=$("#email").val(),t=$("#first_name").val(),i=$("#last_name").val(),s=$("#phone").val(),o=$("#company").val(),a=$("#notes").val();this.pricingPlanClick&&(a=a+" Submitted from pricing page. Clicked on "+this.pricingPlanClick);var l=$("#company-size").val(),u=l===this._coSizeMenu.unselected,h=$("#contact-selected-country").val(),d=h===this._contactCountryMenu.unselected,f=$("#contact-state").data("stateAbbr");if($("#contact-dialog #company-size, #contact-dialog #contact-selected-country").addClass("required"),n.isEmail(e)&&t&&i&&s&&o&&!u&&!d){$("#signup_form :input, #co-size, #signup-btn").prop("disabled",!0),r.removeRequired("#contact-dialog");var p=_.bind(function(){this.trigger("next"),window.scrollTo(0,0),this._dataLayerPush(o,l,e)},this);if("undefined"!=typeof MktoForms2){var g={FirstName:t,LastName:i,Email:e,Phone:s,size_of_team__c:l,Company:o,Country:h,State:f,Reason_for_Switch__c:a};c.submit(1093,g)}else console.log("Marketo Forms not available. Not sending any data");return p(),!1}r.checkRequired("#contact-dialog",!0),"COUNTRY"===$("#contact-selected-country").val()&&$("#contact-selected-country").addClass("required-flagged")},_close:function(){Backbone.trigger("overlay")}})}),define("hbs!guest/templates/contact_dialog_confirm",["handlebars"],function(e){return e.template(function(e,t,n,i,r){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=r||{},'<div class="dialog-top">\n  <div id="dialog-close">&times;</div>\n</div>\n\n<h4 class="contact-confirm text-center">\n  <span>&#10003;</span>\n  Thank you for contacting Dialpad!<br>We will reach out soon\n</h4>\n'})}),define("guest/views/contact_dialog_confirm_view",["views/common/view","hbs!guest/templates/contact_dialog_confirm"],function(e,t){return e.extend({template:t,events:{"click #dialog-close":"_close"},initialize:function(){e.prototype.initialize.call(this)},_close:function(){Backbone.trigger("overlay")}})}),define("phone",[],function(){return{isPhone:function(e){return/^[0-9-+s()]*$/.test(e)}}}),define("text!fslib/jp_prefectures.json",[],function(){return'{"prefectures": {\n  "北海道": {"value":"Hokkaido", "name":"北海道"},\n  "青森県": {"value":"Aomori", "name":"青森県"},\n  "岩手県": {"value":"Iwate", "name":"岩手県"},\n  "宮城県": {"value":"Miyagi", "name":"宮城県"},\n  "秋田県": {"value":"Akita", "name":"秋田県"},\n  "山形県": {"value":"Yamagata", "name":"山形県"},\n  "福島県": {"value":"Fukushima", "name":"福島県"},\n  "茨城県": {"value":"Ibaraki", "name":"茨城県"},\n  "栃木県": {"value":"Tochigi", "name":"栃木県"},\n  "群馬県": {"value":"Gunma", "name":"群馬県"},\n  "埼玉県": {"value":"Saitama", "name":"埼玉県"},\n  "千葉県": {"value":"Chiba", "name":"千葉県"},\n  "東京都": {"value":"Tokyo", "name":"東京都"},\n  "神奈川県": {"value":"Kanagawa", "name":"神奈川県"},\n  "新潟県": {"value":"Niigata", "name":"新潟県"},\n  "富山県": {"value":"Toyama", "name":"富山県"},\n  "石川県": {"value":"Ishikawa", "name":"石川県"},\n  "福井県": {"value":"Fukui", "name":"福井県"},\n  "山梨県": {"value":"Yamanashi", "name":"山梨県"},\n  "長野県": {"value":"Nagano", "name":"長野県"},\n  "岐阜県": {"value":"Gifu", "name":"岐阜県"},\n  "静岡県": {"value":"Shizuoka", "name":"静岡県"},\n  "愛知県": {"value":"Aichi", "name":"愛知県"},\n  "三重県": {"value":"Mie", "name":"三重県"},\n  "滋賀県": {"value":"Shiga", "name":"滋賀県"},\n  "京都府": {"value":"Kyoto", "name":"京都府"},\n  "大阪府": {"value":"Osaka", "name":"大阪府"},\n  "兵庫県": {"value":"Hyōgo", "name":"兵庫県"},\n  "奈良県": {"value":"Nara", "name":"奈良県"},\n  "和歌山県": {"value":"Wakayama", "name":"和歌山県"},\n  "鳥取県": {"value":"Tottori", "name":"鳥取県"},\n  "島根県": {"value":"Shimane", "name":"島根県"},\n  "岡山県": {"value":"Okayama", "name":"岡山県"},\n  "広島県": {"value":"Hiroshima", "name":"広島県"},\n  "山口県": {"value":"Yamaguchi", "name":"山口県"},\n  "徳島県": {"value":"Tokushima", "name":"徳島県"},\n  "香川県": {"value":"Kagawa", "name":"香川県"},\n  "愛媛県": {"value":"Ehime", "name":"愛媛県"},\n  "高知県": {"value":"Kōchi", "name":"高知県"},\n  "福岡県": {"value":"Fukuoka", "name":"福岡県"},\n  "佐賀県": {"value":"Saga", "name":"佐賀県"},\n  "長崎県": {"value":"Nagasaki", "name":"長崎県"},\n  "熊本県": {"value":"Kumamoto", "name":"熊本県"},\n  "大分県": {"value":"Ōita", "name":"大分県"},\n  "宮崎県": {"value":"Miyazaki", "name":"宮崎県"},\n  "鹿児島県": {"value":"Kagoshima", "name":"鹿児島県"},\n  "沖縄県": {"value":"Okinawa", "name":"沖縄県"}\n}}\n'}),define("hbs!guest/templates/lang/ja-jp/contact_dialog_form",["handlebars"],function(e){return e.template(function(e,t,n,i,r){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=r||{},'<div class="dialog-top"><div id="dialog-close">&times;</div></div>\n<h4>Dialpadに関心をお持ちですか？是非、以下フォームよりお問い合わせください。担当者よりご連絡いたします。</h4>\n<br><br>\n<form id="signup-form" class="form form-1" method="post">\n  <input type="hidden" id="source" name="source" value="contact-sales">\n  <input type="text" id="first_name" name="first_name" value="" placeholder="姓" title="first_name" class="iblock required" required aria-required="true">\n  <input type="text" id="last_name" name="last_name" value="" placeholder="名" title="last_name" class="iblock required" required aria-required="true">\n  <input type="email" pattern="^([a-zA-Z0-9_.+-])+\\@(([a-zA-Z0-9-])+\\.)+([a-zA-Z0-9]{2,4})+$" id="email" name="email" value="" placeholder="メールアドレス" title="メールアドレス" class="required" required aria-required="true">\n  <input type="tel" pattern="^[0-9-+s()]*$" id="phone" name="phone" value="" placeholder="電話番号" title="電話番号" class="iblock required" required aria-required="true">\n  <div id="contact-departments" class="iblock required"></div>\n  <input type="text" id="company" name="company" value="" placeholder="会社名" title="会社名" class="iblock required" required aria-required="true">\n  <div id="co-size" class="required"></div>\n  <input type="text" id="post_code" name="post_code" value="" placeholder="郵便番号" title="郵便番号" class="iblock required" required aria-required="true">\n  <div id="contact-prefectures" class="iblock required"></div>\n  <input type="text" id="address" name="address" value="" placeholder="住所" title="住所" class="iblock required" required aria-required="true">\n  <textarea id="notes" name="notes" value="" title="お問い合わせ内容" placeholder="お問い合わせ内容"></textarea>\n  <div id="signup-btn" class="btn s-btn-inv">送信する</div>\n</form>'})}),define("guest/views/lang/ja-jp/contact_dialog_form_view",["views/common/view","views/common/select_menu_view","email","phone","fslib/company_sizes","form_verify","text!fslib/jp_prefectures.json","hbs!guest/templates/lang/ja-jp/contact_dialog_form","marketo"],function(e,t,n,i,r,s,o,a,c){return e.extend({template:a,events:{"click #signup-btn":"_formSubmit","click #dialog-close":"_close"},DEPARTMENTS:[{name:"管理者",value:"Administration"},{name:"サポート",value:"Customer Service and Support"},{name:"製品開発",value:"Engineering/Product Development"},{name:"経理・財務",value:"Finance"},{name:"人事部",value:"HR"},{name:"情報システム部",value:"IT"},{name:"製造業",value:"Manufacturing"},{name:"マーケティング・広報部",value:"Marketing/Public Relations"},{name:"総務部",value:"Operations"},{name:"営業部",value:"Sales and Business Development"},{name:"その他",value:"Other"}],TRANSLATIONS:{company_size:"社員数",prefecture:"御社所在地",department:"所属部署"},initialize:function(){e.prototype.initialize.call(this),this._createMenu()},_createMenu:function(){this._coSizeMenu=new t({name:"company-size",items:r.COMPANY_SIZES,unselected:this.TRANSLATIONS.company_size}),this.addChild(this._coSizeMenu,"#co-size");var e=JSON.parse(o);this._contactPrefectureMenu=new t({name:"contact-selected-prefecture",items:e.prefectures,unselected:this.TRANSLATIONS.prefecture}),this.addChild(this._contactPrefectureMenu,"#contact-prefectures"),this._contactDepartmentsMenu=new t({name:"contact-selected-department",items:this.DEPARTMENTS,unselected:this.TRANSLATIONS.department}),this.addChild(this._contactDepartmentsMenu,"#contact-departments")},_dataLayerPush:function(e){dataLayer.push({event:"inbound_message",type:"overlay",company_size:e})},_formSubmit:function(){var e=$("#email").val(),t=$("#first_name").val(),r=$("#last_name").val(),a=$("#phone").val(),l=$("#company").val(),u=$("#notes").val(),h=$("#company-size").val(),d=h===this._coSizeMenu.unselected,f=$("#contact-selected-department").val(),p=f===this._contactDepartmentsMenu.unselected,g=$("#address").val(),m=$("#contact-selected-prefecture").val(),v=m===this._contactPrefectureMenu.unselected,y=$("#post_code").val();if($("#contact-dialog #company-size, #contact-dialog #contact-selected-department, #contact-dialog #contact-selected-prefecture").addClass("required"),n.isEmail(e)&&t&&r&&i.isPhone(a)&&l&&h&&!d&&f&&!p&&g&&m&&!v&&y){$("#signup_form :input, #co-size, #signup-btn").prop("disabled",!0),s.removeRequired("#contact-dialog");var b=_.bind(function(){this.trigger("next"),window.scrollTo(0,0),this._dataLayerPush(h)},this);if(m=JSON.parse(o).prefectures[m].value,f=$.grep(this.DEPARTMENTS,function(e){return e.name==f})[0].value,"undefined"!=typeof MktoForms2){var S={FirstName:t,LastName:r,Email:e,Phone:a,size_of_team__c:h,Company:l,Address:g,City:m,PostalCode:y,dr_department__c:f,Reason_for_Switch__c:u};c.submit(1439,S)}else console.log("Marketo Forms not available. Not sending any data");return b(),!1}s.checkRequired("#contact-dialog",!0),n.isEmail($("#contact-dialog input[type=email]").val())||$("#contact-dialog input[type=email]").addClass("required-flagged"),i.isPhone($("#contact-dialog input[type=tel]").val())||$("#contact-dialog input[type=tel]").addClass("required-flagged"),$("#company-size").val()===this.TRANSLATIONS.company_size&&$("#company-size").addClass("required-flagged"),$("#contact-selected-prefecture").val()===this.TRANSLATIONS.prefecture&&$("#contact-selected-prefecture").addClass("required-flagged"),$("#contact-selected-department").val()===this.TRANSLATIONS.department&&$("#contact-selected-department").addClass("required-flagged")},_close:function(){Backbone.trigger("overlay")}})}),define("hbs!guest/templates/lang/ja-jp/contact_dialog_confirm",["handlebars"],function(e){return e.template(function(e,t,n,i,r){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=r||{},' <div class="dialog-top"><div id="dialog-close">&times;</div></div>\n<h4 class="contact-confirm text-center">\n  <span>&#10003;</span>\n  お問い合わせ、ありがとうございます！\n</h4>'})}),define("guest/views/lang/ja-jp/contact_dialog_confirm_view",["views/common/view","hbs!guest/templates/lang/ja-jp/contact_dialog_confirm"],function(e,t){return e.extend({template:t,events:{"click #dialog-close":"_close"},initialize:function(){e.prototype.initialize.call(this)},_close:function(){Backbone.trigger("overlay")}})}),define("guest/views/contact_dialog_flow_view",["views/common/flow_view","guest/views/contact_dialog_form_view","guest/views/contact_dialog_confirm_view","guest/views/lang/ja-jp/contact_dialog_form_view","guest/views/lang/ja-jp/contact_dialog_confirm_view"],function(e,t,n,i,r){return e.extend({initialize:function(s){var o=[t,n];"ja"===s.lang&&(o=[i,r]),e.prototype.initialize.call(this,s,o,s)},_setView:function(t){e.prototype._setView.call(this,t)}})}),define("hbs!guest/templates/contact_dialog",["handlebars"],function(e){return e.template(function(e,t,n,i,r){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=r||{},'<div id="contact-dialog" class="dialog-view-2"></div>'})}),define("guest/views/contact_dialog_view",["views/common/view","guest/views/contact_dialog_flow_view","hbs!guest/templates/contact_dialog"],function(e,t,n){return e.extend({template:n,initialize:function(n){e.prototype.initialize.call(this),this.addChild(new t(n),"#contact-dialog"),dataLayer.push({event:"co_open"})}})}),define("hbs!guest/templates/company_size",["handlebars"],function(e){return e.template(function(e,t,n,i,r){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=r||{};var s,o,a="",c="function",l=this.escapeExpression,u=n.blockHelperMissing;function h(e,t){var i,r="";return r+="?",i=(i=n.queryParams)?i.call(e,{hash:{},data:t}):(void 0===(i=e.queryParams)?"undefined":_typeof(i))===c?i.apply(e):i,r+=l(i)}return a+='<div class="dialog-top">\n  <div id="dialog-close">&times;</div>\n</div>\n<div class="mblock" id="company-size-img">\n  <img class="center iphone-img" alt="Work from anywhere"/>\n</div>\n<div class="mblock" id="company-size-form">\n  <h3 class="main-color-0">',o={hash:{},inverse:this.noop,fn:this.program(1,function(e,t){return"Start your trial"},r),data:r},s=(s=n.i18n)?s.call(t,o):(void 0===(s=t.i18n)?"undefined":_typeof(s))===c?s.apply(t):s,n.i18n||(s=u.call(t,s,o)),(s||0===s)&&(a+=s),a+='</h3>\n  <p class="copy-color">\n    ',o={hash:{},inverse:this.noop,fn:this.program(3,function(e,t){return"To get started, please select your company size below."},r),data:r},s=(s=n.i18n)?s.call(t,o):(void 0===(s=t.i18n)?"undefined":_typeof(s))===c?s.apply(t):s,n.i18n||(s=u.call(t,s,o)),(s||0===s)&&(a+=s),a+='\n  </p>\n  <a id="company-size-select-less" class="btn p-btn center first" href="/signup',((s=n.if.call(t,t.queryParams,{hash:{},inverse:this.noop,fn:this.program(5,h,r),data:r}))||0===s)&&(a+=s),a+='">\n    ',o={hash:{},inverse:this.noop,fn:this.program(7,function(e,t){return"More than 100 employees"},r),data:r},s=(s=n.i18n)?s.call(t,o):(void 0===(s=t.i18n)?"undefined":_typeof(s))===c?s.apply(t):s,n.i18n||(s=u.call(t,s,o)),(s||0===s)&&(a+=s),a+='\n  </a>\n  <a id="company-size-select-more" class="btn p-btn center" href="/signup',((s=n.if.call(t,t.queryParams,{hash:{},inverse:this.noop,fn:this.program(5,h,r),data:r}))||0===s)&&(a+=s),a+='">\n    ',o={hash:{},inverse:this.noop,fn:this.program(9,function(e,t){return"Less than 100 employees"},r),data:r},s=(s=n.i18n)?s.call(t,o):(void 0===(s=t.i18n)?"undefined":_typeof(s))===c?s.apply(t):s,n.i18n||(s=u.call(t,s,o)),(s||0===s)&&(a+=s),a+='\n  </a>\n  <p class="bottom p-3 copy-color">\n    ',o={hash:{},inverse:this.noop,fn:this.program(11,function(e,t){return"Need help? Call our sales team at "},r),data:r},s=(s=n.i18n)?s.call(t,o):(void 0===(s=t.i18n)?"undefined":_typeof(s))===c?s.apply(t):s,n.i18n||(s=u.call(t,s,o)),(s||0===s)&&(a+=s),a+='<a class="p-3" href="tel:+18557542520">855-DIALPAD</a>\n  </p>\n</div>\n'})}),define("guest/views/company_size_dialog_view",["views/common/view","hbs!guest/templates/company_size"],function(e,t){return e.extend({template:t,id:"company-size-dialog",events:{"click #dialog-close":"_close"},initialize:function(t){e.prototype.initialize.call(this,t),this.signupQueryParams=t.queryParams},getTemplateData:function(){return{queryParams:this.signupQueryParams}},_close:function(){Backbone.trigger("overlay")}})}),define("guest/views/guest_view",["config","views/common/view","views/common/dialog_view","guest/views/contact_dialog_view","guest/views/company_size_dialog_view"],function(e,t,n,i,r){return t.extend({el:"body",events:{"click .contact-sales-dialog":"_showContactDialog"},initialize:function(){t.prototype.initialize.call(this),this.listenTo(Backbone,"overlay",this.setOverlay),$(window).scroll(function(){$(this).scrollTop()>200?$("#alert-banner").addClass("solid-alert"):$("#alert-banner").removeClass("solid-alert")})},setOverlay:function(e,t,n){$("#overlay").length<1&&$("body").prepend('<div id="overlay" class="snappy"></div>');var i=null;this.$overlay=$("#overlay"),t&&t.cid?i=t:n=t,n=n||{},e=e||"none";var r=this.overlayType,s=this.overlayView;this._toggleLayoutClass("overlay-"+r,!1),this.overlayType=e,this.overlayView=this.getOverlay(e,i,n),this._toggleLayoutClass("overlay-"+e,!0);var o=_.bind(function(){this.$overlay.html(this.overlayView.render().el)},this);s&&"none"===this.overlayType?s.remove():o(),this._toggleBodyLock(e)},getOverlay:function(e,t,i){return(i=i||{}).view=t,new n(i)},_toggleLayoutClass:function(e,t){e&&(e="app-"+e,this.$overlay.toggleClass(e,t))},showView:function(e,t){this._options=t||{},this.$content=this.$("#content"),this._previousCssClass&&this._previousCssClass!=this._options.cssClass&&$("html").removeClass(this._previousCssClass),this._options.cssClass&&($("html").addClass(this._options.cssClass),this._previousCssClass=this._options.cssClass),this.lastView?(this.listenToOnce(this.lastView,"removed",_.bind(function(){this.$content.html(""),_.defer(_.bind(function(){this.$content.html(e.render().el)},this))},this)),this.lastView.remove()):this.$content.html(e.render().el),this.lastView=e},_toggleBodyLock:function(e){var t=$("body");if("none"===e){var n=Math.abs(t.css("top").replace("px",""));t.css("top","").removeClass("overlay-lock"),window.scrollTo(0,n)}else{var i=document.body.scrollTop;i>0&&t.css("top",-i+"px"),t.addClass("overlay-lock")}},_showContactDialog:function(t){if("ja"===e.lang){window.open("http://hello.dialpad.com/softbank","_blank").focus()}else{var n={lang:e.lang};"/pricing"===window.location.pathname&&(n.pricingPlanClick=t.target.id),Backbone.trigger("overlay","dialog",new i(n),{centered:!0})}},_showCompanySizeDialog:function(e){var t=e.target.closest(".company-size-dialog").dataset,n={};t.accountType&&(n.queryParams="account_type="+t.accountType),Backbone.trigger("overlay","dialog",new r(n),{centered:!0})}})}),define("guest/includes/common/form",[],function(){return{checkSelectMenuValue:function(e,t){t&&$("#"+e).closest(".input-cont").addClass("show-label")}}}),define("text!fslib/all_provinces.json",[],function(){return'{"provinces": {\n  "AB": {"name":"Alberta", "value":"AB"},\n  "BC": {"name":"British Columbia", "value":"BC"},\n  "MB": {"name":"Manitoba", "value":"MB"},\n  "NB": {"name":"New Brunswick", "value":"NB"},\n  "NL": {"name":"Newfoundland and Labrador", "value":"NL"},\n  "NT": {"name":"Northwest Territories", "value":"NT"},\n  "NS": {"name":"Nova Scotia", "value":"NS"},\n  "NU": {"name":"Nunavut", "value":"NU"},\n  "ON": {"name":"Ontario", "value":"ON"},\n  "PE": {"name":"Prince Edward Island", "value":"PE"},\n  "QC": {"name":"Quebec", "value":"QC"},\n  "SK": {"name":"Saskatchewan", "value":"SK"},\n  "YT": {"name":"Yukon", "value":"YT"}\n}}\n'}),define("hbs!guest/templates/request_trial",["handlebars"],function(e){return e.template(function(e,t,n,i,r){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=r||{},'<form id="trial-main-form" class="form" method="post" novalidate="novalidate">\n  <input type="hidden" id="trial-source" name="trial-source" value="trial-request-form">\n  <div class="input-cont rt-first-name-cont iblock">\n    <input type="text" id="trial-first-name" name="trial-first-name" value="" placeholder="FIRST NAME" class="required" required aria-required="true">\n    <label>First Name</label>\n  </div>\n  <div class="input-cont rt-last-name-cont iblock">\n    <input type="text" id="trial-last-name" name="trial-last-name" value="" placeholder="LAST NAME" class="required" required aria-required="true">\n    <label>Last Name</label>\n  </div>\n  <div class="input-cont rt-company-cont iblock">\n    <input type="text" id="trial-company" name="trial-company" value="" placeholder="COMPANY NAME" class="required" required aria-required="true">\n    <label>Company Name</label>\n  </div>\n  <div class="input-cont rt-company-size-cont iblock">\n    <div id="trial-co-size" class="iblock"></div>\n    <label>Company Size</label>\n  </div>\n  <div class="input-cont rt-email-cont iblock">\n    <input type="email" id="trial-email" name="trial-email" value="" placeholder="WORK EMAIL" class="required" required aria-required="true">\n    <label>Work Email</label>\n  </div>\n  <div class="input-cont rt-phone-cont iblock">\n    <input type="tel" id="trial-phone" name="trial-phone" value="" placeholder="PHONE" class="required" required aria-required="true">\n    <label>Phone</label>\n  </div>\n  <div class="input-cont rt-country-cont iblock show-label">\n    <div id="trial-country" class="iblock simple-trans"></div>\n    <label>Country</label>\n  </div>\n  <div class="input-cont rt-state-cont iblock">\n    <div id="trial-state" class="iblock simple-trans"></div>\n    <label>State</label>\n  </div>\n  <div class="input-cont rt-province-cont iblock">\n    <div id="trial-province" class="iblock simple-trans"></div>\n    <label>Province</label>\n  </div>\n  <label class="b-checkbox-label"><input type="checkbox" id="bCheckbox" name="b-checkbox"> B checkbox</label>\n  <button id="trial-request-btn" class="btn p-btn disabled center">START FREE TRIAL</button>\n</form>\n'})}),define("guest/views/request_trial_view",["views/common/view","views/common/select_menu_view","guest/includes/common/form","email","form_verify","fslib/company_sizes","text!fslib/all_countries.json","text!fslib/all_states.json","text!fslib/all_provinces.json","hbs!guest/templates/request_trial","js-cookie","marketo","config"],function(e,t,n,i,r,s,o,a,c,l,u,h,d){return e.extend({template:l,el:"#trial-main-form-cont",events:{"click #trial-request-btn":"_submit","submit #trial-main-form":"_submit","keypress #trial-first-name, #trial-last-name, #trial-company, #trial-phone, #trial-email":"_checkComplete"},DIRECT_SIGNUP_SIZES:[{name:"1 - 5",value:"1-5"},{name:"6 - 10",value:"6-10"},{name:"11 - 50",value:"11-50"}],initialize:function(t){e.prototype.initialize.call(this),this.firstName="",this.lastName="",this.email="",this.phone="",this.company="",this.size="",this.country="",this.international=!1,this.trialEligibleCountry=!0,this.state="",this.province="",this.bCheck=!1,this.accountType="",this._createMenu(),$(window).on("keyup",$.proxy(this._keyUp,this)),this.listenTo(this._trialCoSizeMenu,"changed",this._checkCoSize),this.listenTo(this._trialCountryMenu,"changed",this._checkCountry),this.listenTo(this._trialStateMenu,"changed",this._setUSstate),this.listenTo(this._trialProvinceMenu,"changed",this._setProvince);var n=this;$(window).on("load",function(){var e=JSON.parse(o),t=d.region.toUpperCase(),i=e.countries[t].value;n._setCountry(i)})},render:function(){return e.prototype.render.call(this)},_submit:function(e){if(e&&e.preventDefault(),this._getValues()){$("#trial-main-form :input").prop("disabled",!0),r.removeRequired("#trial-main-form");var t=_.bind(function(){if(this.trialEligibleCountry)if(this._isTrialSize(this.size)){this._cookieCoData(this.company,this.size);var e="/signup";this.accountType&&(e+="?account_type="+this.accountType),location.href=e}else this._showConfirmation("#trial-large-company");else this._isTrialSize(this.size)?this._showConfirmation("#trial-intl-small-company"):this._showConfirmation("#trial-large-company");this._dataLayerPush(this.company,this.size,this.email)},this);if("undefined"!=typeof MktoForms2){var n=this.state;"Canada"===this.country&&(n=this.province);var i={FirstName:this.firstName,LastName:this.lastName,Email:this.email,Phone:this.phone,Company:this.company,size_of_team__c:this.size,Country:this.country,State:n,bCheckboxv2:this.bCheck,AccountType:this.accountType};h.submit(1097,i)}else console.log("Marketo Forms not available. Not sending any data");t()}else r.checkRequired("#trial-main-form",!1),$("#trial-company-size").val()||$("#trial-company-size").addClass("required-flagged"),$("#trial-selected-state").hasClass("required")&&!$("#trial-selected-state").val()&&$("#trial-selected-state").addClass("required-flagged"),$("#trial-selected-province").hasClass("required")&&!$("#trial-selected-province").val()&&$("#trial-selected-province").addClass("required-flagged")},_createMenu:function(){this._trialCoSizeMenu=new t({name:"trial-company-size",items:s.COMPANY_SIZES,placeholder:"COMPANY SIZE",autocomplete:"off"}),this.addChild(this._trialCoSizeMenu,"#trial-co-size");var e=JSON.parse(o);this._trialCountryMenu=new t({name:"trial-selected-country",items:e.countries,selected:"ca"===d.region?"Canada":"United_States",autocomplete:"off"}),this.addChild(this._trialCountryMenu,"#trial-country");var n=JSON.parse(a);this._trialStateMenu=new t({name:"trial-selected-state",items:n.states,placeholder:"STATE",autocomplete:"off"}),this.addChild(this._trialStateMenu,"#trial-state");var i=JSON.parse(c);this._trialProvinceMenu=new t({name:"trial-selected-province",items:i.provinces,placeholder:"PROVINCE",autocomplete:"off"}),this.addChild(this._trialProvinceMenu,"#trial-province")},_checkCoSize:function(e){if(n.checkSelectMenuValue(e.name,e.value),this._isTrialSize(e.value)){$("#trial-request-btn").text("Start Free Trial"),$("#trial-request-title").text("Start Free Trial".toUpperCase())}else{$("#trial-request-btn").text("Request Trial".toUpperCase()),$("#trial-request-title").text("Request Trial")}this._checkComplete()},_checkCountry:function(e){n.checkSelectMenuValue(e.name,e.value),this._setCountry(e.value),this._checkComplete()},_setCountry:function(e){"United_States"!==e&&"Canada"!==e?(this.international=!0,$(".rt-country-cont, .rt-state-cont, .rt-province-cont").addClass("out-us"),this.trialEligibleCountry=!1):($(".rt-country-cont, .rt-state-cont, .rt-province-cont").removeClass("out-us"),this.international=!1,this.trialEligibleCountry=!0,"Canada"===e?($(".rt-state-cont").hide(),$(".rt-province-cont").show()):($(".rt-state-cont").show(),$(".rt-province-cont").hide()))},_setUSstate:function(e){n.checkSelectMenuValue(e.name,e.value),$("#trial-state").data("stateAbbr",e.value),this._checkComplete()},_setProvince:function(e){n.checkSelectMenuValue(e.name,e.value),$("#trial-province").data("provinceAbbr",e.value),this._checkComplete()},_checkComplete:function(){this._getValues()&&$("#trial-request-btn").removeClass("disabled")},_getValues:function(){$("#trial-source").val();this.firstName=$("#trial-first-name").val(),this.lastName=$("#trial-last-name").val(),this.email=$("#trial-email").val(),this.phone=$("#trial-phone").val(),this.company=$("#trial-company").val(),this.size=$("#trial-company-size").val(),this.country=$("#trial-selected-country").val(),this.state=$("#trial-state").data("stateAbbr"),this.province=$("#trial-province").data("provinceAbbr"),this.accountType=$("#trial-account-type").val(),$("#bCheckbox:checkbox:checked").length>0&&(this.bCheck=!0);var e=!0;return this.international||(e=this.state||this.province,$("#trial-selected-state, #trial-selected-province").addClass("required")),$("#trial-main-form #trial-company-size, #trial-selected-country").addClass("required"),i.isEmail(this.email)&&this.firstName&&this.lastName&&this.phone&&this.company&&this.size&&this.country&&e},_cookieCoData:function(e,t){var n=JSON.stringify({companyName:e,companySize:t});u("small-co-data",n,{expires:9999,path:"/"})},_dataLayerPush:function(e,t,n){var i={event:"request_trial_form_complete",type:"form",company:e,company_size:t,user_email:n};dataLayer.push(i)},_isTrialSize:function(e){var t=0;return this.DIRECT_SIGNUP_SIZES.some(function(n,i){return t=i,n.name==e||n.value==e})&&t<=3},_showConfirmation:function(e){$("#request-trial .module").fadeOut(150,function(){setTimeout(function(){$(e).fadeIn(150,function(){$(window).trigger("lookup")})},150)})}})}),define("hbs!guest/templates/waitlist",["handlebars"],function(e){return e.template(function(e,t,n,i,r){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=r||{},'<form id="waitlist-main-form" class="form flex flex-wrap flex-x-space-between" method="post" novalidate="novalidate">\n  <input type="hidden" id="waitlist-source" name="waitlist-source" value="waitlist-request-form">\n  <div class="waitlist-first-name-cont">\n    <input type="text" id="waitlist-first-name" name="waitlist-first-name" value="" placeholder="FIRST NAME" class="required" required aria-required="true">\n    <label>First Name</label>\n  </div>\n  <div class="waitlist-last-name-cont">\n    <input type="text" id="waitlist-last-name" name="waitlist-last-name" value="" placeholder="LAST NAME" class="required" required aria-required="true">\n    <label>Last Name</label>\n  </div>\n  <div class="waitlist-email-cont">\n    <input type="email" id="waitlist-email" name="waitlist-email" value="" placeholder="EMAIL" class="required" required aria-required="true">\n    <label>Email</label>\n  </div>\n  <div class="waitlist-company-cont">\n    <input type="text" id="waitlist-company" name="waitlist-company" value="" placeholder="COMPANY NAME" class="required" required aria-required="true">\n    <label>Company Name</label>\n  </div>\n  <div class="input-cont waitlist-company-size-cont">\n    <div id="waitlist-co-size" class="iblock"></div>\n    <label>Company Size</label>\n  </div>\n  <div class="waitlist-area-code-cont">\n    <input type="number" min="1" max="999" id="waitlist-area-code" name="waitlist-area-code" value="" placeholder="AREA CODE" class="required" required aria-required="true">\n    <label>Area Code</label>\n  </div>\n  <label class="b-checkbox-label"><input type="checkbox" id="bCheckbox" name="b-checkbox"> B checkbox</label>\n  <input type="submit" id="waitlist-submit-btn" class="btn t-btn disabled center" value="Continue" />\n</form>\n'})}),define("guest/views/waitlist_view",["views/common/view","views/common/select_menu_view","guest/includes/common/form","email","form_verify","fslib/company_sizes","text!fslib/all_countries.json","text!fslib/all_states.json","text!fslib/all_provinces.json","hbs!guest/templates/waitlist","js-cookie","marketo","config"],function(e,t,n,i,r,s,o,a,c,l,u,h,d){return e.extend({template:l,el:"#waitlist-main-form-cont",events:{"click #waitlist-submit-btn":"_submit","submit #waitlist-main-form":"_submit","keypress #waitlist-first-name, #waitlist-last-name, #waitlist-company, #waitlist-area-code, #waitlist-email":"_checkComplete","keyup #waitlist-area-code":"_verifyAreaCode"},DIRECT_SIGNUP_SIZES:[{name:"1 - 5",value:"1-5"},{name:"6 - 10",value:"6-10"},{name:"11 - 50",value:"11-50"}],FREE_AREA_CODES:["408","669","415","628","510","650","707","925"],initialize:function(){e.prototype.initialize.call(this),this.firstName="",this.lastName="",this.email="",this.phone="",this.company="",this.size="",this.areaCode="",this.bCheck=!1,this._createMenu(),$(window).on("keyup",$.proxy(this._keyUp,this))},render:function(){return e.prototype.render.call(this),this.$areaCode=this.$("#waitlist-area-code"),this.$submit=this.$("#waitlist-submit-btn"),this},_submit:function(e){if(e&&e.preventDefault(),this._getValues()){$("#waitlist-main-form :input").prop("disabled",!0),r.removeRequired("#waitlist-main-form");var t=_.bind(function(){this._isTrialSize(this.size)&&this._cookieCoData(this.company,this.size),this._dataLayerPush(this.company,this.size,this.email)},this);if("undefined"!=typeof MktoForms2){var n={FirstName:this.firstName,LastName:this.lastName,Email:this.email,Company:this.company,size_of_team__c:this.size,areaCode:this.areaCode,bCheckboxv2:this.bCheck,InferredCity:d.city,InferredStateRegion:d.region,InferredCountry:d.country};if(!this.bCheck)if(this._isAvailableAreaCode(this.areaCode))h.submit(1976,n),MktoForms2.getForm(1976).onSuccess(function(){window.location.href="https://dialpad.com/signup/free"});else{h.submit(1976,n);var i=this;MktoForms2.getForm(1976).onSuccess(function(){i._showConfirmation("#waitlist-thank-you")})}}else console.log("Marketo Forms not available. Not sending any data");t()}else r.checkRequired("#waitlist-main-form",!1),$("#waitlist-company-size").val()||$("#waitlist-company-size").addClass("required-flagged"),$("#waitlist-selected-state").hasClass("required")&&!$("#waitlist-selected-state").val()&&$("#waitlist-selected-state").addClass("required-flagged"),$("#waitlist-selected-province").hasClass("required")&&!$("#waitlist-selected-province").val()&&$("#waitlist-selected-province").addClass("required-flagged")},_verifyAreaCode:function(e){var t=this.$areaCode.val();t.length<3||this._isAvailableAreaCode(t)?this.$submit.val("Continue"):this.$submit.val("Join Waitlist")},_isAvailableAreaCode:function(e){return this.FREE_AREA_CODES.indexOf(e)>-1},_createMenu:function(){this._trialCoSizeMenu=new t({name:"waitlist-company-size",items:s.COMPANY_SIZES,placeholder:"COMPANY SIZE",autocomplete:"off"}),this.addChild(this._trialCoSizeMenu,"#waitlist-co-size")},_checkComplete:function(){this._getValues()&&$("#waitlist-request-btn").removeClass("disabled")},_getValues:function(){return this.firstName=$("#waitlist-first-name").val(),this.lastName=$("#waitlist-last-name").val(),this.email=$("#waitlist-email").val(),this.company=$("#waitlist-company").val(),this.size=$("#waitlist-company-size").val(),this.areaCode=$("#waitlist-area-code").val(),$("#bCheckbox:checkbox:checked").length>0&&(this.bCheck=!0),i.isEmail(this.email)&&this.firstName&&this.lastName&&this.company&&this.size&&this.areaCode>99&&this.areaCode<1e3},_cookieCoData:function(e,t){var n=JSON.stringify({companyName:e,companySize:t});u("small-co-data",n,{expires:9999,path:"/"})},_dataLayerPush:function(e,t,n){var i={event:"waitlist_form_complete",type:"form",company:e,company_size:t,user_email:n};dataLayer.push(i)},_isTrialSize:function(e){var t=0;return this.DIRECT_SIGNUP_SIZES.some(function(n,i){return t=i,n.name==e||n.value==e})&&t<=3},_showConfirmation:function(e){$("#waitlist .module").fadeOut(150,function(){setTimeout(function(){$(e).fadeIn(150,function(){$(window).trigger("lookup")})},150)})}})}),define("hbs!guest/templates/roi_tabs",["handlebars"],function(e){return e.template(function(e,t,n,i,r){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=r||{},'<div class="tabs flex flex-x-space-between">\n  <div for="tab-one" id="tab-label-one" class="tab checked"><h5>Step One</h5></div>\n  <div for="tab-two" id="tab-label-two" class="tab"><h5 class="base-color-5">Step Two</h5></div>\n  <div for="tab-three" id="tab-label-three" class="tab base-background-5"><h5 class="base-color-7">Results</h5></div>\n</div>'})}),define("guest/views/roi_tabs_view",["views/common/view","hbs!guest/templates/roi_tabs"],function(e,t){return e.extend({template:t,events:{"click .tab":"_tabClick"},initialize:function(t){e.prototype.initialize.call(this),this.options=t},_tabClick:function(e){var t=$(e.currentTarget).closest(".tab");t.hasClass("completed")&&this._changePanel(t)},_changePanel:function(e,t){$(".tab").removeClass("checked"),e.addClass("checked");var n=e.index();Backbone.trigger("roi:tab_click",n,this.options)}})}),define("hbs!guest/templates/common/slider",["handlebars"],function(e){return e.template(function(e,t,n,i,r){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=r||{};var s,o="",a="function",c=this.escapeExpression;return o+='<div class="range-slider ',((s=n.if.call(t,t.valueDisplay,{hash:{},inverse:this.noop,fn:this.program(1,function(e,t){return"value-display"},r),data:r}))||0===s)&&(o+=s),o+='">\n  ',((s=n.if.call(t,t.valueDisplay,{hash:{},inverse:this.noop,fn:this.program(3,function(e,t){var i,r="";return r+='\n    <div class="current-value-wrapper">\n      <div class="cv-bar-left"></div>\n      <div class="cv-arrow-left"></div>\n      <div class="rs-current-value rs-label base-color-7">',i=(i=n.value)?i.call(e,{hash:{},data:t}):(void 0===(i=e.value)?"undefined":_typeof(i))===a?i.apply(e):i,r+=c(i),i=(i=n.suffix)?i.call(e,{hash:{},data:t}):(void 0===(i=e.suffix)?"undefined":_typeof(i))===a?i.apply(e):i,r+=c(i)+'</div>\n      <div class="cv-arrow-right"></div>\n      <div class="cv-bar-right"></div>\n    </div>\n  '},r),data:r}))||0===s)&&(o+=s),o+='\n  <div class="rs-background-bar"></div>\n  <div class="rs-bar"></div>\n  <input ',((s=n.if.call(t,t.name,{hash:{},inverse:this.noop,fn:this.program(5,function(e,t){var i,r="";return r+='id="',i=(i=n.name)?i.call(e,{hash:{},data:t}):(void 0===(i=e.name)?"undefined":_typeof(i))===a?i.apply(e):i,r+=c(i)+'"'},r),data:r}))||0===s)&&(o+=s),o+=" ",((s=n.if.call(t,t.name,{hash:{},inverse:this.noop,fn:this.program(7,function(e,t){var i,r="";return r+='name="',i=(i=n.name)?i.call(e,{hash:{},data:t}):(void 0===(i=e.name)?"undefined":_typeof(i))===a?i.apply(e):i,r+=c(i)+'"'},r),data:r}))||0===s)&&(o+=s),o+=' type="range" min="',s=(s=n.min)?s.call(t,{hash:{},data:r}):(void 0===(s=t.min)?"undefined":_typeof(s))===a?s.apply(t):s,o+=c(s)+'" max="',s=(s=n.max)?s.call(t,{hash:{},data:r}):(void 0===(s=t.max)?"undefined":_typeof(s))===a?s.apply(t):s,o+=c(s)+'" value="',s=(s=n.value)?s.call(t,{hash:{},data:r}):(void 0===(s=t.value)?"undefined":_typeof(s))===a?s.apply(t):s,o+=c(s)+'" ',((s=n.if.call(t,t.disabled,{hash:{},inverse:this.noop,fn:this.program(9,function(e,t){return'class="disabled" disabled'},r),data:r}))||0===s)&&(o+=s),o+='>\n  <div class="rel labels-wrapper">\n    <div class="rs-min rs-label base-color-3 iblock abs">',s=(s=n.minLabel)?s.call(t,{hash:{},data:r}):(void 0===(s=t.minLabel)?"undefined":_typeof(s))===a?s.apply(t):s,o+=c(s)+"</div>\n    ",((s=n.each.call(t,t.labels,{hash:{},inverse:this.noop,fn:this.program(11,function(e,t){var i,r="";return r+='\n        <div class="rs-label base-color-3 iblock abs">',i=(i=n.label_name)?i.call(e,{hash:{},data:t}):(void 0===(i=e.label_name)?"undefined":_typeof(i))===a?i.apply(e):i,r+=c(i)+"</div>\n    "},r),data:r}))||0===s)&&(o+=s),o+='\n    <div class="rs-max rs-label base-color-3 iblock abs">',s=(s=n.maxLabel)?s.call(t,{hash:{},data:r}):(void 0===(s=t.maxLabel)?"undefined":_typeof(s))===a?s.apply(t):s,o+=c(s)+"</div>\n  </div>\n</div>\n"})}),define("guest/views/common/slider_view",["views/common/view","fslib/fsutil","hbs!guest/templates/common/slider"],function(e,t,n){return e.extend({template:n,events:{"input input":"_onInput","mouseup input":"_onChange"},initialize:function(){e.prototype.initialize.call(this),this._name=this.options.name,this._minVal=this.options.min||0,this._minLabel=this.options.min_label||this._minVal,this._maxVal=this.options.max||100,this._maxLabel=this.options.max_label||this._maxVal,this._labels=this.options.labels||[],this._suffix=this.options.suffix||"",this.value=this.options.value||this._minVal,this.valueDisplay=this.options.value_display||!1,this.valueDisplayBelow=this.options.value_display_below||!1,this._disabled=this.options.disabled,$(window).resize(function(){this._calculatePosition(),this._setLabels()}.bind(this))},getTemplateData:function(){return{name:this._name,min:this._minVal,minLabel:this._minLabel,max:this._maxVal,maxLabel:this._maxLabel,labels:this._labels,value:this.value,valueDisplay:this.valueDisplay,valueDisplayBelow:this.valueDisplayBelow,suffix:this._suffix,disabled:this._disabled}},render:function(){return e.prototype.render.apply(this,arguments),this._$val=this.$(".rs-current-value"),this._$input=this.$("input"),this._$bar=this.$(".rs-bar"),this._$cvRightBar=this.$(".cv-bar-right"),this._$cvLeftBar=this.$(".cv-bar-left"),this},postRender:function(){this._calculatePosition(),this._setLabels()},_calculatePosition:function(){if(this._$input){var e=(this.value-this._minVal)/(this._maxVal-this._minVal),n=this._$input[0].getBoundingClientRect(),i=n.width*e,r=12*(.5-e),s=this._$input.position().left+n.width*e+(9-12*e);t.isEdge()&&(s+=6+r),this._$bar.css({left:s});var o=this.$(".current-value-wrapper").width(),a=.08*o,c=i+a,l=c-12*((a+c)/o),u=l-30,h=o-l-30;this._$val.css({left:l}),this._$val.text(this.translate("[num_seconds] K",{num_seconds:this.value})),this._$cvRightBar.css({width:h}),this._$cvLeftBar.css({width:u}),this.$(".cv-arrow-left").css({width:l});var d=o-l;this.$(".cv-arrow-right").css({width:d})}},_onInput:function(e){this.value=e.currentTarget.valueAsNumber,this._calculatePosition()},_onChange:function(){this._$input&&(t.isIE()&&(this.value=this._$input.val(),this._calculatePosition()),this.trigger("changed",{name:this._name,value:this.value}))},_setLabels:function(){var e=this.$(".labels-wrapper").width(),t=this._labels.length+1,n=0;this.$(".labels-wrapper .rs-label").each(function(){n+=$(this).width()});var i=(e-n)/t+"px";this.$(".labels-wrapper .rs-label:not(.rs-min, .rs-max)").css({"margin-left":i})}})}),define("hbs!guest/templates/roi_panel_one",["handlebars"],function(e){return e.template(function(e,t,n,i,r){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=r||{};var s,o="",a="function",c=this.escapeExpression;function l(e,t){return""}return o+='<div class="rel">\n  <img id="step-one-left" src="https://storage.googleapis.com/switch_static/guest/redesign/roi_calculator/step-1-left.svg" style="max-width:254px" alt="Dialpad ROI Calculator">\n  <div id="tab-panel-one" class="panel active">\n    <div class="question">\n      <p class="p-3 iblock">Is your phone system in the cloud or on premise?</p>\n      <div id="system-drop" class="roi-drop iblock"></div>\n    </div>\n    <div class="question">\n      <p class="p-3 iblock">What productivity suite does your company use today?</p>\n      <div id="productivity-drop" class="roi-drop iblock"></div>\n    </div>\n    <div class="question">\n      <p class="p-3 iblock">How many countries do you have employees in today?</p>\n      <input type="number" id="_countries" name="roi-countries" value="',((s=n.if.call(t,t.countries,{hash:{},inverse:this.program(3,l,r),fn:this.program(1,function(e,t){var i;return i=(i=n.countries)?i.call(e,{hash:{},data:t}):(void 0===(i=e.countries)?"undefined":_typeof(i))===a?i.apply(e):i,c(i)},r),data:r}))||0===s)&&(o+=s),o+='" placeholder="number of countries" class="required">\n    </div>\n    <div class="question">\n      <p class="p-3 iblock">How many users require a phone number in your company?</p>\n      <input type="number" id="_users" name="roi-users" value="',((s=n.if.call(t,t.users,{hash:{},inverse:this.program(3,l,r),fn:this.program(5,function(e,t){var i;return i=(i=n.users)?i.call(e,{hash:{},data:t}):(void 0===(i=e.users)?"undefined":_typeof(i))===a?i.apply(e):i,c(i)},r),data:r}))||0===s)&&(o+=s),o+='" placeholder="number of users" class="required">\n    </div>\n    <div class="question slider-question">\n      <p class="p-3 iblock">What is the average salary of your employees?</p>\n      <div id="salary-slider-user" class="roi-slider block"></div>\n    </div>\n    <div class="btn-container">\n      <div class="next-btn btn p-btn rfloat disabled">Next</div>\n    </div>\n  </div>\n  <img id="step-one-right" src="https://storage.googleapis.com/switch_static/guest/redesign/roi_calculator/step-1-right.svg" style="max-width:67px" alt="Dialpad ROI Calculator">\n</div>\n'})}),define("guest/views/roi_panel_one_view",["views/common/view","views/common/select_menu_view","guest/views/common/slider_view","hbs!guest/templates/roi_panel_one"],function(e,t,n,i){return e.extend({template:i,events:{"change .question > input":"_valueEntered","click .next-btn":"_nextPanel"},PHONE_SYSTEM:[{name:"Cloud",value:"Cloud"},{name:"On Premise",value:"On Premise"}],PRODUCTIVITY:[{name:"G Suite",value:"GSuite"},{name:"Office 365",value:"Office365"},{name:"Other",value:"Other"}],initialize:function(t){e.prototype.initialize.call(this),this.options=t,this._createMenus(),this._createSliders(),this._isComplete(),$(window).on("keyup",$.proxy(this._keyUp,this)),this.listenTo(Backbone,"roi:tab_click",this._tabClick)},postRender:function(){this._isComplete()},getTemplateData:function(){return{countries:this.options.values._countries,users:this.options.values._users}},_createMenus:function(){var e={name:"_phoneSystem",items:this.PHONE_SYSTEM,placeholder:"choose here",cssClass:"required",autocomplete:"off"};this.options.values._phoneSystem&&(e.selected=this.options.values._phoneSystem),this._phoneSystemMenu=new t(e),this.addChild(this._phoneSystemMenu,"#system-drop"),this.listenTo(this._phoneSystemMenu,"changed",this._valueEntered);var n={name:"_productivity",items:this.PRODUCTIVITY,placeholder:"choose here",cssClass:"required",autocomplete:"off"};this.options.values._productivity&&(n.selected=this.options.values._productivity),this._productivityMenu=new t(n),this.addChild(this._productivityMenu,"#productivity-drop"),this.listenTo(this._productivityMenu,"changed",this._valueEntered)},_createSliders:function(){var e={name:"_salaryUser",min:30,min_label:"30 K",max:150,max_label:"150+ K",value:60,value_display:!0,suffix:" K",labels:[{label_name:"60 K"},{label_name:"90 K"},{label_name:"120 K"}]};this.options.values._salaryUser&&(e.value=this.options.values._salaryUser),this._salarySliderUser=new n(e),this.addChild(this._salarySliderUser,"#salary-slider-user"),this.options.values._salaryUser=60,this.listenTo(this._salarySliderUser,"changed",this._valueEntered)},_valueEntered:function(e){var t=e.name||$(e.currentTarget).attr("id"),n=e.value||e.target.value;this.options.values[t]=n,this._isComplete(e)},_keyUp:function(e){e.stopPropagation(),e.preventDefault(),13!==e.which||"div.sm-input-shim"===e.target||this.$(".btn").hasClass("disabled")||this._nextPanel();var t=e.key;"number"===$(e.target).prop("type")&&t.length<2&&this._validateNumberInput($(e.target),t)},_isComplete:function(e){var t;this.$(".question").each(function(){t=!0;var n=$(this).find("input");if(e&&n.attr("id")===e.name){if(!e.value)return t=!1,!1}else if(!n.val())return t=!1,!1}),t&&$(".panel.active .btn").removeClass("disabled")},_nextPanel:function(){this._validateForm()&&($("#tab-label-one").addClass("completed"),this._dataLayerPush(),this.trigger("next",this.options))},_validateForm:function(){var e=this;e.$(".required").removeClass("required-flagged");var t=!0;return e.$(".required").each(function(){$(this).val()||($(this).addClass("required-flagged"),t=!1);var n=$(this).closest("input");"number"===n.prop("type")&&e._validateNumberInput(n,$(this).val())}),t},_validateNumberInput:function(e,t){/^[a-zA-Z]+$/.test(t)?e.prev().hasClass("error-message")?$(".error-message").css("display","inline-table"):e.before('<label class="error-message">Numerals Only</label>'):e.prev().hasClass("error-message")&&!/^[a-zA-Z]+$/.test(t)&&$(".error-message").hide()},_dataLayerPush:function(){dataLayer.push({event:"roi_panel_one_complete",type:"form"})},_tabClick:function(e,t){this.trigger("index",e,t)}})}),define("hbs!guest/templates/roi_panel_two",["handlebars"],function(e){return e.template(function(e,t,n,i,r){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=r||{};var s,o="",a="function",c=this.escapeExpression;function l(e,t){var i;return i=(i=n.annualCost)?i.call(e,{hash:{},data:t}):(void 0===(i=e.annualCost)?"undefined":_typeof(i))===a?i.apply(e):i,c(i)}function u(e,t){return""}function h(e,t){var i;return i=(i=n.deskPhones)?i.call(e,{hash:{},data:t}):(void 0===(i=e.deskPhones)?"undefined":_typeof(i))===a?i.apply(e):i,c(i)}function d(e,t){var i;return i=(i=n.itProfessionals)?i.call(e,{hash:{},data:t}):(void 0===(i=e.itProfessionals)?"undefined":_typeof(i))===a?i.apply(e):i,c(i)}return o+='<div class="rel">\n  <img id="step-two-left" src="https://storage.googleapis.com/switch_static/guest/redesign/roi_calculator/step-2-left.svg" style="max-width:368px" alt="Dialpad ROI Calculator">\n  <div id="tab-panel-two" class="panel">\n    <div id="step-two-cloud">\n      <div class="question">\n        <p class="p-3 iblock">What is your current annual cost of service with existing provider?</p>\n        <input type="number" id="_annualCostCloud" name="roi-annual-cost" value="',((s=n.if.call(t,t.annualCost,{hash:{},inverse:this.program(3,u,r),fn:this.program(1,l,r),data:r}))||0===s)&&(o+=s),o+='" placeholder="annual cost" class="required">\n      </div>\n      <div class="question">\n        <p class="p-3 iblock">How many desk phones does your company own today?</p>\n        <input type="number" id="_deskPhones" name="roi-desk-phones" value="',((s=n.if.call(t,t.deskPhones,{hash:{},inverse:this.program(3,u,r),fn:this.program(5,h,r),data:r}))||0===s)&&(o+=s),o+='" placeholder="number of desk phones" class="required">\n      </div>\n      <div class="question">\n        <p class="p-3 iblock">How many IT professionals are dedicated to your phone system?</p>\n        <input type="number" id="_itProfessionalsCloud" name="roi-it-professionals" value="',((s=n.if.call(t,t.itProfessionals,{hash:{},inverse:this.program(3,u,r),fn:this.program(7,d,r),data:r}))||0===s)&&(o+=s),o+='" placeholder="number of IT professionals" class="required">\n      </div>\n      <div class="question slider-question">\n        <p class="p-3 iblock">What\'s the average salary of one of these IT professionals?</p>\n        <div id="salary-slider-cloud" class="roi-slider block"></div>\n      </div>\n      <div class="btn-container">\n        <div class="next-btn btn p-btn rfloat disabled">Next</div>\n      </div>\n    </div>\n    <div id="step-two-hardware">\n      <div class="question">\n        <p class="p-3 iblock">What is your current annual cost of service with existing provider?</p>\n        <input type="number" id="_annualCostHardware" name="roi-annual-cost" value="',((s=n.if.call(t,t.annualCost,{hash:{},inverse:this.program(3,u,r),fn:this.program(1,l,r),data:r}))||0===s)&&(o+=s),o+='" placeholder="annual cost" class="required">\n      </div>\n      <div class="question">\n        <p class="p-3 iblock">How many desk phones does your company own today?</p>\n        <input type="number" id="_deskPhones" name="roi-desk-phones" value="',((s=n.if.call(t,t.deskPhones,{hash:{},inverse:this.program(3,u,r),fn:this.program(5,h,r),data:r}))||0===s)&&(o+=s),o+='" placeholder="number of desk phones" class="required">\n      </div>\n      <div class="question">\n        <p class="p-3 iblock">How much do you spend annually on hardware?</p>\n        <input type="number" id="_hardware" name="roi-hardware" value="',((s=n.if.call(t,t.hardware,{hash:{},inverse:this.program(3,u,r),fn:this.program(9,function(e,t){var i;return i=(i=n.hardware)?i.call(e,{hash:{},data:t}):(void 0===(i=e.hardware)?"undefined":_typeof(i))===a?i.apply(e):i,c(i)},r),data:r}))||0===s)&&(o+=s),o+='" placeholder="hardware cost" class="required">\n      </div>\n      <div class="question">\n        <p class="p-3 iblock">How many IT professionals are dedicated to your phone system?</p>\n        <input type="number" id="_itProfessionalsHardware" name="roi-it-professionals" value="',((s=n.if.call(t,t.itProfessionals,{hash:{},inverse:this.program(3,u,r),fn:this.program(7,d,r),data:r}))||0===s)&&(o+=s),o+='" placeholder="number of IT professionals" class="required">\n      </div>\n      <div class="question slider-question">\n        <p class="p-3 iblock">What\'s the average salary of one of these IT professionals?</p>\n        <div id="salary-slider-hardware" class="roi-slider block"></div>\n      </div>\n      <div class="btn-container">\n        <div class="next-btn btn p-btn rfloat disabled">Next</div>\n      </div>\n    </div>\n  </div>\n  <img id="step-two-right" src="https://storage.googleapis.com/switch_static/guest/redesign/roi_calculator/step-2-right.svg" style="max-width: 98px" alt="Dialpad ROI Calculator">\n</div>\n'})}),define("guest/views/roi_panel_two_view",["views/common/view","guest/views/common/slider_view","hbs!guest/templates/roi_panel_two"],function(e,t,n){return e.extend({template:n,events:{"change .question > input":"_valueEntered","click .panel .next-btn":"_nextPanel"},initialize:function(t){e.prototype.initialize.call(this),this.options=t,this._panelView=this._isCloud()?"#step-two-cloud":"#step-two-hardware",this._updateTabs(),this._createSliders(),this._isComplete(),$(window).on("keyup",$.proxy(this._keyUp,this)),this.listenTo(Backbone,"roi:tab_click",this._tabClick)},getTemplateData:function(){return{annualCost:this.options.values._annualCostCloud?this.options.values._annualCostCloud:this.options.values._annualCostHardware,deskPhones:this.options.values._deskPhones,itProfessionals:this.options.values._itProfessionalsCloud?this.options.values._itProfessionalsCloud:this.options.values._itProfessionalsHardware,hardware:this.options.values.hardware}},postRender:function(){this._isCloud()?this.$("#step-two-hardware").hide():this.$("#step-two-cloud").hide()},_updateTabs:function(){$(".tab").removeClass("checked"),$("#tab-label-two").addClass("checked")},_createSliders:function(){if(this._isCloud()){var e={name:"_salaryCloud",min:30,min_label:"30 K",max:150,max_label:"150+ K",value:60,value_display:!0,suffix:" K",labels:[{label_name:"60 K"},{label_name:"90 K"},{label_name:"120 K"}]};this.options.values._salaryCloud&&(e.value=this.options.values._salaryCloud),this._salarySliderCloud=new t(e),this.addChild(this._salarySliderCloud,"#salary-slider-cloud"),this.options.values._salaryCloud=60,this.listenTo(this._salarySliderCloud,"changed",this._valueEntered)}else{var n={name:"_salaryCloud",min:30,min_label:"30 K",max:150,max_label:"150+ K",value:60,value_display:!0,suffix:" K",labels:[{label_name:"60 K"},{label_name:"90 K"},{label_name:"120 K"}]};this.options.values._salaryHardware&&(n.value=this.options.values._salaryHardware),this._salarySliderHardware=new t(n),this.addChild(this._salarySliderHardware,"#salary-slider-hardware"),this.options.values._salaryHardware=60,this.listenTo(this._salarySliderHardware,"changed",this._valueEntered)}},_valueEntered:function(e){var t=e.name||$(e.currentTarget).attr("id"),n=e.value||e.target.value;this.options.values[t]=n,this._isComplete(e)},_keyUp:function(e){13===e.which&&this._nextPanel();var t=e.key;"number"===$(e.target).prop("type")&&t.length<2&&this._validateNumberInput($(e.target),t)},_isComplete:function(e){var t;$(this._panelView+" .question").each(function(){t=!0;var n=$(this).find("input");if(e&&n.attr("id")===e.name){if(!e.value)return t=!1,!1}else if(!n.val())return t=!1,!1}),t&&this.$(".panel .btn").removeClass("disabled")},_nextPanel:function(){this._validateForm()&&($("#tab-label-two").addClass("completed"),this._dataLayerPush(),this.trigger("next",this.options.values))},_validateForm:function(){var e=this;e.$(".required").removeClass("required-flagged");var t=!0;return $(this._panelView+" .required").each(function(){$(this).val()||($(this).addClass("required-flagged"),t=!1);var n=$(this).closest("input");"number"===n.prop("type")&&e._validateNumberInput(n,$(this).val())}),t},_validateNumberInput:function(e,t){/^[a-zA-Z]+$/.test(t)?e.prev().hasClass("error-message")?$(".error-message").css("display","inline-table"):e.before('<label class="error-message">Numerals Only</label>'):e.prev().hasClass("error-message")&&!/^[a-zA-Z]+$/.test(t)&&$(".error-message").hide()},_isCloud:function(){return"Cloud"===this.options.values._phoneSystem},_dataLayerPush:function(){dataLayer.push({event:"roi_panel_two_complete",type:"form"})},_tabClick:function(e,t){this.trigger("index",e,t)}})}),define("numbers_helpers",[],function(){return{commaSeparated:function(e){for(;/(\d+)(\d{3})/.test(e.toString());)e=e.toString().replace(/(\d+)(\d{3})/,"$1,$2");return e}}}),define("hbs!guest/templates/roi_panel_results",["handlebars"],function(e){return e.template(function(e,t,n,i,r){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=r||{};var s,o="",a=this.escapeExpression;return o+='  <div id="tab-panel-three" class="panel" style="display:none;">\n    <div class="hide results-overlay">\n      <div class="results-overlay-container">\n        <div class="main-background-0 results-overlay-wrapper">\n          <div class="rel">\n            <img id="step-three-email" src="https://storage.googleapis.com/switch_static/guest/redesign/roi_calculator/results-pop-up.svg" style="max-width:894px" alt="Dialpad ROI Calculator">\n            <p class="p-3 uppercase base-color-7 rfloat results-overlay-close">X</p>\n            <h2 class="base-color-7 center">Thank You</h2>\n            <p class="base-color-7 center">Your personalized free report is on its way.</p>\n            <p class="base-color-7 center">Interested in learning more about Dialpad?</p>\n            <div>\n              <div class="btn-container center">\n                <a href="/voice-and-video">\n                  <div class="btn p-btn">Learn More</div>\n                </a>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n<div class="rel">\n  <img id="step-three-left-back" src="https://storage.googleapis.com/switch_static/guest/redesign/roi_calculator/results-left-back.svg" style="max-width:310px" alt="Dialpad ROI Calculator">\n  <div class="results main-background-2">\n    <img id="step-three-left-front" src="https://storage.googleapis.com/switch_static/guest/redesign/roi_calculator/results-left-front.svg" style="max-width:61px" alt="Dialpad ROI Calculator">\n    <div class="results-wrapper">\n      <div class="results-row">\n        <h5 class="base-color-7">Average Annual Net Benefit</h5>\n        <h1 class="base-color-7">$ ',o+=a(s=(s=n.result_annual_savings)?s.call(t,{hash:{},data:r}):"function"===(void 0===(s=t.result_annual_savings)?"undefined":_typeof(s))?s.apply(t):s)+'</h1>\n      </div>\n      <div class="results-row">\n        <p class="p-3 base-color-7">Annual Benefit from Increased Employee Productivity</p>\n        <h3 class="base-color-7">$ ',o+=a(s=(s=n.result_productivity)?s.call(t,{hash:{},data:r}):"function"===(void 0===(s=t.result_productivity)?"undefined":_typeof(s))?s.apply(t):s)+'</h3>\n      </div>\n      <div class="results-row">\n        <p class="p-3 base-color-7">Reduced Telephony Expense with Dialpad</p>\n        <h3 class="base-color-7">$ ',o+=a(s=(s=n.result_system_savings)?s.call(t,{hash:{},data:r}):"function"===(void 0===(s=t.result_system_savings)?"undefined":_typeof(s))?s.apply(t):s)+'</h4>\n      </div>\n      <div class="results-row">\n        <p class="p-3 base-color-7">Reduced Annual Personnel Expense</p>\n        <h3 class="base-color-7">$ ',o+=a(s=(s=n.result_it)?s.call(t,{hash:{},data:r}):"function"===(void 0===(s=t.result_it)?"undefined":_typeof(s))?s.apply(t):s)+'</h3>\n      </div>\n      <p class="contact-callout p-3 base-color-7">Enter your e-mail to have your report sent to you.</p>\n      <div>\n        <input type="text" id="_email" name="roi-email" placeholder="e-mail address" class="required iblock">\n        <div class="btn-container">\n          <div class="btn p-btn main-background-0">Submit</div>\n        </div>\n      </div>\n    </div>\n    <img id="step-three-right-front" src="https://storage.googleapis.com/switch_static/guest/redesign/roi_calculator/results-right-front.svg" style="max-width:49px" alt="Dialpad ROI Calculator">\n  </div>\n  <img id="step-three-right-back" src="https://storage.googleapis.com/switch_static/guest/redesign/roi_calculator/results-right-back.svg" style="max-width:176px" alt="Dialpad ROI Calculator">\n</div>\n'})}),define("guest/views/roi_panel_results_view",["views/common/view","email","numbers_helpers","marketo","hbs!guest/templates/roi_panel_results"],function(e,t,n,i,r){return e.extend({template:r,events:{"click .results-wrapper .btn":"_emailSubmit","click .results-overlay-close":"_closeOverlay"},initialize:function(t){console.log("initialize"),e.prototype.initialize.call(this),this.dataEntered=this.options.values.annual_savings,this.options=t,this._updateTabs(),this._calculateResults(),this._completedCalculation(),$(window).on("keyup",$.proxy(this._keyUp,this)),this.listenTo(Backbone,"roi:tab_click",this._tabClick)},postRender:function(){this.dataEntered&&(console.log("postRender send mkto"),this._sendMkto()),this.$("#tab-panel-three").fadeIn()},getTemplateData:function(){return{_productivity:this.options.values._productivity,result_annual_savings:n.commaSeparated(this.options.values.annual_savings),result_productivity:n.commaSeparated(this.options.values.productivity),result_system_savings:n.commaSeparated(this.options.values.system_savings),result_it:n.commaSeparated(this.options.values.it)}},_updateTabs:function(){$(".tab").removeClass("checked"),$("#tab-label-three").addClass("checked completed")},_completedCalculation:function(){$("#tab-label-three").click(function(){return!1})},_emailSubmit:function(){this._calculateResults();var e=$("#_email");e.removeClass("required-flagged"),this._verifyEmail()?(this.options.values.email=e.val(),$(".results-overlay").fadeIn(),this._dataLayerPush(),this._sendMkto()):$("#_email").addClass("required-flagged")},_keyUp:function(e){13===e.which&&this._emailSubmit()},_verifyEmail:function(){var e=$("#_email").val();return t.isEmail(e)},_valuesToInt:function(){var e=this;$.each(e.options.values,function(t,n){"_phoneSystem"!==t&&"_productivity"!==t&&(e.options.values[t]=parseFloat(n))})},_calculateResults:function(){this._valuesToInt(),this._productivityCalculation(),this._systemSavingsCalculation(),this._itSavingsCalculation(),this._annualSavingsCalculation()},_productivityCalculation:function(){var e=this.options.values._users*(1e3*this.options.values._salaryUser)*.04;this.options.values.productivity=e.toFixed(2)},_systemSavingsCalculation:function(){var e;e=this._isCloud()?this.options.values._annualCostCloud-25*this.options.values._users:this.options.values._annualCostHardware+this.options.values._hardware-25*this.options.values._users,this.options.values.system_savings=e.toFixed(2)},_itSavingsCalculation:function(){var e,t;this._isCloud()?(t=this.options.values._itProfessionalsCloud,e=1e3*this.options.values._salaryCloud):(t=this.options.values._itProfessionalsHardware,e=1e3*this.options.values._salaryHardware);var n=t*e*.9;this.options.values.it=n.toFixed(2)},_annualSavingsCalculation:function(){var e;e=this._isCloud()?this.options.values._annualCostCloud+this.options.values._itProfessionalsCloud*(1e3*this.options.values._salaryCloud)-(25*this.options.values._users+this.options.values._itProfessionalsCloud*(1e3*this.options.values._salaryCloud)*.1):this.options.values._annualCostHardware+this.options.values._hardware+this.options.values._itProfessionalsHardware*(1e3*this.options.values._salaryHardware)-(25*this.options.values._users+this.options.values._itProfessionalsHardware*(1e3*this.options.values._salaryHardware)*.1),this.options.values.annual_savings=e.toFixed(2)},_isCloud:function(){return"Cloud"===this.options.values._phoneSystem},_dataLayerPush:function(){dataLayer.push({event:"roi_panel_three_email_entered",type:"form"})},_sendMkto:function(){var e=this.options.values.email,t=this.options.values._phoneSystem,r=this.options.values._productivity,s=this.options.values._countries,o=n.commaSeparated(this.options.values._users),a=n.commaSeparated(1e3*this.options.values._salaryUser),c=this.options.values._annualCostCloud?n.commaSeparated(this.options.values._annualCostCloud):n.commaSeparated(this.options.values._annualCostHardware),l=this.options.values._deskPhones,u=this.options.values._hardware?n.commaSeparated(this.options.values._hardware):null,h=this.options.values._itProfessionalsCloud?this.options.values._itProfessionalsCloud:this.options.values._itProfessionalsHardware,d=this.options.values._salaryCloud?1e3*n.commaSeparated(this.options.values._salaryCloud):1e3*n.commaSeparated(this.options.values._salaryHardware),f=n.commaSeparated(this.options.values.productivity),p=n.commaSeparated(this.options.values.system_savings),g=n.commaSeparated(this.options.values.it),m=n.commaSeparated(this.options.values.annual_savings);if("undefined"!=typeof MktoForms2){var _={Email:e,rOICalcSystem:t,productivitySuite:r,rOICalcNumberofCountries:s,rOICalcNumberofUsers:o,rOICalcAverageSalaryofUsers:a,rOICalcCurrentAnnualCost:c,rOICalcNumberofDeskPhones:l,rOICalcIfonpremiseAnnualCostofHardware:u,rOICalcNumberofITProfessionals:h,rOICalcAverageSalaryofITProfessionals:d,rOICalcProductivitySavings:f,rOICalcSystemSavings:p,rOICalcITSavings:g,rOICalcAnnualSavings:m};i.submit(1723,_)}else console.log("Marketo Forms not available. Not sending any data");return!1},_closeOverlay:function(){$(".results-overlay").fadeOut()},_tabClick:function(e,t){this.trigger("index",e,t)}})}),define("guest/views/roi_panel_flow_view",["views/common/flow_view","guest/views/roi_panel_one_view","guest/views/roi_panel_two_view","guest/views/roi_panel_results_view"],function(e,t,n,i){return e.extend({initialize:function(r){var s=[t,n,i];e.prototype.initialize.call(this,r,s,r)},_setView:function(t){e.prototype._setView.call(this,t)}})}),define("hbs!guest/templates/roi_calculator",["handlebars"],function(e){return e.template(function(e,t,n,i,r){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=r||{},'<div id="tabs"></div>\n<div id="panels"></div>'})}),define("guest/views/roi_calculator",["views/common/view","guest/views/roi_tabs_view","guest/views/roi_panel_flow_view","hbs!guest/templates/roi_calculator"],function(e,t,n,i){return e.extend({template:i,el:"#roi-calc-tabs",initialize:function(i){e.prototype.initialize.call(this),this.addChild(new t(i),"#tabs"),this.addChild(new n(i),"#panels")}})}),define("hbs!guest/templates/international_form",["handlebars"],function(e){return e.template(function(e,t,n,i,r){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=r||{},'<form class="form" method="post">\n  <input type="hidden" id="source" name="source" value="international-waitlist">\n  <input type="text" id="name" name="name" value="" placeholder="Name&#42;" class="required" title="Name" required aria-required="true">\n  <input type="email" id="email" name="email" value="" placeholder="Email&#42;" title="Email" class="required" required aria-required="true">\n  <div id="countries-list"></div>\n  <div id="signup-btn" class="mblock btn s-btn-inv">Notify Me</div>\n</form>'})}),define("guest/views/international_form_view",["views/common/select_menu_view","views/common/view","hbs!guest/templates/international_form","email","form_verify","text!fslib/all_countries.json","marketo"],function(e,t,n,i,r,s,o){return t.extend({template:n,el:"#international-waitlist-form",events:{"click #signup-btn":"_submit"},initialize:function(){t.prototype.initialize.call(this),$(".su-facebook").on("click",$.proxy(this._facebook,this)),this._submitLock=!1,this._country=this.options.country,this._createMenu()},render:function(){return t.prototype.render.call(this)},_createMenu:function(){var t=JSON.parse(s),n=t.countries[this._country]?t.countries[this._country].name:"Afghanistan";delete t.countries.US,this._countriesMenu=new e({name:"countries",items:t.countries,selected:n}),this.addChild(this._countriesMenu,"#countries-list")},_dataLayerPush:function(e,t){dataLayer.push({event:"inbound_message",type:"international",country:e,user_email:t})},_submit:function(){var e=$("#email").val(),t=$("#name").val(),n=$("#countries").val();if(i.isEmail(e)&&t&&n&&!this._submitLock){$("#international-waitlist-form :input").prop("disabled",!0),this._submitLock=!0,r.removeRequired("#international-waitlist-form");var s=_.bind(function(){this._submitLock=!1,this._showConfirmation(),this._dataLayerPush(n,e)},this);if("undefined"!=typeof MktoForms2){var a={LastName:t,Email:e,Country:n};o.submit(1133,a)}else console.log("Marketo Forms not available. Not sending any data");s()}else r.checkRequired("#international-waitlist-form")},_showConfirmation:function(){window.scrollTo(0,0),$("#main-intl-waitlist").fadeOut(500,function(){$("#signup-complete").fadeIn(400)})},_facebook:function(){FB.ui({method:"share",href:"https://dialpad.com"},function(e){})}})}),define("hbs!guest/templates/event_form",["handlebars"],function(e){return e.template(function(e,t,n,i,r){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=r||{},'<form id="event-form" class="form" method="post">\n  <input type="hidden" id="source" name="source" value="event">\n  <input type="hidden" id="event-name" name="event-name" value="Default Event Name">\n  <div class="iblock">\n    <input type="text" id="name" name="name" value="" placeholder="Name&#42;" title="Full Name" class="required" required aria-required="true">\n  </div>\n  <div class="iblock">\n    <input type="email" id="email" name="email" value="" placeholder="Email&#42;" title="Email" class="required" required aria-required="true">\n  </div>\n  <div class="iblock">\n    <input type="tel" id="phone" name="phone" value="" placeholder="Phone number" title="Phone number">\n  </div>\n  <div class="iblock">\n    <input type="text" id="co-name" name="coName" value="" placeholder="Company name&#42;" title="Company name" class="required" required aria-required="true">\n  </div>\n  <div id="co-size" class="iblock required"></div>\n  <div id="register-btn" class="btn p-btn">Register</div>\n</form>'})}),define("guest/views/event_view",["views/common/select_menu_view","views/common/view","hbs!guest/templates/event_form","email","form_verify"],function(e,t,n,i,r){return t.extend({template:n,el:"#event-form",events:{"click #register-btn":"_submit"},initialize:function(){this._companySizes=[{name:"0-49",value:"0-49"},{name:"50-349",value:"50-349"},{name:"350-999",value:"350-999"},{name:"1000+",value:"1000+"}],t.prototype.initialize.call(this),this._createMenu()},render:function(){return t.prototype.render.call(this)},_createMenu:function(){this._coSizeMenu=new e({name:"company-size",items:this._companySizes,unselected:"Company size*"}),this.addChild(this._coSizeMenu,"#co-size")},_dataLayerPush:function(e){dataLayer.push({event:"inbound_message",type:"event",company_size:e})},_submit:function(){var e,t=$("#email").val(),n=$("#name").val(),s=$("#phone").val(),o=$("#co-name").val();$("#event_form #company-size").addClass("required"),e=$("#company-size").val().split("-").length>1?$("#company-size").val().split("-")[1]:$("#company-size").val().slice(0,-1),i.isEmail(t)&&n&&o&&e?($("#sfevt_form :input, #co-size, #register").prop("disabled",!0),r.removeRequired("#event-form"),$.ajax({url:"/api/waitlist",contentType:"application/json",data:JSON.stringify({email:t,name:n,phone:s,company_name:o,size:e,source:$("#source").val(),event_name:$("#event-name").val()}),dataType:"json",type:"post",complete:_.bind(function(){this._showConfirmation(),this._dataLayerPush(e)},this)})):r.checkRequired("#event-form",!0)},_showConfirmation:function(){$("#event-form").fadeOut(500,function(){$("#form-submit").fadeIn(400),$("#event_form").remove()})}})}),define("hbs!guest/templates/mktg_form",["handlebars"],function(e){return e.template(function(e,t,n,i,r){return this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=r||{},'<form id="mktg-main-form" class="form" method="post">\n<input type="hidden" id="mktg-source" name="mktg-source" value="mktg-main-form">\n<input type="text" id="mktg-name" name="mktg-name" value="" placeholder="NAME" class="required" required aria-required="true"><input\n  type="text" id="mktg-email" name="mktg-email" value="" placeholder="WORK EMAIL" class="required" required aria-required="true"><input\n  type="text" id="mktg-phone" name="mktg-phone" value="" placeholder="PHONE" class="required" required aria-required="true"><div id="mktg-co-size" class="iblock">\n  </div><div id="mktg-request-btn" class="iblock btn p-btn">REQUEST DEMO</div>\n</form>\n<p class="error-msg">Please enter <span id="errored-el"></span>.</p>'})}),define("guest/views/mktg_form_view",["views/common/view","views/common/select_menu_view","guest/views/contact_dialog_confirm_view","email","fslib/company_sizes","form_verify","hbs!guest/templates/mktg_form"],function(e,t,n,i,r,s,o){return e.extend({template:o,el:"#mktg-main-form-cont",events:{"click #mktg-request-btn":"_submit"},initialize:function(){e.prototype.initialize.call(this),this._createMenu(),$(window).on("keyup",$.proxy(this._keyUp,this))},render:function(){return e.prototype.render.call(this)},_submit:function(){$(".error-msg").hide();var e=$("#mktg-source").val(),t=$("#mktg-name").val(),n=$("#mktg-email").val(),r=$("#mktg-phone").val(),o=$("#mktg-company-size").val();$("#mktg-main-form #mktg-company-size").addClass("required"),i.isEmail(n)&&t&&r&&o?($("#mktg-main-form :input").prop("disabled",!0),s.removeRequired("#mktg-main-form"),$.ajax({url:"/api/waitlist",contentType:"application/json",data:JSON.stringify({source:e,email:n,name:t,phone:r,size:o}),dataType:"json",type:"post",complete:_.bind(function(){this._showConfirmation(),this._dataLayerPush(o)},this)})):(s.checkRequired("#mktg-main-form",!1),"EMPLOYEES"===$("#mktg-company-size").val()&&$("#mktg-company-size").addClass("required-flagged"),this._errorMessage())},_createMenu:function(){this._mktgCoSizeMenu=new t({name:"mktg-company-size",items:companySizes.COMPANY_SIZES,unselected:"EMPLOYEES"}),this.addChild(this._mktgCoSizeMenu,"#mktg-co-size")},_keyUp:function(e){13==e.keyCode&&this._submit()},_dataLayerPush:function(e){dataLayer.push({event:"mktg_landing_message",type:"form",company_size:e})},_errorMessage:function(){$(".error-msg span").addClass("hide"),$("#errored-el").text("");var e=!1,t=!1,n=!1,r=$("#errored-el");$("#mktg-main-form .required").each(function(){var s=$(this).attr("id");$(this).val()?"mktg-email"!==s||i.isEmail($(this).val())?"mktg-company-size"===s&&"EMPLOYEES"===$(this).val()&&(e||t||n?r.append(" and your company size"):r.append(" your company size")):(e?r.append(", a valid email"):r.append(" a valid email"),t=!0):"mktg-name"===s?(r.append("your name"),e=!0):"mktg-email"==s?(e?r.append(", a valid email"):r.append(" a valid email"),t=!0):(e||t?r.append(", your phone number"):r.append(" your phone number"),n=!0)}),$(".error-msg span").removeClass("hide"),$(".error-msg").fadeIn()},_showConfirmation:function(){$("#overlay").length<1&&$("body").prepend('<div id="overlay" class="snappy"></div>'),Backbone.trigger("overlay","dialog",new n,{centered:!0})}})}),define("fslib/sdp_util",[],function(){return sdpUtil={mergeConstraints:function(e,t){if(!e||!t)return e||t;var n=e;for(var i in t)n[i]=t[i];return n},iceCandidateType:function(e){return e.split(" ")[7]},formatTypePreference:function(e){if("chrome"===adapter.browserDetails.browser)switch(e){case 0:return"TURN/TLS";case 1:return"TURN/TCP";case 2:return"TURN/UDP"}else if("firefox"===adapter.browserDetails.browser)switch(e){case 0:return"TURN/TCP";case 5:return"TURN/UDP"}return""},maybeSetOpusOptions:function(e,t){return"true"===t.opusStereo?e=this.setCodecParam(e,"opus/48000","stereo","1"):"false"===t.opusStereo&&(e=this.removeCodecParam(e,"opus/48000","stereo")),"true"===t.opusFec?e=this.setCodecParam(e,"opus/48000","useinbandfec","1"):"false"===t.opusFec&&(e=this.removeCodecParam(e,"opus/48000","useinbandfec")),"true"===t.opusDtx?e=this.setCodecParam(e,"opus/48000","usedtx","1"):"false"===t.opusDtx&&(e=this.removeCodecParam(e,"opus/48000","usedtx")),t.opusMaxPbr&&(e=this.setCodecParam(e,"opus/48000","maxplaybackrate",t.opusMaxPbr)),e},maybeSetAudioSendBitRate:function(e,t){return t.hasOwnProperty("audioSendBitrate")?(console.debug("Prefer audio send bitrate: "+t.audioSendBitrate),this.preferBitRate(e,t.audioSendBitrate,"audio")):e},maybeSetAudioReceiveBitRate:function(e,t){return t.hasOwnProperty("audioRecvBitrate")?(console.debug("Prefer audio receive bitrate: "+t.audioRecvBitrate),this.preferBitRate(e,t.audioRecvBitrate,"audio")):e},maybeSetVideoSendBitRate:function(e,t){return t.hasOwnProperty("videoSendBitrate")?(console.debug("Prefer video send bitrate: "+t.videoSendBitrate),this.preferBitRate(e,t.videoSendBitrate,"video")):e},maybeSetVideoReceiveBitRate:function(e,t){return t.hasOwnProperty("videoRecvBitrate")?(console.debug("Prefer video receive bitrate: "+t.videoRecvBitrate),this.preferBitRate(e,t.videoRecvBitrate,"video")):e},preferBitRate:function(e,t,n){var i=e.split("\r\n"),r=this.findLine(i,"m=",n);if(null===r)return console.debug("Failed to add bandwidth line to sdp, as no m-line found"),e;var s=this.findLineInRange(i,r+1,-1,"m=");null===s&&(s=i.length);var o=this.findLineInRange(i,r+1,s,"c=");null===o&&(o=r);var a=this.findLineInRange(i,o+1,s,"b=AS");if(a&&i.splice(a,1),t){var c="b=AS:"+t;i.splice(o+1,0,c)}return e=i.join("\r\n")},addGoogleSimulcastStream:function(e,t){var n=e.split("\r\n"),i=this.findLine(n,"m=","video");if(null===i)return e;n.splice(i+1,0,"a=x-google-flag:conference");var r=this.findLineInRange(n,i+1,-1,"m="),s=null===r?n.length-1:r+1;n.splice(s++,0,"a=ssrc-group:SIM 3735928559 12513054"),n.splice(s++,0,"a=ssrc-group:FID 3735928559 3203391149"),n.splice(s++,0,"a=ssrc-group:FID 12513054 3203366485");var o=t.id,a=t.getVideoTracks()[0].id;return this.addSSRCLines(n,"video",{ssrc:12513054,msid:o+" "+a,label:"primary",cname:"localVideo"}),this.addSSRCLines(n,"video",{ssrc:3203366485,msid:o+" "+a,label:"primary_rtx",cname:"localVideo"}),this.addSSRCLines(n,"video",{ssrc:3735928559,msid:o+" "+a,label:"secondary",cname:"localVideo"}),this.addSSRCLines(n,"video",{ssrc:3203391149,msid:o+" "+a,label:"secondary_rtx",cname:"localVideo"}),e=n.join("\r\n")},maybeAddGoogleSimulcastGroup:function(e,t){for(var n,i,r,s=e.split("\r\n"),o=0;o<s.length;o++){var a=s[o].match(/a=ssrc-group:FID (\d+) (\d+)/);if(a)n=a[1],i=a[2],s.splice(o,1),o--;else if(0==s[o].indexOf("m=video 1 RTP/SAVPF")&&(s[o]="m=video 1 RTP/SAVPF 100"),"a=rtpmap:116 red/90000"!=s[o])if("a=rtpmap:117 ulpfec/90000"!=s[o])if("a=rtpmap:96 rtx/90000"!=s[o])if("a=fmtp:96 apt=100"!=s[o]){if(n){var c=s[o].match("a=ssrc:"+n+" msid:(.+)");if(c&&(r=c[1]),0===s[o].indexOf("a=ssrc:"+i)){s.splice(o,1),o--;continue}if(0===s[o].indexOf("a=ssrc:"+n)){s.splice(o,1),o--;continue}}0!=s[o].length||(s.splice(o,1),o--)}else s.splice(o,1),o--;else s.splice(o,1),o--;else s.splice(o,1),o--;else s.splice(o,1),o--}return n?(s.push("a=ssrc-group:SIM "+n+" 3735928559 184594917"),s.push("a=ssrc:"+n+" cname:localCname"),s.push("a=ssrc:"+n+" msid:"+r),s.push("a=ssrc:3735928559 cname:localCname"),s.push("a=ssrc:3735928559 msid:"+r),s.push("a=ssrc:184594917 cname:localCname"),s.push("a=ssrc:184594917 msid:"+r),s.push("a=x-google-flag:conference"),s.push(""),s.join("\r\n")):(console.warn("no video ssrc found"),e)},maybeAddGoogleConferenceFlag:function(e){var t=e.split("\r\n"),n=this.findLine(t,"m=","video");return null===n?(console.debug("Failed to find video m-line"),e):(t.splice(n+1,0,"a=x-google-flag:conference"),t.join("\r\n"))},maybeSetVideoInitialSendBitRate:function(e,t){var n=t.videoSendInitialBitrate;if(!n)return e;var i=t.videoSendMaxBitrate,r=t.videoSendMinBitrate,s=e.split("\r\n");if(null===this.findLine(s,"m=","video"))return console.debug("Failed to find video m-line"),e;var o=t.videoRecvCodec;return n&&(e=this.setCodecParam(e,o,"x-google-start-bitrate",t.videoSendInitialBitrate.toString())),i&&(e=this.setCodecParam(e,o,"x-google-max-bitrate",i.toString())),r&&(e=this.setCodecParam(e,o,"x-google-min-bitrate",r.toString())),e},removePayloadTypeFromMline:function(e,t){e=e.split(" ");for(var n=0;n<e.length;++n)e[n]===t.toString()&&e.splice(n,1);return e.join(" ")},removeCodecByName:function(e,t){var n=this.findLine(e,"a=rtpmap",t);if(null===n)return e;var i=this.getCodecPayloadTypeFromLine(e[n]);e.splice(n,1);var r=this.findLine(e,"m=","video");return null===r?e:(e[r]=this.removePayloadTypeFromMline(e[r],i),e)},removeCodecByPayloadType:function(e,t){var n=this.findLine(e,"a=rtpmap",t.toString());if(null===n)return e;e.splice(n,1);var i=this.findLine(e,"m=","video");return null===i?e:(e[i]=this.removePayloadTypeFromMline(e[i],t),e)},maybeAddRtxToVideoCodec:function(e,t){if(t.codec){var n=e.split("\r\n"),i=this.findLine(n,"m=","video");if(null===i)return e;var r=this.getCodecPayloadType(n,t.codec);if(!r)return e;var s=(parseInt(r)+1).toString(),o=this.findLineInRange(n,i,n.length,"a=rtpmap",s);if(!o)o=this.findLineInRange(n,i,n.length,"a=ice-ufrag")||n.length,n.splice(o,0,"a=rtpmap:"+s+" rtx/90000");var a,c=this.findLineInRange(n,i,n.length,"a=fmtp",s);return null!==c?(a=this.parseFmtpLine(c),n.splice(c,1)):(c=o+1,a={pt:s,params:{apt:r}}),t.rtxTime&&(a.params["rtx-time"]=500),n.splice(c,0,this.writeFmtpLine(a)),n.join("\r\n")}},maybeRemoveVideoFec:function(e,t){if("false"!==t.videoFec)return e;var n=e.split("\r\n"),i=this.findLine(n,"a=rtpmap","red");if(null===i)return e;var r=this.getCodecPayloadTypeFromLine(n[i]);if(n=this.removeCodecByPayloadType(n,r),n=this.removeCodecByName(n,"ulpfec"),null===(i=this.findLine(n,"a=fmtp",r.toString())))return e;var s=this.parseFmtpLine(n[i]).pt;return null===s?e:(n.splice(i,1),(n=this.removeCodecByPayloadType(n,s)).join("\r\n"))},maybeAddRtpExtension:function(e,t){if(!t.mediaType||!t.id||!t.uri)return e;var n=e.split("\r\n"),i=this.findLine(n,"m="+t.mediaType);if(null===i)return e;var r=this.findLineInRange(n,i+1,-1,"m=");null===r&&(r=n.length);var s="a=extmap:"+t.id;return null!==this.findLineInRange(n,i,r,s)?e:(t.direction&&(s+="/"+t.direction),s+=" "+t.uri,t.attrs&&(s+=" "+t.attrs),n.splice(i+1,0,s),e=n.join("\r\n"))},maybeAddRtcpFbToCodec:function(e,t){if(!t.codec||!t.type)return e;var n=e.split("\r\n"),i=this.getCodecPayloadType(n,t.codec);if(!i)return e;var r="a=rtcp-fb:"+i+" "+t.type;if(null===this.findLine(n,r)){var s=this.findLine(n,"a=rtcp-fb:"+i);if(null===s)return e;n.splice(s+1,0,r)}return n.join("\r\n")},maybeRemoveRtcpFb:function(e,t){for(var n,i=e.split("\r\n");n=this.findLine(i,"a=rtcp-fb:",t);)i.splice(n,1);return i.join("\r\n")},maybePreferAudioSendCodec:function(e,t){return this.maybePreferCodec(e,"audio","send",t.audioSendCodec)},maybePreferAudioReceiveCodec:function(e,t){return this.maybePreferCodec(e,"audio","receive",t.audioRecvCodec)},maybePreferVideoSendCodec:function(e,t){return this.maybePreferCodec(e,"video","send",t.videoSendCodec,t.forceDefaultCodec)},maybePreferVideoReceiveCodec:function(e,t){return this.maybePreferCodec(e,"video","receive",t.videoRecvCodec,t.forceDefaultCodec)},maybePreferCodec:function(e,t,n,i,r){var s=t+" "+n+" codec";if(!i)return console.debug("No preference on "+s+"."),e;console.debug("Prefer "+s+": "+i);var o=e.split("\r\n"),a=this.findLine(o,"m=",t);if(null===a)return e;var c=this.getCodecPayloadType(o,i);return c&&(o[a]=this.setDefaultCodec(o[a],c,r)),e=o.join("\r\n")},maybeRemoveCodecByName:function(e,t){var n=e.split("\r\n"),i=this.findLine(n,"a=rtpmap",t);if(null===i)return e;var r=this.getCodecPayloadTypeFromLine(n[i]);for(n=this.removeCodecByPayloadType(n,r);i=this.findLine(n,"a=rtcp-fb:",r.toString());)n.splice(i,1);if(null!==(i=this.findLine(n,"a=fmtp",":"+r))&&n.splice(i,1),null===(i=this.findLine(n,"a=fmtp","apt="+r)))return n.join("\r\n");var s=this.parseFmtpLine(n[i]).pt;return null===s?n.join("\r\n"):(n.splice(i,1),(n=this.removeCodecByPayloadType(n,s)).join("\r\n"))},setCodecParam:function(e,t,n,i){var r=e.split("\r\n"),s=this.findFmtpLine(r,t),o={};if(null===s){var a=this.findLine(r,"a=rtpmap",t);if(null===a)return e;var c=this.getCodecPayloadTypeFromLine(r[a]);o.pt=c.toString(),o.params={},o.params[n]=i,r.splice(a+1,0,this.writeFmtpLine(o))}else(o=this.parseFmtpLine(r[s])).params[n]=i,r[s]=this.writeFmtpLine(o);return e=r.join("\r\n")},maybeAddSSRCGroup:function(e,t){var n=e.split("\r\n"),i=this.findLine(n,"m=",t.type?t.type:"video");if(null===i)return e;var r=this.findLineInRange(n,i+1,-1,"m="),s=null===r?n.length-1:r+1;return n.splice(s,0,"a=ssrc-group:"+t.groupName+" "+t.ssrcs.join(" ")),e=n.join("\r\n")},maybeRemoveVideoSSRCs:function(e){var t=e.split("\r\n");return e=(t=this.removeSSRCLines(t,"video")).join("\r\n")},maybeAddVideoSSRC:function(e,t){var n=e.split("\r\n");return e=(n=this.addSSRCLines(n,"video",t)).join("\r\n")},addVideoSSRCWithRtx:function(e,t){e=this.maybeAddSSRCGroup(e,{groupName:"FID",ssrcs:[t.ssrc,t.rtx_ssrc]}),e=this.maybeAddVideoSSRC(e,t);var n=Object.assign({},t,{ssrc:t.rtx_ssrc,label:t.label+"_rtx"});return e=this.maybeAddVideoSSRC(e,n)},addSSRCLines:function(e,t,n){var i=this.findLine(e,"m=",t);if(null===i)return e;var r=this.findLineInRange(e,i+1,-1,"m="),s=null===r?e.length-1:r+1;return e.splice(s,0,"a=ssrc:"+n.ssrc+" cname:"+n.cname),n.msid&&e.splice(++s,0,"a=ssrc:"+n.ssrc+" msid:"+n.msid),n.mslabel&&e.splice(++s,0,"a=ssrc:"+n.ssrc+" mslabel:"+n.mslabel),n.label&&e.splice(++s,0,"a=ssrc:"+n.ssrc+" label:"+n.label),e},removeSSRCLines:function(e,t){var n=this.findLine(e,"m=",t);if(null===n)return e;var i,r=this.findLineInRange(e,n+1,-1,"m=");for(null===r&&(r=e.length);i=this.findLineInRange(e,n,r,"a=ssrc");)e.splice(i,1),r--;return e},removeCodecParam:function(e,t,n){var i=e.split("\r\n"),r=this.findFmtpLine(i,t);if(null===r)return e;var s=this.parseFmtpLine(i[r]);delete s.params[n];var o=this.writeFmtpLine(s);return null===o?i.splice(r,1):i[r]=o,e=i.join("\r\n")},parseFmtpLine:function(e){var t={},n=e.indexOf(" "),i=e.substring(n+1).split("; "),r=new RegExp("a=fmtp:(\\d+)"),s=e.match(r);if(!s||2!==s.length)return null;t.pt=s[1];for(var o={},a=0;a<i.length;++a){var c=i[a].split("=");2===c.length&&(o[c[0]]=c[1])}return t.params=o,t},writeFmtpLine:function(e){if(!e.hasOwnProperty("pt")||!e.hasOwnProperty("params"))return null;var t=e.pt,n=e.params,i=[],r=0;for(var s in n)i[r]=s+"="+n[s],++r;return 0===r?null:"a=fmtp:"+t.toString()+" "+i.join("; ")},findFmtpLine:function(e,t){var n=this.getCodecPayloadType(e,t);return n?this.findLine(e,"a=fmtp:"+n.toString()):null},findLine:function(e,t,n){return this.findLineInRange(e,0,-1,t,n)},findLineInRange:function(e,t,n,i,r){for(var s=-1!==n?n:e.length,o=t;o<s;++o)if(0===e[o].indexOf(i)&&(!r||-1!==e[o].toLowerCase().indexOf(r.toLowerCase())))return o;return null},getCodecPayloadType:function(e,t){var n=this.findLine(e,"a=rtpmap",t);return n?this.getCodecPayloadTypeFromLine(e[n]):null},getCodecPayloadTypeFromLine:function(e){var t=new RegExp("a=rtpmap:(\\d+) [a-zA-Z0-9-]+\\/\\d+"),n=e.match(t);return n&&2===n.length?n[1]:null},setDefaultCodec:function(e,t,n){var i=e.split(" "),r=i.slice(0,3);if(r.push(t),!n)for(var s=3;s<i.length;s++)i[s]!==t&&r.push(i[s]);return r.join(" ")},getCodecTaneSum:function(e,t){var n=e.split("\r\n"),i=this.findFmtpLine(n,t);if(null!==i){var r=this.parseFmtpLine(n[i]);return parseInt(r["x-tane-qsum"],16)}}}});var JsSIP=JsSIP||null,_wrapper,_notif,_rtcParams;function TestCall(e){this.traceEvent=function(e){console.log(e)},this.traceEvent({config:e}),this.pc1=new RTCPeerConnection(e),this.pc2=new RTCPeerConnection(e),this.pc1.addEventListener("icecandidate",this.onIceCandidate_.bind(this,this.pc2)),this.pc2.addEventListener("icecandidate",this.onIceCandidate_.bind(this,this.pc1)),this.iceCandidateFilter_=TestCall.noFilter}define("fslib/webrtc",["underscore","backbone","config","fslib/fsutil","fslib/object","fslib/singleton","fslib/sdp_util","fslib/lazy_loader","jquery"],function(e,t,n,i,r,s,o,a,$){var c=r.extend({MAX_IDLE_TIME:60*(n.isDev?2:60)*1e3,PING_PONG_INTERVAL:5e3,DISABLE_WEBRTC_IN_PROD:!1,DISABLE_TEMASYS_INSTALL:!0,chromeStableVersion:44,chromeMinVersion:34,firefoxMinVersion:31,firefoxMaxVersion:9999,safariMinVersion:11,safariMaxVersion:9999,PRELOAD_CALL_TIMEOUT:5e3,LOG_STREAM_STATS:{AUDIO:!0,VIDEO:!1},initialize:function(){r.prototype.initialize.call(this),this.initialized=!1,this._isReady=!1,this._lastCallOptions={},this._loadingJsSip=!1,this._loadingTemasys=!1,this._temasysTimeout=null,this._temasysPollCount=0,this.$audioParent=$('<div id="audio-parent"/>'),0!=n.loadWebrtc&&this.init()},isReady:function(){return this._isReady},isStateReady:function(){return"ready"===this.callState},isLoading:function(){return this._loadingJsSip||this._loadingTemasys},init:function(t){if(n.isWidget)console.log("No JsSIP from widget");else if(this.isReady())console.log("WebRTC already initialized");else{this._params=t=t||{};var i=!0,r=this.getCompatibility(),s=t.inTemasysExperiment||!!n.isSystem;if(this._loadingTemasys=r.temasysEnabled&&s&&r.needsTemasys&&!r.temasysInitStatus.adapterReady,this._loadingTemasys){if(i=!1,this._temasysPollCount<10)return console.log("Polling for temasys ",this._temasysPollCount),++this._temasysPollCount,clearTimeout(this._temasysTimeout),void(this._temasysTimeout=e.delay(e.bind(function(){this.init(t)},this),500));console.log("Polling for Temasys ended.")}if(this.stopListening(),!i)return this.disabled=!0,void this.onInitialized(!1);if(r.needsTemasys){if(r.temasysInitStatus.notInstalled)return console.log("Temasys needed for WebRTC but not installed"),void this.onInitialized(!0);console.log("WEBRTC: has Temasys")}this._isReady=!1,r.chromeVersionSupported||r.firefoxVersionSupported||r.safariVersionSupported||r.isElectron||r.isUsingTemasys||r.isEdge?JsSIP?this._jsSipLoaded(JsSIP):(console.log("Loading JsSip dynamically"),this.listenToOnce(a,"error:jssip",this._jsSipLoadError),a.load("jssip",this._jsSipLoaded,this)):(n.disableWebrtc||console.info("JsSIP not supported for this browser. cv:"+r.chromeVersion),this.onInitialized(!0))}},onInitialized:function(e){this.initialized=!0,this.trigger("initialized"),this.reconnectAttempts=0,e||this.trigger("failed")},_jsSipLoadError:function(e){console.error("JSSip load fail:",e),this.failed=!0,this._jsSipError(e),this.trigger("jssipLoadError")},_jsSipError:function(e){console.error("JSSip fail:",e),this._renegotiating=!1,this.trigger("failed")},_isActiveXEnabled:function(){var e=null;try{e=!!new ActiveXObject("htmlfile")}catch(t){e=!1}return e},getCompatibility:function(){if(this.DISABLE_WEBRTC_IN_PROD&&!n.isDev&&!n.isStaging&&!n.isSystem)return console.log("WebRTC temporarily disabled"),{webrtcDisabled:!0};if(n.disableWebrtc)return{webrtcDisabled:!0};var e,t=i.getChromeVersion(!0),r=i.getFirefoxVersion(!0),s=i.getSafariVersion(!0),o=!!i.isChrome()&&t>=this.chromeMinVersion,a=!!i.isChrome()&&!o,c=i.isFirefox()&&r>=this.firefoxMinVersion,l=i.isFirefox()&&!c,u=c&&!n.disableFirefoxWebRtc,h=i.isSafari()&&s>=this.safariMinVersion,d=i.isSafari()&&!h,f=i.isIE()&&(!window.uc_ie||!window.uc_ie.lt9)&&this._isActiveXEnabled(),p=i.isIE()&&!f,g=!!n.temasys_enabled&&!s,m=!!this._params&&!!this._params.inTemasysExperiment,_=f,v=this.getTemasysPlugin(),y=!(!_||!v),b=_&&!y&&m,S=window._temasysInitStatus||{},C=S.isUsingTemasys&&m,w=i.supportsWebRtc();return w&&(i.isChrome()||i.isFirefox()||i.isSafari()||i.isIE()||i.isEdge()||i.isElectron()||(w=!1),r&&n.disableFirefoxWebRtc&&(w=!1),!_||y&&g&&m||(w=!1),(a||l||d||p)&&(w=!1)),n.isStaging&&(o=u=!0,l=a=!1,w=!0),e=!(!g||!(!this.DISABLE_TEMASYS_INSTALL&&_||y))||(o||u||i.isElectron()||h||i.isEdge()),{webrtcDisabled:!1,webRtcSupported:w,chromeVersion:t,chromeVersionSupported:o,isChromeButVersionNotSupported:a,firefoxVersion:r,disableFirefoxWebRtc:n.disableFirefoxWebRtc,firefoxVersionSupported:c,isFirefoxButVersionNotSupported:l,isElectron:i.isElectron(),safariVersion:s,safariVersionSupported:h,isSafariButVersionNotSupported:d,isIE:i.isIE(),ieVersionSupported:f,isIeButVersionNotSupported:p,isEdge:i.isEdge(),allowWebRtcCallOption:e,temasysEnabled:g,needsTemasys:_,hasTemasys:y,isUsingTemasys:C&&g,promptToInstallTemasys:b&&g,temasysPlugin:v,temasysInitStatus:S}},getTemasysPlugin:function(){return window.AdapterJS&&AdapterJS.WebRTCPlugin&&AdapterJS.WebRTCPlugin.plugin},_jsSipLoaded:function(e){this.stopListening(a,"error:jssip",this._dependenciesError),this.JsSIP=e,JsSIP=this.JsSIP,this._loadingJsSip=!1,this._isReady=!0,this.loadedDate=new Date,this.disabled=!1,console.info("WebRtc READY"),this.onInitialized(!0),this.loaded=!0,this.trigger("ready"),this.trigger("loaded")},_dependenciesError:function(e){console.error("JSSip load fail:",e),this.failed=!0,this.stopListening(a,"error:jssip",this._dependenciesError),this.onInitialized(!1)},_resetIEAudio:function(){if(this.localAudio)try{this.localAudio.pause()}catch(e){console.error("error pausing local audio",e)}if(this.remoteAudio)try{this.remoteAudio.pause()}catch(e){console.error("error pausing remote audio",e)}this.$audioParent.html(""),$("body").append(this.$audioParent);var e=$("<audio autoplay muted/>"),t=$("<audio autoplay />");this.$audioParent.append(e).append(t),this.localAudio=e[0],this.remoteAudio=t[0],this._setRemoteAudioVolume()},start:function(t,r){if(!this.isReady())return this.init(),this.listenToOnce(this,"loaded",e.bind(function(){this.start(t,r)},this)),void console.log("jssip is not loaded");if(this.reconnectAttempts&&console.error("reconnectAttempts = "+this.reconnectAttempts),r&&(this._resetReconnectAttempts(),console.log("Forcing webrtc start.")),this.hasFatalFailure())this._onFatalFailure();else if(this.client)console.log("webrtc already started");else{t||(console.log("Starting webrtc.js without options..."),t={}),this.options=t,this.startDate=new Date,clearInterval(this._reconnectId),this._reconnectId=setInterval(this.verifyConnection,this.MAX_IDLE_TIME),this.registerAttempts=0,this.emulate=t.emulate,this.phone=t.phone,this.user=t.user||"UC-WebRTC-Client",this.realm=t.realm||n.sipRegistrarDomain,this.realms=t.realms,i.isIE()||(this.localAudio=new Audio,this.localAudio.autoplay=!0,this.localAudio.volume=0,this.remoteAudio=new Audio,this.remoteAudio.autoplay=!0,this.remoteAudio.oncanplaythrough=this.remoteAudio.play,this.muteRemoteAudio(!!t.muteRemoteAudio)),this.realms&&(this.realm=e.first(this.realms).ws_uri||this.realm,this.realm=e.last(this.realm.split("//"))),this.displayName=t.name,this.webrtcEngine=t.webrtcEngine||"69.39.239.94",this.userAgent=t.userAgent||"UC-webrtc-client/1.0",this.sipUri=t.sipUri||"sip:"+this.user+"@"+this.realm,this.reconnect=null==t.reconnect||t.reconnect,this.protocol=n.isDev&&n.isLocalTelephonyEnabled?"ws://":"wss://",this.logStats=!!t.logStats,this.useUpdate=!t.hasOwnProperty("useUpdate")||!!t.useUpdate,this.webrtcEngine&&(this.sipUrl+=";fs_path=sip:"+this.webrtcEngine),t.register_expires&&console.info("Custom Registration Time: "+t.register_expires),this.configuration={ws_servers:t.ws_servers||this.realms||this.protocol+this.realm,uri:this.sipUri,password:t.password||"firespotter",register:this.options.register,register_expires:t.register_expires?parseInt(t.register_expires):300,display_name:this.displayName,session_timers:!1,ws_server_max_reconnection:this.reconnect?3:0};var s=["User-Agent: "+this.userAgent];this.organization&&s.push("Organization: "+this.organization);var o=i.getChromeVersion();o&&s.push("X-CHROME-VERSION: "+o);var a=this._getAudioConstraints(t.audioConstraintsOptional);this.callOptions={extraHeaders:s,mediaConstraints:{audio:{optional:a}},pcConfig:{iceServers:[],gatheringTimeoutAfterRelay:1e3,gatheringTimeoutAfterReflexive:3e3,midCallUpdateRetries:3,sdpSemantics:"plan-b",mangleLocalOffer:this._mangleLocalOffer,mangleLocalDescription:this._mangleLocalDescription,mangleRemoteDescription:this._mangleRemoteDescription,delayIceGathering:!1}},(this._useTurnOnly||t.forceTurn)&&(this.callOptions.pcConfig.iceTransportPolicy="relay"),t.onMangleLocalOffer&&(this.onMangleLocalOffer=t.onMangleLocalOffer),t.onMangleLocalDescription&&(this.onMangleLocalDescription=t.onMangleLocalDescription),t.onMangleRemoteDescription&&(this.onMangleRemoteDescription=t.onMangleRemoteDescription),t.iceGatheringTimeout&&(this.callOptions.pcConfig.gatheringTimeout=5e3),t.noAudio&&(this.callOptions.mediaConstraints.audio=!1),t.disableStun&&this.disableStun();var c=this.callOptions.pcConfig;t.stunServers&&t.stunServers.length&&(c.iceServers=[{urls:t.stunServers}]),t.turnServers&&t.turnServers.length&&(c.iceServers=e.union(c.iceServers,e.map(t.turnServers,function(e){return{urls:e.server,username:e.username||"fstelephony",credential:e.password||"firespotter1234"}}))),this.callOptions.rtcConstraints=t.rtcConstraints||null,this.callOptions.rtcOfferConstraints=t.rtcOfferConstraints||null,this._preloadCalls=!(!t.preloadCalls&&!t.preloadCallsWithMic),this._preloadCallsWithMic=!!t.preloadCallsWithMic,this.setRegister(t.register),console.log("WebRTC start!"),console.log(this.callOptions),console.log(this.configuration),this._sinkId="",this._resetSession(),this._createClient()}},muteRemoteAudio:function(e){this.remoteAudioMuted=!!e,this._setRemoteAudioVolume()},setRegister:function(e){console.log("WEBRTC: Setting register to:",!!e),this.register=!!e,this.options.register=this.register,this.configuration.register=this.register},_getAudioConstraints:function(e){var t={},n=[];return this._addConstraints(n,t,[{chromeRenderToAssociatedSink:!0},{googNoiseSuppression2:!0},{googDucking:!1}]),this._addConstraints(n,t,e||[]),n},_addConstraints:function(e,t,n){for(var i=0;i<n.length;i++){var r=n[i],s=window.Object.keys(r)[0];t.hasOwnProperty(s)||(t[s]=i),e[t[s]]=r}},_resetReconnectAttempts:function(){console.log("Resetting webrtc reconnect attempts."),this.reconnectAttempts=0,this.fatalFailure=!1},restart:function(){this._resetReconnectAttempts(),this.stop(),this.start(this.options)},hasFatalFailure:function(){return this.fatalFailure||this.reconnectAttempts>=5},_onFatalFailure:function(){console.error("Too many reconnects...Quitting WebRTC"),this.stop(),this.fatalFailure=!0,this._setRegistrationState("fatal")},_createFatalFailure:function(){this.reconnectAttempts=5,this.verifyConnection()},verifyConnection:function(){try{if(this.hasFatalFailure())return this._onFatalFailure(),!1;if(!this.isReady())return console.log("WebRTC not loaded"),!0;if(!this.client)return console.log("WebRTC has no client yet"),!1;var e=new Date;if(this.loadedDate&&e-this.loadedDate<3e4)return console.log("WebRTC recently loaded...aborting"),!0;if(this.startDate&&e-this.startDate<15e3)return console.log("WebRTC recently started...aborting"),!0;if(this.registerDate&&e-this.registerDate>6e4&&(this.restarting||this.registering)&&(console.log("WebRTC clearing locks..."),this.restarting=!1,this.registering=!1),this.restarting)return console.log("WebRTC is already trying to restart"),!1;if(this.registering)return console.log("WebRTC is already registering"),!1;if(!this.onCall()&&!this.emulate&&(this.registerAttempts>3||this.startDate&&e-this.startDate>this.MAX_IDLE_TIME))return console.log("Idle Socket reconnecting"),this.restarting=!0,this.reconnectAttempts++,this.startDate=e,this.stop(),this.start(this.options),this.registerAttempts>3&&this._setRegistrationState("critical"),!1;if(!this.client.isConnected())return console.error("WebRTC socket not connected...restarting"),this.restarting=!0,this.startDate=e,this.client.start(),this._setRegistrationState("restarting"),!1;if(this.register&&!this.client.isRegistered())return console.error("WebRTC not registered....retrying"),this.registering=!0,this.registerAttempts++,this.client.register(),this._setRegistrationState("registering"),!1}catch(e){return console.error("Fatal error verifying WebRTC client"),!1}return!0},_setRegistrationState:function(t,n){this.registrationState=e.extend({state:t},n),this.trigger("registrationstate",this.registrationState),this.trigger(t,n)},isRegistered:function(){return this.client&&this.client.isRegistered()},stop:function(){try{this.hangUp(),this._destroyClient(),this._reconnectId=clearInterval(this._reconnectId)}catch(e){console.log(e)}},call:function(t,i){if(this.deferred=null,this.session)return console.log("Already on call"),!1;if(!this.hasFatalFailure()){if(!this.connected)return this.deferred=e.bind(function(){this.call(t,i)},this),console.log("Socket not connected yet..."),!1;this.trigger("webrtc:peerconnection");var r=i||[];n.isDev&&r.push("X-FST-route-basis: "+this.user),r.push("X-FROM-PHONE: "+this.phone);var s=$.extend(!0,{},this.callOptions);s.extraHeaders=e.union(s.extraHeaders,r),this._extraCallHeaders&&(s.extraHeaders=e.union(s.extraHeaders,this._extraCallHeaders));var o=this._createMediaConstraintsObject();if(s.mediaConstraints.audio=o.audio,s.mediaConstraints.video=o.video,this._lastCallOptions=s,console.info("VARZ: SIP Call Initiated:"),console.log(s),this.emulate){var a=new l;this._onNewSession({originator:"local",session:a}),this._onLocalMedia(),this._onCallConfirmed({sender:a}),this._onCallAddStream({sender:a}),this.emulate.call&&e.defer(e.bind(function(){this.emulate.call()},this))}else this.client.call(t,s);return!0}this._onFatalFailure()},dtmf:function(e){this.session.sendDTMF(e)},mute:function(){this.session.mute()},unmute:function(){this.session.unmute()},answer:function(t){if(this._preloadCalls)return this._answerPreloadedCall(t);this.trigger("webrtc:peerconnection");var n=t||[],i=$.extend(!0,{},this.callOptions);i.extraHeaders=e.union(i.extraHeaders,n),i.mediaConstraints.audio=this._createMediaConstraintsObject().audio,console.log("Answer: session="+this.session),this.session&&(this._setCallState("answering"),this.session.answer(i))},_answerPreloadedCall:function(t){if(this.session){if(this.isPreloading()&&!this.isPcConnected())return console.info("WEBRTC: Trying to answer preloaded call early. Waiting for ice to connect."),this.session.extraHeaders=t,void this._setCallState("waiting");this.session.extraHeaders=null,this._setCallState("answering"),console.log("Answer: session="+this.session),this._maybeUpdateAudioInput(),this._preloadCallsWithMic&&this.unmuteMic(),this.session.remoteStream&&this._setStreamToRemoteAudio(this.session.remoteStream,e.bind(function(){this._logRemoteAudioStreamAttached("answering preloaded call")},this)),this.session._answerPreloadedCall(t,e.bind(function(){this._maybeSetCallStateConnected()},this))}},_preloadCall:function(e,t){var n=$.extend(!0,{},this.callOptions);n.preload=!0,n.mediaConstraints.audio=this._createMediaConstraintsObject().audio,this._dummyMediaStream&&!this._preloadCallsWithMic&&(n.mediaStream=this._dummyMediaStream),this.session._preloadedCallData={callId:e,contactKey:t},this._setCallState("preloading"),this.session.on("preload",this._onSessionPreload),this.session.answer(n),this._preloadTo=setTimeout(this._onPreloadTimeout,this.PRELOAD_CALL_TIMEOUT)},_onSessionPreload:function(e){this.session._answerPreloadedCall=e,this._preloadCallsWithMic&&this.muteMic()},_onPreloadTimeout:function(){console.warn("WEBRTC: Preloading call took too long (>",this.PRELOAD_CALL_TIMEOUT,"ms)!"),this._triggerPreloadTimeout()},_triggerPreloadTimeout:function(e){this.session&&this.trigger("preload:timeout",this.session._preloadedCallData,this._localMediaFailed,e)},_cancelPreloadTimeout:function(){clearTimeout(this._preloadTo)},unmuteMic:function(){var e=this._getLocalAudioTrack();e&&(console.log("WEBRTC: Unmuting mic track."),e.enabled=!0)},muteMic:function(){var e=this._getLocalAudioTrack();e&&(console.log("WEBRTC: Muting mic track."),e.enabled=!1)},isMicMuted:function(){var e=this._getLocalAudioTrack();return e&&!e.enabled},setDummyMediaStream:function(e){this._dummyMediaStream=e},isUsingDummyMediaStream:function(){return this.getLocalAudioStream()===this._dummyMediaStream},hangUp:function(){try{this._resetSession(),this.emulate&&this.emulate.hangup&&e.defer(e.bind(function(){this.emulate.hangup()},this))}catch(e){console.log(e)}},reject:function(){this._resetSession({status_code:603})},onCall:function(){return!!this.session},getCallState:function(){return this.callState},getIdentity:function(){return this.phone},getRemotePhone:function(){if(this.remoteData){var e=this.remoteData.phone;return e&&4==e.length&&(e="+1415555"+e),e}},_setCallState:function(e){this.callState=e,this.callStateTime=Date.now(),this.trigger("onCallState",this.callState)},_getStatsIsPromise:function(){if(this.hasOwnProperty("_pcGetStatsIsPromise"))return this._pcGetStatsIsPromise;var e=this.session.connection.pc;if(n.isNative||i.isChromeApp()||i.isChrome())this._pcGetStatsIsPromise=!1;else try{var t=e.getStats();this._pcGetStatsIsPromise="promise"===i.typeOf(t)}catch(e){this._pcGetStatsIsPromise=!1}return this._pcGetStatsIsPromise},getStats:function(){if(this.session&&this.session.connection&&this.session.connection.pc){var e=this.session.connection.pc,t=arguments,n=("function"!=typeof t[0]?t[1]:t[0])||Function.prototype,i=("function"!=typeof t[0]?t[2]:t[1])||Function.prototype;this._getStatsIsPromise()?e.getStats().then(n).catch(i):e.getStats(n,i)}},_parseCandidates:function(e){for(var t,n=new RegExp(/a=candidate:\d+ \d+ \w+ \d+ (\d+\.\d+.\d+.\d+).*/g),i=[];t=n.exec(e);)i.push(t[1]);return i},_checkCandidatesForPublicAddress:function(e){if(this.emulate)return!0;for(var t=!1,n=this._parseCandidates(e.body),i=0;i<n.length;i++)if(0!=n[i].indexOf("192.168.")&&0!=n[i].indexOf("10.")){t=!0;break}return t},_onNewSession:function(e){if(this.session&&(console.log("New session while on call"),"connected"==this.callState||"calling"==this.callState))return console.warn("WEBRTC: sending 486 busy here status to the server to get rid of the extra session."),void e.session.terminate({status_code:486});console.log("SIP Session"),this._cancelPreloadTimeout(),this.session=e.session,this.originator=e.originator,this.originator_request=e.request,this.remoteData=this._parseRequest(e.request);var t=this.remoteData["X-PRIMARY-A"],n=this.remoteData["X-CONTACT-KEY"];this.session.on("sip:request",this._onSipRequest),this.session.on("sip:response",this._onSipResponse),this.session.on("connecting",this._onCallConnecting),this.session.on("accepted",this._onCallAccepted),this.session.on("confirmed",this._onCallConfirmed),this.session.on("addstream",this._onCallAddStream),this.session.on("removestream",this._onCallRemoveStream),this.session.on("failed",this._onCallFailed),this.session.on("progress",this._onCallProgress),this.session.on("ended",this._onCallEnded),this.session.on("localMediaAcquired",this._onLocalMedia),this.session.on("localMediaFailed",this._onLocalMediaFailed),this.session.on("signalingstatechange",this._onSignalingStateChange),this.session.on("iceconnectionstatechange",this._onIceConnectionStateChange),this.session.on("icegatheringstatechange:jssip",this._onIceGatheringStateChange),this.session.on("icecandidate",this._onIceCandidate),"remote"==this.originator?this._preloadCalls?this._preloadCall(t,n):(this._setCallState("ringing"),this.trigger("callRinging",t,n,5)):(this._setCallState("calling"),this.trigger("callCalling")),this.trigger("session",this.session),this.stats=[],this.session.remoteVideo={}},_onSipRequest:function(e){if("INVITE"==e.method){var t=e.headers["Proxy-Authorization"]?" nonce":"";console.info("VARZ: SIP INVITE"+t)}},_onSipResponse:function(e){console.info("SIP response: "+e.status_code+" "+e.reason_phrase)},_onRegister:function(e){console.info("WebRTC register"),console.log(e),this.registering=!1,this.restarting=!1,this.registerDate=new Date,this.registerAttempts=0,this.reconnectAttempts=0;var t={sip:this.sipUri,type:"registered"};this._setRegistrationState("registered",t)},_onUnregister:function(e){if(this.client&&this.client.isRegistered())console.log("Unregister: Already re-registered...");else{console.error("WebRTC unregister"),console.log(e);var t={sip:this.sipUri,type:"unregistered",registerAttempts:this.registerAttempts,reconnectAttempts:this.reconnectAttempts};this._setRegistrationState("unregistered",t)}},_onConnected:function(e){this.connected=!0,this.restarting=!1,i.isIE()&&(this._wsPingPongTimer||(this._wsPingPongTimer=setInterval(this._ping,this.PING_PONG_INTERVAL))),(e=e||{}).type="connected",this._onSocketEvent(e),this.deferred&&this.deferred()},_onDisconnected:function(e){this.client&&this.client.isConnected()?console.log("Disconnect: Already re-connected..."):(this._wsPingPongTimer&&clearInterval(this._wsPingPongTimer),this.connected=!1,this.restarting=!1,this.registering=!1,this.restarting=!1,this.startDate=null,(e=e||{}).type="disconnected",console.info("WebRTC disconnected"),this._onSocketEvent(e))},_onRegistrationFailed:function(e){this.client&&this.client.isRegistered()?console.log("RegistrationFailed: Already re-registered..."):((e=e||{}).type="registrationFailed",this.registering=!1,this.restarting=!1,this._onSocketEvent(e))},_onSocketEvent:function(e){var t=e&&e.type||void 0;console.info("SIP Socket type="+t),console.log(e),this.socketState=e,this.trigger(t),this.trigger("socket",t,e)},_onCallConnecting:function(e){console.info("VARZ: SIP Call Connecting")},_onCallAccepted:function(e){console.info("VARZ: SIP Call Accepted")},_onNoIceCandidates:function(){console.error("No SDP Candidates...hanging up"),this.trigger("no_candidates"),this.hangUp();this.isPreloading()?this._triggerPreloadTimeout():t.trigger("webrtc:nocandidates",{message:"Failed to get SDP Candidates. Please try again"})},_candidateTypes:{stun:"STUN/Server Reflexive",peer:"STUN/Peer Reflexive",turn:"TURN/Relay",host:"HOST/public IP"},_mangleLocalDescription:function(e){console.log("WEBRTC: Mangle SDP (before mangle -- you will see the after in an invite immediately following):",e.sdp),this.onMangleLocalDescription&&(e=this.onMangleLocalDescription(e));var t=e.sdp,n={},i="";for(i in this._candidateTypes){var r=this._filterCandidates(t,i);n[i]=r.ports,t=r.sdp,console.log("WEBRTC: Local sdp contains (",r.ports.length,")",this._candidateTypes[i],"candidates")}var s=n.stun.length||n.peer.length,o=n.turn.length;if(this.options.removeHostCandidates&&s&&!this._useTurnOnly&&(t=this._removeCandidatesFromSdp(t,"host"),n.host=[]),this._useTurnOnly&&o)for(i in this._candidateTypes)"turn"!==i&&(t=this._removeCandidatesFromSdp(t,i),n[i]=[]);return t.match(/a=candidate[^\n]+\n/g)?t=this._maybeUpdateMlinePort(t,n):this._onNoIceCandidates(),new RTCSessionDescription({type:e.type,sdp:t})},_removeCandidatesFromSdp:function(e,t){var n=this._getCandidateReg(t),i=0;return e=e.replace(n,function(e){return i++,""}),i&&console.log("WEBRTC: Removed",this._candidateTypes[t],"candidates (",i,") from the sdp."),e},_getCandidateReg:function(e){var t;switch(e){case"stun":t=/a=candidate[^\n]+typ srflx[^\n]+\n/g;break;case"host":t=/a=candidate[^\n]+typ host[^\n]+\n/g;break;case"turn":t=/a=candidate[^\n]+typ relay[^\n]+\n/g;break;case"peer":t=/a=candidate[^\n]+typ prflx[^\n]+\n/g;break;default:throw"InvalidCandidateType"}return t},_filterCandidates:function(e,t,n){for(var i=this._getCandidateReg(t),r=/(\d+)?\styp/,s=n||e.match(i)||[],o=[],a=0;a<s.length;a++){var c=s[a];if(this._isPrivateOrV6Candidate(c))console.log("WEBRTC (FILTERING PRIVATE/Ipv6 "+t.toUpperCase()+"):",$.trim(c)),e=e.replace(c,"");else{console.info("WEBRTC (FOUND PUBLIC "+t.toUpperCase()+"):",$.trim(c));var l=(c.match(r)||[])[1];l&&o.push(l)}}return{sdp:e,ports:o}},_filterHostCandidates:function(e,t){return this._filterCandidates(e,"host",t)},_filterStunCandidates:function(e,t){return this._filterCandidates(e,"stun",t)},_filterTurnCandidates:function(e,t){return this._filterCandidates(e,"turn",t)},_isPrivateOrV6Candidate:function(e){var t=e.match(/(?:\s+)(\d+\.\d+\.\d+\.\d+)(?:\s+)/),n=t?t[1]:void 0;return!n||i.isPrivateIp(n)},_mangleLocalOffer:function(e){return this.onMangleLocalOffer&&(e=this.onMangleLocalOffer(e)),new RTCSessionDescription({type:e.type,sdp:e.sdp})},_maybeUpdateMlinePort:function(t,n){var i={list:[]};e.each(this._candidateTypes,function(t,r){e.each(n[r],function(e){i[e]?i[e]++:(i[e]=1,i.list.push(e))})});return t=t.replace(/(?:m=.+?\s)(\d+)[^\n]+/gi,function(e,t){return i[t]||(console.warn("WEBRTC: Port in m line not found in candidates. Changing it from:",e),e=e.replace(t,i.list[0]),console.warn("to:",e)),e})},_mangleRemoteDescription:function(e){if(this.onMangleRemoteDescription&&(e=this.onMangleRemoteDescription(e)),!this._renegotiating)return e;var t={type:e.type,sdp:e.sdp.replace(/a=setup:actpass/,function(){return console.warn("WEBRTC: Freeswitch sent back incorrect setup of actpass -- changing to passive so that renegotiation works."),"a=setup:passive"})};return new RTCSessionDescription(t)},disableStun:function(){this._useTurnOnly=!0},_hasConnection:function(){return this.session&&this.session.connection},_getAudioSourceIdFromConstraints:function(){var e=this._getOptionalAudioConstraints()[0]||{};return e.hasOwnProperty("sourceId")&&e.sourceId},_getVideoSourceIdFromConstraints:function(){var e=this._getOptionalVideoConstraints()[0]||{};return e.hasOwnProperty("sourceId")&&e.sourceId},_getSourceIdFromSession:function(t){var n=this._getLocalTrack(t),i=n&&n.getConstraints()||{};if(i.deviceId)return i.deviceId.exact;var r=i.advanced||[],s=e.first(r)||{};return s&&s.deviceId&&s.deviceId.exact},_getAudioSourceIdFromSession:function(){return this._getSourceIdFromSession("audio")},_getVideoSourceIdFromSession:function(){return this._getSourceIdFromSession("video")},_getSourceId:function(e){var t="video"===e?this._getVideoSourceIdFromConstraints():this._getAudioSourceIdFromConstraints();if(t=t||"",!this.session||!this._getLocalTrack())return t;var n=this._getSourceIdFromSession()||"";return"video"===e||t===n||this._renegotiating||console.warn("WEBRTC: Session",e,"source (",n,") does not match what was passed into the constraints (",t,")!! Attempting to set session to constraints source."),n},_getAudioSourceId:function(){return this._getSourceId("audio")},_getVideoSourceId:function(){return this._getSourceId("video")},_getOptionalAudioConstraints:function(){return this._getOptionalConstraints("audio")},_getOptionalVideoConstraints:function(){return this._getOptionalConstraints("video")},_getOptionalConstraints:function(e){return this.callOptions?!!this.callOptions.mediaConstraints.hasOwnProperty(e)&&(this.callOptions.mediaConstraints[e].optional||[]):[]},_getSinkId:function(){return this.getRemoteAudioStream()?this.remoteAudio&&this.remoteAudio.sinkId:this._sinkId},updateAudioConstraintsSourceId:function(e){return this.updateConstraintsSourceId("audio",e)},updateVideoConstraintsSourceId:function(e){return this.updateConstraintsSourceId("video",e)},updateConstraintsSourceId:function(e,t){var n="video"===e?this._getOptionalVideoConstraints():this._getOptionalAudioConstraints();if(n){var i={sourceId:t},r=(n[0]||{}).hasOwnProperty("sourceId");return t?(r?n[0]=i:n.unshift(i),this.callOptions&&(this.callOptions.mediaConstraints[e]={optional:n}),n):(r&&n.shift(),n)}},_setSinkId:function(t,n,r){t&&t.setSinkId&&!i.isEdge()?t.setSinkId(n||"").then(e.bind(function(){this._onUpdateAudioSink(n,r)},this)).catch(e.bind(function(){console.error("WEBRTC MEDIA: Could not change remote audio sink to:",n,"so setting it to default."),n?this._setSinkId(t,void 0,r):r&&r()},this)):r&&r()},updateAudioSinkId:function(t,n){if(this._sinkId=t,this.getRemoteAudioStream()){this.remoteAudio.volume=0,this._renegotiatingSink=!0,this.trigger("renegotiate:sink:request");var i=e.bind(function(){this._setRemoteAudioVolume(),this._renegotiatingSink=!1,this.trigger("renegotiate:sink:success"),n&&n()},this);this.remoteAudio.sinkId&&t?this._setSinkId(this.remoteAudio,"",e.bind(function(){this._setSinkId(this.remoteAudio,t,i)},this)):this._setSinkId(this.remoteAudio,t,i)}},updateAudioVolume:function(e){this._remoteVolume=e,this._renegotiatingSink||this._setRemoteAudioVolume()},_setStreamToRemoteAudio:function(t,n){t&&t.id!==this.remoteAudio.streamId?(this.remoteAudio.volume=0,this.remoteAudio.streamId=t.id,this.remoteAudio.onloadeddata=e.bind(function(){this._onRemoteAudioLoaded(n)},this),this.remoteAudio=this._attachMediaStream(this.remoteAudio,t)):!t&&this.remoteAudio.streamId&&delete this.remoteAudio.streamId},_onRemoteAudioLoaded:function(t){this.updateAudioSinkId(this._sinkId,e.bind(function(){this._setRemoteAudioVolume(),t&&t(),this.trigger("change:input:remote")},this)),this.remoteAudio.onloadeddata=null},_setRemoteAudioVolume:function(){if(this.remoteAudio){var t=e.isUndefined(this._remoteVolume)?1:this._remoteVolume;this.remoteAudio.volume=this.remoteAudioMuted?0:t}},getMediaIds:function(){return{audioinput:this._getAudioSourceId()||"",audiooutput:this._getSinkId()||"",videoinput:this._getVideoSourceId()||""}},_onUpdateAudioSink:function(e,t){console.info("WEBRTC MEDIA: Changed remote audio sink to:",e||"Default"),console.info("WEBRTC MEDIA: webrtc.remoteAudio.sinkId is:",this.remoteAudio.sinkId),t&&t()},_renegotiate:function(t){var n=e.extend({},this.callOptions.rtcOfferConstraints,{iceRestart:!1});return this.session.renegotiate({useUpdate:this.useUpdate,rtcOfferConstraints:n},t||Function.prototype)},_parseAudioSourceMediaInfo:function(t){var n=[];return e.each(t,function(e){"audioinput"==e.kind&&n.push({id:e.deviceId,kind:"audio",groupId:e.groupId,label:e.label})}),n},getSources:function(t){i.supportsMediaDevices()?navigator.mediaDevices.enumerateDevices().then(e.bind(function(e){t(this._parseAudioSourceMediaInfo(e))},this)):MediaStreamTrack.getSources(t)},getMediaInfo:function(e){i.supportsMediaDevices()&&navigator.mediaDevices.enumerateDevices().then(e)},changeAudioInput:function(e){return this.changeInput("audio",e)},changeVideoInput:function(e){return this.changeInput("video",e)},updateVideoConstraintsResolution:function(t,n,i){var r={};t&&(r.width={max:t}),n&&(r.height={max:n}),i&&(r.frameRate={max:i}),e.isEmpty(r)||e.extend(this.callOptions.mediaConstraints,{video:r})},changeInput:function(e,t){if(!this._hasConnection()||this._renegotiating){var n=this._renegotiating?"already renegotiating.":"no connection present.";return console.warn("WEBRTC: Tried to change",e,"input to (",t,") when",n),!1}return console.log("WEBRTC: Changing",e,"input to:",t),"video"===e?this.updateVideoConstraintsSourceId(t):this.updateAudioConstraintsSourceId(t),this.refreshLocalMedia()},refreshLocalMedia:function(e){if(!this._hasConnection()||this._renegotiating){var t=this._renegotiating?"already renegotiating.":"no connection present.";return console.warn("WEBRTC: Tried to refresh local media when",t),!1}var n=this._createMediaConstraintsObject(),i=this.isUsingDummyMediaStream();return(!!e||!i||i&&"answering"===this.callState)&&this.isPcConnected()&&!this._renegotiating&&(this._renegotiating=!0,e?this._changeInputSuccess(e):getUserMedia(n,this._changeInputSuccess,this._jsSipError)),!0},_createMediaConstraintsObject:function(){var t={audio:{},video:{}},n=this._getAudioSourceIdFromConstraints(),i=this._getVideoSourceIdFromConstraints();if(n?t.audio.deviceId={exact:n}:t.audio.optional=this._getOptionalAudioConstraints(),this._useVideo){i&&(t.video.deviceId={exact:i}),t.video={width:{max:848,ideal:848},height:{max:480,ideal:480},frameRate:{max:24,ideal:24}};var r=e.get(this.callOptions,"mediaConstraints.video");e.extend(t.video,r)}else t.video=!1;return t},_changeInputSuccess:function(t){if(this._hasConnection()){var n=this.session.connection.getLocalStreams()[0];if(n!==t)n&&this.session.connection.removeStream(n),t&&this.session.connection.addStream(t),e.difference(n?n.getTracks():[],t?t.getTracks():[]).forEach(this._stopTrack);else console.debug("Renegotiated with same stream!");this.localAudio=this._attachMediaStream(this.localAudio,t),this._setTrackIds(),this._renegotiate(e.bind(function(){this._renegotiating=!1},this));var i="(empty stream)";if(t){var r=t.getAudioTracks()[0];r&&(i=r?r.label:"(empty track)")}console.log("Swapped input audio device to "+i),console.log(t),this.isRinging()&&this._preloadCallsWithMic&&this.muteMic(),this.trigger("change:input:local")}else console.warn("Swapped input audio. No session in progress.")},isRenegotiatingSource:function(){return this.session&&this.session.connection&&this.session.connection.renegotiating},isRenegotiatingSink:function(){return this._renegotiatingSink},_onSignalingStateChange:function(e){switch(this.signalingState=e.state,this.session&&(this.session.signalingState=e.state),e.state){case"have-local-offer":this.session.connection.localOffers||(this.session.connection.localOffers=0),this.session.connection.localOffers++,this.session.connection.localOffers>1&&(this.session.connection.renegotiating=!0,this.trigger("renegotiate:source:request")),this.trigger("localmedia",this.session.connection.getLocalStreams()[0]);break;case"stable":var t=this.session.connection.renegotiating;this.session.connection.renegotiating=!1,t&&(console.log("WEBRTC: Renegotiate success!"),this.trigger("renegotiate:source:success"))}this.trigger("signalingstatechange",e.state)},_onIceConnectionStateChange:function(e){if(this.session){switch(this.iceConnectionState=e.state,e.state){case"connected":case"completed":this._maybeSetRinging(),this._maybeSetCallStateConnected(),this._maybeUpdateAudioInput();break;case"failed":case"closed":this.trigger("peerconnection:closed")}this.trigger("iceconnectionstate:"+e.state),this.trigger("iceconnectionstate:changed",e.state),this.trigger("iceconnectionstatechange",e.state)}},_onIceGatheringStateChange:function(e){this.iceGatheringState!==e.state&&(console.log("WEBRTC: Ice gathering state change. JSSIP:",e.state,"WEBRTC:",e.pcState),"new"===e.state||"gathering"===e.state?this._iceGatheringStarted=this._iceGatheringStarted||(performance||Date).now():"complete"===e.state&&(this._iceGatheringEnded=this._iceGatheringEnded||(performance||Date).now(),console.info("WEBRTC: Ice gathering took",this._iceGatheringEnded-this._iceGatheringStarted,"ms."),console.info("VARZ: ICE Complete")),this.iceGatheringState=e.state,this.trigger("icegatheringstate:"+e.state),this.trigger("icegatheringstate:changed",e.state),this.trigger("icegatheringstatechange",e.state))},_onIceCandidate:function(e){this._gatheredCandidates=this.session.connection.gatheredCandidates},isPcConnected:function(){var e="connected"===this.iceConnectionState||"completed"===this.iceConnectionState;return this.session&&this.session.connection&&e},isPcDisconnected:function(){return this.session&&this.session.connection&&"disconnected"===this.iceConnectionState},isPcClosed:function(){var e=this.iceConnectionState;return!e||"failed"===e||"closed"===e},_maybeSetRinging:function(){if(!this.session||!this.session._preloadedCallData)return!1;var e=this.session._preloadedCallData.callId,t=this.session._preloadedCallData.contactKey,n="has ice connected";return this.isPcConnected()||(n="has been forced to show ringing"),console.info("WEBRTC: Preloaded call (",e,")",n,"for contact (",t,")"),this.session._preloadedCallData=null,"preloading"===this.callState||"ready"===this.callState?(console.info("WEBRTC: Setting state to ringing for preloaded call (",e,")"),this._setCallState("ringing"),this.trigger("callRinging",e,t,5)):"waiting"===this.callState&&(console.info("WEBRTC: State is waiting, so now answering the preloaded call (",e,")"),this._answerPreloadedCall(this.session.extraHeaders)),this._cancelPreloadTimeout(),!0},_maybeSetCallStateConnected:function(){this.isConnecting()&&this._setCallState("connected")},_maybeUpdateAudioInput:function(){if(this.isUsingDummyMediaStream()&&"answering"===this.callState&&this.isPcConnected()){var e=this._getAudioSourceIdFromConstraints()||"";console.info("WEBRTC: Now that call is connected, change audio input to:",e),this.changeAudioInput(e)}},_onCallConfirmed:function(e){if(console.info("VARZ: SIP Call Confirmed"),console.log(e),this.emulate)this._maybeSetCallStateConnected();else{var t=this.session.connection.getLocalStreams()[0];this.localAudio=this._attachMediaStream(this.localAudio,t)}},_onCallAddStream:function(t){console.info("VARZ: SIP Call Started"),console.log(t);var n=t.stream;if(this.emulate)this.remoteAudio.src="https://files.musopen.org/media/abda2887-5cb6-419c-b5e1-6b8c0f92b97b.mp3";else{if(!n.getAudioTracks().length)return this.session.remoteVideo[n.id]=n,this.trigger("videoStreamAdded",n),void console.debug("GOT STREAM VID",n);this.session.remoteStream=n,this._preloadCalls&&"outgoing"!==this.session.direction||this._setStreamToRemoteAudio(n,e.bind(function(){this._logRemoteAudioStreamAttached("making outbound call -- they should be hearing ringing (unless this is a cold start).")},this))}this.emulate&&this._onCallProgress({})},_onCallRemoveStream:function(e){var t=e.stream;this.session.remoteVideo[t.id]&&(delete this.session.remoteVideo[t.id],this.trigger("videoStreamRemoved",t),console.debug("BYE STREAM VID",t))},onCallConnected:function(e){this.session.callConnected=!0,this.trigger("callStarted",e)},_onLocalMedia:function(e){this.trigger("localMedia")},_onLocalMediaFailed:function(e){console.log("Failed to get local media"),this.trigger("localMedia"),this.trigger("localMedia:failed"),this._localMediaFailed=!0},_onCallFailed:function(t){console.info("VARZ: SIP Call Failed: "+(t&&t.cause||"")),console.log(t);var n={type:this._localMediaFailed?"localmedia":"jssip"};if(t.cause){n=e.extend(n,{cause:t.cause,errorType:t.type,originator:t.originator});var i=t.message;i&&(n=e.extend(n,{reason:i.reason_phrase||i.headers&&i.headers.Reason&&i.headers.Reason[0]&&i.headers.Reason[0].raw,sipData:i.data}))}var r="RTP Timeout"===n.cause;this.isPreloading()&&r&&this._triggerPreloadTimeout(),this._resetSession(),r&&this.trigger("iceFailed",n),this.trigger("callError",n)},_isHavingNetworkProblems:function(){var e=Date.now()-this.callStateTime;return"complete"!==this.iceGatheringState&&e>.6*this.PRELOAD_CALL_TIMEOUT},_onCallProgress:function(e){console.info("VARZ: SIP Call Progress"),console.log(e),this.trigger("callProgress")},hasCandidates:function(){try{if(!this.session||!this.session.connection)return console.error("WEBRTC: hasCandidates: NO SESSION",this.session?"CONNECTION":""),!1;var e=this._parseCandidates(this.session.connection.localDescription.sdp);if(e.length)return console.info("Candidates: "),console.info(e),!0;console.error("WEBRTC: NO CANDIDATES FOUND IN LOCAL SDP:",this.session.connection.localDescription.sdp)}catch(e){return!0}return!1},_onCallEnded:function(e){console.info("VARZ: SIP Call Ended"),console.log(e),this.trigger("callEnded",e.originator),this.trigger("peerconnection:closed"),"RTP Timeout"===e.cause&&this.trigger("iceFailed",e),this._resetSession()},_getStream:function(t){if(this.session&&this.session.connection){var n;switch(t){case"local":n=this.session.connection.getLocalStreams();break;case"remote":n=this.session.connection.getRemoteStreams();break;default:console.warn("WEBRTC: Trying to get stream with invalid type (",t,"). Valid are local or remote.")}return e.first(n||[])}},_getTrack:function(t,n){if(this.session){var i=this._getStream(t);if(i)return e.first("video"===n?i.getVideoTracks():i.getAudioTracks())}},_getLocalTrack:function(e){return this._getTrack("local",e)},_getLocalAudioTrack:function(){return this._getLocalTrack("audio")},_getLocalVideoTrack:function(){return this._getLocalTrack("video")},_ping:function(){if(this._hasConnection()&&"connected"==this.getCallState())try{this.session.getOptions()}catch(e){console.log("Failed to send websocket ping")}else clearInterval(this._wsPingPongTimer)},getLastCallOptions:function(){return this._lastCallOptions},_onReportError:function(e){console.log("onReportError"),console.log(e)},_resetSession:function(t){t=t||{};try{this.session&&(this.emulate?this.trigger("callEnded"):this.session.terminate(t))}catch(e){console.log("error terminating session: "+e)}i.isIE()?this._resetIEAudio():(this.localAudio&&!this._onVideoCall&&this._attachMediaStream(this.localAudio),this.remoteAudio&&!this._onVideoCall&&this._attachMediaStream(this.remoteAudio)),this.session&&this.session.connection&&(e.each(this.session.connection.getLocalStreams(),this._stopStream),e.each(this.session.connection.getRemoteStreams(),this._stopStream)),this.session=null,this.originator=null,this.remoteData=null,this._localMediaFailed=!1,this._currentAudioStream=null,this._renegotiating=!1,this._renegotiatingSink=!1,this._trackIds=null,this._localTrackLabels=[],this._fixingRemoteAudio=!1,this._settingRemoteDescription=null,this.iceConnectionState=null,this.iceGatheringState=null,this.signalingState=null,this._iceGatheringStarted=null,this._iceGatheringEnded=null,this._gatheredCandidates=null,this._setCallState("ready"),this._cancelPreloadTimeout(),this.trigger("session")},_stopStream:function(t){t&&e.each(t.getTracks(),this._stopTrack)},_stopTrack:function(e){e.stop&&e.stop()},_createClient:function(){if(this.emulate)return this.client={stop:function(){console.log("mock stop")},start:function(){console.log("mock start")},register:function(){console.log("mock register")},isConnected:function(){return!0},isRegistered:function(){return!0}},void this._onConnected({type:"connected"});this.client=new this.JsSIP.UA(e.clone(this.configuration)),this.client.on("connected",this._onConnected),this.client.on("disconnected",this._onDisconnected),this.client.on("registrationFailed",this._onRegistrationFailed),this.client.on("newRTCSession",this._onNewSession),this.client.on("registered",this._onRegister),this.client.on("unregistered",this._onUnregister),this.client.on("newNotify",this._onNewMessage),this.client.start()},_attachMediaStream:function(e,t){return attachMediaStream(e,t)||e},reAttachRemoteAudioStream:function(){this.session&&this.session.remoteStream&&this._setStreamToRemoteAudio(this.session.remoteStream)},attachVideoCallAudioStream:function(t,n){t===this.remoteAudio?(this._setStreamToRemoteAudio(n,e.bind(function(){this._logRemoteAudioStreamAttached("video")},this)),this._videoStream=n):this._attachMediaStream(t,n),this._onVideoCall=!0},detachVideoCallAudioStream:function(e){this._attachMediaStream(e),e===this.remoteAudio&&(this._videoStream=null),this._onVideoCall=!1},setRemoteDescription:function(t){return this.isPcConnected()?"stable"!==this.signalingState?Promise.reject("Invalid signaling state: "+this.signalingState):this.isRenegotiatingSource()?Promise.reject("Already renegotiating!"):new Promise(e.bind(function(n,i){var r=e.extend({},this.callOptions.rtcOfferConstraints,{iceRestart:!1});this.session.connection.pc.createOffer(r).then(e.bind(function(r){return"stable"!==this.signalingState?i("Invalid signaling state on createOffer: "+this.signalingState):(r=this._mangleLocalOffer(r),r=this._mangleLocalDescription(r),this.session.connection.pc.setLocalDescription(r).then(e.bind(function(){return"have-local-offer"!==this.signalingState?i("Invalid signaling state on setAnswer: "+this.signalingState):this.session.connection.pc.setRemoteDescription(t).then(n).catch(i)},this)).catch(i))},this)).catch(i)},this)):Promise.reject("No peer connection!")},getRemoteAudioStream:function(){return this._videoStream||this.session&&this.session.remoteStream},getLocalAudioStream:function(){return this._getStream("local")},fixRemoteAudioStream:function(){var t=this.getRemoteAudioStream();t&&!this._fixingRemoteAudio&&(this._fixingRemoteAudio=!0,this.remoteAudio&&this._attachMediaStream(this.remoteAudio),this.remoteAudio=new Audio,this.remoteAudio.autoplay=!0,console.warn("WEBRTC: Trying to fix remote audio stream (",t.id,")"),this._setStreamToRemoteAudio(t,e.bind(function(){this._fixingRemoteAudio=!1,console.info("WEBRTC: Fixed remote audio stream.")},this)))},_onNewMessage:function(e,t){console.info("AELOG: SIP Message");var n,i={};t&&t.body?n=t.body:e&&e.data&&e.data.body&&(n=e.data.body),console.log(n),n&&(i=JSON.parse(n)),this.trigger("sipMessage",i)},_destroyClient:function(){this.client&&(this.client.stop(),this.client=null,this.stopListening(this,"onCallState"))},_parseRequest:function(e){var t={};try{for(var n=e.data.split("\n"),i=0,r=n.length;i<r;i++)if(1!=n[i].indexOf("=")){var s=n[i].split(/:/),o=$.trim(s.shift()),a=$.trim(s.join(":"));t[o]=a}}catch(e){}return console.log(t),t},canCallOut:function(){var e=this.getCallState();return"ready"===e||"connected"===e},isConnecting:function(){var e=u.getCallState();return"calling"===e||"answering"===e},isPreloading:function(){var e=this.getCallState();return"preloading"===e||"waiting"===e},forcePreloadingCallToRing:function(){return this._maybeSetRinging()},isRinging:function(){return"ringing"===u.getCallState()},isConnected:function(){return"connected"===this.getCallState()},isSocketConnected:function(){return this.client&&this.client.isConnected()},inProgress:function(){return this.isConnecting()||this.isRinging()},_setTrackIds:function(){var e=this.session.connection.pc.getLocalStreams()[0],t=this.session.connection.pc.getRemoteStreams()[0],n=e&&e.getAudioTracks()[0],i=t&&t.getAudioTracks()[0];this._trackIds={local:{audio:n?n.id:""},remote:{audio:i?i.id:""}}},getTrackIds:function(){if(this._hasConnection())return this._trackIds||this._setTrackIds(),this._trackIds},setLocalTrackLabel:function(e,t){this._localTrackLabels.push({trackId:e.id,trackLabel:t})},_logRemoteAudioStreamAttached:function(e){console.log("WEBRTC: finished setting remote audio tag stream (",e,")")},getRemoteStreams:function(){if(this.session&&this.session.connection&&this.session.connection.pc)return this.session.connection.pc.getRemoteStreams()},getLocalStreams:function(){if(this.session&&this.session.connection&&this.session.connection.pc)return this.session.connection.pc.getLocalStreams()},getRemoteDescription:function(){if(this.session&&this.session.connection&&this.session.connection.pc)return this.session.connection.pc.remoteDescription},getRawPc:function(){return this.session&&this.session.connection&&this.session.connection.pc}}),l=r.extend({_events:{},on:function(e,t){console.log("mock bind "+e);var n=this._events[e];n||(n=this._events[e]={handlers:{}}),n.handlers[t]=t},emit:function(){var t=arguments[0],n=Array.prototype.slice.call(arguments,1),i=this._events[t];i&&e.each(i.handlers,function(e){e.call(null,n)})},answer:function(){console.log("answer")},terminate:function(){console.log("mock terminate")},sendDTMF:function(e){console.log("mock dtmf "+e)}}),u=s.create(c,"webrtc");return _webrtc=u,u}),define("objects/common/local_state_wrapper",["require","fslib/fsutil"],function(require){var e=require("fslib/fsutil");return{LOCAL_STATE:{},COMMON_LOCAL_STATE:{adding:!1,creating:!1,destroying:!1,errors:!1,errorMessage:null,errorResponseJson:null,saving:!1,requesting:!1,loaded:!1,numRequests:0,lastSuccessfulRequest:0,lastErrorRequest:0,source:null,sources:null,cursor:null,cursors:null,requests:null,cached:null,polling:null},hasLoaded:function(){return this.getLocalState("loaded")},hasError:function(){var e=this.getLocalState("numRequests"),t=this.getLocalState("lastErrorRequest");return!!t&&e===t},isRequesting:function(){return this.getLocalState("requesting")},isSaving:function(){return this.getLocalState("saving")},hasGottenResponse:function(){return!(!this.getLocalState("lastSuccessfulRequest")&&!this.getLocalState("lastErrorRequest"))},getLocalState:function(e){var t=this._localState||{},n=this._processingState||{},i={};return _.each(this.LOCAL_STATE,function(e,n){i[n]=t.hasOwnProperty(n)?t[n]:e}),_.each(this.COMMON_LOCAL_STATE,function(e,n){i[n]=t.hasOwnProperty(n)?t[n]:e}),_.each(n||{},function(e,t){i[t]=e}),e?i[e]:i},adjustLocalState:function(e,t,n){if(!_.isEmpty(e)){var i=e,r=t;"object"!==(void 0===e?"undefined":_typeof(e))&&((i={})[e]=t,r=n),r=(r="boolean"==typeof r?{silent:r}:r)||{};var s=!1;for(var o in i)this._adjustLocalAttr(o,i[o])&&!r.silent&&(s=!0,this.trigger("change:local:"+o,this,i[o]));s&&this.trigger("localStateChange",this)}},addLocalSource:function(e,t){var n=this.getLocalSources(),i=this.__getSourceObj(e),r=!0;for(var s in i)n[s]||(r=!1,this._setLocalStateAttr(n,s,1));r||t&&t.silent||(this.trigger("change:local:sources",this,n),this.trigger("localStateChange",this))},removeLocalSource:function(e,t){var n=this.getLocalSources(),i=this.__getSourceObj(e),r=!0;for(var s in i)n[s]&&(r=!1,this._unsetLocalStateAttr(n,s));r||t&&t.silent||(this.trigger("change:local:sources",this,n),this.trigger("localStateChange",this))},hasLocalSource:function(e){var t=this.getLocalSources(),n=this.__getSourceObj(e);for(var i in n)if(t[i])return!0;return!1},__getSourceObj:function(t){var n=e.typeOf(t),i=t;if("array"===n){i={};for(var r=0;r<t.length;r++)i[t[r]]=1}else"object"!==n&&((i={})[t]=1);return i},__getLocalStore:function(e){var t=this.getLocalState(e);return t||(t={},this.adjustLocalState(e,t)),t},__getLocalStoreItem:function(e,t){return this.__getLocalStore(e)[t]},__setLocalStoreItem:function(e,t,n,i){var r=this.__getLocalStore(e);this._setLocalStateAttr(r,t,n),i&&i.silent||(this.trigger("change:local:"+e,this,r),this.trigger("localStateChange",this))},__unsetLocalStoreItem:function(e,t,n){var i=this.__getLocalStore(e);this._unsetLocalStateAttr(i,t),n&&n.silent||(this.trigger("change:local:"+e,this,i),this.trigger("localStateChange",this))},getLocalSources:function(){return this.__getLocalStore("sources")},getLocalCursors:function(){return this.__getLocalStore("cursors")},getLocalRequests:function(){return this.__getLocalStore("requests")},getLocalErrors:function(){return this.__getLocalStore("errors")},getLocalCursor:function(e){return this.__getLocalStoreItem("cursors",e)},getLocalRequest:function(e,t){var n=this.__getFetchParamsString(e,t);return n&&this.__getLocalStoreItem("requests",n)},getLocalError:function(e,t){var n=this.__getFetchParamsString(e,t);return n&&this.__getLocalStoreItem("errors",n)},getLocalErrorMessage:function(e,t){var n=this.getLocalError(e,t);return n&&n.errorMessage},getLocalErrorResponse:function(e,t){var n=this.getLocalError(e,t);return n&&n.errorResponseJson},getLocalCached:function(e){return this.__getLocalStoreItem("cached",e)},getLocalPoll:function(e,t){var n=this.__getFetchParamsString(e,t);return n&&this.__getLocalStoreItem("polling",n)},getLocalPollKey:function(e,t){return this.__getFetchParamsString(e,t)},hasLocalCursor:function(e,t){var n=this.getLocalCursor(e);if(!n||!t)return!1;var i=!0,r=["cursor","after_feed_key","before_feed_key","peek_feed_key"];for(var s in t)-1==r.indexOf(s)&&t[s]!==n[s]&&(i=!1);return i&&"DONE"===n.cursor},hasLocalRequest:function(e,t){return!!this.getLocalRequest(e,t)},hasLocalCached:function(e){return!!this.getLocalCached(e)},hasLocalPoll:function(e,t){return!!this.getLocalPoll(e,t)},setLocalCursor:function(e,t,n){!(n||{}).force&&this.hasLocalCursor(e,t)||this.__setLocalStoreItem("cursors",e,t,n)},setLocalRequest:function(e,t){var n=this.__getFetchParamsString(e,t);n&&this.__setLocalStoreItem("requests",n,1)},setLocalError:function(e,t,n){var i=this.__getFetchParamsString(e,t);i&&this.__setLocalStoreItem("errors",i,this._getCommonError(n))},setLocalCached:function(e){this.__setLocalStoreItem("cached",e,1)},setLocalPoll:function(e,t,n){var i=this.__getFetchParamsString(t,n);this.__setLocalStoreItem("polling",i,e)},unsetLocalRequest:function(e,t){var n=this.__getFetchParamsString(e,t);n&&this.__unsetLocalStoreItem("requests",n)},unsetLocalError:function(e,t){var n=this.__getFetchParamsString(e,t);n&&this.__unsetLocalStoreItem("errors",n)},unsetLocalCached:function(e){this.__unsetLocalStoreItem("cached",e)},unsetLocalPoll:function(e,t){var n=this.__getFetchParamsString(e,t);n&&this.__unsetLocalStoreItem("polling",n)},updateLocalPoll:function(e,t,n,i){if(e){var r=this.getLocalPoll(t,n);if(r){var s=!1;for(var o in e)e[o]!==r[o]&&(s=!0,this._setLocalStateAttr(r,o,e[o]));s&&(i&&i.silent||(this.trigger("change:local:polling",this,r),this.trigger("localStateChange",this)))}else this.setLocalPoll(e,t,n)}},__getFetchParamsString:function(e,t){var n="string"==typeof(e=e||"")?e:JSON.stringify(e),i=t||this.url;return"function"==typeof i&&(i=i()),i&&!i.endsWith("/")&&(i+="/"),i+n},_adjustLocalAttr:function(e,t){var n=!1;return this.LOCAL_STATE.hasOwnProperty(e)||this.COMMON_LOCAL_STATE.hasOwnProperty(e)?(!this._localState&&this._createLocalState("_localState"),n=this._localState[e]!==t,this._setLocalStateAttr(this._localState,e,t)):0===e.indexOf("processing:")&&(!this._processingState&&this._createLocalState("_processingState"),n=this._processingState[e]!==t,this._setLocalStateAttr(this._processingState,e,t)),n},_createLocalState:function(e){this[e]={}},_setLocalStateAttr:function(e,t,n){e[t]=n},_unsetLocalStateAttr:function(e,t){delete e[t]},_addCommonLocalStateListeners:function(){this.listenTo(this,"request",this._onCommonRequest),this.listenTo(this,"sync",this._onCommonSync),this.listenTo(this,"error",this._onCommonError)},_onCommonSave:function(){this.adjustLocalState({saving:!0}),this.trigger("save",this)},_onCommonRequest:function(e){e===this&&this.adjustLocalState({requesting:!0,numRequests:this.getLocalState("numRequests")+1})},_onCommonSync:function(e){e===this&&(this.adjustLocalState({loaded:!0,lastSuccessfulRequest:this.getLocalState("numRequests"),errorMessage:null,errorResponseJson:null}),this._onCommonServerResponse())},_onCommonError:function(e,t,n){e===this&&(this.adjustLocalState(_.extend({lastErrorRequest:this.getLocalState("numRequests")},this._getCommonError(t))),this._onCommonServerResponse())},_getCommonError:function(e){return{errorMessage:this._getCommonErrorMessage(e),errorResponseJson:e.responseJSON||null}},_getCommonErrorMessage:function(e){var t=e.responseJSON||{},n=t.message;return!n&&t.errors&&(n=t.errors[0]),n||"SERVER_ERROR"},_onCommonServerResponse:function(){this.adjustLocalState({requesting:!1,saving:!1,adding:!1})}}}),define("models/common/model",["backbone","config","fslib/fsutil","objects/common/local_state_wrapper","fslib/i18n"],function(e,t,n,i,r){var s=e.Model.extend(i).extend({initialize:function(){_.bindAll(this),this._addCommonLocalStateListeners()},parse:function(){return this.__resetCachedJson__(),e.Model.prototype.parse.apply(this,arguments)},translate:function(){return r.get.apply(r,arguments)},set:function(){return this.__resetCachedJson__(),e.Model.prototype.set.apply(this,arguments)},_adjustLocalAttr:function(){var e=i._adjustLocalAttr.apply(this,arguments);return e&&this.__resetCachedJson__(),e},save:function(){return this._onCommonSave(),e.Model.prototype.save.apply(this,arguments)},saveAndAdjustLocalState:function(e,t,n,i,r){this.adjustLocalState(t,!0);var s=n&&"object"===(void 0===n?"undefined":_typeof(n))?n.success:n,o=n&&"object"===(void 0===n?"undefined":_typeof(n))?n.error:n,a={};_.each(e,function(e,t){a[t]=this.get(t)},this);var c={success:_.bind(function(){this.adjustLocalState(t,!1),i&&(this.set(a,{silent:!0}),this.set(e)),s&&s.apply(this,arguments)},this),error:_.bind(function(){this.set(a,{silent:!0}),this.adjustLocalState(t,!1),o&&o.apply(this,arguments)},this),patch:!0};i&&(c.wait=!1,this.set(e,{silent:!0})),r&&(c.patch=!1),this.save(e,c)},clone:function(){var t=e.Model.prototype.clone.apply(this,arguments);return _.isEmpty(this.LOCAL_STATE)||(t._localState=$.extend(!0,{},this._localState)),t},toJSON:function(t){if(t&&t.cached&&this.__cached__&&this.__cached__.json)return this.__cached__.json;var n=e.Model.prototype.toJSON.apply(this,arguments);return t&&t.localState&&(n.localState=this.getLocalState(),n.idAttribute=this.idAttribute||"id"),t&&t.deep&&(n=JSON.parse(JSON.stringify(n))),t&&t.localState&&(!this.__cached__&&this._createLocalState("__cached__"),this._setLocalStateAttr(this.__cached__,"json",n)),n},__resetCachedJson__:function(){!this.__cached__&&this._createLocalState("__cached__"),this._setLocalStateAttr(this.__cached__,"json",null)}});return n.extendEvents(s),s}),define("models/base",["models/common/model"],function(e){return e.extend({parse:function(t,n){var i=this._getAttrs(this.attributes,t);return n.collection||this.clear({silent:!0}),this.set(i.current,{silent:!0}),e.prototype.parse.call(this,i.updated,n)},save:function(t,n,i){var r;t||(t=this.attributes),null==t||"object"===(void 0===t?"undefined":_typeof(t))?(r=t,i=n):(r={})[t]=n;var s=_.extend({wait:!0,patch:!0},i);return e.prototype.save.call(this,r,s)},isCollection:function(){return!1},isModel:function(){return!0},_getAttrs:function(e,t){var n={},i={};for(var r in t)_.isEqual(e[r],t[r])?i[r]=t[r]:n[r]=t[r];return{updated:n,current:i}}})}),define("objects/contact_wrapper",["backbone"],function(e){return{stripAffinity:function(e){var t=_.clone(e);return t.affinity_key_name&&(delete t.can_sms,delete t.sms_error_details),delete t.affinity_key_name,delete t.affinity,delete t.target_key,delete t.unread,delete t.description,delete t.description_details,delete t.date_description,delete t.date_modified,delete t.path,t}}}),define("models/contact",["models/base","config","objects/contact_wrapper"],function(e,t,n){var i=e.extend({urlRoot:t.REQUEST_URL+"contact",set:function(t,n){if(!t)return e.prototype.set.call(this,t,n);var i=this.stripAffinity(t);return e.prototype.set.call(this,i,n)},getShortKey:function(){var e=this.get("short_key");return e||(e="Contact:"+this.contact_id),e},isAffinity:function(){return!1},isContact:function(){return!0},isFree:function(){return!!this.get("is_free")},isDialpadistan:function(){return!!this.get("is_dialpadistan")},getExtension:function(){return this.get("extension")},getDisplayPhone:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=this.get("display_primary_phone")||this.get("display_uber_phone")||this.get("extension")||"";return e&&(n=e.display),t&&t.get("display_external_endpoint")&&(n=t.get("display_external_endpoint")),n||""},getCallableNumber:function(){return this.get("primary_phone")||this.get("extension")},getPhonesDetails:function(){var e=[];if(this.isTarget()){if(!this.isDialpadistan()){var t=this.get("directory_phones_details")||[],n=this.get("dids_details")||[];e=e.concat(n.concat(t))}_.isEmpty(e)&&this.primaryPhone()&&(e=[{label:"Dialpad",display:this.getDisplayPhone(),number:this.primaryPhone()}])}else e=e.concat(this.get("phones_details")||[]);var i=this.get("selected_phone");return i&&!_.findWhere(e,{number:i})&&e.push({label:"Phone",display:this.getDisplayPhone(),number:i}),e},getEmails:function(e){if(this.isTarget()){var t=e?[]:this.get("emails")||[];if(_.isEmpty(t)){var n=this.get("primary_email");n&&(t=[n])}return t}return this.get("emails")||[]},primaryEmail:function(){return this.get("primary_email")},primaryPhone:function(){return this.get("primary_phone")||this.get("uber_phone")},hasSharedExtension:function(){return"shared"===this.get("type")&&Boolean(this.get("extension"))},hasPhoneNumber:function(){return Boolean(this.primaryPhone())},primaryFax:function(){return this.get("primary_fax")},hasFaxNumber:function(){return Boolean(this.primaryFax())},getUserId:function(){return this.get("user_id")},isDialpad:function(){return this.isTarget()||this.isDialpadContactGroup()||this.getUserId()},isUser:function(){return"user"==this.get("type")},isOffice:function(){return"office"==this.get("type")},isDepartment:function(){return"department"==this.get("type")||this.isCallCenter()},isCallCenter:function(){return"call_center"==this.get("type")},isRoutingTarget:function(){return"call_router"===this.get("type")},isCoachingGroup:function(){return"coaching_group"===this.get("type")},isShortcode:function(){return"shortcode"==this.get("type")},isEmergency:function(){return"emergency"==this.get("type")},isGroup:function(){return this.isOffice()||this.isDepartment()||this.isStaff()||this.isCoachingGroup()},isChannel:function(){return"channel"==this.get("type")},isContactGroup:function(){return"contact_group"==this.get("type")},isStaff:function(){return"staff"==this.get("type")},isLocal:function(){return"local"==this.get("type")},isGoogle:function(){return"google"==this.get("type")},isMicrosoft:function(){return"microsoft"==this.get("type")},isUberconference:function(){return"uberconference"==this.get("type")},isAnonymous:function(){return"anonymous"==this.get("type")},isDirectory:function(){return!(!this.isGoogle()||-1==this.get("contact_id").indexOf("/m8/feeds/profiles/"))||!(!this.isMicrosoft()||-1==this.get("contact_id").indexOf("microsoft_user_"))},isMobile:function(){return"mobile"==this.get("type")},isRoom:function(){return"room"==this.get("type")},isMuted:function(){return!!this.get("is_muted")},hasGeneralInfo:function(){return this.get("company_name")||this.get("location")||this.get("job_title")},_getPhoneCountry:function(){var e=_.findWhere(this.get("phones_details"),{number:this.get("primary_phone")});return e&&e.country?e.country:null},hasNonUSPrimaryPhone:function(){var e=this._getPhoneCountry();return!(!e||"us"==e)},isShared:function(){return this.get("is_shared")},isTarget:function(){return this.isUser()||this.isGroup()||this.isRoom()||this.isChannel()},isIndividual:function(){return!(this.isGroup()||this.isRoom()||this.isContactGroup()||this.isCallCenter())},getContactGroupKeys:function(){return this.isContactGroup()?_.pluck(this.get("contacts"),"key"):[]},isDoNotDisturb:function(e){if(this.isUser()){if("dnd"==this.get("presence"))return!0;if(e)return"unavailable"==this.getGroupStatus(e)}return!1},getGroupDetails:function(e){var t={};if(this.isTarget()){var n=this.get("group_details")||[];t=_.findWhere(n,{id:e})||{}}return t},getGroupStatus:function(e){return this.getGroupDetails(e).status},isAvailable:function(e){return"available"===this.getGroupStatus(e)},getSvgName:function(){return this.isContactGroup()?"Group_Conversation":this.isDepartment()||this.isCallCenter()?"avatar_department":this.isOffice()?"avatar_office":this.isRoom()?"avatar_room":""},_supportedE911Countries:{us:1,ca:1},e911Supported:function(){return!this.isDialpadistan()&&this.e911SupportedForCountry(this.get("country"))},e911SupportedForCountry:function(e){return this._supportedE911Countries[(e||"").toLowerCase()]},isBlocked:function(){return!!this.get("blocked_numbers")},isUnknownContact:function(){return this.get("display_name")===this.get("display_primary_phone")},isStraightToVoicemail:function(){return!!this.isBlocked()&&_.every(this.get("blocked_numbers"),function(e){return"voicemail"==e})},shouldShowIndicator:function(){return this.isUser()||this.getUserId()},getMinRingSeconds:function(){return 10},getMaxRingSeconds:function(){return 45},getDefaultRingSeconds:function(){return this.isRoom()?45:30},isDialpadContactGroup:function(){return this.get("switch_only")},canWarmTransfer:function(){return null!==this.primaryPhone()},canParkTransfer:function(){return this.get("may_park")&&(this.isDepartment()||this.isOffice())},canVoicemailTransfer:function(){return!this.get("vm_disabled")&&(this.isUser()||this.isDepartment()||this.isOffice())},canHoldTransfer:function(){return this.isUser()},getShortName:function(){return this.get("display_name")===this.get("display_primary_phone")?this.get("display_name"):this.get("short_name")||this.get("first_name")||this.get("display_name")},getDateDescription:function(){return this.get("date_description")},getAutoHoldMax:function(){if(this.has("auto_hold_max")){var e=parseInt(this.get("auto_hold_max"));return isNaN(e)?5:e}return 5},getAutoHoldSeconds:function(){if(this.has("auto_hold_seconds")){var e=parseInt(this.get("auto_hold_seconds"));return isNaN(e)?300:e}return 300},getDoAutoHold:function(){return this.get("do_auto_hold")},getQueueEscapeDtmf:function(){var e=this.get("queue_escape_dtmf");if("#"===e||"*"===e)return e;var t=parseInt(e);return _.isNaN(t)?null:t}});return _.extend(i.prototype,n),i}),define("models/user",["config","models/contact"],function(e,t){return t.extend({urlRoot:e.REQUEST_URL+"user",initialize:function(){},defaults:{first_name:"",last_name:""},validate:function(e,t){console.log(e)},getUberPhone:function(){return this.get("uber_phone")},getDisplayUberPhone:function(){return this.get("display_uber_phone")},getShortKey:function(){return"UserProfile:"+this.getUserId()},toggleStatus:function(e){var t=null;if(e){var n=_.findWhere(this.get("group_details"),{id:e});t=!n||"available"==n.status}else t=this.get("is_available");this.save({status:t?"unavailable":"available",status_group_key:e})},setSnooze:function(e){this.save({snooze_duration:e})},setPowerdialMode:function(e){return this.save({autodial_mode:e})},finishPowerdialSession:function(){return this.save({autodial_session:!1})},getPowerdialMode:function(){return"autodial"===this.get("user_mode")&&this.get("autodial_session_id")},getPowerdialConcluding:function(){return"autodial"!==this.get("user_mode")},isUser:function(){return!0},isCompanyAdmin:function(){return this.get("is_super_admin")||this.get("is_google_admin")||this.get("is_microsoft_admin")},isRemoteAdmin:function(){return this.get("is_google_admin")||this.get("is_microsoft_admin")},isRegionalAdmin:function(){return this.get("is_regional_admin")},isAdmin:function(){return this.isCompanyAdmin()||this.get("is_admin")},isCallCenterOperator:function(){return!!this.get("is_call_center_operator")},isTrainee:function(){return!!this.get("coached")},isOperator:function(e){return _.findWhere(this.get("operator_groups"),{id:e})},isFree:function(){return!!this.get("is_free")},isDialpadistan:function(){return!!this.get("is_dialpadistan")},isCoach:function(){return!!this.get("coaching")},hasPaidUc:function(){var e=this.get("uberconference_line_type");return e&&"uc_free"!==e},hasPermission:function(e){if(!e)return!1;var t=this.get("permissions")||[];return _.contains(t,e)},canRemoveExtension:function(){return this.get("extension")&&!this.isDialpadistan()},getRoutingOptions:function(e){for(var t=this.get("dtmf"),n=[],i=0;i<10;i++)t[i]&&(n[i]=t[i],n[i].target=t[i].action_target);return{dtmf:n}},hasDialpadSellLicense:function(){return _.contains(this.get("licenses"),"agents")},hasDialpadSupportLicense:function(){return _.contains(this.get("licenses"),"lite_support_agents")},hasCallCenterLicense:function(e){return!!e&&(!!e.isSupportCenter()||(e.hasMixedCallCenterLicenses()?this.hasDialpadSellLicense()||this.hasDialpadSupportLicense():this.isCallCenterOperator()))},getAvailableCallCenters:function(){var e=this;return!this.isOnDuty()||this.isDoNotDisturb()?[]:_.filter(this.get("operator_groups"),function(t){return"call_center"===t.type&&e.isAvailable(t.id)})}})}),define("models/current_user",["backbone","fslib/singleton","models/user","fslib/webrtc","config"],function(e,t,n,i,r){var s=n.extend({urlRoot:r.REQUEST_URL+"user/me",url:r.REQUEST_URL+"user/me",LOCAL_STATE:{processingMute:!1,processingOnDuty:!1,processingHasCallAi:!1,hasCallAi:!1},getDomains:function(){return this.get("company")?_.clone(this.get("company").all_domains):[this.get("account_domain")]},getLanguage:function(){var e=this.get("language")||r.lang||"en";return e=e.split("-")[0]},getLanguages:function(){return r.langs||["en","dp","de","es","fr","ja"]},showSurnameFirst:function(){return"ja"==this.getLanguage()},getSupportUrl:function(){var e=r.domain,t="/contact-support",n=this.getLanguage();return"en"!==n&&(t="/"+n+t),e+t},getHelpCenterUrl:function(){var e=this.getLanguage(),t=e;return"en"===e&&(t="en-us"),"https://help.dialpad.com/hc/"+t},getForumUrl:function(){return this.getHelpCenterUrl()+"/community/topics"},getCallCenterSKUDetailsUrl:function(){return r.domain+"/callcenter"},getFullDisplayPhone:function(){if(this.isFree()){var e=this.get("office");return(e&&e.display_primary_phone)+" "+this.get("display_primary_phone")}return this.get("display_primary_phone")},getExtension:function(){return this.get("extension")},canMms:function(){return!0},getDomesticCountryCodes:function(){return["us","ca","dp"]},isFree:function(){return!!this.get("is_free")},isTrial:function(){return"trial"===this.get("plan").state},isTrialOrFree:function(){return this.isFree()||this.isTrial()},isManaging:function(){return this.get("is_managing")},getHasVoiceAi:function(){return this.getLocalState("processingHasCallAi")?this.getLocalState("hasCallAi"):this.get("has_callai")},allowVoiceAi:function(){return!!this.get("allow_callai")},allowTalkIq:function(){return this.inExperiment("talkiq")},saveHasVoiceAi:function(e,t){this.saveAndAdjustLocalState({has_callai:e},"processingHasCallAi",t),this.adjustLocalState("hasCallAi",e)},isSuspended:function(){var e=this.get("office");return e&&"suspended"===e.state},isBetaTester:function(){return!!this.get("is_beta_tester")},isInternal:function(){return _.contains(["firespotter.com","switch.co","dialpad.com","fuzz-ball.com","dialpad.co.jp","lojackphone.com"],this.getDomain())},isChannelsEnabled:function(){return this.inExperiment("channels")},isSamlEnabled:function(){return this.inExperiment("saml")},isDpEverywhereEnabled:function(){return!this.inExperiment("no_dp_everywhere")},isApiKeysEnabled:function(){return this.inExperiment("api_keys")||this.isSamlEnabled()},inExperiment:function(e){if(!e)return!1;var t=this.get("experiments")||[],n="-"===e[0],i=_.contains(t,e);return n?i:i&&!_.contains(t,"-"+e)},isFastAnswer:function(){return this.inExperiment("fast_answer_no_mic")||this.inExperiment("fast_answer_mic")},isSprint:function(){return"sprint"===this.get("payment_method")},isSoftbank:function(){return"softbank"===this.get("payment_method")},isServiceTitan:function(){return"service_titan"===this.get("payment_method")},isAppDirect:function(){return"softbank"===this.get("payment_method")||"appdirect"===this.get("payment_method")},isFixedLicense:function(){return this.get("plan").fixed_license},isResold:function(){return this.isSprint()||this.isAppDirect()||this.isServiceTitan()},isCreditCard:function(){return"credit_card"===this.get("payment_method")},onHold:function(){return"hold"===this.get("plan").state},isUcEnabled:function(){return!this.inExperiment("no_uberconference")&&(!!this.isInternal()||(!!this.isSoftbank()||!!this.isFixedLicense()&&!!_.contains(["us","ca"],this.get("country"))))},hasUberConference:function(){return this.isUcEnabled()&&this.get("uberconference_number")},isOpenSignup:function(){return!this.get("google_apps_domain")&&!this.get("microsoft_domain")},getDomain:function(){return this.get("account_domain")},getStaticImageUrl:function(){return this.id?r.domain+"/avatar/contact/"+this.id+".png?version=static":""},getNoAnswerActionData:function(){switch(this.get("no_answer_action")){case"message":return{isMessage:!0};case"voicemail":return{isVoicemail:!0};case"menu":return{displayName:this.translate("an automated response menu")};case"forward":return{displayName:this.get("forward_to_contact").display_name};default:return{}}},isDND:function(e){return!!this.get("do_not_disturb")||(e?this._isDNDForDepartment(e):this.get("do_not_disturb"))},_isDNDForDepartment:function(e){var t=_.findWhere(this.get("group_details"),{id:e});return!!t&&"unavailable"==t.status},maxGroupPstnLines:function(){return this.isFree()?1:10},maxGroupUserLines:function(){return this.isFree()?4:25},minGroupSize:function(){return 3},isConnectedToClient:function(){return(this.get("connected_endpoint")||"").indexOf(i.user)>-1},isConnectedToADesktopClient:function(){return(this.get("connected_endpoint")||"").indexOf("-client-")>-1},isOnDuty:function(){return this.get("is_on_duty")},setOnDuty:function(e,t){this.saveAndAdjustLocalState({is_on_duty:e},"processingOnDuty",t,!0)},setOnDutyReason:function(e,t,n){this.duty_setter=null,this.saveAndAdjustLocalState({is_on_duty:e,duty_status_reason:t},"processingOnDuty",n,!0)},_isOneOfficeCompanyAdmin:function(){var e=this.get("company").office_count||0;return this.isAdmin()&&e<=1},hasCompanySettingsAccess:function(){return!(!this.isCompanyAdmin()&&!this.isRegionalAdmin())||this._isOneOfficeCompanyAdmin()},hasWebCallHistoryAccess:function(){return!0},hasESAccess:function(){return!!this.get("has_es_access")},hasAllAnalyticsAccess:function(){return this.isAdmin()||this.hasPermission("analytics")},isMuted:function(){return!!this.get("muted")},mute:function(e){if(this.isMuted())return this.unMute(e);this.saveAndAdjustLocalState({muted:!0},"processingMute",e,!0)},unMute:function(e){this.saveAndAdjustLocalState({muted:!1},"processingMute",e,!0)},canRecord:function(){return this.get("can_record")},getGroup:function(e){return _.findWhere(this.get("operator_groups"),{key:e})},callerIdIsUserPhone:function(){return this.get("caller_id")===this.get("primary_phone")||null===this.get("caller_id")||"blocked"===this.get("caller_id")},wentOffDutyByMissedCall:function(){return!this.isOnDuty()&&"auto"===this.duty_setter},onAdminAuth:function(){this.adminAuthDate=new Date},adminAuthRequired:function(){if(!this.isRemoteAdmin())return!0;if(!this.adminAuthDate)return!0;var e=new Date;return Math.floor((e-this.adminAuthDate)/6e4)>20100},getFormattedCallerId:function(){return"blocked"===this.get("display_caller_id")?this.translate("Blocked"):this.get("display_caller_id")},getCallerIdDisplays:function(){var e=this.get("dids_details"),t={},n=this;return e.filter(function(e){return!t.hasOwnProperty(e.number)&&(("dp"!==e.country||!n.isFree())&&(t[e.number]=1,!0))})},isGoogleAppsAdmin:function(){return this.get("is_google_admin")},hasFax:function(){var e=!1;return _.each(this.get("operator_groups"),function(t){e=e||!!t.primary_fax}),e||!!this.get("primary_fax")},messagingEnabled:function(){return!this.inExperiment("no_messaging")},canParkCalls:function(){return this.inExperiment("call_parking")&&!this.inExperiment("no_call_parking")},vmDropEnabled:function(){return!!this.get("voicemail_drop_enabled")},vmDropEnabledForOffice:function(){return((this.get("office")||{}).office_settings||{}).voicemail_drop_enabled},canDropVoicemail:function(){return this.inExperiment("voicemail_drop")&&this.vmDropEnabled()&&this.vmDropEnabledForOffice()},isOfficeOperator:function(){return _.findWhere(this.get("operator_groups"),{type:"office",id:this.get("office").id})},officeParkingEnabled:function(){var e=this.get("office");return e&&!!e.may_park},canParkOnlyOnOffice:function(){return this.canParkCalls()&&this.officeParkingEnabled()&&!this.isOfficeOperator()},getOperatorGroups:function(){var e=_.clone(this.get("operator_groups"))||[];return this.canParkOnlyOnOffice()&&e.unshift(this.get("office")),e},_canTransferContactTo:function(e,t){var n=e&&e.contact?e.contact:e;if(!n)return!1;switch(t){case"park":return n.id===this.get("office").id&&n.canParkTransfer();case"warm":var i=!n.isCallCenter()||this.inExperiment("call_center_warm_transfer");return n.canWarmTransfer()&&i;case"voicemail":return n.canVoicemailTransfer();case"hold":return n.canHoldTransfer()}},canParkContact:function(e){return this.canParkCalls()&&this._canTransferContactTo(e,"park")},canWarmTransferContact:function(e){return this._canTransferContactTo(e,"warm")},canVoicemailTransferContact:function(e){return this._canTransferContactTo(e,"voicemail")},canHoldTransferContact:function(e){return this._canTransferContactTo(e,"hold")},canAddDepartment:function(){return this.isAdmin()&&!this.isFree()},canEavesdrop:function(){return this.inExperiment("admin_eavesdrop")},assistantForwardingSupported:function(){return!this.isDialpadistan()},roomPhonesSupported:function(){return!this.isSupportCenter()},onPaymentHold:function(){return!!this.get("on_payment_hold")},creditCardExpiringSoon:function(){var e=new Date(this.get("plan").date_credit_card_expires);if(!e)return!1;var t=new Date(this.get("plan").date_credit_card_expires);t=t.setDate(t.getDate()-30);var n=new Date;return n>=t&&n<=e},creditCardExpired:function(){var e=new Date(this.get("plan").date_credit_card_expires);return!!e&&new Date>e},shouldVerifyCreditCard:function(){return this.isAdmin()&&this.get("plan")&&"cc_account_verification_attempts"in this.get("plan")&&!this.get("plan").cc_verified},hasTalkIq:function(){return this.get("has_callai")},canOnlyViewVoiceAi:function(){return this.inExperiment("call_ai_supervisor")},hasVoiceAiSummary:function(){return this.inExperiment("talkiq")},hasBillableCallCenters:function(){var e="free";return this.get("company")&&(e=this.get("company").account_type||"free"),this.inExperiment("call_center")&&this.inExperiment("call_center_billing")&&"free"!==e},hasMixedCallCenterLicenses:function(){return this.hasBillableCallCenters()&&this.isMixedLicense()},upgradedFromFree:function(){return!!this.get("upgraded_from_free")},isIntegrationEnabled:function(e){return this.get("enabled_integrations").includes(e)},showBilling:function(){return!(!this.isAdmin()||this.isSoftbank()||this.isFree()||this.isServiceTitan())},showLicenses:function(){return this.isAdmin()&&!this.isServiceTitan()},getBucket:function(){return r.bucket},isBucketA:function(){return"group_a"==this.getBucket()},isSupportCenter:function(){return this.inExperiment("support_center")},isCoachingGroupLicenseAssigned:function(){return this.get("coaching")&&this.inExperiment("coaching_groups")},isMixedLicense:function(){return!this.get("call_center_add_on")},getAdminCallCenters:function(){var e=this.getOperatorGroups()||[];return _.filter(e,function(e){return"call_center"===e.type&&e.is_admin})},hasAdminCallCenters:function(){var e=this.getAdminCallCenters()||[];return!_.isEmpty(e)}});return t.create(s,"currentUser")}),define("hbs!single/templates/unregistered_alertbar",["handlebars"],function(e){return e.template(function(e,t,n,i,r){this.compilerInfo=[4,">= 1.0.0"],r=r||{};var s,o,a="",c=(n=this.merge(n,e.helpers)).blockHelperMissing,l=this.escapeExpression;return a+='<table>\n  <tr>\n    <td style="text-align:left;">\n     <div class="mblock"><svg class="mblock icon-sm icon-error-inv"><use xlink:href="#error"/></svg></div>\n     <div class="mblock" style="margin-left: 5px;">\n       <span class="alertbar-hd">',o={hash:{},inverse:this.noop,fn:this.program(1,function(e,t){return"Your device is not connected to Dialpad"},r),data:r},s=(s=n.i18n)?s.call(t,o):"function"===(void 0===(s=t.i18n)?"undefined":_typeof(s))?s.apply(t):s,n.i18n||(s=c.call(t,s,o)),(s||0===s)&&(a+=s),a+='</span>\n       <span style="margin: 0 3px;">|</span> ',o={hash:{},inverse:this.noop,fn:this.program(3,function(e,t){return"This could be due to network issues or your firewall settings"},r),data:r},s=(s=n.i18n)?s.call(t,o):"function"===(void 0===(s=t.i18n)?"undefined":_typeof(s))?s.apply(t):s,n.i18n||(s=c.call(t,s,o)),(s||0===s)&&(a+=s),a+='\n     </div>\n    </td>\n    <td style="text-align: right;">\n      <div class="mblock a-restart alertbar-external-link" style="margin-right: 7px;">',o={hash:{},inverse:this.noop,fn:this.program(5,function(e,t){return"Try Restarting"},r),data:r},s=(s=n.i18n)?s.call(t,o):"function"===(void 0===(s=t.i18n)?"undefined":_typeof(s))?s.apply(t):s,n.i18n||(s=c.call(t,s,o)),(s||0===s)&&(a+=s),a+='</div>\n      <a class="alertbar-external-link alert-link-click" href="',a+=l(s=(s=n.helpCenterUrl)?s.call(t,{hash:{},data:r}):"function"===(void 0===(s=t.helpCenterUrl)?"undefined":_typeof(s))?s.apply(t):s)+'/articles/211437923-Adjust-Your-Network" target="_blank">',o={hash:{},inverse:this.noop,fn:this.program(7,function(e,t){return"Get Help"},r),data:r},s=(s=n.i18n)?s.call(t,o):"function"===(void 0===(s=t.i18n)?"undefined":_typeof(s))?s.apply(t):s,n.i18n||(s=c.call(t,s,o)),(s||0===s)&&(a+=s),a+="</a>\n    </td>\n  </tr>\n</table>\n"})}),define("single/views/unregistered_alertbar_view",["config","views/common/view","models/current_user","hbs!single/templates/unregistered_alertbar"],function(e,t,n,i){return t.extend({template:i,events:{"click .alert-link-click":"linkClick","click .a-restart":"restart"},initialize:function(){t.prototype.initialize.call(this)},getTemplateData:function(){return{helpCenterUrl:n.getHelpCenterUrl()}},restart:function(){Backbone.trigger("restart")}})}),define("models/webrtc_stats",["models/base","config"],function(e,t){return e.extend({urlRoot:t.REQUEST_URL+"webrtcstats"})}),define("fslib/local_storage",["require","config","fslib/fsutil"],function(require){var e=require("config"),t=require("fslib/fsutil").getChrome("storage.local"),n=window.localStorage,i={},r=[],s=!1,o=null,a=!1,c=!1,l=function(){return e.env||"env"},u=function(e){return l()+":"+e},h=function(e,t,n){e&&(t?_.defer(e,n):e(n))},d=function(e,t,i,r){!function(e){return _.isUndefined(e)||_.isNull(e)}(t)?n[e]=JSON.stringify(t):(n.removeItem(e),y(e)),h(i,r,t)},f=function(e,r,s){var o;return m(e)?(o=g(e),h(r,s,o),o):(t?o=function(e,n){t.get(e,function(t){v(e,t[e]),h(n,!1,t[e])})}(e,r||Function.prototype):n?o=function(e,t,r){var s=n[e];try{s=JSON.parse(s)}catch(e){}return b.setKeyOnLocalCache(i,e,s),h(t,r,s),s}(e,r,s):(o=g(e),h(r,s,o)),o)},p=function(e,i,r,s){t?function(e,n,i){var r={};r[e]=n,t.set(r,i)}(e,i,r||Function.prototype):n&&d(e,i,r,s)},g=function(e){return i[e]},m=function(e){return i.hasOwnProperty(e)},v=function(e,t){b.setKeyOnLocalCache(i,e,t),S(e,t)},y=function(e){b.removeKeyFromLocalCache(i,e),S(e)},b={setKeyOnLocalCache:function(e,t,n){e[t]=n},removeKeyFromLocalCache:function(e,t){delete e[t]}},S=function(e,t){var n=w(e);Backbone.trigger("change:storage:"+n,t),Backbone.trigger("localStorageChanged",{key:n,value:t}),C(n,t)},C=function(e,t){c||Backbone.trigger("localstorage:sync",{key:e,value:t})},w=function(e){var t=l()+":";return 0===e.indexOf(t)?e.substring(t.length):e},T=function(e,n,i,a){var c=u(e);v(c,n);var l=!!i&&!t;return a||t||(r.push(M(e,n)),s||(clearTimeout(o),o=_.defer(k))),i?p(c,n,i,l):new Promise(function(e){p(c,n,e)})},k=function(){A().then(x).catch(x)},E=function(e){t?function(e){t.getBytesInUse(null,e)}(e):e(n?function(){var e,t=0;for(e in n)t+=2*(n[e].length+e.length)||0;return t}():0)},A=function(){return s=!0,new Promise(function(e){E(e)})},x=function(e){var t=(e=e||0)/1024/1024;t>4&&(Backbone.trigger("localstorage:maxstoragesize",r),console.error("MAX STORAGE SIZE REACHED:",t,"MB")),r=[],s=null},R=function(e){I(),t?function(e){t.clear(e)}(e):(n&&n.clear(),e())},I=function(){Object.keys(i).forEach(function(e){b.removeKeyFromLocalCache(i,e)})},L=function(e){return e.map(function(e){return M(e)})},M=function(e,t){return{key:e,value:t||g(u(e))}};return{clearLocal:function(e){if(!a){a=!0;var t=L(e||[]);return new Promise(function(e){R(e)}).then(function(){a=!1,t.forEach(function(e){T(e.key,e.value)})})}},getCache:function(){return i},getLocal:function(e,t){var n=u(e);return f(n,t,!0)},getLocalCache:g,hasLocal:function(e){var t=u(e);return m(t)},localCacheProperties:b,setLocal:T,setLocalCache:v,syncLocal:function(e){c=!0,T(e.key,e.value),c=!1}}}),define("fslib/server_time",[],function(){var e=null,t=null;return{getServerTime:function(){var e=t||0;return Date.now()-e},setServerTime:function(n){var i=Date.parse(n);if(i&&!(e&&e>i)){e=i;var r=Date.now();r,t=r-i}}}}),define("models/common/session",["backbone","config","fslib/singleton","fslib/fsutil","fslib/i18n","fslib/local_storage","fslib/server_time","underscore"],function(e,t,n,i,r,s,o,a){return e.Model.extend({urlRoot:null,STICKY_STORAGE_ITEMS:["lang","audioinput","videoinput","audiooutput","forgottenMedia"],initialize:function(){e.Model.prototype.initialize.apply(this,arguments),a.bindAll(this),this.getClientId(),this.getLocal("lang",this.setLanguageOnLaunch)},getClientId:function(){return this.getLocal("client_id",this._onClientId)},getLanguage:function(){var e=this._getCurrentUser().getLanguage();return this.setLanguage(e),e},setLanguageOnLaunch:function(e){e=e||t.lang,console.info("Setting Initial Language: "+e),this.setLanguage(e)},setLanguage:function(e){r.lang!=e&&(a.contains(this._getCurrentUser().getLanguages(),e)?(this.setLocal("lang",e),r.changeLanguage(e)):console.error("invalid language: "+e))},_onLanguageChange:function(e){this.setLanguage(e.get("language"))},_getCurrentUser:function(){throw new Error("Implement _getCurrentUser")},_setRandomId:function(){this.clientId=Math.random().toString(36).substring(2,17),this.setLocal("client_id",this.clientId)},_onNetworkInterfaces:function(e){if(e&&e.length){var t=a.find(e,function(e){return e.address.search("::")});t&&(this.clientId=t.address)}this.clientId&&-1!=this.clientId.search("::")||(console.log("Failed to find mac address in interfaces"),this._setRandomId()),this.clientId=this.clientId.replace(/:/g,""),this.setLocal("client_id",this.clientId),this._onClientId(this.clientId)},_onClientId:function(e){if(this.clientId=e||this.clientId,!this.clientId||this.clientId.length>20)try{return void chrome.system.network.getNetworkInterfaces(this._onNetworkInterfaces)}catch(e){console.log("Permission not allowed to system network"),this._setRandomId()}this.authorize()},getAjaxParams:function(){},authorize:function(){var e=this.getAjaxParams();return e&&$.ajaxSetup(e),this._setUpAjaxListeners(),t.isApp&&globals.background&&globals.background.$.ajaxSetup(e),e},_setUpAjaxListeners:function(){this._ajaxListeners||(this._ajaxListeners=!0,$(document).ajaxSuccess(this._onAjaxSuccess))},_onAjaxSuccess:function(e,n,i,r){i&&0===i.url.indexOf(t.domain)&&this._maybeSetServerTime(r,n)},_maybeSetServerTime:function(e,t){o.setServerTime(t.getResponseHeader("date")||e.now)},getServerTime:function(){return o.getServerTime()},setLocal:function(e,t,n,i){s.setLocal(e,t,n,i)},getLocal:function(e,t){return s.getLocal(e,t)},syncLocal:function(e,t){return s.syncLocal(t)},setLocalMemory:function(e,t){s.setLocalCache(e,t)},getLocalMemory:function(e){return s.getLocalCache(e)},clearLocalStorage:function(e){var t=this._getStickyStorageKeys(e);return s.clearLocal(t).then(this.getClientId)},clearSession:function(){this.setLocal("session",null)},clearAnnouncement:function(){this.set("announcement",null),this.setLocal("session",this)},clearLoginMessage:function(){var e=this.get("message");if(e){var t="custom_login_message_"+e;this.set("message",null),this.setLocal("session",this),this.setLocal(t,null)}},_getStickyStorageKeys:function(e){var t=e||[];return this.STICKY_STORAGE_ITEMS.concat(t)},localFetchedAlready:function(e){return s.hasLocal(e)},currentWindow:function(){return window}})}),define("models/session",["models/common/session","config","fslib/singleton","fslib/fsutil","fslib/i18n","models/current_user"],function(e,t,n,i,r,s){var o=0,a={},c=e.extend({urlRoot:t.REQUEST_URL+"login",_stickyStorageItems:["lang","audioinput","videoinput","audiooutput"],initialize:function(){if(e.prototype.initialize.apply(this,arguments),this.listenTo(s,"change:language",this._onLanguageChange),this.listenTo(s,"sync",this._onCurrentUserUpdate),this.listenTo(Backbone,"session:setlocal",this.setLocal),this.listenTo(Backbone,"localstorage:maxstoragesize",this._onMaxStorageSize),this.online=window.navigator&&window.navigator.onLine,this.online=!!_.isUndefined(this.online)||this.online,this.online=!0,t.isApp||t.isNative){$(window).on("offline",this._onNetwork),$(window).on("online",this._onNetwork);try{chrome.idle.setDetectionInterval(120),chrome.idle.onStateChanged.addListener(_.bind(this._onIdle,this))}catch(e){console.log("Failed to listen to system activity")}}window.globals&&globals.notification&&"call"==globals.notification.type&&"ringing"===globals.notification.state&&(console.info("SESSION: Got a push notification for a ringing call. Setting up cold start."),this.preventRegister=!0),t.isNative&&_electron&&_electron.ipcRenderer.on("local_storage",this.syncLocal)},isLoggedIn:function(){return this.loggedIn||this.cachedLoggedIn},getGoogleProjectId:function(){return"640049980484"},getClientId:function(){return this.getLocal("client_id",this._onClientId)},getLanguage:function(){return lang=s.getLanguage(),this.setLanguage(lang),lang},setLanguageOnLaunch:function(e){e=e||t.lang,console.info("Setting Initial Language: "+e),this.setLanguage(e)},setLanguage:function(e){e&&r.lang!=e&&(_.contains(s.getLanguages(),e)?(this.setLocal("lang",e),r.changeLanguage(e)):console.error("invalid language: "+e))},_onLanguageChange:function(e){this.setLanguage(e.get("language"))},_setRandomId:function(){this.clientId=Math.random().toString(36).substring(2,17),this.setLocal("client_id",this.clientId)},_onNetworkInterfaces:function(e){if(e&&e.length){var t=_.find(e,function(e){return e.address.search("::")});t&&(this.clientId=t.address)}this.clientId&&-1!=this.clientId.search("::")||(console.log("Failed to find mac address in interfaces"),this._setRandomId()),this.clientId=this.clientId.replace(/:/g,""),this.setLocal("client_id",this.clientId),this._onClientId(this.clientId)},_onClientId:function(e){if(this.clientId=e||this.clientId,!this.clientId||this.clientId.length>20)try{return void chrome.system.network.getNetworkInterfaces(this._onNetworkInterfaces)}catch(e){console.log("Permission not allowed to system network"),this._setRandomId()}this.authorize()},getAjaxParams:function(){var e={"office-id":t.office_id,"switch-id":this.clientId,"api-version":1};if(auth=this.get("auth"),auth&&(e.Authorization="Bearer "+auth.access_token),this.type&&(e["switch-type"]=this.type),t.isApp){var n=i.getAppVersion();n&&(e["switch-version"]="Dialpad/"+n)}else(t.isSalesforce||t.isIframe)&&t.version&&(e["switch-version"]="Dialpad/"+t.version);var r=this;return{headers:e,beforeSend:function(e,t){var n=o++;a[n]=setTimeout(function(){delete a[n],!r.isMakingAjaxCall()&&r.trigger("ajax:done")},1e4),e.ajaxId=n;var i=t.url;if(i){var s=i.match(/(\/api\/.*)/);if(s){var c=s[0],l=t.type;console.log("AJAX "+l+": "+c),e.fail(function(t){t.statusText;console.info("failed status="+t.status+" "+l+" "+c),e.responseJSON&&console.info(JSON.stringify(e.responseJSON))})}}},complete:function(e,n){var i=e.status,s=!1;if(clearTimeout(a[e.ajaxId]),delete a[e.ajaxId],r.isMakingAjaxCall()||(clearTimeout(null),r.trigger("ajax:done")),200!=i||r.online||(r.online=!0,r.trigger("online")),403==i){try{s="unauthorized"==JSON.parse(e.responseText).exception}catch(e){console.log("Could not parse JSON response.")}t.isApp||!s?s&&!$(".a-relaunch").length&&(r.clearSession(),r.clearLocalStorage(),r.trigger("unauthorized")):r.logout()}}}},isMakingAjaxCall:function(){return!_.isEmpty(a)},login:function(e,n){var i=!1,r=!1;return e&&(i=!!e.force,r=!!e.silent,e=_.omit(e,["force","silent"])),this._loginOptions=e||this._loginOptions||{},this.type=this._loginOptions.type||this.type,this.started&&!i?(console.info("started is true, not trying to login again"),void(n&&n())):(this.started=!0,this.authorize(),!t.useCache||i||t.proxy_user?this._loginOptions.email&&this._loginOptions.password?this._sendClientLogin(n):(!r&&this._showBigLoader(),this._sendLogin(n)):(this.getLocal("session",this._onCachedSession),n&&n()),!0)},_getCurrentUser:function(){return s},_onCachedSession:function(e){e?(console.log("Cached login:"),console.log(e),this.set(e),this._updateSingletons(),this.cachedLoggedIn=s.id,this.trigger("login")):this._showBigLoader(),this._sendLogin()},_showBigLoader:function(){this.online&&(Backbone.trigger("overlay","dialpad_swoosh",{text:"Logging you in"}),this.showBigLoader=!0)},_sendLogin:function(e){return this.online?this.clientId?(this._loginOptions.client_id=this.clientId,t.isNative?this._loginOptions.native={version:t.appVersion,js_version:t.version,platform:t.platform,hostname:t.hostname}:t.version&&(this._loginOptions.packaged_app_version=t.version),t.proxy_user&&(this._loginOptions.proxy_user=t.proxy_user),void this.save(this._loginOptions,{success:this._onLogin.bind(this,!0,e),error:_.bind(function(t,n,i){this._onLoginError(t,n,i,e)},this)})):(console.log("No client id yet..."),void _.delay(this._sendLogin.bind(null,e),10)):(console.log("Not online...skipping login"),this.started=!1,this.cachedLoggedIn?(e&&e(),!1):this._onLoginError(null,null,null,e))},_sendClientLogin:function(e){_.extend(this._loginOptions,{action:"packaged_app"});var n=JSON.stringify(this._loginOptions);$.ajax(t.REQUEST_URL+"auth/client",{data:n,contentType:"application/json",type:"post",success:this._onClientLoginSuccess.bind(null,e),error:_.bind(function(t,n,i){this._onClientLoginError(e,t)},this)})},_onClientLoginSuccess:function(e){this.hasClientLogin=!0,this.setLocal("hasclientlogin",this.hasClientLogin),this._sendLogin(e)},_onClientLoginError:function(e,t){return this._onLoginError(this,t,null,e)},_onLoginError:function(e,t,n,i){window.navigator.onLine&&Backbone.trigger("overlay"),console.log("Login Failed"),this.started=!1;var r={};try{r=JSON.parse(t.responseText),this.setLocal("login:error",r)}catch(e){i&&i()}this.trigger("login:error",r),i&&i()},_updateSingletons:function(){this.authorize(),t.disableChannels=!this.getChannelId();var e=this.get("config")||{};t.googleApiKey=e.gKey,t.braintreeApiKey=e.btKey,t.braintreeMerchantID=e.btId,t.braintreeTokenizationKey=e.btTokenKey,t.wootricApiKey=e.wootricKey,t.pusherApiKey=e.pusherKey,t.pusherCluster=e.pusherCluster,t.callstatsIoKey=e.callstatsKey,t.langs=e.langs,t.talkiq_url=e.talkiq_url,t.bucket=e.bucket,t.helpEnabled=e.help_enabled,t.zendeskKey=e.zendesk_key,s.set(this.get("user")),s.isBetaTester()&&(t.disableConsoleLogs=!1,console.log("console logs enabled for beta tester"))},_onLogin:function(e,n){this.showBigLoader&&(Backbone.trigger("overlay"),this.showBigLoader=!1),console.log("Logged In: ");var i=this.get("now")||Date.now()-100,r=Date.now();if(this.setLocal("time_delta",r-i),t.proxy_user||this.setLocal("session",this.toJSON()),this.setLocal("login:error",null),this._updateSingletons(),Backbone.trigger("track:identify",s.toJSON()),t.isSingle&&!e&&Backbone.trigger("track:event","login",{client_id:this.clientId}),this.cachedLoggedIn&&this.cachedLoggedIn!=s.id)return this.trigger("logout"),void(n&&n());this.loggedIn=!0,this.trigger("login"),this.trigger("login:fresh"),n&&n()},logout:function(){this.loggedIn=!1,this.cachedLoggedIn=null,this.started=!1,this._loginOptions=null,this.clientId=null,this.clearSession(),this.clearLocalStorage(),$.ajax({type:"POST",url:t.domain+"/api/logout",success:_.bind(function(){this.trigger("logout")},this)})},getSipConfig:function(){var e=_.clone(this.get("sip"));if(e)return t.wsServers&&(console.log("Overriding ws_servers with "+t.wsServers),e.ws_servers=t.wsServers),e.userAgent=i.getUserAgent(),e.reconnect=!1,this.preventRegister&&(e.register=!1,this.preventRegister=!1),e.logStats=!0,s.inExperiment("no_turn")&&(e.turnServers=[]),s.inExperiment("rm_host_candidates")&&(e.removeHostCandidates=!0),s.inExperiment("ice_gathering_timeout")&&(e.iceGatheringTimeout=!0),s.inExperiment("fast_answer_no_mic")&&(e.preloadCalls=!0),s.inExperiment("fast_answer_mic")&&(e.preloadCallsWithMic=!0),t.isRemote&&(e.noAudio=!0,e.allowEdgeBrowser=!0),e;console.log("Sip Config doesn't exist...make sure you are logged in.")},getWebrtcSipConfig:function(){var e=this._stripUdpTurnServers(this.getSipConfig());return s.inExperiment("no_stun")&&(e.disableStun=!0),e},_stripUdpTurnServers:function(e){e=JSON.parse(JSON.stringify(e));for(var t=[],n=0;n<e.turnServers.length;n++)-1===e.turnServers[n].server.indexOf("transport=udp")&&t.push(e.turnServers[n]);return e.turnServers=t,e},getDeviceId:function(){return(this.get("sip")||{}).user},getChannelToken:function(){var e=this.get("channel");if(e)return e.channel_token;console.log("No channel token yet")},getChannelId:function(){var e=this.get("channel");if(e)return e.channel_id},_onNetwork:function(e){this.online=window.navigator.onLine,this.loggedIn||this.login(),this.online?(console.info("Network Status: online"),this.trigger("online")):(console.info("Network Status: offline"),this.trigger("offline"))},_onIdle:function(e){console.log("System Idle: "+e),"active"==e&&this.trigger("active"),this.trigger("idle",e)},currentWindow:function(){return window},_onCurrentUserUpdate:function(){s.get("update_session")&&(this.set(s.get("update_session")),this.trigger("login:fresh"))},setTimeDiff:function(){e.prototype.setTimeDiff.apply(this,arguments),this.trackClientSleep()},trackClientSleep:function(){clearTimeout(this._timeTo);var e=Date.now(),t=e-(this._lastTimeCheck||e)-5e3;Math.abs(t)>1e4&&console.info("SLEEP: user came out of sleep or changed system clock. Time asleep: ",t,"ms"),this._lastTimeCheck=e,this._timeTo=_.delay(this.trackClientSleep,5e3)},reload:function(e,n){var i=n||{};t.proxy_user&&(i.proxy_user=t.proxy_user);var r=$.param(i);r&&(e=e+"?"+r),e.startsWith("/")||(e="/"+e),this.clearSession(),Backbone.trigger("navigate",e)},_onMaxStorageSize:function(e){this.refreshLocalStorage().then(this._restoreLocalStorage.bind(this,e))},_restoreLocalStorage:function(e){e.forEach(this._restoreLocalStorageItem)},_restoreLocalStorageItem:function(e){this.setLocal(e.key,e.value,null,!0)},refreshLocalStorage:function(){return this.clearLocalStorage(["notifications_on","mini_on","sounds_on","client_id","mini_answer"])}});return n.create(c,"session")}),define("objects/stats_monitor_wrapper",["config","models/webrtc_stats","models/current_user","models/session"],function(e,t,n,i){return{CALLSTATS_ID:"132995113",_resetAlerts:function(){this.currentAlerts={},this.hideAlerts()},_addAlertListeners:function(){this.listenTo(Backbone,"alertDialogRemoved",this._onAlertRemoved),this.listenTo(Backbone,"alertDialogAdded",this._onAlertAdded),this.listenTo(Backbone,"alertbar:removed",this._onAlertRemoved),this.listenTo(Backbone,"alertbar:added",this._onAlertAdded)},_onAlertDialogChanged:function(e,t){e.alertId&&(this.currentAlerts[e.alertId]=!!t&&e,t?console.log("STATS MONITOR WRAPPER: Alert (",e.alertId,") shown."):console.log("STATS MONITOR WRAPPER: Alert (",e.alertId,") removed."))},_onAlertRemoved:function(e){this._onAlertDialogChanged(e)},_onAlertAdded:function(e){this._onAlertDialogChanged(e,!0)},hideAlert:function(e){this.isShowingAlert(e)&&(this.currentAlerts[e].isAlertbar?Backbone.trigger("alertbar:close",e):Backbone.trigger("overlay"))},isShowingAlert:function(e){return!!this.currentAlerts[e]},_showConnectionAlert:function(){var e=this.translate("Weak connection");e+=" | ",e+=this.translate("This may affect call quality"),Backbone.trigger("alertbar","warning",{showX:!0,logo:"error",id:this.ALERTS.CONNECTION,content:e,url:"https://dialpad.com/weak-connection",displayURL:this.translate("Open help center")})},_showMicAlert:function(){Backbone.trigger("alert",{title:this.translate("We can't hear you!"),titleEscaped:!0,icon:"#microphone_unplugged",iconSize:"lg",message:this.translate("Seems like there is a problem detecting your microphone. Please hang up your call and try another microphone. If this problem persists, we recommend restarting your browser or computer."),alertId:this.ALERTS.MIC})},hideAlerts:function(){for(var e in this.ALERTS)this.hideAlert(this.ALERTS[e])},_onShowAlert:function(e,t){if(!this.isShowingAlert(e)){switch(e){case this.ALERTS.CONNECTION:var n=t.isLocal();console.warn("SHOULD show connection error. Average",n?"round trip time (rtt)":"jitter delay",":",n?t.getRtt():t.getJitterDelay(),"ms"),console.log("Disabled showing the weak connection alert bar for now until we can figure out a better metric.");break;case this.ALERTS.MIC:console.warn("Showing mic error. Average Input Volume: ",t.getAverageVolume()),this._showMicAlert()}return!0}},sendStatsToServer:function(e){var n=this.getStatsForServer();return this.clearStatsForServer(),new Promise(_.bind(function(i,r){if(!n||!n.length)return r();(new t).save({call_id:e,stats:JSON.stringify(n)},{success:i,error:function(){r(n)}})},this))},_getRtcPeerConnection:function(){if(this.pc)return this.pc.getRawPc()},useCallStats:function(){return n.inExperiment("callstats_io")&&callstats&&this.pc},_createCallStatsFabric:function(e){console.log("STATS MONITOR WRAPPER: CALL STATS: Adding new fabric for:",e),callstats.addNewFabric(this._getRtcPeerConnection(),this._callStatsFabric.remoteId||"remote",callstats.fabricUsage.multiplex,e),this._addCallStatsListeners()},_addCallStatsListeners:function(){this.stopListening(this,"stopped",this._onStoppedForCallStats),this.stopListening(this,"signalingstatechange",this._updateCallStatsRemoteId),this.listenTo(this,"stopped",this._onStoppedForCallStats),this.listenTo(this,"signalingstatechange",this._updateCallStatsRemoteId)},_onStoppedForCallStats:function(){this._callStatsFabric=null},_getCallstatsId:function(){return n.get("user_id")+"_"+i.getClientId()+"_"+Date.now()},updateCallStatsWithCall:function(e){if(this.useCallStats()&&this._callStatsFabric){var t=this._getCallStatsFabricEvent(e);!this._callStatsFabric[e.id]&&this._callStatsFabric.initialCallId&&e.shouldStartRecordingCallStats()?(this._createCallStatsFabric(e.id),this._callStatsFabric[e.id]=t):this._callStatsFabric.initialCallId||this._updateCallStatsInitialCallId(),this._callStatsFabric[e.id]&&this._callStatsFabric[e.id]!==t&&(this._callStatsFabric[e.id]=t,console.log("STATS MONITOR WRAPPER: CALL STATS: Sending fabric event for call (",e.id,"):",t),callstats.sendFabricEvent(this._getRtcPeerConnection(),t,e.id))}},_updateCallStatsRemoteId:function(){var e=this.getRemoteIpAddress();e&&this._callStatsFabric.remoteId!==e&&(this._callStatsFabric.remoteId=e,this._updateCallStatsIdentifiers())},_updateCallStatsInitialCallId:function(e){e&&!this._callStatsFabric.initialCallId&&(this._callStatsFabric.initialCallId=e,this._callStatsFabric[e]=fabricEvent,this._updateCallStatsIdentifiers())},_shouldUpdateCallStatsIdentifiers:function(){return!this._callStatsFabric.initialIdentifiers&&this._callStatsFabric.initialCallId&&this._callStatsFabric.remoteId},_updateCallStatsIdentifiers:function(){if(this._shouldUpdateCallStatsIdentifiers()){var e={conferenceID:this._callStatsFabric.initialCallId,remoteUserID:this._callStatsFabric.remoteId};console.log("STATS MONITOR WRAPPER: CALL STATS: Updating identifiers with",JSON.stringify(e)),this._callStatsFabric.initialIdentifiers=e,callstats.setIdentifiers(e)}},_getCallStatsFabricEvent:function(e){return e.shouldStartRecordingCallStats()?callstats.fabricEvent.fabricResume:e.shouldPauseRecordingCallStats()?callstats.fabricEvent.fabricHold:e.shouldStopRecordingCallStats()?callstats.fabricEvent.fabricTerminated:void 0}}}),define("fslib/cbuffer",[],function(){var e=function(e){this.buffer=new Array(e),this.pointer=0,this.length=0};return e.prototype.push=function(e){this.buffer[this.pointer]=e,this.pointer=(this.pointer+1)%this.buffer.length,this.length<this.buffer.length&&this.length++},e.prototype.pop=function(){if(!(this.length<1)){this.length--;var e=this.pointer-1;return e<0&&(e=this.buffer.length-1),this.pointer=e,this.buffer[this.pointer]}},e.prototype.at=function(e){if(!(e>=this.buffer.length||e>=this.length||e<0)){var t=this.pointer-this.length+e;return t<0&&(t+=this.buffer.length),this.buffer[t]}},e.prototype[Symbol.iterator]=function(){var e=0,t=this;return{next:function(){return e<t.length?{value:t.at(e++),done:!1}:{done:!0}}}},e}),define("models/common/stream_stats",["models/common/model"],function(e){return e.extend({initialize:function(){e.prototype.initialize.apply(this,arguments),this.tracks={}},addTrack:function(e){e&&(this.tracks[e.id]=e)},isLocal:function(){return!!this._findTracks({local:!0}).length},isLegacy:function(){return!!this._findTracks({isLegacy:!0}).length},_findTracks:function(e){var t=[];for(var n in this.tracks){var i=!0;for(var r in e)if(this.tracks[n][r]!=e[r]){i=!1;break}i&&t.push(this.tracks[n])}return t},_getTracksOfType:function(e){return this._findTracks({type:e})},getAudioTracks:function(){return this._getTracksOfType("audio")},getVideoTracks:function(){return this._getTracksOfType("video")},getTrack:function(e){var t=e.id||e;return this.tracks[t]||this._findTracks({ssrc:t})[0]},hasAudio:function(){return!!this.getAudioTracks().length},hasVideo:function(){return!!this.getVideoTracks().length},isAudioMuted:function(){var e={type:"audio",isMute:!0},t=!this.isLegacy()&&this.isLocal();t||(e.state="started");var n=this._findTracks(e);if(!t)return!!n.length;for(var i=0;i<n.length;i++)if(!n[i].packets&&"stopped"!==n[i].state)return!0;return!1},_isTrackStarted:function(e,t){var n={state:"started",type:e};return t&&(n.id=t),!!this._findTracks(n).length},isVideoStarted:function(e){return this._isTrackStarted("video",e)},isAudioStarted:function(e){return this._isTrackStarted("audio",e)},_getTrackValues:function(e,t){var n={state:"started"};t&&(n.type=t);for(var i=this._findTracks(n),r=[],s=0;s<i.length;s++)isNaN(i[s][e])||r.push(i[s][e]||0);return r},_getMaxFromArray:function(e){return(e=e||[]).length?Math.max.apply(Math,e):0},_getMaxValue:function(e){var t=this._getTrackValues(e);return this._getMaxFromArray(t)},_isScoreAbove:function(e,t,n){return this._getMaxValue(e,n)>t},isJitterScoreAbove:function(e){return this._isScoreAbove("jitterDelayScore",e,"audio")&&this._isScoreAbove("jitterDelayScorePrediction",e,"audio")},isRttScoreAbove:function(e){return this._isScoreAbove("rttScore",e)&&this._isScoreAbove("rttScorePrediction",e)},getVolume:function(){return this._getMaxValue("volume","audio")},getRtt:function(){return this._getMaxValue("rttAvg")},getRttScore:function(){return this._getMaxValue("rttScore")},getRttScorePrediction:function(){return this._getMaxValue("jitterDelayScorePrediction")},getJitterScore:function(){return this._getMaxValue("jitterDelayScore")},getJitterScorePrediction:function(){return this._getMaxValue("jitterDelayScorePrediction")},getJitter:function(){return this._getMaxValue("jitterBufferAvg")},getJitterDelay:function(){return this._getMaxValue("jitterDelayAvg")},getAverageVolume:function(){return this._getMaxValue("volumeAvg","audio")},getVolumeScore:function(){return this._getMaxValue("volumeScore","audio")},hasEcho:function(){return!!this._findTracks({type:"audio",state:"started",echoAvg:!0}).length},isTyping:function(){return!!this._findTracks({type:"audio",state:"started",typingAvg:!0}).length},hasSsrc:function(e){return this._findTracks({ssrc:e})}})}),define("objects/common/peer_connection_stats_gatherer",["fslib/object","fslib/cbuffer"],function(e,t){var n=/^f[0-9]+$/i;return e.extend({POLL_TIME:200,SLIDING_WINDOW:{volume:6,rtt:6,jitterDelay:6,jitterBuffer:6,echo:.2,typing:.2,packets:6.2},PER_SECOND:["bytes","packets"],initialize:function(){e.prototype.initialize.apply(this,arguments),this.unsetPeerConnection()},setPeerConnection:function(e){this.unsetPeerConnection(),this.pc=e,this.addPeerConnectionListeners(),this._onPcChange()},unsetPeerConnection:function(){this.stopGatheringStats(),this.resetStats(),this.removePeerConnectionListeners(),this.pc=null,this.trigger("stopped")},addPeerConnectionListeners:function(){this.removePeerConnectionListeners(),this.listenTo(this.pc,"iceconnectionstatechange",this._onPcChange),this.listenTo(this.pc,"icegatheringstatechange",this._onPcChange),this.listenTo(this.pc,"signalingstatechange",this._onPcChange)},removePeerConnectionListeners:function(){this.pc&&(this.stopListening(this.pc,"iceconnectionstatechange"),this.stopListening(this.pc,"icegatheringstatechange"),this.stopListening(this.pc,"signalingstatechange"))},resetStats:function(){this.iceConnectionState=null,this.iceGatheringState=null,this.signalingState=null,this.tracks={},this.candidates={},this._ignoredStats={}},getTrackStats:function(e){if(e){var t=e.id||e;return this.tracks[t]||this._getTrackBySsrc(t)}},_findTracks:function(e){var t=[];for(var n in this.tracks){var i=!0;for(var r in e)if(this.tracks[n][r]!=e[r]){i=!1;break}i&&t.push(this.tracks[n])}return t},_getTrackBySsrc:function(e){return this._findTracks({ssrc:e})[0]},_onPcChange:function(){this._onIceConnectionStateChange(),this._onIceGatheringStateChange(),this._onSignalingStateChange()},getIceConnectionState:function(){return this.pc?this.pc.iceConnectionState:"closed"},_onIceConnectionStateChange:function(e){var t=this.getIceConnectionState();if(this.iceConnectionState!==t){switch(this.iceConnectionState=t,t){case"new":case"checking":break;case"connected":case"completed":this.gatherStats();break;case"disconnected":break;case"failed":this._onIceFailed();case"closed":this.unsetPeerConnection()}this.trigger("iceconnectionstatechange",t)}},_onIceFailed:function(){console.warn("PC STATS GATHERER: Ice failed.")},getIceGatheringState:function(){return this.pc?this.pc.iceGatheringState:"new"},_onIceGatheringStateChange:function(e){var t=this.getIceGatheringState();this.iceGatheringState!==t&&(this.iceGatheringState=t,this.trigger("icegatheringstatechange",t))},getSignalingState:function(){return this.pc?this.pc.signalingState:"closed"},_onSignalingStateChange:function(e){var t=this.getSignalingState();this.signalingState!==t&&(this.signalingState=t,this.trigger("signalingstatechange",t))},gatherStats:function(){this.stopGatheringStats(),this.pc&&(this.pc.getStats(null,this._onStatsSuccess,this._onStatsError),this._gatheringTo=setTimeout(this.gatherStats,this.POLL_TIME))},stopGatheringStats:function(){clearTimeout(this._gatheringTo)},getRemoteIpAddress:function(){if(this.pc){var e=this.pc.getRemoteDescription(),t=e&&e.sdp;return t&&t.match(/c=.+?(\S+)[\n|\r]/)[1]}},_onStatsSuccess:function(e){var t=Date.now();this._updateGatheringTimes(t),(e.result||e.forEach)&&(e=this._makeMapStats(this._fixChromeStats(e),t)),this.processStats(e)},_fixChromeStats:function(e){var t=!!e.result,i={_isLegacy:{id:"_isLegacy",type:"legacy",value:t}};return(e.result?e.result():e).forEach(function(e){var r=e;if(e.names){if(n.test(e.stat("googTrackId")))return;r={id:e.id,timestamp:e.timestamp,type:e.type},e.names().forEach(function(t){r[t]=e.stat(t)})}if(!t)switch(e.type){case"track":var s=e.id.split("_").slice(-3);e.dp_ssrc=s[2],e.dp_trackId=s[1],e.dp_kind=e.kind||s[0],e.dp_rtpStream="RTC"+(e.remoteSource?"Inbound":"Outbound")+"RTP"+("audio"===e.dp_kind?"Audio":"Video")+"Stream_"+e.dp_ssrc}i[r.id]=r}),i},_makeMapStats:function(e,t){var n=new Map(Object.keys(e).map(function(t){return[t,e[t]]}));return Object.keys(e).forEach(function(t){n[t]=e[t]}),n.set("timestamp",t),n.timestamp=t,n},_updateGatheringTimes:function(e){this._lastGatheredTime=e,this._startGatheringTime||(this._startGatheringTime=this._lastGatheredTime)},getLastGatheredTime:function(){return this._lastGatheredTime},_onStatsError:function(){},processStats:function(e){for(var t=this._getTracksFromStats(e),n=0;n<t.length;n++)this._processTrackStat(t[n],e)},_processTrackStat:function(e,t){var n=this._getTrackIdFromTrackStat(e);if(!n&&!this._ignoredStats[e.id])return console.warn("PEER CONNECTION STATS GATHERER: no track id found for "+e.id),void(this._ignoredStats[e.id]=1);if(this.tracks.hasOwnProperty(n)){var i=this.tracks[n];if(i.stats&&i.stats.timestamp&&i.stats.timestamp>e.timestamp)return}this._updateTrackActivity(n,e,t),this._updateCandidateActivity(n,e,t)},_isTrackStat:function(e){var t=e.id||e;return!!t.indexOf&&((!e.hasOwnProperty("googTrackId")||!n.test(e.googTrackId))&&(0===t.indexOf("ssrc_")||0===t.indexOf("RTCMediaStreamTrack")||"track"===e.type))},_getTracksFromStats:function(e){var t,n=[];for(var i in e)t=e[i],this._isTrackStat(t)&&n.push(t);return n},_updateTrackActivity:function(e,t,n){var i=this._getTrackActivity(e,t,n),r=this.tracks[e],s=this._getChangedAttrs(r,i);_.isEmpty(s)||(i.changes=s),r.changes=!1,_.extend(r,i)},_getChangedAttrs:function(e,t){var n={};for(var i in t)e[i]!==t[i]&&(n[i]={previous:e[i],current:t[i]});return n},_updateCandidateActivity:function(e,t,n){var i=this._getCandidatesForTrack(t,n);for(var r in i){var s=i[r];if(s&&!this.candidates[s.id]){this.candidates[s.id]=s;var o=s.candidate,a={priority:o.priority,ip:o.ipAddress||o.ip,port:o.portNumber||o.port,type:o.candidateType};console.info("PC STATS GATHERER: Using",r,"ice candidate:",a.priority,a.ip,a.port,"type",a.type)}}},_getTrackActivity:function(e,t,n){var i=this._isLocalTrack(t,n),r=t.dp_kind||this._getMediaTypeFromTrackStat(t,n),s=_.extend({id:e,isLegacy:n._isLegacy.value,ssrc:this._getSsrcFromTrackStat(t),packets:this._getPacketsFromTrackStat(t,n),bytes:this._getBytesFromTrackStat(t,n),timeMs:this._getTimeMsFromTrackStat(t,n),type:r,codec:this._getCodecFromTrackStat(t,n),stats:t,local:i,modified:this._lastGatheredTime},"audio"===r?this._getAudioTrackActivity(t,n):this._getVideoTrackActivity(t,n),i?this._getLocalTrackActivity(t,n):this._getRemoteTrackActivity(t,n));return this.tracks[e]||(this.tracks[e]=_.clone(s)),s.state=this._getTrackState(e,s,"packets"),"video"===r&&(s.videoState=this._getTrackState(e,s,"framesDecoded")),this._updateSlidingAverages(e,s),this._updatePerSecondStats(e,s),s},_getTrackState:function(e,t,n){var i=this.tracks[e];n=n||"packets";var r=this._getKeyForLastReceivedTime(n),s=i.state,o=s?i[n]:0,a=s?i[r]:0,c=this._lastGatheredTime-a,l=i.state;return t[n]>o&&"started"!==s?l="started":t[n]===o&&"started"===s&&c>1e3&&(l="stopped"),"started"===l&&t[n]!==o&&(i[r]=this._lastGatheredTime),l},_updateSlidingAverages:function(e,t){var n=this.tracks[e];for(var i in this.SLIDING_WINDOW)n.hasOwnProperty(i)&&this._updateSlidingAverage(i,n,t)},_updatePerSecondStats:function(e,t){for(var n=this.tracks[e],i=0;i<this.PER_SECOND.length;i++){var r=this.PER_SECOND[i];n.hasOwnProperty(r)&&this._updatePerSecondStat(r,n,t)}},_getNumSamplesForSlidingWindow:function(e){return Math.round(1e3*(this.SLIDING_WINDOW[e]||0)/this.POLL_TIME)},_getKeyForArray:function(e){return e+"Array"},_getKeyForAvg:function(e){return e+"Avg"},_getKeyForTrend:function(e){return e+"Trend"},_getKeyForLastReceivedTime:function(e){return e+"LastReceivedTime"},_getKeyForPerSecond:function(e){return e+"PerSecond"},_getKeyForPerSecondArray:function(e){return e+"PerSecondArray"},_getKeyForReceivedTimeArray:function(e){return e+"ReceivedTimeArray"},_updateSlidingAverage:function(e,n,i){var r=this._getNumSamplesForSlidingWindow(e),s=this._getKeyForAvg(e),o=this._getKeyForArray(e),a=this._getKeyForTrend(e),c="stopped"===i.state;n[o]||(n[o]=new t(r));var l=n[o];if(c?c&&n.hasOwnProperty(s)&&(delete n[s],delete n[a]):l.push(n[e]),!(l.length<r))switch(e){case"volume":i[s]=this._getAverageVolume(l);break;case"echo":i[s]=this._trackHasEcho(l);break;case"typing":i[s]=this._trackIsTyping(l);break;case"rtt":i[s]=this._getAverageRtt(l),i[a]=this._getTrend(l);break;case"jitterDelay":i[s]=this._getAverageJitterDelay(l),i[a]=this._getTrend(l);break;case"jitterBuffer":i[s]=this._getAverageJitterBuffer(l),i[a]=this._getTrend(l);break;case"packets":i[s]=this._getAverageDeltaPackets(l)}},_updatePerSecondStat:function(e,n,i){var r=this._getKeyForReceivedTimeArray(e),s=this._getKeyForPerSecondArray(e),o=this._getKeyForPerSecond(e),a=2e3/this.POLL_TIME;n[s]||(n[s]=new t(a)),n[r]||(n[r]=new t(a));var c=n[s],l=n[r],u=i[e],h=i.timeMs;c.at(c.length-1)!==u&&(c.push(u),l.push(h)),i[o]=this._getPerSecond(h,u,c,l)},_getPerSecond:function(e,t,n,i){if(i.length<2)return 0;for(var r=i.length-1;r>-1;r--)if(e-i.at(r)>=1e3){r;break}var s=i.at(r);return(t-n.at(r))/((e-s)/1e3)},_getAverage:function(e){for(var t=0,n=0;n<e.length;n++)t+=e.at(n);return t/e.length},_getTrend:function(e){for(var t,n=e.length,i=1,r=1,s=0,o=0,a=0;a<e.length;a++)i+=a,s+=t=e.at(a),r+=Math.pow(a+1,2),o+=(a+1)*t;return(n*o-i*s)/(n*r-Math.pow(i,2))},_getAverageVolume:function(e){return this._getAverage(e)},_trackHasEcho:function(e){for(var t=0;t<e.length;t++)if(e.at(t)<.5)return!1;return!0},_trackIsTyping:function(e){for(var t=0;t<e.length;t++)if(!e.at(t))return!1;return!0},_getAverageRtt:function(e){return this._getAverage(e)},_getAverageJitterDelay:function(e){return this._getAverage(e)},_getAverageJitterBuffer:function(e){return this._getAverage(e)},_getAverageDeltaPackets:function(e){for(var t=0,n=1;n<e.length;n++)t+=e.at(n)-e.at(n-1);return t/(e.length-1)},_getAudioTrackActivity:function(e,t){var n={volume:this._getVolumeFromTrackStat(e,t)};return this._isLocalTrack(e,t)?_.extend(n,{echo:this._getEchoFromTrackStat(e),typing:this._getTypingFromTrackStat(e)}):n},_getVideoTrackActivity:function(e,t){return{framesDecoded:this._getFramesDecodedFromTrackStat(e,t)}},_getLocalTrackActivity:function(e,t){return{rtt:this._getRttFromTrackStat(e,t)}},_getRemoteTrackActivity:function(e,t){return _.extend({},this._getJitterFromTrackStat(e,t))},_isLocalTrack:function(e,t){return e.dp_rtpStream&&(e=t[e.dp_rtpStream]),e.hasOwnProperty("packetsSent")},_getCandidatesForTrack:function(e,t){var n=this._getIceConnectionForTrack(e,t)||{};return{local:this._getCandidateFromStats(n.localCandidateId,t),remote:this._getCandidateFromStats(n.remoteCandidateId,t)}},_getCandidateFromStats:function(e,t){if(t[e])return{id:e,candidate:t[e],time:this._lastGatheredTime}},_getIceConnectionForTrack:function(e,t){return e.dp_rtpStream&&(e=t[e.dp_rtpStream]),t[(t[(e||{}).transportId]||{}).selectedCandidatePairId]},_getTrackIdFromTrackStat:function(e){return e.googTrackId||e.trackIdentifier},_getSsrcFromTrackStat:function(e){return e.ssrc||e.dp_ssrc},_getPacketsFromTrackStat:function(e,t){return e.dp_rtpStream&&(e=t[e.dp_rtpStream]),parseInt(e.packetsReceived||e.packetsSent)||0},_getBytesFromTrackStat:function(e,t){return e.dp_rtpStream&&(e=t[e.dp_rtpStream]),parseInt(e.bytesReceived||e.bytesSent)||0},_getTimeMsFromTrackStat:function(e,t){e.dp_rtpStream&&(e=t[e.dp_rtpStream]);var n=e.timestamp;return n&&n.getTime?n.getTime():this._lastGatheredTime},_getMediaTypeFromTrackStat:function(e,t){return e.dp_rtpStream&&(e=t[e.dp_rtpStream]),e.mediaType},_getVolumeFromTrackStat:function(e,t){return e.hasOwnProperty("audioLevel")?e.audioLevel:this._getVolumePercent(parseInt(e.audioInputLevel||e.audioOutputLevel))},_getVolumePercent:function(e){return e?Math.max(0,Math.min(e/1e4,1)):0},_getRttFromTrackStat:function(e,t){var n=this._getIceConnectionForTrack(e,t);return this._getRttFromCandidatePair(n)},_getRttFromCandidatePair:function(e){return e?e.hasOwnProperty("googRtt")?parseInt(e.googRtt)||null:1e3*e.currentRoundTripTime:null},_getCodecFromTrackStat:function(e,t){return e.dp_rtpStream&&(e=t[(e=t[e.dp_rtpStream]).codecId]),e?e.googCodecName||e.mimeType:"unknown"},_getJitterFromTrackStat:function(e,t){return{jitterDelay:this._getJitterDelayFromTrackStat(e,t),jitterBuffer:this._getJitterBufferFromTrackStat(e,t)}},_getJitterDelayFromTrackStat:function(e,t){return e.dp_rtpStream&&(e=t[e.dp_rtpStream]),e.hasOwnProperty("googCurrentDelayMs")?parseInt(e.googCurrentDelayMs):1e3*e.jitter},_getJitterBufferFromTrackStat:function(e,t){if(!e.hasOwnProperty("googJitterBufferMs"))return 0;var n=parseInt(e.googPreferredJitterBufferMs),i=parseInt(e.googJitterBufferMs);parseInt(e.googJitterReceived);return Math.abs(i-n)/n},_getFramesDecodedFromTrackStat:function(e,t){return e.dp_rtpStream&&(e=t[e.dp_rtpStream]),parseInt(e.framesDecoded)},_getCaptureStartFromTrackStat:function(e,t){return parseInt(e.googCaptureStartNtpTimeMs)},_getEchoFromTrackStat:function(e){return e.hasOwnProperty("googResidualEchoLikelihood")?parseInt(e.googResidualEchoLikelihood||0):0},_getTypingFromTrackStat:function(e){return!!e.hasOwnProperty("googTypingNoiseState")&&"false"!==e.googTypingNoiseState}})}),define("objects/common/stats_monitor",["config","fslib/fsutil","fslib/cbuffer","models/common/stream_stats","objects/common/peer_connection_stats_gatherer"],function(e,t,n,i,r){return r.extend({ALERTS:{CONNECTION:"connectionError",MIC:"inputMicError",REMOTE_MIC:"remoteMicError"},SCORE:{volume:[0,1/3,2/3],rtt:[0,200,300,400,500],jitterDelay:[0,150,300,450,600]},WATCH:["state","isMute","hasEcho","rttScore","volumeScore","jitterDelayScore","videoState","muted"],SERVER_STATS_INTERVAL:1e3,SERVER_STATS_DURATION:3e5,initialize:function(){r.prototype.initialize.apply(this,arguments),this.clearStatsForServer(),this._addStreamListeners()},_addStreamListeners:function(){this.listenTo(this,"stream:remote:changed",this._onRemoteStreamChanged),this.listenTo(this,"stream:local:changed",this._onLocalStreamChanged)},resetStats:function(){r.prototype.resetStats.apply(this,arguments),this.shownAlerts={},this._connectionScore=this._getMaxConnectionScore()},clearStatsForServer:function(){this._statsForServer=new n(this.SERVER_STATS_DURATION/this.SERVER_STATS_INTERVAL)},processStats:function(n){r.prototype.processStats.apply(this,arguments),this._updateConnectionScore(),this._triggerStreamsActivity(),(e.isNative||t.isChromeApp()||t.isChrome())&&this._collectStatsForServer(n)},getConnectionScore:function(){return this._connectionScore},getStatsForServer:function(){return Array.from(this._statsForServer)},sendStatsToServer:function(e){},getStream:function(e){var t=this.getTrackStats(e),n=t&&this._getStreamFromTrackStat(t);if(n&&n.stream){var r=new i({stream:n.stream,id:n.streamid});return r.addTrack(this._extendTrackStat(t,n.track)),r}},_extendTrackStat:function(e,t){return t?_.extend(e,{readyState:t.readyState,muted:t.muted,enabled:t.enabled}):e},_collectStatsForServer:function(e){this._statsForServer.length&&this._lastGatheredTime-this._lastServerGatheredTime<this.SERVER_STATS_INTERVAL||(this._lastServerGatheredTime=this._lastGatheredTime,this._statsForServer.push(this._filterStatsForServer(e,this._statsForServer.at(this._statsForServer.length-1))))},_filterStatsForServer:function(e,t){var n={},i=t||{};for(var r in e)0===r.indexOf("Conn-")?("true"===e[r].googActiveConnection||i[r])&&(n[r]=this._filterConnStatForServer(e[r])):0===r.indexOf("ssrc_")&&(n[r]=this._filterSsrcStatForServer(e[r]));return n},_filterConnStatForServer:function(e){return _.omit(e,["timestamp","type","id"])},_filterSsrcStatForServer:function(e){return _.omit(e,["timestamp","transportId","type","id"])},_getTrackActivity:function(e,t,n){var i=r.prototype._getTrackActivity.apply(this,arguments),s=this._getStreamFromTrackStat(i);return s&&(i=this._extendTrackStat(i,s.track)),this._updateMeanOpinionScores(e,i),i},_getKeyForScore:function(e){return e+"Score"},_getKeyForPrediction:function(e){return e+"ScorePrediction"},_updateMeanOpinionScores:function(e,t){var n=this.tracks[e];for(var i in this.SCORE)t.hasOwnProperty(i)&&this._updateMeanOpinionScore(i,n,t)},_getStartGatheringTime:function(e){return this._startGatheringTime},_haveEnoughSamples:function(e){var t=Math.ceil(1e3*this.SLIDING_WINDOW[e])+6e3;return this.getLastGatheredTime()-this._getStartGatheringTime(e)>t},_updateMeanOpinionScore:function(e,t,n){var i=this._getKeyForAvg(e),r=this._getKeyForScore(e),s=this._getKeyForPrediction(e);if("stopped"===n.state)return t.hasOwnProperty(r)&&delete t[r],void("volume"===e&&t.hasOwnProperty("isMute")&&delete t.isMute);var o=this._haveEnoughSamples(e);switch(e){case"volume":n[r]=this._getScore(n[e],this.SCORE[e]),o&&(n.isMute=0==n[i]);break;case"rtt":case"jitterDelay":o&&(n[r]=this._getScore(n[i],this.SCORE[e]),n[s]=this._getPredictionScore(n,e))}},_getPredictionScore:function(e,t){var n=this._getKeyForAvg(t),i=this._getKeyForTrend(t);if(isNaN(e[n]))return 0;var r=e[n]+e[i]*this._getNumSamplesForSlidingWindow(t);return this._getScore(r,this.SCORE[t])},_getScore:function(e,t){if(isNaN(e))return 0;for(var n=0;n<t.length;n++)if(e<t[n])return n;return t.length},_triggerStreamsActivity:function(){var e,t={};for(e in this.tracks){var n=this.tracks[e];if(this._shouldNotify(n)){var r=this._getStreamFromTrackStat(n);if(r)t[r.stream.id]||(t[r.stream.id]=new i({stream:r.stream,id:r.stream.id})),t[r.stream.id].addTrack(n)}}for(e in t){var s=t[e],o=s.isLocal()?"local":"remote";this.trigger("stream:"+o+":changed",s)}},_shouldNotify:function(e){for(var t=0;t<this.WATCH.length;t++)if(e.changes[this.WATCH[t]])return!0;return!1},_getStreamFromTrackStat:function(e){for(var t=e.id,n=e.local,i=this._getStreamsFromPc(n),r=0;r<i.length;r++){var s=this._streamHasTrack(i[r],t);if(s)return{stream:i[r],track:s}}},_getStreamsFromPc:function(e){var t=e?"getLocalStreams":"getRemoteStreams";return this.pc&&this.pc[t]?this.pc[t](!0):this.pc&&this.pc.connection&&this.pc.connection.pc?this.pc.connection.pc[t]():[]},_streamHasTrack:function(e,t){for(var n=e.getTracks(),i=0;i<n.length;i++)if(n[i].id===t)return n[i];return!1},_getMaxConnectionScore:function(){return this.SCORE.rtt.length},_getConnectionScoreFromTrack:function(e){for(var t=["rtt","jitterDelay"],n=this.tracks[e],i=0;i<t.length;i++){var r=this._getKeyForScore(t[i]);if(n.hasOwnProperty(r)&&("started"===n.state||!n.state))return n[r]}return"started"===n.state?this._getMaxConnectionScore():0},_updateConnectionScore:function(){var e=[];for(var t in this.tracks)e.push(this._getConnectionScoreFromTrack(t));this._connectionScore=e.length?Math.max.apply(Math,e):this._getMaxConnectionScore()},_onRemoteStreamChanged:function(e){e.isAudioMuted()&&this._maybeTriggerRemoteAudioMuted(),e.isJitterScoreAbove(4)&&this._maybeTriggerJitterError(e)},_onLocalStreamChanged:function(e){e.isAudioMuted()&&this._maybeTriggerLocalAudioMuted(e),e.isRttScoreAbove(4)&&this._maybeTriggerRttError(e)},_alreadyShownAlert:function(e){return!!this.shownAlerts[e]},_maybeTriggerLocalAudioMuted:function(e){this._alreadyShownAlert(this.ALERTS.MIC)||this.trigger("audio:local:muted",e)},_maybeTriggerRemoteAudioMuted:function(e){this._alreadyShownAlert(this.ALERTS.REMOTE_MIC)||this.trigger("audio:remote:muted",e)},_maybeTriggerJitterError:function(e){this._alreadyShownAlert(this.ALERTS.CONNECTION)||this.trigger("error:connection",e)},_maybeTriggerRttError:function(e){this._alreadyShownAlert(this.ALERTS.CONNECTION)||this.trigger("error:connection",e)},_showAlert:function(e,t){this.shownAlerts[e]=(performance||Date).now(),this._onShowAlert.apply(this,arguments)},_onShowAlert:function(){},showMicAlert:function(e){this._showAlert(this.ALERTS.MIC,e)},showRemoteMicAlert:function(e){this._showAlert(this.ALERTS.REMOTE_MIC,e)},showConnectionAlert:function(e){this._showAlert(this.ALERTS.CONNECTION,e)}})}),define("objects/common/webrtc_monitor",["fslib/webrtc","objects/common/stats_monitor"],function(e,t){return t.extend({ALERTS:_.extend(t.prototype.ALERTS,{UNREGISTERED:"webrtcUnregistered",CRITICAL:"webrtcRegistrationCritical",FATAL:"webrtcrRegistrationFatal"}),initialize:function(){t.prototype.initialize.apply(this,arguments),this._addWebrtcListeners(),this._addStatsListeners()},_getStartGatheringTime:function(e){return"volume"===e&&this.pc?"connected"!==this.pc.callState?this.getLastGatheredTime():(this.pc.callStateTime||console.error("WEBRTC MONITOR: Webrtc should have a callStateTime. If this was removed, fix that."),this.pc.callStateTime||this._startGatheringTime):this._startGatheringTime},_addStatsListeners:function(){this.listenTo(this,"audio:local:muted",this._onStatsLocalAudioMuted),this.listenTo(this,"audio:remote:muted",this._onStatsRemoteAudioMuted),this.listenTo(this,"error:connection",this._onStatsConnection)},_onStatsLocalAudioMuted:function(e){this.showMicAlert(e)},_onStatsRemoteAudioMuted:function(t){this.showRemoteMicAlert(t),e.fixRemoteAudioStream()},_onStatsConnection:function(e){this.showConnectionAlert(e)},_addWebrtcListeners:function(){this._setSessionListener(),this._setSocketListener(),this._setRegistrationListener()},_setSessionListener:function(){this.listenTo(e,"session",this._onWebrtcSession),this._onWebrtcSession(e.session)},_setSocketListener:function(){this.listenTo(e,"socket",this._onWebrtcSocket),this._onWebrtcSocket(null,e.socketState)},_setRegistrationListener:function(){this.listenTo(e,"registrationstate",this._onWebrtcRegistrationState),this._onWebrtcRegistrationState(e.registrationState)},_onWebrtcSession:function(t){t?this.setPeerConnection(e):this.unsetPeerConnection(e)},_onWebrtcSocket:function(e,t){var n=t&&t.data&&t.data.cause||"";e=e||t&&t.type,this._socketState=e,this._socketMessage=n},_onWebrtcRegistrationState:function(e){switch(this._registrationState=e&&e.state,this._registrationState){case"registered":this._onWebrtcRegistered();break;case"unregistered":this._onWebrtcUnregistered(e);break;case"registering":case"restarting":case"critical":break;case"fatal":this._onWebrtcFatal();break;default:return}},_onWebrtcRegistered:function(){},_onWebrtcUnregistered:function(e){e.reconnectAttempts<2||this.showUnregisteredAlert(e)},_onWebrtcFatal:function(){this.showFatalAlert(this.ALERTS.FATAL)},showUnregisteredAlert:function(e){this._showAlert(this.ALERTS.UNREGISTERED,e)},showCriticalAlert:function(){this._showAlert(this.ALERTS.CRITICAL)},showFatalAlert:function(){this._showAlert(this.ALERTS.FATAL)}})}),define("objects/webrtc_monitor",["config","single/views/unregistered_alertbar_view","objects/stats_monitor_wrapper","objects/common/webrtc_monitor","fslib/webrtc","fslib/singleton"],function(e,t,n,i,r,s){var o=i.extend({initialize:function(){i.prototype.initialize.apply(this,arguments),this._addAlertListeners(),this.listenTo(this,"audio:local:muted",this._onStatsLocalAudioMuted),this.listenTo(this,"audio:remote:muted",this._onStatsRemoteAudioMuted),this.listenTo(this,"error:connection",this.showConnectionAlert)},resetStats:function(){i.prototype.resetStats.apply(this,arguments),this._resetAlerts()},showUnregisteredAlert:function(e){this.isShowingAlert(this.ALERTS.UNREGISTERED)||(console.warn("WEBRTC MONITOR: Showing unregistered alert."),this._showUnregisteredAlert())},showFatalAlert:function(){this.isShowingAlert(this.ALERTS.FATAL)||(console.warn("WEBRTC MONITOR: Showing fatal alert."),this._showWebrtcFatalAlert())},_onStatsLocalAudioMuted:function(e){this.showMicAlert(e)},_onStatsRemoteAudioMuted:function(e){this.showRemoteMicAlert(e),r.fixRemoteAudioStream()},_onWebRtcFatal:function(){this.showFatalAlert()},_onIceFailed:function(){console.error("WEBRTC MONITOR: ICE CONNECTION FAILED!! RTP TIMEOUT."),Backbone.trigger("call:icefailed")},_onWebrtcRegistered:function(){this.hideAlerts()},_showWebrtcFatalAlert:function(){Backbone.trigger("alert",{title:this.translate("Registration Error"),criticalWebrtcError:!0,refresh:!0,sendReport:!0,alertId:this.ALERTS.FATAL})},_showUnregisteredAlert:function(){Backbone.trigger("alertbar","alert",{id:this.ALERTS.UNREGISTERED,type:"error",stayOnTop:!0,view:new t})}});return _.extend(o.prototype,n),s.create(o,"webrtcMonitor")}),define("collections/common/collection",["backbone","objects/common/local_state_wrapper"],function(e,t){return e.Collection.extend(t).extend({fetching:{},MAX_FETCH_RETRIES:5,garbageCollectionTime:0,garbageCollectionMaxItems:0,initialize:function(){_.bindAll(this),this._addCommonLocalStateListeners()},hasLoaded:function(){return this.getLocalState("loaded")||!!this.length},isCollection:function(){return!0},isModel:function(){return!1},_isFetching:function(e){return!!this.fetching[e]},_setFetching:function(e,t){this.fetching[e]=t},_stopFetching:function(e){delete this.fetching[e]},getOrFetch:function(e,t){var n="object"===(void 0===e?"undefined":_typeof(e))?e:{id:e};return this.get(n.id)||this._fetchById(n,t)},_fetchById:function(e,t,n){if(n="number"==typeof n?n:this.MAX_FETCH_RETRIES,!this._isFetching(e.id)){var i=new this.model(e,t),r=i.id||i.get("id");console.log("CURSOR COLLECTION: Fetching model (",r,") try number",this.MAX_FETCH_RETRIES+1-n),this._setFetching(r,!0),i.fetch({success:this._onAddByIdSuccess,error:this._onAddByIdError.bind(this,t,n),merge:!0})}},_onAddByIdSuccess:function(e){this._stopFetching(e.id),this._stopFetching(e.get("id")),e.set("fromServer",!0),this.add(e,{merge:!0})},_onAddByIdError:function(e,t,n){console.log("CURSOR COLLECTION: Error fetching model (",n.id,") attempts remaining",t),t?(this._setFetching(n.id,!1),this._fetchById(n.attributes,e,t-1)):(console.warn("CURSOR COLLECTION: Tried fetching model (",n.id,")",this.MAX_FETCH_RETRIES+1,"times. Giving up."),this._stopFetching(n.id))},biIndexOf:function(t){if(!this.get(t))return-1;var n=this._getComparator();if(!n)return e.Collection.prototype.indexOf.apply(this,arguments);for(var i,r,s=0,o=this.length;s<o;)if(i=Math.floor((s+o)/2),(r=n(t,this.at(i)))<0)o=i;else{if(!(r>0))return this._findItemByWalkout(t,i,n);s=i+1}return-1},_getComparator:function(){if(this.comparator){if("string"==typeof this.comparator){var e=this.comparator;return function(t,n){if(!t||!n)return 0;var i=t.get?t.get(e):t[e],r=n.get?n.get(e):n[e];return i>r?1:i<r?-1:0}}return this.comparator}},_findItemByWalkout:function(e,t,n){var i,r;for(r=t;r>=0;r--){if((i=this.at(r))===e||i.id===e.id)return r;if(n(e,i)>0)break}var s=this.length;for(r=t+1;r<s;r++){if((i=this.at(r))===e||i.id===e.id)return r;if(n(e,i)<0)break}return-1},startGarbageCollection:function(){this.garbageCollectionTime&&this.__scheduleGarbageCollection(),this.garbageCollectionMaxItems&&this.__addMaxItemGarbageCollectionListeners()},__scheduleGarbageCollection:function(){clearTimeout(this._gcTo),this._gcTo=setTimeout(this.__onScheduledGarbageCollection,this.garbageCollectionTime)},__addMaxItemGarbageCollectionListeners:function(){this.listenTo(this,"add",this.__updateGarbageCollectionOnAdd)},updateLastAccessed:function(e){(this.garbageCollectionTime||this.garbageCollectionMaxItems)&&(this.__updateLastAccessedDict||(this.__updateLastAccessedDict={}),this.__updateLastAccessedDict[e.id]=1,this.__updateAccessedTo||(this.__updateAccessedTo=setTimeout(this.__updateAllLastAccessed,0)))},__updateAllLastAccessed:function(){var e,t=performance.now();Object.keys(this.__updateLastAccessedDict).forEach(function(n){(e=this.get(n))&&(e.__lastAccessed=t)}.bind(this)),this.__updateLastAccessedDict={},this.__updateAccessedTo=null},__updateGarbageCollectionOnAdd:function(e){this.updateLastAccessed(e),this.garbageCollectionMaxItems&&this.length>this.garbageCollectionMaxItems&&!this.__gcMiTo&&(this.__gcMiTo=setTimeout(this.__onMaxItemGarbageCollection,0))},__onScheduledGarbageCollection:function(){this.__maybeCollectGarbage(),this.__scheduleGarbageCollection()},__onMaxItemGarbageCollection:function(){clearTimeout(this.__gcMiTo),this.__maybeCollectGarbage(6e4),this.__gcMiTo=null},__canCollectGarbage:function(e){return!this.__lastGarbageCollection||e-this.__lastGarbageCollection>6e4},__maybeCollectGarbage:function(e){var t=performance.now(),n=this.__canCollectGarbage(t);if(this.length&&n){var i=this.length,r=e||this.garbageCollectionTime,s=this.reduce(function(e,n){return(!n.__lastAccessed||this.__updateLastAccessedDict[n.id]||t-n.__lastAccessed<=r)&&e.push(n),e}.bind(this),[]);s.length!==i&&(this.reset(s),console.log("COLLECTION (GARBAGE COLLECTION): collected garbage and removed",i-this.length,"items."),this.__lastGarbageCollection=t)}else console.log("COLLECTION (GARBAGE COLLECTION): aborting collection garbage bc len:",this.length,"canCollectionGarbage:",n)}})}),define("collections/common/cursor_collection",["collections/common/collection"],function(e){return e.extend({initialize:function(){e.prototype.initialize.apply(this,arguments),!this.wrapper&&this._addCursorCollectionListeners()},_addCursorCollectionListeners:function(){this.listenToOnce(this,"sync",this._setLoaded),this.listenTo(this,"error",this._onError),this.listenTo(this,"change",this._onChange),this.listenTo(this,"destroy",this._onDestroy)},_setLoaded:function(){this.loaded=!0},onLoaded:function(e){e?this.loaded?e():this.listenToOnce(this,"sync",e):console.error("No callback provided to onLoaded")},_onDestroy:function(e,t){this.session&&this.session.refreshLocalStorage()},_onChange:function(e,t){if(t=t||{},this.currentCacheKey&&!t.cached&&e&&!_.isArray(e)){var n=e.attributes||e;this._fetchOptions.next=!0,this._setItems([n])}},add:function(t,n){if(n=n||{},this.currentCacheKey&&!n.cached&&t&&!_.isArray(t)){var i=t.attributes||t;this._fetchOptions.next=!0,this._setItems([i])}return e.prototype.add.call(this,t,n)},parse:function(t,n){n.xhr&&(this.cursor=n.xhr.getResponseHeader("cursor"));var i=e.prototype.parse.call(this,t,n);return i=this._sortCollectionOfDicts(i),Backbone.trigger("collection:sync",this),i},_sortCollectionOfDicts:function(e){return _.isFunction(this.comparator)?e=_.sortBy(e,_.bind(function(e){var t=new this.model(e);return this.comparator(t)},this)):this.comparator?e=_.sortBy(e,this.comparator):_.isFunction(this.complexComparator)&&e.sort(_.bind(function(e,t){return this.complexComparator(new this.model(e),new this.model(t))},this)),e},fetch:function(t){return(t=t||{}).data=t.data||{},t.next||(this.cursor=null,this.currentCacheKey=null,Backbone.trigger("collection:fetch",this)),this._fetchOptions=t,this.abort(),this.xhr=e.prototype.fetch.call(this,_.clone(this._fetchOptions)),this.cacheKey&&this.cache(),this.xhr},abort:function(){if(this.xhr)return this.xhr.abort(),!0},next:function(){return this.cursor?(this._fetchOptions.reset=!1,this._fetchOptions.remove=!1,this._fetchOptions.next=!0,_.extend(this._fetchOptions.data,{cursor:this.cursor}),this.fetch(this._fetchOptions),Backbone.trigger("collection:next",this),!0):(this.trigger("cursor:end",this),!1)},setFetchOptions:function(e){var t=_.clone(e);t.data&&t.data.hasOwnProperty("cursor")&&(this.cursor=t.data.cursor,delete t.data.cursor),this._fetchOptions=t},getFetchOptions:function(){if(this._fetchOptions){var e=_.clone(this._fetchOptions);return _.extend(e.data,{cursor:this.cursor}),e}},getCacheKey:function(e){var t=e.filter||"search",n=e.search||"",i=e.target_key||"";return this.cacheKey+":"+t+":"+n+":"+i},cache:function(){if(this.cacheKey&&this._fetchOptions&&!window.jasmine){var e=this._fetchOptions.data;this.currentCacheKey=this.getCacheKey(e),this.currentCacheKey&&(this._fetchOptions.next||this.session.getLocal(this.currentCacheKey,this._onCached),this.xhr.done(this._setItems))}},_onCached:function(e){if(e&&e.length){this._fetchOptions.reset&&this.reset();var t=this,n=this.session,i=e.length,r=[];_.each(e,function(e){n.getLocal(e,function(e){e&&r.push(e),0==--i&&t._onCachedItems(r)})})}},_onCachedComplete:function(){this.trigger("cache",this),Backbone.trigger("collection:cache",this)},_onCachedItems:function(e){e=this._sortCollectionOfDicts(e),this.set(e,{sort:!0,cached:!0}),this._onCachedComplete()},_setItems:function(e){var t=_.map(e,this._setItem),n=this.session,i=this.currentCacheKey;this._fetchOptions.next?this.session.getLocal(i,function(e){var r=_.uniq((e||[]).concat(t));n.setLocal(i,r)}):this.session.setLocal(i,t)},_setItem:function(e){var t=this.idAttribute?e[this.idAttribute]:e.key;return this.session.setLocal(t,e),t},_onError:function(){Backbone.trigger("collection:error",this)}})}),define("collections/contact_list",["collections/common/cursor_collection","config","fslib/fsutil","fslib/singleton","models/contact","models/current_user","models/session"],function(e,t,n,i,r,s,o){var a=e.extend({model:r,url:t.REQUEST_URL+"contact/",cacheKey:t.useCache&&"contacts",session:o,add:function(t,n){return t==s&&(console.error("ADDING A USER TO THE CONTACTS COLLECTION"),t=t.attributes),(n=n||{}).merge=!0,e.prototype.add.call(this,t,n)}});return i.create(a,"contactList")}),define("models/affinity",["models/base","models/current_user","models/session","models/contact","collections/contact_list","config"],function(e,t,n,i,r,s){return e.extend({idAttribute:"path",LOCAL_STATE:{interactionTime:null,isActive:!1,callRinging:!1,callCalling:!1,callViewable:!1,callId:null,videoCallId:null,processingIsFavorite:!1,processingSelectedPhone:!1,processingSelectedCallerId:!1,selectedPhone:null,selectedCallerId:null,contact_keys:null},url:function(){var e=this.get("key")||"",t=s.REQUEST_URL+"contact/"+e+"?is_affinity=1";return this.params&&this.params.target_key&&(t=t+"&target_key="+this.get("target_key")),this.params&&this.params.archive&&(t+="&archive_only=1"),t},initialize:function(){this.params={},e.prototype.initialize.call(this),this.listenTo(this,"change:favorite",this._adjustFavoriteSource),this.listenTo(this,"localStateChange",this._onLocalStateChange)},_onLocalStateChange:function(){this.trigger("change",this)},destroy:function(t){this.removeContactListeners(),this.contact=null,this.conversation=null,this.wrapper&&(this.wrapper.unwrap(),this.wrapper=null),this.params.target_key=!0,e.prototype.destroy.call(this,t),this.params.target_key=!1},archive:function(e){this.params.archive=!0,this.destroy(e),this.params.archive=!1},parse:function(n,i){if(t){this.addContact(n);var r=n.target_key||t.get("key");return n.path=n.key+"/"+r,e.prototype.parse.call(this,n,i)}console.log("NO CURRENT USER YET IN AFFINITY PARSE")},addContact:function(e){var t=new i(e);r.add(t,{merge:!0}),(t=r.get(e.key))&&this.addContactListeners(t)},addContactListeners:function(e){this.removeContactListeners(),this.contact=e,this.listenTo(this.contact,"add",this._updateContact),this.listenTo(this.contact,"change",this._updateContact),this.listenTo(this.contact,"localStateChange",this._onLocalStateChange)},removeContactListeners:function(){this.contact&&(this.stopListening(this.contact,"add",this._updateContact),this.stopListening(this.contact,"change",this._updateContact),this.stopListening(this.contact,"localStateChange",this._onLocalStateChange))},_updateContact:function(e){this.set(e.toJSON())},updateFilter:function(e){this.filter=e},getShortKey:function(){return this.getContact().getShortKey()},isAffinity:function(){return!0},isContact:function(){return!1},getTargetKey:function(){return this.get("target_key")||""},getContact:function(){return this.contact||this.addContact(this.toJSON()),this.contact},getDisplayPhone:function(){var e;return(e=this.getContact()).getDisplayPhone.apply(e,arguments)},getCallableNumber:function(){return this.getContact().getCallableNumber()},getPhonesDetails:function(){return this.getContact().getPhonesDetails()},hasPhoneNumber:function(){return this.getContact().hasPhoneNumber()},hasFaxNumber:function(){return this.getContact().hasFaxNumber()},primaryEmail:function(){return this.getContact().primaryEmail()},primaryPhone:function(){return this.getContact().primaryPhone()},getSelectedPhone:function(){return this.getLocalState("processingSelectedPhone")?this.getLocalState("selectedPhone"):this.get("primary_phone")},getSelectedPhoneDetails:function(){var e=this;if(!this.getSelectedPhone())return null;var t=this.getPhonesDetails().find(function(t){return t.number===e.getSelectedPhone()});return t.extension=this.getContact().getExtension(),t},getContactKeys:function(){return this.get("contact_keys")||this.getLocalState("contact_keys")},primaryFax:function(){return this.getContact().primaryFax()},isUser:function(){return this.getContact().isUser()},isInternal:function(){return(this.isUser()||!!this.getUserId())&&this.get("company_id")===t.get("company_id")},isOffice:function(){return this.getContact().isOffice()},isDepartment:function(){return this.getContact().isDepartment()},isCallCenter:function(){return this.getContact().isCallCenter()},isFavorite:function(){return this.getLocalState("processingIsFavorite")?!this.get("favorite"):this.get("favorite")},isGroup:function(){return this.getContact().isGroup()},isChannel:function(){return this.getContact().isChannel()},isContactGroup:function(){return this.getContact().isContactGroup()},isLocal:function(){return this.getContact().isLocal()},isGoogle:function(){return this.getContact().isGoogle()},isMicrosoft:function(){return this.getContact().isMicrosoft()},isDirectory:function(){return this.getContact().isDirectory()},isMobile:function(){return this.getContact().isMobile()},isStaff:function(){return this.getContact().isStaff()},isRoom:function(){return this.getContact().isRoom()},isShortcode:function(){return this.getContact().isShortcode()},isEmergency:function(){return this.getContact().isEmergency()},belongsToCurrentUser:function(){return this.get("target_key")===t.id},hasGeneralInfo:function(){return this.getContact().hasGeneralInfo()},hasNonUSPrimaryPhone:function(){return this.getContact().hasNonUSPrimaryPhone()},isInternationalPhone:function(){var e=this.getContact()._getPhoneCountry();return!!e&&!_.contains(t.getDomesticCountryCodes(),e)},canMms:function(){return this.isContactGroup()||this.isDialpad()||!this.isInternationalPhone()},isTarget:function(){return this.getContact().isTarget()},isIndividual:function(){return this.getContact().isIndividual()},isBlocked:function(){return this.getContact().isBlocked()},isSpam:function(){return this.get("tags")&&this.get("tags").indexOf("spam")>-1},isMuted:function(){return this.getContact().isMuted()},isAnonymous:function(){return this.getContact().isAnonymous()},isShared:function(){return this.get("is_shared")},getSelectedCallerId:function(){return this.getLocalState("processingSelectedCallerId")?this.getLocalState("selectedCallerId"):this.get("selected_caller_id")},isStraightToVoicemail:function(){return this.getContact().isStraightToVoicemail()},getSvgName:function(){return this.getContact().getSvgName()},getGroupDetails:function(e){return this.getContact().getGroupDetails(e)},getContactGroupKeys:function(){return this.getContact().getContactGroupKeys()},getEmails:function(e){return this.getContact().getEmails(e)},getShortName:function(){return this.getContact().getShortName()},isDoNotDisturb:function(e){return this.getContact().isDoNotDisturb(e)},shouldShowIndicator:function(){return this.isUser()||this.getUserId()||this.get("deprecated")},isDialpad:function(){return this.getContact().isDialpad()},getUserId:function(){return this.getContact().getUserId()},setInteractionTime:function(e){this.adjustLocalState("interactionTime",e||n.getServerTime())},toggleFavorite:function(){if(this.belongsToCurrentUser()){if(!this.getLocalState("processingIsFavorite")){var e=!this.get("favorite");this.saveAndAdjustLocalState({favorite:e},"processingIsFavorite"),this._adjustFavoriteSource()}}else console.warn("Cannot favorite contact with different owner")},_adjustFavoriteSource:function(){this.isFavorite()?this.addLocalSource("favorite",{silent:!0}):this.removeLocalSource("favorite",{silent:!0})},saveSelectedDid:function(e,t,n){var i={primary_phone:e,selected_phone:e,display_primary_phone:t,target_key:this.get("target_key"),edit:!0,save_to_remote:!0};this.saveAndAdjustLocalState(i,"processingSelectedPhone",n),this.adjustLocalState("selectedPhone",e)},saveSelectedCallerId:function(e,t){var n={selected_caller_id:e};this.saveAndAdjustLocalState(n,"processingSelectedCallerId",t),this.adjustLocalState("selectedCallerId",e)},getDateDescription:function(){var e=this.getLocalState("interactionTime")||0,t=this.get("date_description")||0;return e>t?e:t},isGroupAffinity:function(){var e=this.get("target_key");return e&&e!==t.id},setActive:function(e){this.adjustLocalState("isActive",!!e)},isActive:function(){return this.getLocalState("isActive")},hasRingingCall:function(){return this.getLocalState("callRinging")},processingPhoneChange:function(){return this.getLocalState("processingSelectedPhone")},hasCallingCall:function(){return this.getLocalState("callCalling")},hasViewableCall:function(){return this.getLocalState("callViewable")},lastCallId:function(){return this.getLocalState("callId")},lastVideoCallId:function(){return this.getLocalState("videoCallId")}})}),define("collections/affinity_list",["collections/common/cursor_collection","config","fslib/fsutil","fslib/singleton","models/affinity","models/contact","models/current_user","models/session","collections/contact_list"],function(e,t,n,i,r,s,o,a,c){var l=e.extend({model:r,url:t.REQUEST_URL+"contact/",cacheKey:t.useCache&&"affinities",session:a,idAttribute:"path",initialize:function(){e.prototype.initialize.call(this),this.cloning={}},getCacheKey:function(t){var n=e.prototype.getCacheKey.apply(this,arguments),i=!!t.phones_only,r=!!t.individuals_only;return(i||r)&&(n=n+":options"+i+r),n},addContacts:function(e,t){if((t=t||{}).merge=!0,_.isArray(e))_.each(e,_.bind(function(e){var n=e.attributes||e;this.addContact(e,n.target_key,t)},this));else if(_.isObject(e)){var n=e.attributes||e;this.addContact(e,n.target_key,t)}},addContact:function(t,n,i){var s=n;if("undefined"==s&&(console.error("Passing in target as 'undefined' string...assuming user."),s=null),_.isObject(n)&&(s=n.id),t)if(o.get("key")){if(t!=o){(i=i||{}).merge=!0,s=s||o.get("key");var a=t.attributes||t;a.target_key=s,a.path=a.key+"/"+s;var c=new r(a);e.prototype.add.call(this,c,i);var l=this.get(a.path);return l.addContact(a),l}console.error("check yourself before you wreck yourself")}else console.error("no current user yet");else console.error("no contact to add")},getContact:function(e,t){var n=e+"/"+t,i=this.get(n);return i?i.getContact():i},getContactAffinity:function(e,t){return this.get(this.getPath(e,t))},getPath:function(e,t){return e+"/"+t},_onDestroy:function(e,t){if(!(t=t||{}).cached&&e&&!_.isArray(e)){var n=e.attributes||e,i=(this.session,this.idAttribute?n[this.idAttribute]:n.key,{target_key:n.target_key});_.each(["frequent","unread","recent"],function(e){i.filter=e;var t=this.getCacheKey(i);this.session.setLocal(t,null)},this)}e&&!_.isArray(e)&&Backbone.trigger("affinity:destroyed",e.get("key"),e.get("target_key"))},clone:function(e,t,n,i,s){var o=e?e.toJSON():t;if(this._isCloning(t,n))return!1;this._onClone(t,n);(new r).save({create_from:o,target_key:n},{success:_.bind(function(e,r,s){this._onClone(t,n,!0),i&&i(e,r,s)},this),error:_.bind(function(e,i,r){this._onClone(t,n,!0),s&&s(e,i,r)},this)})},_onClone:function(e,t,n){var i=this.getPath(e,t);n?delete this.cloning[i]:this.cloning[i]=new Date},_isCloning:function(e,t){var n=this.getPath(e,t);return!!this.cloning[n]&&(!(new Date-this.cloning[n]>1e4)||(this._onClone(e,t,!0),!1))},cloningWithNewTarget:function(e,t,n,i){if(e&&(e.isTarget()||"shared"===e.get("type")))return!1;var r=e?e.get("target_key")||o.get("key"):null;if((!r||r!=n)&&!this.getContactAffinity(t,n))return this.clone(e,t,n,i),!0;return!1}});return i.create(l,"affinityList")}),define("models/participant",["models/current_user","models/base"],function(e,t){return t.extend({urlRoot:null,STATES:{SUPERVISOR_LISTENING:"monitor",SUPERVISOR_BARGING:"barge",SUPERVISOR_TAKING_OVER:"takeover",CONNECTED:"connected",HANGUP:"hangup"},TYPES:{AGENT:"operator",CONTACT:"contact",SUPERVISOR:"supervisor"},idAttribute:"contact_key",parse:function(e){return e.call_id=parseInt(e.call_id),e},isAgent:function(){return this.get("participant_type")===this.TYPES.AGENT},isContact:function(){return this.get("participant_type")===this.TYPES.CONTACT},isSupervisor:function(){return this.get("participant_type")===this.TYPES.SUPERVISOR},isConnected:function(){return this.get("state")===this.STATES.CONNECTED},isTakingOver:function(){return this.get("state")===this.STATES.SUPERVISOR_TAKING_OVER},isBarging:function(){return this.get("state")===this.STATES.SUPERVISOR_BARGING},isListening:function(){return this.get("state")===this.STATES.SUPERVISOR_LISTENING},isSupervising:function(){return this.isBarging()||this.isListening()},getName:function(){return this.get("display_name")},getCallId:function(){return this.get("call_id")},getCallLeg:function(){return this.get("call_leg_id")},shouldDisplay:function(t){var n=this._getAttributes(t)||this.attributes||{state:this.STATES.HANGUP},i=this._getContactKey(n),r=n.state;return i!==e.id&&r!==this.STATES.HANGUP},_getAttributes:function(e){return e&&(e.attributes||e)},_getContactKey:function(e){if("string"==typeof e||!e)return e;var t=this._getAttributes(e);return t.contact_key||t.key}},{_randomNum:function(e){return Math.floor(Math.random()*(e||10))},_getSortOrder:function(e){var t=e.participant_type,n=3;return t===this.prototype.TYPES.AGENT?n=0:t===this.prototype.TYPES.CONTACT?n=1:t===this.prototype.TYPES.SUPERVISOR&&e.state===this.prototype.STATES.SUPERVISOR_BARGING&&(n=2),n},_createParticipant:function(e,t,n,i){var r={participant_type:e||this.prototype.TYPES.SUPERVISOR,display_name:t||this._mockParticipantName(),image_url:n||"",contact_key:i,state:this._mockParticipantState(e)};return r.sortOrder=this._getSortOrder(r),r},_mockParticipantState:function(e){return(e||this.prototype.TYPES.SUPERVISOR)!==this.prototype.TYPES.SUPERVISOR?this.prototype.STATES.CONNECTED:Math.random()<.5?this.prototype.STATES.SUPERVISOR_BARGING:this.prototype.STATES.SUPERVISOR_LISTENING},_mockParticipantName:function(){return["Jean Luc","Deanna","Geordi","Tasha","Wesley","Beverly","Locutus","William T","Kathryn","420 Party"][this._randomNum()]+" "+["Picard","Troy","La Forge","Yar","Crusher","Worf","Of Borg","Riker","Janeway","Boi 666"][this._randomNum()]},getAttributes:function(e){return this.prototype._getAttributes.call(this.prototype,e)},getContactKey:function(e){return this.prototype._getContactKey.call(this.prototype,e)},createParticipantJson:function(e,t){var n=this.getAttributes(e);return"operator_target"===t&&(t=this.prototype.TYPES.AGENT),n&&this._createParticipant(t,n.display_name,n.image_url,this.getContactKey(e))},shouldDisplay:function(e){return this.prototype.shouldDisplay.call(this.prototype,e)},isTakingOver:function(e){return this.getAttributes(e).state===this.prototype.STATES.SUPERVISOR_TAKING_OVER},isBarging:function(e){return this.getAttributes(e).state===this.prototype.STATES.SUPERVISOR_BARGING},isListening:function(e){return this.getAttributes(e).state===this.prototype.STATES.SUPERVISOR_LISTENING},isSupervising:function(e){return this.isListening(e)||this.isBarging(e)},getStates:function(){return this.prototype.STATES}})}),define("collections/participants_list",["models/current_user","models/participant","collections/common/collection"],function(e,t,n){return n.extend({model:t,comparator:"sortOrder",getAgent:function(){return this.find(function(e){return e.isAgent()})},hasConnectedAgent:function(){var e=this.getAgent();return e&&e.isConnected()},getContact:function(){return this.find(function(e){return e.isContact()})},isListening:function(e){return this.find(function(t){return t.get("contact_key")===e&&t.isListening()})},isBarging:function(e){return this.find(function(t){return t.get("contact_key")===e&&t.isBarging()})},isTakingOver:function(e){return this.find(function(t){return t.get("contact_key")===e&&t.isTakingOver()})},isSupervising:function(e){return this.find(function(t){return t.get("contact_key")===e&&t.isSupervising()})},hasConnectedContact:function(){var e=this.getContact();return e&&e.isConnected()},isFirstOfType:function(e){if(e){var n=t.getAttributes(e).sortOrder;return this.findWhere({sortOrder:n})===e}},isLastOfType:function(e){if(e){var n=t.getAttributes(e).sortOrder;return _.last(this.where({sortOrder:n}))===e}},setParticipantsFromCall:function(e){var n=[],i=this._getParticipantsFromCall(e),r={};return _.each(i,_.bind(function(e){var i=e.contact_key;t.shouldDisplay(e)&&!r[i]&&(n.push(e),r[i]=1)},this)),this.set(n,{merge:!0}),this.hasOwnProperty("_numParticipants")&&this._numParticipants!==n.length&&this.trigger("length:change"),this._numParticipants=n.length,this._createParticipantsDict(i)},_createParticipantsDict:function(e){for(var t={},n=0;n<e.length;n++){var i=e[n];i.call_leg_id&&!t[i.call_leg_id]&&(t[i.call_leg_id]=i)}return t},mockParticipantsFromCall:function(e,t){this._mocked=t||3,this.setParticipantsFromCall(e)},_cloneParticipantsFromCall:function(e){for(var t=JSON.parse(JSON.stringify(e.get("participants")||[])),n=0;n<t.length;n++){var i=t[n];if("contact"===i.participant_type&&!i.call_id){var r=e.getEntryPointCallId&&e.getEntryPointCallId();r=r||(e.get?e.get("id"):e.id),i.call_id=r}}return t},_getParticipantsFromCall:function(e){var t=this._getDefaultParticipants(e);return this._mocked?this._mockParticipants(t):this._cloneParticipantsFromCall(e).concat(t)},_getDefaultParticipants:function(n){var i=[];if(!n.get("participants")){for(var r,s=["contact","operator_target"],o=0;o<s.length;o++){if((r=t.createParticipantJson(n.get(s[o]),s[o]))&&"operator_target"===s[o]){r.call_id=n.get("operator_call_id");var a=n.get("internal_leg_ids")||[];a[0]&&(r.call_leg_id=a[0])}else if(r&&"contact"===s[o]&&!r.call_id){var c=n.getEntryPointCallId&&n.getEntryPointCallId();c||(r.call_leg_id=n.get?n.get("external_leg_id"):n.external_leg_id),c=c||(n.get?n.get("id"):n.id),r.call_id=c}r&&i.push(r)}n.get("target_key")===e.id&&n.getEntryPointCallId&&!n.getEntryPointCallId()&&((r=t.createParticipantJson(e.toJSON(),"operator_target")).call_leg_id=(n.get("internal_leg_ids")||[])[0],i.push(r))}return i},_mockParticipants:function(e){for(var n=e||[],i={},r=!1,s=0;s<n.length;s++)i[n[s].contact_key]=1,"operator"===n[s].participant_type&&(r=!0);for(var o=globals.vars.contactList,a=0,c=o.length-1;a<=c&&n.length<this._mocked;){var l=o.at(a);if(t.shouldDisplay(l)&&!i[l.id]){var u=null;r||(u="operator",r=!0),n.push(t.createParticipantJson(l.attributes,u)),i[l.id]=1}a++}return n},hasParticipant:function(e){if(!e)return!1;var t=e.id||e.contact_key||e.get&&e.get("contact_key")||e;return this.findWhere({contact_key:t})},getNames:function(){var e="";return this.each(function(t){t.shouldDisplay()&&(e&&(e+=", "),e+=t.getName())}),e},getCallIds:function(){return this.reduce(function(e,t){return t.getCallId()&&e.push(t.getCallId()),e},[])}},{createParticipantJson:function(){return t.createParticipantJson.apply(t,arguments)},getContactKey:function(e){return t.getContactKey(e)},isTakingOver:function(e){return t.isTakingOver(e)},isBarging:function(e){return t.isBarging(e)},isListening:function(e){return t.isListening(e)},isSupervising:function(e){return t.isSupervising(e)},getStates:function(){return t.getStates()},getParticipants:function(e){return this.prototype._getParticipantsFromCall(e)},getParticipantsDict:function(e){return this.prototype._createParticipantsDict(this.getParticipants(e))}})}),define("fslib/collection_wrapper",["backbone","fslib/object"],function(e,t){var n=t.extend({wrap:function(e,t,n,i){this.unwrap();var r=e.prototype||window.Object.getPrototypeOf(e);return r.wrapper=this,this.filteredCollection=new e.constructor,delete r.wrapper,this.filteredCollection.wrapper=this,this.wrappedCollection=e,this.filterFunction=t||function(e,t){if("add:filtered"==t)return!0},this.listenToLocal=!!n,this.listenTo(this.wrappedCollection,"add",this._onWrappedAdd),this.listenTo(this.wrappedCollection,"change",this._onWrappedChange),this.listenTo(this.wrappedCollection,"reset",this._onWrappedReset),this.listenTo(this.wrappedCollection,"remove",this._onWrappedRemove),this.listenToLocal&&(this.listenTo(this.wrappedCollection,"localStateChange",this._onWrappedLocalStateChange),this.listenTo(this.filteredCollection,"localStateChange",this._onFilteredLocalStateChange)),this.listenTo(this.filteredCollection,"add",this._onFilteredAdd),this.listenTo(this.filteredCollection,"change",this._onFilteredChange),this.listenTo(this.filteredCollection,"reset",this._onFilteredReset),this.listenTo(this.filteredCollection,"remove",this._onFilteredRemove),i&&i(this.filteredCollection),this.wrappedCollection.trigger("wrapped",this.filteredCollection),this.wrappedCollection.each(_.bind(this._onWrappedAdd,this)),this.filteredCollection},unwrap:function(){this.filteredCollection&&(this.stopListening(this.filteredCollection),this.wrappedCollection.trigger("unwrapped",this.filteredCollection),this.filteredCollection=null),this.wrappedCollection&&(this.stopListening(this.wrappedCollection),this.wrappedCollection=null),this.filterFunction=null},_copyLocalState:function(e,t,n){e&&t&&!_.isEmpty(e.LOCAL_STATE)&&t.adjustLocalState(e._localState,null,n)},_onWrappedAdd:function(e,t){this.filteredCollection.get(e)||this.filterFunction(e,"add:wrapped")&&(this.filteredCollection.add(e,{silent:!0===t}),this._copyLocalState(e,this.filteredCollection.get(e),!0===t))},_onWrappedRemove:function(e){this.filteredCollection.get(e)&&(e.destroying||this.filterFunction(e,"remove:wrapped")&&(e.destroying=!0,this.filteredCollection.remove(e)))},_onWrappedReset:function(){var e=this;this.wrappedCollection.each(function(t){e._onWrappedAdd(t)})},_onWrappedChange:function(e){var t=this.filteredCollection.get(e);t?(t.set(e.attributes),this.filterFunction(e,"add:filtered",{onChange:!0})||this.filteredCollection.remove(e)):this.filterFunction(e,"add:wrapped")&&(this.filteredCollection.add(e),t=this.filteredCollection.get(e)),this._copyLocalState(e,t)},_onWrappedLocalStateChange:function(t){return!(t instanceof e.Collection)&&this._onWrappedChange(t)},_onFilteredAdd:function(e,t,n){n&&n.cached||this.filterFunction(e,"add:filtered")&&(this.wrappedCollection.add(e,{merge:!0}),this._copyLocalState(e,this.wrappedCollection.get(e)))},_onFilteredRemove:function(e){this.wrappedCollection.get(e)&&(e.destroying||this.filterFunction(e,"remove:filtered")&&(e.destroying=!0,this.wrappedCollection.remove(e)))},_onFilteredReset:function(){var e=this;this.filteredCollection.each(function(t){e._onFilteredAdd(t)})},_onFilteredChange:function(e){var t=this.wrappedCollection.get(e);t&&(t.set(e.attributes),this.filterFunction(e,"add:filtered",{onChange:!0})||this.filteredCollection.remove(e),this._copyLocalState(e,t))},_onFilteredLocalStateChange:function(t){return!(t instanceof e.Collection)&&this._onFilteredChange(t)},reset:function(){var e=this.filteredCollection.last();this.filteredCollection.reset([],{silent:!0}),this.wrappedCollection.each(_.bind(function(e){this._onWrappedAdd(e,!0)},this));var t=this.filteredCollection.last();e&&this.filteredCollection.trigger("remove",t),t&&this.filteredCollection.trigger("add",t)}});return _wrapper=n,n}),define("objects/pusher",["config","fslib/object","fslib/singleton","models/current_user","models/session"],function(e,t,n,i,r){var s=t.extend({start:function(){this.started?console.error("pusher already started"):(this.channels=[],this.started=!0,require(["fslib/pubsub_wrapper"],this.createPusherChannel))},createPusherChannel:function(t){if(e.isUnitTest)console.log("Skipping Pusher for now...");else{this.client=t.Channel({authEndpoint:e.REQUEST_URL+"channelauth",cluster:e.pusherCluster});var n=i.id;console.log("Subcribing to Pusher: "+n),this.client.open({channel:n,connect:this._onConnect,message:this._onUserMessage,error:this._onError,close:this._onClose}),i.inExperiment("talkiq")&&this.subscribeToTalkIq(i),this.queuedChannels&&this.subscribeToChannels(this.queuedChannels)}},subscribeToChannels:function(e){if(!this.client)return this.queuedChannels=e,void console.log("no pusher socket yet...queueing channels: "+this.queuedChannels);this.queued_channels=null,e&&e.length&&(console.log("subscribing to pusher channels: "+e),_.each(e,_.bind(function(e){var t=e.replace(":","-");this.client.isSubscribed(t)||(this.client.open({channel:t,message:this._onMessage}),this.channels.push(t))},this)))},TALK_IQ_EVENTS:{recommendations:"recommendations",transcription:"transcription",calldata:"calldata","nlp-activations":"sentiment","nlp-events":"moment","nlp-popups":"popup",start:"transcriptionstart",end:"transcriptionend"},subscribeToTalkIq:function(e){var t=this._getTalkIqChannel(e);t&&this._openTalkIqChannel(t)},isSubscribedToTalkIq:function(e){var t=this._getTalkIqChannel(e);return!!t&&(this.client&&this.client.isSubscribed(t))},_getTalkIqChannel:function(e){if(e.getShortKey)return"talkiq-"+e.getShortKey().replace(":","-");console.warn("need to pass in a model that has a convenience method getShortKey -- see user.js or group.js")},_openTalkIqChannel:function(e){if(this.client){console.log("Listening to Pusher TalkIQ: "+e);var t=this.client.open({channel:e});this._bindTalkIqEvents(t)}},_bindTalkIqEvents:function(e){if(e)for(var t in this.TALK_IQ_EVENTS)e.bind(t,this._onTalkIq.bind(this,this.TALK_IQ_EVENTS[t]))},_onMessage:function(e){console.log("Pusher Received"),console.log(e),this.trigger("notify",e.data)},_onUserMessage:function(e){this.trigger("user",e.data)},_onTalkIq:function(t,n){e.debug&&console.log(n),this.trigger("talkiq",n,t)},_onConnect:_.throttle(function(e){console.log("pusher connected"),this.trigger("connected",e)},1e3,{trailing:!1}),_onError:function(e){console.error("pusher error"),console.error(e),this.trigger("error",e)},_onClose:function(e){console.error("pusher closed"),console.error(e),this.trigger("disconnected",e)}});return n.create(s,"pusher")}),define("models/group",["models/contact","models/current_user","config"],function(e,t,n){return e.extend({LOCAL_STATE:{processingHasCallAi:!1,hasCallAi:!1},urlRoot:n.REQUEST_URL+"group",defaults:{name:"New Group"},getShortKey:function(){var e;switch(this.get("type")){case"call_center":e="CallCenter";break;case"department":e="OfficeGroup";break;case"office":e="Office";break;case"coaching_group":e="CoachingGroup"}return e&&e+":"+this.get("group_id")},callRecordingSettings:{always:"call_recording_always",outgoing:"call_recording_outgoing",incoming:"call_recording_incoming",disabled:"call_recording_disabled"},recordingRuleSettings:{none:"record_none",operator_only:"record_operator_only"},fetchOperatorCount:function(){if(!this.isParkOnly()){var e=this.url()+"?operators=1&count=1";$.ajax({url:e,success:_.bind(function(e,t,n){var i=parseInt(e.operator_count);_.isFinite(i)&&this.trigger("count:sync",i)},this)})}},isUser:function(){return!1},isAdmin:function(){return!!this.get("is_admin")},isOffice:function(){return"office"==this.get("type")},isStaff:function(){return"staff"==this.get("type")},isCallCenter:function(){return"call_center"==this.get("type")},isExtended:function(){return this.has("has_callai")},getHasVoiceAi:function(){return this.getLocalState("processingHasCallAi")?this.getLocalState("hasCallAi"):this.get("has_callai")},allowVoiceAi:function(){return!!this.get("allow_callai")},saveHasVoiceAi:function(e,t){this.saveAndAdjustLocalState({has_callai:e},"processingHasCallAi",t),this.adjustLocalState("hasCallAi",e)},canEavesdrop:function(){return this.get("admin_allowed_to_eavesdrop")&&this.isAdmin()},canEditSettings:function(e){return this.has("can_edit")?this.get("can_edit")||t.isCompanyAdmin()||e:this.isAdmin()},isAlwaysAutoRecording:function(){return this.get("call_recording_setting")===this.callRecordingSettings.always},isIncomingAutoRecording:function(){return this.isAlwaysAutoRecording()||this.get("call_recording_setting")===this.callRecordingSettings.incoming},isOutgoingAutoRecording:function(){return this.isAlwaysAutoRecording()||this.get("call_recording_setting")===this.callRecordingSettings.outgoing},allowPauseRecording:function(){return!!this.get("allow_pause_recording")},isCallWaiting:function(){return this.get("dial_busy_operators")},isParkOnly:function(){return t.get("office").id===this.id&&t.canParkOnlyOnOffice()},isUnattendedQueue:function(){return this.get("unattended_queue")},allowQueuing:function(){return!!this.get("allow_queuing")},isAdminEavesdropTransparency:function(){return this.get("admin_eavesdrop_transparency")},hasNonUSPrimaryPhone:function(){return"us"!=this.get("country")},isSkilledBasedRouting:function(){return"mostskilled"===this.getOperatorRouting(!1)||"mostskilled"===this.getOperatorRouting(!0)},getEnableHoldInterrupt:function(){return this.get("enable_hold_interrupt")},getAnnouncePosition:function(){return this.get("announce_position")},getDisplayName:function(){return this.get("display_name")},getImage:function(){return this.get("image_url")||"http://dialpad.com/avatar/static/avatar_group_contact.png?version=2"},getMaxHoldCount:function(){var e=parseInt(this.get("max_hold_count"));return isNaN(e)?5:e},getMaxHoldSeconds:function(){var e=parseInt(this.get("max_hold_seconds"));return isNaN(e)?300:e},getAnnouncementIntervalSeconds:function(){var e=parseInt(this.get("announcement_interval_seconds"));return isNaN(e)?120:e},getMaxWrapUp:function(){var e=parseInt(this.get("max_wrap_up_seconds"));return isNaN(e)?0:e},allowQueueCallback:function(){return!!this.get("allow_queue_callback")},getQueueCallbackDtmf:function(){var e=this.get("queue_callback_dtmf"),t="#"===e||"*"===e?e:parseInt(e);return _.isNaN(t)?null:t},getQueueCallbackThreshold:function(){var e=parseInt(this.get("queue_callback_threshold"));return isNaN(e)?5:e},getOfficeSettings:function(){return this.get("office_settings")},getCallAutoRecordingMessage:function(){return this.get("call_auto_recording_message")},getFirstAction:function(e){return this.get("routing_options")[e?"closed":"open"].try_dial_operators?"operators":"menu"},getNoOperatorsAction:function(e){return this.get("routing_options")[e?"closed":"open"].action},getDefaultOperatorRouting:function(){return this.isCallCenter()?"longestidle":"simultaneous"},getOperatorRouting:function(e){return this.get("routing_options")[e?"closed":"open"].operator_routing||this.getDefaultOperatorRouting()},getRoutingOptions:function(e){var t,n,i,r,s=this.get("routing_options"),o={},a=e?"closed":"open";switch(t=this.getFirstAction(e),n=s[a].action){case"department":i=s[a].action_target,r=null;break;case"bridge_target":i=null,r=s[a].display_action_target}for(var c=s[a].dtmf,l=0;l<10;l++)c[l]&&(o[l]=c[l],o[l].target=c[l].action_target);return{firstAction:t,noOperatorsAction:n,forwardToDepartment:i,forwardToBridgeTarget:r,dtmf:o,operatorRouting:this.getOperatorRouting(e)}},getTargetInfo:function(){return this.get("target_info")||{}},getRecordingRuleEnabled:function(){return this.getTargetInfo().enable_recording_rule},getRecordingRules:function(){return this.getTargetInfo().recording_rules||{}},getRecordingRuleSetting:function(){return _.first(_.values(this.getRecordingRules()))},getExcludedCallRecordingPrefixes:function(){return Object.keys(this.getRecordingRules())},updateTargetInfo:function(e,t){var n=Object.assign({},this.getTargetInfo(),e);return this.save({target_info:n},Object.assign({},{patch:!0,wait:!0},t))},saveRecordingRules:function(e,t,n){if(!t)return console.error("Trying to save null recording rule for prefixes");var i=_.object(e.map(function(e){return[e,t]}));return this.updateTargetInfo({recording_rules:i},n)},saveRecordingRuleEnabled:function(e,t){return this.updateTargetInfo({enable_recording_rule:e},t)},toJSON:function(){var t=e.prototype.toJSON.apply(this,arguments);return this.isParkOnly()&&(t.park_only=!0),t}})}),define("collections/group_list",["collections/common/cursor_collection","config","fslib/fsutil","fslib/singleton","objects/pusher","models/group","models/current_user"],function(e,t,n,i,r,s,o){var a=e.extend({model:s,url:t.REQUEST_URL+"group",initialize:function(){e.prototype.initialize.call(this),this.wrapper||this.listenTo(o,"change",this.onCurrentUserSync)},onCurrentUserSync:function(e,t){this.set(e.getOperatorGroups())},comparator:function(e){return e.get("name")},fetch:function(t){return(t=t||{}).data=t.data||{},t.data.operator=1,e.prototype.fetch.call(this,t)},getLineCss:function(e){var n=this.get(e);if(n){var i=t.isSingle?6:3;return"line-"+(this.indexOf(n)%i+1)}},getLineName:function(e){var t=this.get(e);return t?n.ellipsis(t.get("name")||"MAIN LINE"):""},isStaffGroup:function(e){var t=this.get(e);if(t)return"staff"==t.get("type")},isCallCenter:function(e){var t=this.get(e);return t&&t.isCallCenter()},isParkOnly:function(e){var t=this.get(e);return t&&t.isParkOnly()},getAbbreviation:function(e){var t=this.get(e);if(t)return t.get("abbr")},hasNonUSPrimaryPhone:function(e){var t=this.get(e);if(t)return t.hasNonUSPrimaryPhone()},getByCall:function(e){return this.get(e.get("target_key"))},isAutoRecordingCall:function(e){var t=this.getByCall(e);return t&&(e.isInbound()&&t.isIncomingAutoRecording()||e.isOutbound()&&t.isOutgoingAutoRecording())},isEavesdropEnabled:function(e){var t=this.get(e);return t&&t.canEavesdrop()&&o.canEavesdrop()},allowQueuing:function(e){var t=this.get(e);return t&&t.allowQueuing()&&o.inExperiment("department_queues")},canAccessHoldQueue:function(e){var t=this.get(e);return this.isCallCenter(t)||this.allowQueuing(t)},canAccessActiveCalls:function(e){var t=this.get(e);return this.isEavesdropEnabled(t)||this.allowQueuing(t)},canEditOperators:function(e){return!this.isParkOnly(e)&&(this.isCallCenter(e)?this.isEavesdropEnabled(e):this.isAdmin(e))},isAdmin:function(e){var t=this.get(e);return t&&t.isAdmin()},getExtended:function(e){return new Promise(_.bind(function(t,n){var i=this.get(e);if(!i)return n();this.isGroupExtended(i)?t(i):(console.log("GROUP LIST: Fetching extended info for group:",i.id),i.fetch({merge:!0,success:t,error:n}))},this))},isGroupExtended:function(e){var t=this.get(e);return t&&t.isExtended()},hasVoiceAi:function(e){var t=this.get(e);return t&&t.getHasVoiceAi()},subscribeToTalkIq:function(e){return new Promise(_.bind(function(t,n){var i=this.get(e);if(!i||i.isExtended()&&!i.getHasVoiceAi())return n();if(r.isSubscribedToTalkIq(i))return t();var s=_.bind(function(){this.isEavesdropEnabled(i)&&i.getHasVoiceAi()?(r.subscribeToTalkIq(i),t()):n()},this);this.getExtended(e).then(s).catch(s)},this))}});return i.create(a,"groupList")}),define("models/call_ai_leg",["config","models/base"],function(e,t){return t.extend({type:"CallAiLeg",getStartDate:function(){return this.get("date_started")},getStopDate:function(){return this.get("date_ended")}})}),define("collections/callai_leg_list",["require","fslib/singleton","models/call_ai_leg","collections/common/collection"],function(require){var e=require("fslib/singleton"),t=require("models/call_ai_leg"),n=require("collections/common/collection").extend({model:t,getForCallLeg:function(e){return this.where({call_leg_id:e})}});return e.create(n,"callAiLegs")}),define("models/voiceai/battle_card",["require","models/base","config"],function(require){var e=require("models/base"),t=require("config"),n=["name","category","orientation"];return e.extend({type:"BattleCard",idAttribute:"key",LOCAL_STATE:{dateModified:null,targetKey:"",coachKey:"",isCoach:!1},urlRoot:t.REQUEST_URL+"battlecard",url:function(){var e=this.getIsCoach()?this.getCoachKey():this.getTargetKey(),t=this.getBattleCardId(),n=t?"/"+t:"";return""+this.urlRoot+n+"?target_key="+e+"&coach="+this.getIsCoach()},parse:function(t,n){return t.targetKey&&this.setTargetKey(t.targetKey),e.prototype.parse.apply(this,arguments)},getDateModified:function(){return this.getLocalState("dateModified")||this.get("date_modified")},setDateModified:function(e){return this.adjustLocalState("dateModified",e),this},getTargetKey:function(){return this.getLocalState("targetKey")||this.get("target_key")},setTargetKey:function(e){return this.adjustLocalState("targetKey",e),this},getCoachKey:function(){return this.getLocalState("coachKey")||this.get("coach_key")},setCoachKey:function(e){return this.adjustLocalState("coachKey",e),this},getIsCoach:function(){return this.getLocalState("isCoach")||!!this.get("coach_key")},setIsCoach:function(e){return this.adjustLocalState("isCoach",e),this},getBattleCardId:function(){return this.get("id")},getContent:function(){return this.get("content")||{}},getText:function(){return this.getContent().text},getLinkUrl:function(){return this.getContent().link_url},getLinkText:function(e){var t=this.getContent();return t.link_text||e&&t.link_url},getKeywords:function(e){var t=e?[""]:[];return this.get("keywords")||t},getCategory:function(){return this.get("category")},getOrientation:function(){return this.get("orientation")},getName:function(){return this.get("name")},validate:function(e){var t={},i=this.translate("Required");n.forEach(function(n){e[n]||(t[n]=i)});var r=!1,s=(e.keywords||[]).map(function(e){return e?null:(r=!0,i)});r&&(t.keywords=s);var o=e.content||{},a={};if(o.text||(a.text=i),o.link_url&&!o.link_text&&(a.link_text=this.translate("Link requires a name")),o.link_text&&!o.link_url&&(a.link_url=this.translate("Name requires a link URL")),_.isEmpty(a)||(t.content=a),!_.isEmpty(t))return t}})}),define("collections/voiceai/battle_card_list",["require","collections/common/cursor_collection","models/voiceai/battle_card","fslib/singleton","config"],function(require){var e=require("collections/common/cursor_collection"),t=require("models/voiceai/battle_card"),n=require("fslib/singleton"),i=require("config"),r=e.extend({model:t,_targetKey:"",_isCoach:!1,urlRoot:i.REQUEST_URL+"battlecard",url:function(){return this.urlRoot+"?target_key="+this.getTargetKey()+"&coach="+this.getIsCoach()},modelId:function(e){return e.key||e.id},comparator:function(e,t){return t?t.getDateModified()-e.getDateModified():-1},setTargetKey:function(e){return this.wrapper&&(this._targetKey=e),this},setIsCoach:function(e){this.wrapper&&(this._isCoach=e)},getIsCoach:function(){return this._isCoach},getByBattleCardId:function(e){return this.findWhere({id:e})},getTargetKey:function(){return this._targetKey},getOrFetch:function(e,t,n){var i={id:e,targetKey:t},r=this.findWhere({id:i.id})||this._fetchById(i,{parse:!0});return!n&&r&&r.fetch({merge:!0}),r}});return n.create(r,"battleCardList")}),define("models/call_leg",["config","collections/callai_leg_list","models/base"],function(e,t,n){return n.extend({urlRoot:e.REQUEST_URL+"callleg/",RECORDING_TIME:"date_transcript_started",type:"CallLeg",isCall:function(){return!1},parse:function(e,t){return this.get(this.RECORDING_TIME)||(e[this.RECORDING_TIME]=this._getRecordingTimeFromResponse(e)),n.prototype.parse.call(this,e,t)},_getRecordingTimeFromResponse:function(e){var t=e.original_socket_message||{},n=t.start_time||t.payload;return n&&1e3*n},getCallAiLegs:function(){return t.getForCallLeg(this.id)},fromSocket:function(){return this.get("original_socket_message")},getRecordingTime:function(){return this.get(this.RECORDING_TIME)||this.get("date_started")}})}),define("collections/call_leg_list",["fslib/singleton","models/call_leg","collections/common/cursor_collection","collections/callai_leg_list"],function(e,t,n,i){var r=n.extend({model:t,_fetching:{},initialize:function(){n.prototype.initialize.call(this),this.wrapper||this._addListeners()},_addListeners:function(){this.listenTo(this,"add",this._updateCallAiLegs),this.listenTo(this,"change:callai_legs",this._updateCallAiLegs)},_updateCallAiLegs:function(e){(e.get("callai_legs")||[]).forEach(function(e){e.date_started&&(e.id||(e=_.extend({id:e.callai_leg_id},e)),i.add(e,{merge:!0}))})},getCallLeg:function(e){return this.get(e)||this.addCallLeg(e)},getCallAiLeg:function(e,t){var n=i.get(e);if(n&&n.getStartDate())return n;this.addCallLeg(t)},addCallLeg:function(e){this._isFetching(e)||(this._setFetching(e,!0),new this.model({id:e}).fetch({success:this._onAddCallLegSuccess,error:this._onAddCallLegError,merge:!0}))},_isFetching:function(e){var t=this._fetching[e];return t&&t.fetching},_setFetching:function(e,t){var n=this._fetching[e]||{};n.fetching=!!t,n.maxTries=5,n.fetching&&(n.tries=(n.tries||0)+1,console.log("CALL LEG LIST: Fetching call leg (",e,") try number:",n.tries)),this._fetching[e]=n},_stopFetching:function(e){var t=this._fetching[e];t.tries>=t.maxTries&&console.warn("CALL LEG LIST: Tried fetching call leg (",e,")",t.tries,"times. Giving up."),delete this._fetching[e]},_onAddCallLegSuccess:function(e){this._stopFetching(e.id),e.set("fromServer",!0),this.add(e,{merge:!0})},_onAddCallLegError:function(e){console.error("error fetching call leg:",e.id);var t=this._fetching[e.id];t.tries<t.maxTries?(this._setFetching(e.id,!1),this.addCallLeg(e.id)):this._stopFetching(e.id)}});return e.create(r,"callLegs")}),define("models/call",["models/base","models/session","collections/participants_list","fslib/webrtc","fslib/collection_wrapper","collections/group_list","collections/callai_leg_list","collections/voiceai/battle_card_list","collections/call_leg_list","objects/pusher","models/current_user","models/contact","config","fslib/fsutil","fslib/i18n"],function(e,t,n,i,r,s,o,a,c,l,u,h,d,f,p){var g=e.extend({urlRoot:d.REQUEST_URL+"call/",type:"Call",LOCAL_STATE:{parked:!1,participants:{},processingRecord:!1,processingAutoRecord:!1,processingHold:!1,processingMerge:!1,processingVmDrop:!1,processingHangup:!1,processingVoicemail:!1,processingDirectTransfer:!1,processingDirectTransferToVm:!1,processingDirectTransferToHold:!1,processingDirectTransferToPark:!1,processingWarmTransfer:!1,processingWarmTransferVm:!1,processingBarge:!1,processingTakeover:!1,processingSwap:!1,processingCallAiActive:!1,finishedTransfer:!1,dialpadInput:"",byeOriginator:null,warmTransfer:null,swapped:!1,preloadError:!1,mediaError:!1,bookmarkState:null,rejected:!1,isPreanswerCall:!1,preanswering:!1,connecting:!1,powerDialNotes:!1,autodialCountdown:null,outboundCallData:{}},initialize:function(){e.prototype.initialize.apply(this,arguments),this.setParticipantsList(new n),this.listenTo(this,"change",this._onChange),this.listenTo(this,"change:state",this._onChangeState),this.listenTo(this,"change:internal_leg_ids",this.buildParticipantsList),this.listenTo(this,"sync",this._onSync),this.listenTo(this,"request",this._onRequest),this.listenTo(this,"error",this._onError),this.listenTo(i,"onCallState",this._onWebrtcCallStateChanged),this.listenTo(this,"destroy",function(){this.wrapper.unwrap()})},parse:function(t,n){var i=t;return this.isNewer(i,n)?this.clear({silent:!0}):i=this.attributes,e.prototype.parse.call(this,i,n)},isNewer:function(e,t){t=t||{};var n=parseInt(e.date_modified||0),i=parseInt(this.get("date_modified")||0),r=n>i||t.replaceIfSameModifiedDate&&n==i;r||e.state!==g.STATES.HANGUP||this.attributes.state===g.STATES.HANGUP||(console.warn("CALL: Got a hangup and would have ignored it bc it has the same date modified!"),this.set("state",g.STATES.HANGUP));var s=!this.get("swap_call")&&e.swap_call;return r||s||(console.log("call race!"),console.log(this.attributes),console.log(e)),r||s},isRateable:function(){var e=this.get("date_connected");if(!e)return console.log("No date_connected on call. Not Rating"),!1;var t=Date.now();return((this.get("date_ended")||t)-e)/1e3>5||(console.log("Call too short to rate. date_ended:",this.get("date_ended"),"date_connected",this.get("date_connected")),!1)},isCalling:function(){return this.get("state")===g.STATES.CALLING||this.isPreanswer()&&!_.isEmpty(this.getLocalState("outboundCallData"))},isPreanswer:function(){return this.get("state")===g.STATES.PREANSWER},isCallStateConnecting:function(){return this.get("state")===g.STATES.CONNECTING},_canHaveLocalCallStateConnecting:function(){return _.contains([g.STATES.PREANSWER,g.STATES.RINGING,g.STATES.CONNECTING],this.get("state"))},isLocalCallStateConnecting:function(){return this._canHaveLocalCallStateConnecting()&&this.getLocalState("connecting")},isConnecting:function(){return this.isCallStateConnecting()||this.isLocalCallStateConnecting()},isMerged:function(){return this.get("state")===g.STATES.MERGED},isEavesdropping:function(){return this.get("state")===g.STATES.EAVESDROP},isActive:function(){return(this.isConnected()||this.isOnHold()||this.hasPreloadError())&&!this.isHangingUp()},isConnected:function(){return _.contains([g.STATES.CONNECTED,g.STATES.EAVESDROP,g.STATES.MERGED],this.get("state"))||this.isConnecting()},hasNotConnectedYet:function(){return this.isConnecting()||this.isRinging()||this.isCalling()||this.isPreanswer()||this.isPreanswering()},isConnectedToContact:function(){return this.isStateConnected()||this.isMerged()},isStateConnected:function(){return this.get("state")===g.STATES.CONNECTED},isFullyConnected:function(){var e=this.get("state"),t=[g.STATES.CALLING,g.STATES.HOLD];return this.isConnected()||t.indexOf(e)>-1},isRinging:function(){return u.isFastAnswer()?this._isFastAnswerRinging():this.isCallStateRinging()},isPreloading:function(){return this.isCallStateRinging()&&i.isPreloading()},shouldStartRecordingCallStats:function(){return this.isConnected()||this.isConnecting()||this.isCalling()||this.isPreloading()},shouldPauseRecordingCallStats:function(){return this.isOnHold()},shouldStopRecordingCallStats:function(){return _.contains([g.STATES.HANGUP,g.STATES.VOICEMAIL],this.get("state"))},_isFastAnswerRinging:function(){return!!this.isCallStateRinging()&&(!!(this.isPreanswerCall()||i.isPcConnected()||i.isPcDisconnected()||i.isRinging())||!i.session)},_getTimeElapsed:function(){return t.getServerTime()-this.getStartTime()},isCallStateRinging:function(){return this.get("state")===g.STATES.RINGING&&!this.isConnecting()},isVideo:function(){return!1},isCall:function(){return!0},isOnHold:function(){return this.get("state")==g.STATES.HOLD},isVoicemail:function(){return this.getLocalState("processingVoicemail")||this.get("state")==g.STATES.VOICEMAIL},isDummy:function(){return"dummy"===this.id||"dummy"===this.attributes.id||this.isFastCall()},isFastCall:function(){return!!this.isCalling()&&(!!this.get("fast_call")||!!(_.first(this.get("internal_leg_ids"))||"").match("^fast_call"))},isSecondary:function(){return!(!this.get("is_secondary")&&!this.get("entry_point_call_id"))},requiresInternalLeg:function(){return[g.STATES.CONNECTED,g.STATES.MERGED,g.STATES.CALLING].indexOf(this.get("state"))>-1},isInbound:function(){return"inbound"===this.get("direction")},isOutbound:function(){return"outbound"===this.get("direction")},_onChange:function(){this._updatePreloadErrorState()},_onWebrtcCallStateChanged:function(){this._updatePreloadErrorState()},_isUsingClient:function(){return u.isConnectedToClient()&&"ready"!==i.getCallState()},isConnectedToClient:function(){return this.isConnected()&&this._isUsingClient()},isFullyConnectedToClient:function(){return this.isFullyConnected()&&this._isUsingClient()},isStateConnectedToClient:function(){return this.isStateConnected()&&this._isUsingClient()},isDisconnectedFromClient:function(){return this.requiresInternalLeg()&&u.isConnectedToClient()&&"ready"===i.getCallState()},isOnAnotherDevice:function(){if(this.isDummy())return!1;var e=d.isRemote?!u.isConnectedToADesktopClient():!u.isConnectedToClient()&&"connected"!==i.getCallState();return(this.requiresInternalLeg()||this.isOnHold())&&e},isEndpoint:function(e,t){if(this.get("target_key")===(t||u.get("key"))){var n=this.get("external_endpoint");return n&&(n===e||this.getOutboundEndpoint()===e)}},getStartTime:function(){return this.get("date_connected")},isAdminRecordingEnabled:function(){return this.get("admin_call_recording")||u.get("admin_call_recording")},isAutoRecordingEnabled:function(){return!!this.get("entry_point_recording")},isAutoRecordingPaused:function(){return!(!this.isCallCenterCall()&&!this.isCoachingGroupCall())&&!this.get("is_auto_recording")},isManualRecording:function(){return this.get("is_recording")&&!this.isManualRecordingDisabled()},isManualRecordingDisabled:function(){return this.isCallCenterCall()},isCallCenterCall:function(){var e=s.get(this.get("entry_point_target_key"))||s.getByCall(this);return e&&e.isCallCenter()},isCoachingGroupCall:function(){var e=this.parseEntrypointTargetShortKey();return e&&"CoachingGroup"===e.type},parseEntrypointTargetShortKey:function(){return f.parseShortKey(this.get("entry_point_target_short_key"))},canRecord:function(){return u.canRecord()},isRecording:function(){return this.isManualRecording()||this.isAutoRecordingEnabled()},allowPauseRecording:function(){return!!this.get("allow_pause_recording")&&!this.isSupervising()},isVoiceAiEnabled:function(){return!(!this.isVoiceAiAllowed()||!this.get("callai_active"))},isVoiceAiAllowed:function(){return!(!u.allowTalkIq()||!this.get("has_callai"))},toggleVoiceAi:function(e){this.isVoiceAiAllowed()&&!this.isTogglingVoiceAi()&&this.saveAndAdjustLocalState({callai_active:!this.get("callai_active")},"processingCallAiActive",e)},isTogglingVoiceAi:function(){return this.isVoiceAiAllowed()&&this.getLocalState("processingCallAiActive")},toggleAutoRecord:function(e){this.isTogglingAutoRecord()||this.saveAndAdjustLocalState({is_auto_recording:!this.get("is_auto_recording")},"processingAutoRecord",e)},isTogglingAutoRecord:function(){return this.getLocalState("processingAutoRecord")},isSupervising:function(){return this.isListening()||this.isBarging()},isListening:function(){var e=this.get("feed_target")||this.get("target_key");return _.find(this.get("participants"),function(t){return n.getContactKey(t)===e&&n.isListening(t)})},isBarging:function(){var e=this.get("feed_target")||this.get("target_key");return _.find(this.get("participants"),function(t){return n.getContactKey(t)===e&&n.isBarging(t)})||this.getLocalState("processingBarge")},isTakingOver:function(){var e=this.get("feed_target")||this.get("target_key");return _.find(this.get("participants"),function(t){return n.getContactKey(t)===e&&n.isTakingOver(t)})||this.getLocalState("processingTakeover")},hasEnded:function(){return this.isHangingUp()||this.get("state")===g.STATES.HANGUP},record:function(e){if(!this.canRecord()||this.isManualRecording())return this.stopRecording(e);this.saveAndAdjustLocalState({is_recording:!0},"processingRecord",e)},stopRecording:function(e){this.canRecord()&&this.saveAndAdjustLocalState({is_recording:!1},"processingRecord",e)},hold:function(e){if(this.isOnHold())return this.bridge(e);this.saveAndAdjustLocalState({state:g.STATES.HOLD},"processingHold",e)},bridge:function(e){var t={success:e,error:function(t,n){if(e&&e(),n&&412==n.status){if("ready"!==i.getCallState())return console.error("Error calling in after bridge 412, webrtc unavailable");var r=[];r.push("X-UV-STATE: connected"),r.push("X-UV-CALL: "+t.get("id")),i.call(i.getIdentity(),r)}}};this.saveAndAdjustLocalState({state:g.STATES.CONNECTED},"processingHold",t)},merge:function(e){this.saveAndAdjustLocalState({state:g.STATES.MERGED},"processingMerge",e)},addDialpadInput:function(e){var t=this.getDialpadInput()+e;this.adjustLocalState("dialpadInput",t)},getDialpadInput:function(){return this.getLocalState("dialpadInput")||""},vmDrop:function(e){this.saveAndAdjustLocalState({drop_voicemail:!0},"processingVmDrop",e)},hangUp:function(e,t,n){if(console.log("Call (",this.id,") was hung up from",n||"unknown -- opt_source not passed in"),this.isDummy())return this.set({state:g.STATES.HANGUP}),void console.warn("This call was hung up before the other party answered which is why it has the dummy id.");"boolean"==typeof e&&(t=e,e=null),this.saveAndAdjustLocalState({state:g.STATES.HANGUP},"processingHangup",e,t)},sendToVoicemail:function(e){if(this.isDummy())return this.set({state:g.STATES.VOICEMAIL});this.saveAndAdjustLocalState({state:g.STATES.VOICEMAIL},"processingVoicemail",e)},_warmTransfer:function(e,t,n){if(this.isTransferring()||this.isTransferringToVm())console.warn("AUDIO CALL: caller tried to transfer the same call (",this.get("id"),") twice to (",e.get("id"),") -- ignoring the second time.");else{var i=this.get("id"),r=e.get("id"),s=n?"(Voicemail)":"";console.log("Warm transfer from",i,"to",r,s);var o=t,a=null;"object"===(void 0===t?"undefined":_typeof(t))&&(o=t.success,a=t.error);var c={success:_.bind(function(){console.info("Warm transfer succeeded from",i,"to",r,s),this.adjustLocalState("finishedTransfer",!0),o&&o(this)},this),error:function(e,t){console.error("Warm transfer failed from",i,"to",r,s);var n=JSON.parse(t.responseText),o="transfer_failed";n.errors&&n.errors[0]&&(o=n.errors[0]),a&&a(o)}},l={};n?(l.transfer_to_contact_key=e.get("contact").id,l.transfer_state="voicemail"):l.transfer_to_call_id=e.get("id");var u=n?"processingWarmTransferVm":"processingWarmTransfer";this.saveAndAdjustLocalState(l,u,c)}},warmTransferToVoiceMail:function(e,t){this._warmTransfer(e,t,!0)},warmTransfer:function(e,t){this._warmTransfer(e,t)},setWarmTransfer:function(e){this.adjustLocalState("warmTransfer",e,!0),this.trigger("setWarmTransfer")},unsetWarmTransfer:function(){this.adjustLocalState("warmTransfer",null,!0)},getWarmTransfer:function(){return this.getLocalState("warmTransfer")},isTransferring:function(){return this.getLocalState("processingWarmTransfer")},isTransferringToVm:function(){return this.getLocalState("processingWarmTransferVm")},isDirectTransferring:function(){return this.getLocalState("processingDirectTransfer")||this.getLocalState("processingDirectTransferToVm")||this.getLocalState("processingDirectTransferToHold")||this.isParking()},isParking:function(){return this.getLocalState("processingDirectTransferToPark")},finishedTransfer:function(){return this.getLocalState("finishedTransfer")},inTransferringState:function(){return this.isTransferring()||this.isTransferringToVm()||this.isDirectTransferring()||this.finishedTransfer()},_directTransfer:function(e,t,n){if(this.isDirectTransferring())console.warn("AUDIO CALL: caller tried to direct transfer the same call (",this.get("id"),") twice to (",e,") -- ignoring the second time.");else{var i={},r=!(!e||!e.attributes),s=r?"transfer_to_contact_key":"transfer_to",o=r?e.get("key"):e;i[s]=o,t&&(i.transfer_state=t);var a=n,c=null;"object"===(void 0===n?"undefined":_typeof(n))&&(a=n.success,c=n.error);var l={success:_.bind(function(){!this.get(s)&&this.set(s,o),this.adjustLocalState("finishedTransfer",!0),a&&a(this)},this),error:function(e,t){var n=JSON.parse(t.responseText),i="transfer_failed";n.errors&&n.errors[0]&&(i=n.errors[0]),c&&c(i)}},u="processingDirectTransfer";"voicemail"===t?u="processingDirectTransferToVm":"hold"===t?u="processingDirectTransferToHold":"parked"===t&&(u="processingDirectTransferToPark"),console.log("AUDIO CALL: Direct transfer from (",this.get("id"),") to (",o,") with transfer_state (",t,")"),this.saveAndAdjustLocalState(i,u,l)}},isTransferred:function(){return this.get("transfer_to")||this.get("transfer_to_contact_key")},directTransfer:function(e,t){this._directTransfer(e,null,t)},directTransferToVm:function(e,t){this._directTransfer(e,"voicemail",t)},directTransferToHold:function(e,t){this._directTransfer(e,"hold",t)},directTransferToPark:function(e,t){this._directTransfer(e,"parked",t)},park:function(e){this.adjustLocalState("parked",!0),this.isOnHold()?e&&e(this):this.hold(e)},unPark:function(){this.adjustLocalState("parked",!1)},isParked:function(){return this.getLocalState("parked")},isHangingUp:function(){return this.getLocalState("processingHangup")||this.getLocalState("processingVoicemail")||this.isRejected()},setConnecting:function(){this.set({state:g.STATES.CONNECTING}),this.setLocalCallStateConnecting()},setLocalCallStateConnecting:function(){this._canHaveLocalCallStateConnecting()&&this.adjustLocalState("connecting",!0)},connect:function(e){this.save({state:g.STATES.CONNECTED},{error:e})},eavesdrop:function(e){this.save({state:g.STATES.EAVESDROP},{error:e})},isInViewableState:function(){return this.isActive()||this.isCalling()||this.isPreanswer()||this.isPreanswering()||this.shouldSwap()||this.isSwapping()||this.isTakingOver()},isInInactiveState:function(){return this.isOnAnotherDevice()||this.needsToReconnect()||this.isParked()||this.hasPreloadError()||this.isCalling()||this.isPreanswer()||this.isPreanswering()||this.isConnecting()||this.isOnHold()},getEntryPointTargetType:function(){var e=this.get("entry_point");return e?e.type:null},getDateQueued:function(){return parseInt(this.get("date_queued"))},getFormattedHoldTime:function(){var e=((new Date).getTime()-this.getDateQueued())/1e3;return e<60?"< 1":Math.floor(e/60)},getFormattedCallbackRequestedTime:function(){return 0},isCallRequest:function(){return!1},hasLocalBye:function(){return"local"===this.getLocalState("byeOriginator")},needsToReconnect:function(){return this.hasLocalBye()&&!this.isHangingUp()&&!this.isParked()&&(this.requiresInternalLeg()||this.isOnHold())&&!this.isDummy()},setOutboundCallData:function(e){this.adjustLocalState("outboundCallData",e||{},!0)},getOutboundEndpoint:function(){var e=this.getLocalState("outboundCallData");return e&&e.external_endpoint},getExternalEndpoint:function(){return this.getOutboundEndpoint()||this.get("external_endpoint")},mockParticipants:function(e){this.participants.mockParticipantsFromCall(this,e),this.trigger("mock")},_mockSupervising:function(e,t){var i=this.get("participants")||[],r=n.getContactKey(u),s=_.find(i,function(e){return n.getContactKey(e)===r&&n.isSupervising(e)});s?s.state=e:((s=n.createParticipantJson(u)).state=e,i.push(s),this.set("participants",i)),this.mockParticipants(t)},mockListeningIn:function(e){this._mockSupervising("monitor",e)},mockBarging:function(e){this._mockSupervising("barge",e)},hasParticipant:function(e){return this.participants.hasParticipant(e)},buildParticipantsList:function(){var e=this.participants.setParticipantsFromCall(this);this.adjustLocalState("participants",e)},setParticipantsList:function(e){this.participants&&this.stopListening(this.participants),this.participants=e,this.listenTo(this,"change:participants",this.buildParticipantsList),this.buildParticipantsList()},getOperatorTarget:function(){return this.get("operator_target")||this.participants.getAgent()},bargeIn:function(e){this.saveAndAdjustLocalState({participant_state:n.getStates().SUPERVISOR_BARGING},"processingBarge",e)},takeOver:function(e){this.saveAndAdjustLocalState({participant_state:n.getStates().SUPERVISOR_TAKING_OVER},"processingTakeover",e)},isSwappingOutCall:function(e){return!this.getLocalState("swapped")&&this.get("swap_call")&&this.get("swap_call").id===e.id},isOperator:function(e){return!!this.get("participants").find(function(t){return"operator"===t.participant_type&&t.contact_key===e})},swap:function(){var e=this.get("swap_call");console.log("CALL MODEL: Call (",this.id,") has a swapped_call attribute (",e.id,"). Swapping the call."),this.adjustLocalState("processingSwap",!0),this.trigger("call:swapped",e)},shouldSwap:function(){return!!this.get("swap_call")&&!this.getLocalState("swapped")&&!this.isSwapping()},isSwapping:function(){return this.getLocalState("processingSwap")},finishSwapping:function(){var e=this.get("swap_call");console.log("CALL MODEL: Call (",this.id,") finished swapping with (",e.id,")."),this.adjustLocalState("processingSwap",!1,!0),this.adjustLocalState("swapped",!0)},setPreloadError:function(e){i.hangUp(),e&&this.adjustLocalState("mediaError",!0,!0),this.adjustLocalState("preloadError",!0)},hasPreloadError:function(){return this.getLocalState("preloadError")},hasMediaError:function(){return this.getLocalState("mediaError")},wasHungUp:function(){return"hangup"===this.get("state")},getCallLegIds:function(){var e=this.getLocalState("participants"),t=[];for(var n in e)t.push(n);return t},getCallAiLegs:function(){return this.getCallLegIds().reduce(function(e,t){return[].concat(_toConsumableArray(e),_toConsumableArray(o.getForCallLeg(t)))},[])},getParticipant:function(e){return this.getLocalState("participants")[e]},_updatePreloadErrorState:function(){!this.getLocalState("preloadError")||"connected"!==i.getCallState()&&"ringing"===this.get("state")||(this.adjustLocalState("mediaError",!1,!0),this.adjustLocalState("preloadError",!1))},getEntryPointCallId:function(){var e=this.get("entry_point_call_id");if(e)return e;var t=(this.get("external_endpoint")||"").split("monitor_")[1];return t&&parseInt(t)},getRootCallId:function(){return this.getEntryPointCallId()||this.id},_onSync:function(){this._setRequesting(!1)},_onRequest:function(){this._setRequesting(!0)},_onError:function(){this._setRequesting(!1)},_setRequesting:function(e){var t=!!e;this._requesting!==t&&(this._requesting=!!t,console.log("CALL: (",this.id,")",this._requesting?"fetching":"done fetching"))},isRequesting:function(){return!!this._requesting},fetchExtendedInfoForTalkIq:function(){u.allowTalkIq()&&!this.isRequesting()&&this.fetch({merge:!0,replaceIfSameModifiedDate:!0})},bookmark:function(e){this.isBookmarking()||(this._setBookmarkState("processing"),$.ajax({type:"POST",url:d.REQUEST_URL+"callai/event",contentType:"application/json",data:JSON.stringify({call_id:this.id,type:"bookmark"})}).done(_.bind(function(){this._onBookmarkSuccess(),e&&e()},this)).fail(_.bind(function(){this._setBookmarkState(null)},this)),this._onBookmarkSuccess())},isBookmarking:function(){return"processing"==this.getLocalState("bookmarkState")},isBookmarkCompleted:function(){return"completed"==this.getLocalState("bookmarkState")},isBookmarkRefreshing:function(){return"refreshing"==this.getLocalState("bookmarkState")},setRejected:function(){if(this.isPreanswer()||this.isCallStateRinging())return this.adjustLocalState({rejected:!0,processingVoicemail:!0});console.log("CALL: not setting rejected for (",this.id,") bc call state is not preanswer or ringing")},isRejected:function(){return this.getLocalState("rejected")},isTranscribingVoicemail:function(){return this.inVoicemailState()&&!this.isSpamActionVoicemail()},isSpamActionVoicemail:function(){return"spam_voicemail"===this.get("blocked")},isSpamActionIvrScreening:function(){return"spam_ivr_screening"===this.get("blocked")},inVoicemailState:function(){return this.isVoicemail()||this.isEavesdropping()&&!(this.getLocalState("processingHangup")||"hangup"===this.get("state"))},_toggleProcessingBookmark:function(){this.adjustLocalState("bookmarkState",!this.isBookmarking())},_setBookmarkState:function(e){this.adjustLocalState("bookmarkState",e)},_onBookmarkSuccess:function(){this._bmTo=setTimeout(_.bind(function(){this._setBookmarkState("completed"),this._onBookmarkComplete()},this),1e4)},_onBookmarkComplete:function(){this._bmTo=setTimeout(_.bind(function(){this._setBookmarkState("refreshing"),this._onBookmarkRefreshing()},this),3e3)},_onBookmarkRefreshing:function(){this._bmTo=setTimeout(_.bind(function(){this._setBookmarkState(null)},this),7e3)},canHaveInternalLeg:function(){return!_.contains([g.STATES.HANGUP,g.STATES.RINGING,g.STATES.VOICEMAIL,g.STATES.QUEUED],this.get("state"))||this.isPreanswering()},_onChangeState:function(){this.adjustLocalState("preanswering",!1),_.contains([g.STATES.PREANSWER,g.STATES.RINGING,g.STATES.CONNECTING],this.get("state"))||this.adjustLocalState("connecting",!1)},isPreanswering:function(){return this.getLocalState("preanswering")},preanswer:function(){i.dtmf(1),this.set("state",g.STATE.CONNECTING),this.adjustLocalState("preanswering",!0)},setPreanswer:function(){this.adjustLocalState("isPreanswerCall",!0)},isPreanswerCall:function(){return this.getLocalState("isPreanswerCall")},randomPopup:function(){var e=this._chooseRandom(["talking_too_much","speaking_too_quickly","too_many_filler_words","not_enough_questions"]),t=this._chooseRandom(this.getCallLegIds()),n=o.getForCallLeg(t)[0].getStartDate(),i=this._generatePusherPayload(e,n);this._simulatePusherEvent("popup",i,t)},randomRecommendation:function(e){var t=new a.constructor;t.wrapper=!0,t.setTargetKey(this.get("target_key")),t.fetch({merge:!0,success:this._onFetch.bind(this,e,t,null)})},_generatePusherPayload:function(e,t){var n=Date.now()/1e3-(t||0);return[[e,n,n+1e3]]},_chooseRandom:function(e){var t=Math.floor(Math.random()*e.length);return e.isCollection?e.at(t):e[t]},_onFetch:function(e,t,n,i){var r=n||this._chooseRandom(this.getCallLegIds()),s=o.getForCallLeg(r)[0],a=s.getStartDate(),l=c.getCallLeg(r);if(l&&s){var u=_.union(t.where({orientation:l.get("orientation")}),t.where({orientation:"any"})),h=this._chooseRandom(u);t.remove(h);var d=this._generatePusherPayload(h.get("id"),a),f=null;e&&(u=_.union(t.where({orientation:l.get("orientation")}),t.where({orientation:"any"})),(f=this._chooseRandom(u))&&(d=d.concat(this._generatePusherPayload(f.get("id"),a)))),this._simulatePusherEvent("recommendations",d,r)}else(i="number"==typeof i?i:5)?(console.log("fetch retry attempt:",6-i),!l&&console.log("call leg was missing"),!s&&console.log("callai leg was missing"),setTimeout(this._onFetch.bind(this,e,t,r,i-1),500)):console.log("gave up retrying after 6 attempts")},_simulatePusherEvent:function(e,t,n){var i=o.getForCallLeg(n)[0],r=c.getCallLeg(n),s={call_id:n,entry_point_callId:this.getEntryPointCallId(),orientation:r.get("orientation"),parent_call_id:this.get("id"),payload:t,tag:r.get("orientation")+"|"+this.getEntryPointCallId()+"|"+this.get("target_key"),voiceai_id:i.get("id")};l.trigger("talkiq",s,e)},_filterFunction:function(e,t){var n="remove:filtered"===t,i="add:filtered"===t;return e.getTargetKey()===this.get("target_key")||n||i},isRootCall:function(){return!(!this.get("target")||!new h(this.get("target")).isGroup()||!this.get("date_rang")&&!this.isOutbound())},canRecordScreen:function(){return this.id&&"dummy"!==this.id&&this.get("should_record_screen")},getTranslatedDetailedStatus:function(){return g.getTranslatedDetailedStatuses()[this.get("detailed_state")]},isAutodialCall:function(e){var t=this.getLocalState("outboundCallData")||{};return(this.get("autodialSessionCallId")||t.autodialSessionCallId)===e},setAutodialCountdown:function(e){this.adjustLocalState("autodialCountdown",e)},getAutodialCountdown:function(){return this.getLocalState("autodialCountdown")},setPowerdialNotes:function(e){this.adjustLocalState("powerDialNotes",!!e)},hasPowerdialNotes:function(e){return!!this.getLocalState("powerDialNotes")}},{STATES:{CALLING:"calling",CONNECTED:"connected",CONNECTING:"connecting",EAVESDROP:"eavesdrop",HANGUP:"hangup",HOLD:"hold",MERGED:"merged",PREANSWER:"preanswer",RINGING:"ringing",VOICEMAIL:"voicemail",QUEUED:"queued"},createParticipant:function(e,t){return n.createParticipantJson.apply(n,arguments)},createParticipantsDict:function(e){return n.getParticipantsDict(e)},getTranslatedDetailedStatuses:function(){return{active:p.get("Active"),canceled:p.get("Canceled"),deleted:p.get("Deleted"),hung_up:p.get("Abandoned"),inbound:p.get("Inbound"),missed:p.get("Missed"),missed_voicemail:p.get("Missed & Voicemail"),outbound:p.get("Outbound"),parked:p.get("Parked"),self:p.get("Self"),transferred:p.get("Transferred"),transferred_to:p.get("Transferred To"),voicemail:p.get("Voicemail")}}});return g}),define("collections/call_history",["collections/common/cursor_collection","config","fslib/singleton","models/call"],function(e,t,n,i){var r=e.extend({model:i,url:t.REQUEST_URL+"call",hasHungUpCall:function(e){var t=this.get(e.id||e);return t&&t.wasHungUp()}});return n.create(r,"callHistory")}),define("collections/call_list",["config","models/call","models/current_user","collections/contact_list","collections/common/cursor_collection"],function(e,t,n,i,r){var s={};return r.extend({model:t,STATE_ENUM:{preanswer:1,ringing:2,calling:3,connecting:3,connected:4,hold:4,merged:4,eavesdrop:4,voicemail:5,hangup:6},initialize:function(){r.prototype.initialize.call(this),this._buildUrl(),this.listenTo(this,"add",this._onParticipantsChanged),this.listenTo(this,"change:local:participants",this._onParticipantsChanged)},setTarget:function(e){this._targetKey=e&&e.get?e.get("key"):e,this._buildUrl()},setFilter:function(e){this._filter=e,this._buildUrl()},setCoachable:function(){this._coachable=!0,this._buildUrl()},isForTarget:function(e){var t=e&&e.get?e.get("key"):e;return this._targetKey===t},_addListeners:function(){this.listenTo(this,"add",this._onAdd),this.listenTo(this,"remove",this._onRemove),this.listenTo(this,"change",this._onChange),this.listenTo(this,"sync",this._onSync),this.listenTo(this,"request",this._onRequest),this.listenTo(this,"error",this._onError)},_buildUrl:function(){var t=e.REQUEST_URL;this._coachable?t+="coachablecalls/":(t+="activecalls/"+(this._targetKey||"me"),this._filter&&(t+="/"+this._filter));this.url=t},_getTargetKey:function(){return this._targetKey||n.get("key")},validateCall:function(e){var t=this.get(e.id);if(t){var n=this.STATE_ENUM[t.get("state")],i=this.STATE_ENUM[e.state];if(i&&i<n)return console.log("Overriding update for call "+e.id+" due to newer state."),console.log("Fetched call has state "+e.state+" but client has "+t.get("state")+"."),t.attributes}return e},parse:function(e,t){var n=[],i=r.prototype.parse.call(this,e,t);return _.each(i,_.bind(function(e){var t=this.validateCall(e);t&&n.push(t)},this)),n},callForEndpoint:function(e,t){return this.findWhere({external_endpoint:e,target_key:t||this._getTargetKey()})},callForContact:function(e,t){return this.findWhere({contact_key:e,target_key:t||this._getTargetKey()})},getCallingState:function(){return t.STATES.CALLING},refetch:function(e){this._clearRefetchTo();var t=e||this.REFETCH_DELAY,n=Date.now();this._refetchTo=setTimeout(_.bind(function(){console.info("CALL LIST: (",this._targetKey||"Active Calls",") refetching:",Date.now()-n),this.fetch({merge:!0,remove:!0})},this),t)},_clearRefetchTo:function(){clearTimeout(this._refetchTo)},_onAdd:function(){},_onSync:function(){this._setRequesting(!1)},_onRequest:function(){this._setRequesting(!0)},_onError:function(){this._setRequesting(!1)},_setRequesting:function(e){var t=!!e;this._requesting!==t&&(this._requesting=!!t,console.log("CALL LIST: (",this._targetKey||"Active Calls",")",this._requesting?"fetching":"done fetching"))},isRequesting:function(){return!!this._requesting},_onParticipantsChanged:function(e){var t=e.getLocalState("participants");for(var n in t)this._storeParticipantInfo(t[n],e)},_storeParticipantInfo:function(e,t){if(t.get("id")===t.getRootCallId()){var n={id:(e=JSON.parse(JSON.stringify(e))).contact_key,key:e.contact_key,contact_key:e.contact_key,display_name:e.display_name,image_url:e.image_url};i.add(n,{merge:!0}),e.entry_point_call_id=t.getEntryPointCallId()||t.id,e.call_contact_key=t.get("contact_key"),e.call_target_key=t.get("target_key"),s[e.call_leg_id]=e}}},{getCallParticipantInfo:function(e){var t=e&&(e.id||e);return s[t]}})}),define("collections/active_calls",["config","fslib/singleton","fslib/webrtc","objects/webrtc_monitor","models/session","collections/affinity_list","collections/call_history","collections/group_list","collections/call_list"],function(e,t,n,i,r,s,o,a,c){var l=c.extend({REFETCH_DELAY:5e3,LOCAL_STATE:{voicemail_ids:null},initialize:function(){c.prototype.initialize.call(this),this.wrapper||this._addListeners()},parse:function(e,t){var n=this,i=c.prototype.parse.apply(this,arguments);return this._dummy&&!this._callInValidatedResults(this._dummy,i)&&i.push(this._dummy),this.getTranscribingVoicemailCalls().forEach(function(e){!n._callInValidatedResults(e,i)&&i.push(e)}),i},_callInValidatedResults:function(e,t){var n=e.attributes||e||{};return!!_.findWhere(t,{contact_key:n.contact_key,target_key:n.target_key})},_addListeners:function(){c.prototype._addListeners.apply(this,arguments),this.listenTo(n,"onCallState",this._onWebrtcCallStateChanged),this.listenTo(n,"callEnded",this._onWebrtcCallEnded),this.listenTo(n,"socket",this._updateWebrtcCanReceiveNotifies),this.listenTo(n,"unregistered",this._updateWebrtcCanReceiveNotifies),this.listenTo(n,"registered",this._updateWebrtcCanReceiveNotifies),this.listenTo(i,"stream:remote:changed",this._onWebrtcRemoteStreamChanged),this.listenTo(this,"change:local:preloadError",this._onChange),this._checkProgress(),this._updateWebrtcCanReceiveNotifies()},_onAdd:function(e){this._maybeRemoveDummy.apply(this,arguments),this._checkProgress(),this._maybeRefetch(),this._maybeFinishSwappingCall(e),this._updateCallStatsForCall(e),this._updateVoicemailIds(e),a.subscribeToTalkIq(e.get("target_key")).then(Function.prototype).catch(Function.prototype)},_onRemove:function(e){this._maybeRemoveUserSelectedPhone.apply(this,arguments),this._checkProgress(),this.maybeSwapCall(e),this._updateVoicemailIds(e,!0)},_onChange:function(e){this._checkProgress(),this._maybeRefetch(),this._updateCallStatsForCall(e),this._updateVoicemailIds(e)},_onSync:function(){this._maybeRemoveStaleCalls(),this._maybeRefetch(),c.prototype._onSync.apply(this,arguments),this.each(this._updateVoicemailIds)},maybeSwapCall:function(e){e.shouldSwap()&&(e.swap(),this._maybeFinishSwappingCall(this.get(e.get("swap_call").id)))},_maybeFinishSwappingCall:function(e){var t=this.getAssociatedCall(e);t&&this.trigger("call:swapped:finished",t)},_maybeRefetch:function(e){this._shouldRefetch()?this.refetch(e):this._clearRefetchTo()},_shouldRefetch:function(){var e=this.getCallsThatAreConnectedToClient()||[],t=this.getCallThatHasNotConnectedYet(),n=this.getTransferringCall(),i=(t&&t.isDummy()&&1===this.length&&this._hasAudioStream,e.length>1),r=t&&!this._canReceiveNotifies,s=n&&!this._canReceiveNotifies;return!!this.getCallThatHasNotConnectedYet()||i||r||s},_onWebrtcRemoteStreamChanged:function(e){var t=this.getCallThatHasNotConnectedYet();this._hasAudioStream=e.isAudioStarted(),this._hasAudioStream&&t&&this._maybeRefetch(t&&!t.isCalling()&&1e3)},_onWebrtcCallStateChanged:function(e){switch(e){case"connected":this._setByeOriginator(null);break;case"ready":this._maybeRemoveDummy()}this._checkProgress()},_updateWebrtcCanReceiveNotifies:function(){this._canReceiveNotifies=n.isRegistered()&&n.isSocketConnected()},_checkProgress:function(){var e=this.inProgress();e!==this._currentProgressState&&this.trigger("progress:change"),this._currentProgressState=e},_onWebrtcCallEnded:function(e){this._setByeOriginator(e)},_setByeOriginator:function(e){this.each(function(t){t.adjustLocalState("byeOriginator",e)})},getActiveCall:function(){return this.getStateConnectedCall()||this.getStateMergedCall()},getStateConnectedCall:function(){return this.find(function(e){return e.isStateConnected()})},getStateMergedCall:function(){return this.find(function(e){return e.isMerged()})},getByRootCallId:function(e){return this.find(function(t){return t.getRootCallId()===e})},getAllActiveCalls:function(){return this.filter(function(e){return e.isConnectedToContact()})},getViewableCall:function(){return this.find(function(e){return e.isInViewableState()})},hasConnectedCall:function(){return!!this.find(function(e){return e.isConnected()})},hasIncomingCall:function(){return this.find(function(e){return e.isRinging()})},hasDummyCall:function(){return this.find(function(e){return e.isDummy()&&e})},isCallingOut:function(){return this.find(function(e){return e.isCalling()&&e})},getCallConnectedToClient:function(){return this.find(function(e){return e.isConnectedToClient()})},getCallFullyConnectedToClient:function(){return this.find(function(e){return e.isFullyConnectedToClient()})},hasParkedCall:function(){return!!this.find(function(e){return e.isParked()})},isConnecting:function(){return this.find(function(e){return e.isConnecting()||e.isCalling()})},getRingingCall:function(){return this.find(function(e){return e.isRinging()})},getRingingStateCall:function(){return this.find(function(e){return e.isCallStateRinging()})},inProgress:function(){return this.isConnecting()||!(!this.getRingingCall()||n.isPreloading())},getLastHeldCall:function(){return this.findWhere({state:"hold"})},getTransferringCall:function(){return this.find(function(e){return e.inTransferringState()})},getCallThatHasNotConnectedYet:function(){return this.find(function(e){return e.hasNotConnectedYet()})},getCallsThatAreConnectedToClient:function(){return this.filter(function(e){return e.isStateConnectedToClient()})},getTranscribingVoicemailCalls:function(){return this.filter(function(e){return e.isTranscribingVoicemail()})},getAssociatedCall:function(e){if(e)return this.find(function(t){return t.isSwappingOutCall(e)})},hasInternalLeg:function(){return!!this.filter(function(e){return e.canHaveInternalLeg()}).length},canMerge:function(){return this.filter(function(e){return e.canHaveInternalLeg()}).length>1},_setDummy:function(e){console.log("set dummy for call:",JSON.stringify(e.attributes)),e.set("id","dummy"),e.save=function(){},e.sync=function(){}},generateDummy:function(t){if(!this.callForContact(t.contact_key,t.target_key)){t=_.extend({direction:"outbound"},t);var n=new this.model(t);t.fast_call?(console.warn("FAST CALL"),n.xhr=n.save(t,{wait:!1,error:_.bind(function(){console.warn("Converting failed fast_dial to dummy"),this._setDummy(n)},this),success:_.bind(function(e,t){console.info("fast call response: "+JSON.stringify(t)),this.trigger("fastCall",n)},this)})):this._setDummy(n),this._dummy=n,e.isRemote&&(this.dummyNoWebRtc=!0),this.add(this._dummy)}},_maybeRemoveDummy:function(){var e=this.hasDummyCall();"ready"===n.getCallState()||e&&"hangup"===e.get("state")?this._removeDummy(e):this._maybeSwapOutDummy(e)},_maybeSwapOutDummy:function(e){e=e||this._dummy;var t=this._getCallForDummy(e);t&&this._swapDummyWithCall(e,t)},_getCallForDummy:function(e){var t=e||this.hasDummyCall();if(t)return this.filter(function(e){var n=t.getExternalEndpoint()==e.getExternalEndpoint(),i=t.get("contact_key")===e.get("contact_key");return!e.isDummy()&&(n||i)})[0]},_swapDummyWithCall:function(e,t){var n=e.toJSON(),i=_.extend({},n,t.toJSON());t.set(i),t.setOutboundCallData(n),t.setParticipantsList(e.participants),this._removeDummy(e,t)},_removeDummy:function(e,t){var n=e||this.hasDummyCall();if(this._dummy=null,n)if(t){var i=n.get("target_key")!==t.get("target_key");this.remove(n,{silent:!i}),this.trigger("dummyRemoved",t)}else n.hangUp(null,null,"remove dummy race")},_maybeRemoveStaleCalls:function(){this.each(this._maybeRemoveStaleCall)},_maybeRemoveStaleCall:function(e){e.isDummy()||o.hasHungUpCall(e)&&(console.warn("ACTIVE CALLS: Call added to active calls that was previously hung up (",e.id,"). Removing it."),this.remove(e))},_maybeRemoveUserSelectedPhone:function(e){if(!e.isDummy()){var t=s.getContactAffinity(e.get("contact_key"),e.get("target_key"));t&&delete t.userSelectedPhone}},onCallWithEndpoint:function(e,t){return this.find(function(n){return n.isEndpoint(e,t)})},_updateCallStatsForCall:function(e){e.isDummy()||i.updateCallStatsWithCall(e)},_updateVoicemailIds:function(e,t){var n=this.getLocalState("voicemail_ids")||{},i=!1,r=e.inVoicemailState();!n[e.id]||r&&!t||(delete n[e.id],i=!0),r&&(n[e.id]=1,i=!0),i&&this.adjustLocalState({voicemail_ids:n},{silent:!0})},canRecordScreen:function(){return!!this.find(function(e){return e.canRecordScreen()})}});return t.create(l,"activeCalls")}),define("objects/common/ipc_manager",["backbone","config","fslib/fsutil","fslib/object","fslib/singleton"],function(e,t,n,i,r){var s,o;return i.extend({start:function(n){var i=n||{};s=i.currentUser,o=i.session,this.started=!0,this.remoteMode=!1,this.ipc=_electron.ipcRenderer,console.log("Ipc Manager started: "+t.appVersion),t.isNative&&(this.listenTo(e,"lang",this._changeLanguage),"notification"!=window.name&&"mini"!=window.name&&(this.listenTo(s,"change",this._currentUserChange),this.listenToOnce(o,"login",this._loggedIn)),this._changeLanguage(s.getLanguage()),this._ping())},login:function(e,t){this.started&&this.ipc.send("oauth",e,t)},_loggedIn:function(){this.ipc.send("loggedin",s.get("user_id")),n.isMacOSX()&&(_electron.crashReporter.setExtraParameter?_electron.crashReporter.setExtraParameter("userId",""+s.get("user_id")):_electron.crashReporter.addExtraParameter&&_electron.crashReporter.addExtraParameter("userId",""+s.get("user_id")))},badge:function(e){this.started&&this.ipc.send("badge",e)},navigate:function(e,t,n){if(this.started){this.ipc.send("navigate",e,t,n)}},toggleVisibility:function(e,t,n){if(this.started){if(console.log("Toggling Visibility: "+e+", "+t),this.remoteMode&&"single"==e)return void console.log("Ignoring Toggle Visiblity in remote mode.");this.ipc.send("toggle_visibility",e,t,n)}},resize:function(e,t,n){this.started&&this.ipc.send("resize",e,t,n)},reposition:function(e,t,n){this.started&&this.ipc.send("reposition",e,t,n)},restart:function(e){this.ipc.send("restart",e)},logout:function(e){this.ipc.send("logout",e)},checkForUpdate:function(){this.started&&this.ipc.send("check_for_update")},quit:function(e){this.ipc.send("quit",e)},log:function(e){this.ipc.send("log",e)},sendErrorReport:function(){this.ipc.send("send_error_report")},closeWindow:function(e,t){this.started&&this.ipc.send("close_window",e,t)},_currentUserChange:function(){this.ipc.send("current_user",s.toJSON())},_updateCurrentUser:function(e){s.set(e)},_changeLanguage:function(e){this.ipc.send("lang",e)},_ping:function(){console.info("sending ping"),this.ipc.send("ack")}})}),define("models/feed_item",["collections/affinity_list","collections/call_history","models/current_user","collections/group_list","models/session","models/base","config"],function(e,t,n,i,r,s,o){var a=0,c=s.extend({idAttribute:"feed_key",urlRoot:o.REQUEST_URL+"feed",LOCAL_STATE:{oldFeedDate:null,newFeedDate:null,voiceAiDeleted:!1,callSnapshotOpen:!1,fetching:!1,pending:!1,error:!1},initialize:function(e){s.prototype.initialize.call(this),this.error=e.error||!1,this.listenTo(this,"change:feed_date",this._onDateChange),this.listenTo(this,"sync",this._onSync),this.listenTo(this,"request",this._onRequest),this.listenTo(this,"error",this._onError)},parse:function(e,t){e.mms_url&&!e.thumb_url&&(e.thumb_url=e.mms_url);var n=this.attributes.feed_date;return n&&n!==e.feed_date&&(this.adjustLocalState("newFeedDate",e.feed_date),this.adjustLocalState("oldFeedDate",n),e.feed_date=n),this._maybeAddCallToHistory(e),s.prototype.parse.call(this,e,t)},hasError:function(){return this.error||!!this.getLocalState("error")},isTextMessage:function(){return"TextMessage"===this.get("feed_type")},isVoicemail:function(){return"Call"===this.get("feed_type")&&this.get("recording")},isCall:function(){return"Call"===this.get("feed_type")},isVideo:function(){return"Video"===this.get("feed_type")},isUnread:function(){return _.contains(this.get("feed_tags"),"unread")},isDirectVoicemail:function(){return _.contains(this.get("feed_tags"),"direct_vm")},isAbandonedInboundCall:function(){return"incoming"===this.get("category")&&_.contains(this.get("feed_tags"),"abandoned")},isMms:function(){return this.get("mms_url")},isMmsVideo:function(){return this.get("mms_details")?"video"===this.get("mms_details").type:!!this.get("previewUrl")&&"video"===this.get("mmsPreviewOptions").mmsType},isSending:function(){if(!this.isTextMessage())return!1;this.get("contact");var t=e.getContactAffinity(this.get("contact_key"),this.get("feed_target")),n=this.isChannelMessage()||t&&t.isDialpad();return this.isPending()&&(!n||!!this.get("previewUrl"))},isPending:function(){return!(!this.isTextMessage()||!this.getLocalState("pending"))},isFlagged:function(){var e=_.contains(this.get("feed_tags"),"flag"),t=this.getLocalState("processing:flag");return e||t},_maybeAddCallToHistory:function(e){if("Call"===e.feed_type){t.add(e,{merge:!0,parse:!0});var n=e.id,i="feed:"+n;t.get(n).addLocalSource(i)}},_isCurrentUserItem:function(){return this.get("target_key")===n.get("key")},getSourceKey:function(){return"TextMessage"==this.get("feed_type")?this.get("sender_key"):null},markAsRead:function(){var e=_.clone(this.get("feed_tags"));e=_.without(e,"unread"),this.set("feed_tags",e)},applyAction:function(e,t){var n="processing:"+e;this.getLocalState(n)||this.saveAndAdjustLocalState({action:e},n,t,!0)},isFilteredBy:function(e){var t=this.get("feed_tags");switch(e){case"unread":return _.contains(t,"unread");case"calls":return _.contains(t,"call");case"placed":return _.contains(t,"call")&&_.contains(t,"outbound");case"received":return _.contains(t,"call")&&_.contains(t,"inbound")&&_.contains(t,"connected");case"missed":return _.contains(t,"call")&&_.contains(t,"missed");case"voicemails":return _.contains(t,"call")&&_.contains(t,"voicemail");case"messages":return _.contains(t,"message");case"recordings":return _.contains(t,"recording");case"same_target":return _.contains(t,"same_target");case"flagged":return this.isFlagged();case"spam":return _.contains(t,"spam")}return!0},_onDateChange:function(){var e=this.getLocalState("oldFeedDate");e&&this.set("feed_date",e)},_onSync:function(){this.adjustLocalState("error",!1,!0),this._setFetching(!1)},_onError:function(e,t){this.adjustLocalState("error",!0,!0),this._setFetching(!1)},_onRequest:function(){this._setFetching(!0)},_setFetching:function(e){this.adjustLocalState("fetching",e)},isFetching:function(){return this.getLocalState("fetching")},displayDate:function(){var e=this.getLocalState("newFeedDate");return this.get("mms")&&e?e:this.get("feed_date")},adjustReceivedFeedDate:function(e){var t=e||c.getNextReceivedTime();this.adjustLocalState("newFeedDate",this.attributes.feed_date),this.adjustLocalState("oldFeedDate",t),this.attributes.feed_date=t},isChannelMessage:function(){var e=this.get("contact");return this.isPending()&&!e?this.get("target_key")===this.get("contact_key"):e&&"channel"===e.type},getOrientation:function(){return this.isChannelMessage()&&this.get("sender_key")!=n.id?"external":this.get("orientation")},getReceivedDate:function(){return"internal"!==this.get("orientation")&&this.getLocalState("oldFeedDate")?this.getLocalState("oldFeedDate"):null},hasTranscription:function(){var e=this.get("recording");return e&&!!$.trim(e.transcription_text||"")},hasEmbed:function(){return!!_.find(this.get("rich_media"),function(e){return"youtube"===e.type||"vimeo"===e.type})},getMmsSrc:function(){if(this.isMms()){var e=this.get("previewThumb"),t=this.get("previewUrl"),n=this.get("mms_url");return e?n=e:t&&"preview"!==t&&(n=t),n}},hasVoiceAi:function(){if(!this.isCall()||!n.allowTalkIq()||this.isAbandonedInboundCall())return!1;var e=_.contains(["incoming","outgoing","voicemail"],this.get("category"))&&this.get("has_summary");_.contains(["active"],this.get("category"))&&this.get("has_callai");return!this.getLocalState("voiceAiDeleted")&&e},processingDeleteVoiceAi:function(){return this.getLocalState("processing:deleteVoiceAi")},deleteVoiceAi:function(e){!this.processingDeleteVoiceAi()&&this.hasVoiceAi()&&(this.applyAction("delete_callai",e),this.adjustLocalState("voiceAiDeleted",!0))},getRootCallId:function(){if(this.isCall())return this.get("entry_point_call_id")||this.get("id")},forward:function(e,t,n,i){$.ajax({type:"POST",contentType:"application/json",url:o.domain+"/api/feed/"+this.get("feed_key")+"/forward",data:JSON.stringify({emails:e,message:t}),success:n,error:i})}},{getNextReceivedTime:function(){var e=r.getServerTime();return e<a&&(e=a+1),a=e,e}});return c}),define("collections/unread_target_feed_list",["collections/common/cursor_collection","config","fslib/singleton","models/feed_item","models/current_user"],function(e,t,n,i,r){return e.extend({model:i,url:function(){return t.REQUEST_URL+"feed/?filter=unread&target_key="+this.targetKey},initialize:function(t){this.targetKey=t.targetKey||r.get("key"),this.listenTo(this,"add",this.incrementCount),this.listenTo(this,"remove",this.decrementCount),e.prototype.initialize.call(this)},fetchCount:function(){var e=this;return new Promise(function(t,n){var i=e.url();i+="&count=1",$.ajax({url:i,success:_.bind(function(e,n,i){var r=parseInt(e);(r||0==r)&&(this.count=r),this.trigger("count:sync"),t()},e)}).catch(n)})},comparator:function(e){return-e.get("feed_date")},add:function(t,n){n=n||{};var i=[];if(t=!_.isArray(t)?t?[t]:[]:t,_.each(t,_.bind(function(e){(e.attributes||e).feed_target==this.targetKey&&i.push(e)},this)),i.length>0)return e.prototype.add.call(this,i,n)},_getMoreUnread:function(e){e.next()},numMissedByType:function(){var e={};return e.texts=_.size(this.filter(function(e){return e.isTextMessage()})),e.voicemails=_.size(this.filter(function(e){return e.isVoicemail()})),e.calls=_.size(this.filter(function(e){return e.isCall()})),e},incrementCount:function(){this.count=(this.count||0)+1,this.trigger("count:change")},decrementCount:function(){var e=(this.count||0)-1;this.count=Math.max(0,e),this.trigger("count:change")}})}),define("collections/unread_feed_list",["collections/common/cursor_collection","config","fslib/singleton","models/feed_item","models/current_user","models/session","collections/unread_target_feed_list"],function(e,t,n,i,r,s,o){var a=e.extend({model:i,url:t.REQUEST_URL+"feed/?filter=unread",start:function(){this.started||(this.started=!0,s.getLocal("target"),this.collections={},this.targetKeys=[r.get("key")].concat(_.pluck(r.get("operator_groups"),"id")),_.each(this.targetKeys,_.bind(function(e){var t=new o({targetKey:e});this.collections[e]=t},this)),this.wrapper||this._addListeners())},_addListeners:function(){_.each(this.targetKeys,_.bind(function(e){var t=this.collections[e];this.listenTo(t,"sync",this.triggerSync),this.listenTo(t,"change",this.triggerChange),this.listenTo(t,"add",this.triggerAdd),this.listenTo(t,"remove",this.triggerRemove),this.listenTo(t,"count:sync",this.triggerCount),this.listenTo(t,"count:change",this.triggerCount)},this)),this.listenTo(Backbone,"affinity:destroyed",this.markAsRead)},fetch:function(e){var t=[];_.each(this.collections,function(e){t.push(e.fetchCount())});var n=s.getLocal("target"),i=this.getCollection(n);i&&t.push(new Promise(function(e,t){i.fetch({success:e,error:t,reset:!0,wait:!0})}));var r=e||{};Promise.all(t).then(function(){r.success&&r.success()}).catch(function(){r.error&&r.error()})},add:function(e,t){_.each(this.collections,function(n){n.add(e,t)})},remove:function(e,t){_.each(this.collections,function(n){n.remove(e,t)})},getCollection:function(e){return this.collections?(e=e||r.get("key"),this.collections[e]):null},missedFeedForTarget:function(e,t){var n=this.getCollection(e);return this.missedFeedForCollection(n,t)},missedFeedForCollection:function(e,t){return e?t?e.length:e.count||0:0},numMissedForContact:function(e,n){console.log("This shouldnt be used anymore for single window. If this is in logs we should revisit why."),n=n||r.get("key");var i=this.getCollection(n),s=0;return i&&_.each(i.models,function(n){n.get("contact_key")==e&&(s++,t.isSingle||n.get("recording_id")&&s++)}),s},markAsRead:function(e,t){var n=this.getCollection(t),i=[];return n&&(i=n.where({contact_key:e}),n.remove(i),n.fetchCount()),i},triggerSync:function(e){this.trigger("sync",e)},triggerAdd:function(e){this.trigger("add",e)},triggerRemove:function(e){this.trigger("remove",e)},triggerChange:function(e){this.trigger("change",e)},triggerCount:function(){this.trigger("count:change")}});return n.create(a,"unreadFeedList")}),define("utils/latency_tracking_util",["require","../fslib/server_time"],function(require){var e=require("../fslib/server_time"),t={voiceAiSocket:{},voiceAiModel:{}};function n(t,n,i,r){var s=i.send_time,o=i.key,a=Object.assign({},i);delete a.send_time,delete a.key;var c=e.getServerTime(),l=c-s;if(!(n[o]&&l<r)){var u=Object.assign({},a,{send_time:s,receive_time:c,latency:l}),h=Object.keys(u).map(function(e){return"("+e+"="+u[e]+")"});console.info.apply(console,["AELOG:",t].concat(h)),n[o]=!0}}var i=5e3;function r(e){var t=e.stream_name,n=e.call_id;return{key:t+":"+n,send_time:1e3*e.send_time,stream:t,call_leg_id:n,call_id:e.parent_call_id,callai_leg_id:e.voiceai_id,send_uuid:e.send_uuid}}return{logVoiceAiModelLatency:function(e){var s=r(e.original_socket_message);n("voice_ai_model_latency",t.voiceAiModel,s,i)},logVoiceAiSocketLatency:function(e){var s=r(e);n("voice_ai_socket_latency",t.voiceAiSocket,s,i)}}}),define("text!json/talkiq_emoji.json",[],function(){return'{\n  "[noise]": "",\n  "[dp_filler]": "",\n  "[laughter]": "😀😀😀",\n  "poop": "💩",\n  "shit": "💩",\n  "bullshit": "🐄💩",\n  "dance": "💃🕺",\n  "clown": "🤡",\n  "pissed": "😾",\n  "troll": "👹",\n  "voiceai": "🗣🤖",\n  "kwanzaa": "🕯",\n  "hanukkah": "🕎",\n  "chanukah": "🕎",\n  "christmas": "🎄",\n  "santa": "🎅"\n}'}),define("models/talk_iq",["require","config","models/feed_item","models/current_user","models/session","text!json/talkiq_emoji.json"],function(require){var e=require("config"),t=require("models/feed_item"),n=require("models/current_user"),i=require("models/session"),r=require("text!json/talkiq_emoji.json");"object"!==(void 0===r?"undefined":_typeof(r))&&(r=JSON.parse(r));var s=new Date("Dec 1, 2017"),o=/[\w|\[|\]]+/gi;return t.extend({idAttribute:"talkIqId",FEED_TYPE:{POPUP:"CallPopup",TRANSCRIPTION:"CallTranscription",SENTIMENT:"CallSentiment",MOMENT:"CallMoment",RECOMMENDATION:"CallRecommendation"},urlRoot:e.REQUEST_URL+"callai/event",LOCAL_STATE:_.extend({originalSocketMessage:null,parsedPayload:null,endTime:null,related:[]},t.prototype.LOCAL_STATE),parse:function(e,n){return!_.isEmpty(this.attributes)&&this.isFinal()?(console.warn("TALKIQ Model: received update after final received. Ignoring update."),this.attributes):(e.payload="string"!=typeof e.payload?e.payload:JSON.parse(e.payload),e.delta_start=e.delta_start||this.generateDeltaStart(e),e.delta_end=e.delta_end||this.generateDeltaEnd(e),e.date_created=e.date_created||this.generateDateCreated(e),e.talkIqId=this.getGeneratedId(e),e.payload_index=e.payload_index||0,e.confidence=e.confidence||this.generateConfidence(e),this.isTranscription(e)&&(e.text=e.text||this.generateText(e),e.splitParent&&this.adjustLocalState("splitParent",e.splitParent)),this.isSentiment(e)&&(e.sentiment=e.sentiment||this.generateSentiment(e)),this.isMoment(e)&&(e.moment=e.moment||this.generateMoment(e)),this.isPopup(e)&&(e.popup=e.popup||this.generateMoment(e)),this.isRecommendation(e)&&(e.battle_card_id=e.battle_card_id||this.generateMoment(e)),e.original_socket_message&&this.adjustLocalState("originalSocketMessage",e.original_socket_message,{silent:!0}),t.prototype.parse.call(this,e,n))},isForSummary:function(){return!1},getGeneratedId:function(e){var t=[this.FEED_TYPE.TRANSCRIPTION,this.FEED_TYPE.SENTIMENT,this.FEED_TYPE.MOMENT,this.FEED_TYPE.RECOMMENDATION],n=e||this.attributes||{};return(n.entry_point_call_id||n.call_id)+"_"+(n.date_created-s)+"_"+("internal"===n.orientation?"1":"0")+"_"+t.indexOf(n.feed_type)+"_"+(n.payload_index||0)+"_"+n.call_leg_id},_getMatchingIdForType:function(e,t){var n={call_id:this.get("call_id"),entry_point_call_id:this.get("entry_point_call_id"),date_created:this.get("date_created"),orientation:this.get("orientation"),call_leg_id:this.get("call_leg_id"),payload_index:t||0,feed_type:e};return this.getGeneratedId(n)},getCallId:function(){return this.get("entry_point_call_id")||this.get("call_id")},getMatchingSentimentId:function(){return this.isSentiment()?this.id:this._getMatchingIdForType(this.FEED_TYPE.SENTIMENT)},getMatchingTranscriptionId:function(){return this.isTranscription()?this.id:this._getMatchingIdForType(this.FEED_TYPE.TRANSCRIPTION)},getTimeSpan:function(){return{start:this.getStartTime(),end:this.getEndTime()}},overlaps:function(e){var t=e.getTimeSpan(),n=this.getTimeSpan(),i=t.start<=n.end&&t.start>=n.start,r=t.end>=n.start&&t.end<=n.end,s=t.start<=n.start&&t.end>=n.end;return i||r||s},isTextMessage:function(){return this.isTranscription()},getWord:function(e){return(e[0]||"").replace(o,this._maybeReplaceWordWithEmoji)},_maybeReplaceWordWithEmoji:function(e){var t=e.toLowerCase();if(!r.hasOwnProperty(t))return e;var n=r[t];return n?"["===e[0]?n:e+" "+n:""},isFinal:function(){return!!this.isTranscription()&&(!this.attributes.hasOwnProperty("final")||this.get("final"))},_parsePayload:function(e){for(var t,n=(e||this.attributes||{}).payload||[this._createTranscriptionObject()],i=[],r=e||{},s=this.getDeltaStart()||r.delta_start||n[0][1]||-1,o=this.getDeltaEnd()||r.delta_end||n[n.length-1][2]||1e5,a=0;a<n.length;a++)n[a][1]>=s&&n[a][2]<=o&&(t=this.getWord(n[a]))&&i.push([t].concat(n[a].slice(1)));return i},generateText:function(e){var t=this._parsePayload(e);return _.reduce(t,function(e,t){return e&&(e+=" "),e+=t[0]},"")},generateSentiment:function(e){var t=(e||this.attributes||{}).payload||[];return _.reduce(t,function(e,t){return e+t[0]},0)/(t.length||1)},generateMoment:function(e){return((e||this.attributes||{}).payload||[])[0][0]},generateDeltaStart:function(e){return((e||this.attributes||{}).payload||[[0,0]])[0][1]},generateDeltaEnd:function(e){var t=(e||this.attributes||{}).payload||[[0,0]];return t[t.length-1][2]},generateDateCreated:function(e){var t=e||this.attributes||{};return(t.start_time_ms||t.start_time)+1e3*t.delta_start},generateConfidence:function(e){var t=((e||this.attributes||{}).payload||[])[0];return t&&t.length>3?parseFloat(t[3]):1},getSourceKey:function(){return this.get("sender_key")},getFeedType:function(e){return(e||this.attributes||{}).feed_type},isTranscription:function(e){return this.getFeedType(e)===this.FEED_TYPE.TRANSCRIPTION},isSentiment:function(e){return this.getFeedType(e)===this.FEED_TYPE.SENTIMENT},isMoment:function(e){return this.getFeedType(e)===this.FEED_TYPE.MOMENT},isPopup:function(e){return this.getFeedType(e)===this.FEED_TYPE.POPUP},isRecommendation:function(e){return this.getFeedType(e)===this.FEED_TYPE.RECOMMENDATION},isSentimentMoment:function(e){if(!this.isMoment())return!1;var t=(e||this.attributes).moment;return this.isMoment()&&("positive_sentiment"===t||"negative_sentiment"===t||"manager_intervention"===t)},isSentimentForContact:function(e){return this.isManagerIntervention()||this.isSentimentMoment()&&this.isForContact(e)},getOpposingSentimentMomentId:function(){if(this.isSentimentMoment()){var e=0===this.get("payload_index")?1:0;return this._getMatchingIdForType(this.FEED_TYPE.MOMENT,e)}},getAssociatedSentimentIds:function(){if(this.isSentimentMoment()){for(var e=this.get("payload_index"),t=[],n=0;n<3;n++)n!==e&&t.push(this._getMatchingIdForType(this.FEED_TYPE.MOMENT,n));return t}},isPositiveSentiment:function(e){var t=(e||this.attributes).moment;return this.isSentimentMoment(e)&&"positive_sentiment"===t},isNegativeSentiment:function(e){var t=(e||this.attributes).moment;return this.isSentimentMoment(e)&&"negative_sentiment"===t},isManagerIntervention:function(e){var t=(e||this.attributes).moment;return this.isSentimentMoment(e)&&"manager_intervention"===t},getMomentCategory:function(){var e=this.getMomentText();if(e){var t="neutral";switch(e){case"positive_sentiment":t="positive";break;case"negative_sentiment":case"manager_intervention":t="negative"}return t}},getConfidence:function(){return this.get("confidence")},canHaveSentiment:function(){return this.isSentiment()||this.isTranscription()},getSentiment:function(){return this.canHaveSentiment()&&(this.getLocalState("sentiment")||this.get("sentiment"))},getMomentText:function(){if(this.isMoment())return this.get("moment")},getParsedPayload:function(){var e=this.getLocalState("parsedPayload")||this._parsePayload();return!this.getLocalState("parsedPayload")&&this.isFinal()&&this.adjustLocalState("parsedPayload",e,!0),e&&e.length&&e},_createTalkIqObject:function(e,t){var n=t||this;return[e,n.getDeltaStart(),n.getDeltaEnd(),n.id]},_createTranscriptionObject:function(e){var t=e||this;return this._createTalkIqObject(t.get("text"),t)},canHaveMoment:function(){return this.isMoment()||this.isTranscription()},displayDate:function(){return this.get("date_created")},originalOrientation:function(){return this.get("original_orientation")||this.get("orientation")},isForGroup:function(e){return(e||this.attributes||{}).target_key!==n.id},isForContact:function(e,t){var n=e.id||e;return(t||this.attributes||{}).sender_key===n},getStartTime:function(){return this.get("date_created")},getEndTime:function(){var e=this.getLocalState("endTime")||this._calculateEndTime();return!this.getLocalState("endTime")&&this.isFinal()&&this.adjustLocalState("endTime",e,!0),e},_calculateEndTime:function(){var e=this.getDeltaStart(),t=this.getDeltaEnd()||0;return this.getStartTime()+1e3*(t-e)},getParentTranscriptionId:function(){return this.getLocalState("splitParent")||this.id},wasInLastNms:function(e){var t=this.get("date_created");return i.getServerTime()-t<=e},getDeltaStart:function(){return this.attributes&&this.get("delta_start")},getDeltaEnd:function(){return this.attributes&&this.get("delta_end")},testIndexCalc:function(){var e=this.collection.getIndexOf(this);return this.collection.at(e)===this},setRelatedEvents:function(e){this.adjustLocalState("related",e.map(function(e){return e.id}))},getRelatedEventIds:function(){return this.getLocalState("related")},isExternal:function(){return"external"===this.get("orientation")},updatePayload:function(e){e&&e.length&&(this.set({delta_start:_.first(e)[1],delta_end:_.last(e)[2],payload:e},{silent:!0}),this.set({text:this.generateText()}))},hasOriginalSocketMessage:function(){return this.getLocalState("originalSocketMessage")}},{getTalkIqId:function(e){return this.prototype.getGeneratedId.call(this.prototype,e)},getText:function(e){return this.prototype.generateText.call(this.prototype,e)},isForGroup:function(e){return this.prototype.isForGroup.call(this.prototype,e)}})}),define("collections/group_calls",["require","fslib/singleton","collections/call_list","collections/contact_list"],function(require){var e=require("fslib/singleton"),t=require("collections/call_list"),n=(require("collections/contact_list"),t.extend({initialize:function(){t.prototype.initialize.apply(this,arguments),this.wrapper||this._addListeners()},findCallById:function(e){return this.get(e)||this.find(function(t){return t.get("operator_call_id")===e})},validateCall:function(e){var n=t.prototype.validateCall.apply(this,arguments);if(n.operator_target)return n;this.trigger("error:nooperatortarget",n)}}));return e.create(n,"groupCalls")}),define("objects/common/cache_manager",["fslib/object","fslib/singleton"],function(e,t){var n=e.extend({items:{},count:0,maxNum:3e3,_lastCleaned:(new Date).getTime(),_minDateAdded:(new Date).getTime(),_cleanInterval:18e5,get:function(e){var t=this.items[e];return t?t.value:null},put:function(e){var t=e.hasOwnProperty("length")?e:[e],n=(new Date).getTime();this._maybeClean(n);for(var i=0;i<t.length;i++)this._addItem(t[i],n)},_maybeClean:function(e){var t=e-this._lastCleaned>this._cleanInterval,n=this.count>this.maxNum;(t||n)&&this._cleanByTime(e)},_cleanByTime:function(e){var t=e-(e-this._minDateAdded)/2;this._clean(function(e){return e.dateAdded<t}),this._lastCleaned=e},_clean:function(e){var t,n,i=[],r={},s=(new Date).getTime();for(t in this.items)(n=this.items[t])&&e(n)?(i.push(n.value),this.removeItem(t)):n&&(n.dateAdded<s&&(s=n.dateAdded),r[t]=n);this.items=r,this._minDateAdded=s,i.length&&(console.info("CACHE: Cleaned (",i.length,") items from the cache. The cache now has (",this.count,") items in it."),this.trigger("removedFromCache",i))},removeItem:function(e){this.items[e]=null,this.count--},cleanItems:function(e){var t,n=this.items;for(t in n)0===t.indexOf(e)&&this.removeItem(t)},_addItem:function(e,t){this.items[e.id]||this.count++;var n=t||(new Date).getTime();this.items[e.id]={dateAdded:n,value:e}}});return t.create(n,"cacheManager")}),define("collections/talk_iq_list",["require","collections/common/cursor_collection","fslib/singleton","utils/latency_tracking_util","models/talk_iq","objects/pusher","collections/active_calls","collections/group_calls","collections/voiceai/battle_card_list","models/contact","collections/contact_list","collections/call_list","collections/call_leg_list","collections/callai_leg_list","config","objects/common/cache_manager"],function(require){var e=require("collections/common/cursor_collection"),t=require("fslib/singleton"),n=require("utils/latency_tracking_util"),i=require("models/talk_iq"),r=require("objects/pusher"),s=require("collections/active_calls"),o=require("collections/group_calls"),a=require("collections/voiceai/battle_card_list"),c=require("models/contact"),l=require("collections/contact_list"),u=require("collections/call_list"),h=require("collections/call_leg_list"),d=require("collections/callai_leg_list"),f=require("config"),p=require("objects/common/cache_manager"),g=e.extend({model:i,url:f.REQUEST_URL+"callai/event",comparator:"talkIqId",splitTranscriptions:!1,garbageCollectionTime:18e5,garbageCollectionMaxItems:2e3,initialize:function(){e.prototype.initialize.call(this),this._queuedMessages={},this._queuedContacts={},this._moments={}},parse:function(t,n){var i=this._filterResponseItems(t);return e.prototype.parse.call(this,i,n)},_filterResponseItems:function(e){for(var t=[],n={},i=0;i<e.length;i++){var r=e[i].sender_key,s=e[i].sender;s&&!l.get(r)&&l.add(s,{merge:!0}),!r||s||l.get(r)?(e[i].sender=l.get(r).toJSON(),t.push(e[i])):(n[r]=n[r]||[],n[r].push(e[i]))}for(var o in t.length!==e.length&&console.log("TALK IQ LIST: queueing messages (",e.length-t.length,") b/c need to fetch sender keys."),n)this._fetchMissingContact(o,n[o]);return t},_fetchMissingContact:function(e,t){var n=this._queuedContacts[e];n||(n={fetching:!1,messages:[],tries:0},this._queuedContacts[e]=n),n.messages=n.messages.concat(t),n.fetching||n.tries>4?n.tries>5&&console.error("TALK IQ LIST: contact fetched failed 5 times for senderKey: ",e):(n.tries++,n.fetching=!0,console.log("TALK IQ LIST: fetching missing sender (",e,"). Try number:",n.tries),this._fetchContact(e).then(this._onContactFetched.bind(this,e)).catch(this._onContactFetched.bind(this,e)))},_fetchContact:function(e){return new Promise(function(t,n){var i=new c({id:e});l.add(i,{merge:!0}),i.fetch({success:t,error:function(){return n()}})})},_onContactFetched:function(e,t){var n=this._queuedContacts[e];if(n){if(n.fetching=!1,!t)return console.warn("TALK IQ LIST: contact fetch failed for sender_key (",e,") -- trying again"),void this._fetchMissingContact(e,[]);var i=n.messages;console.log("TALK IQ LIST: contact fetch succeeded for sender_key (",e,") - adding (",i.length,") queued messages"),delete this._queuedContacts[e],this.addToCollection(i,{parse:!0,silent:!0})}},removeAllForCall:function(e){this.removeWhere({call_id:e}),this.removeWhere({entry_point_call_id:e})},removeWhere:function(e){for(var t=this.where(e),n=0;n<t.length;n++)this.remove(t[n]),p.remove("talkIqView-"+t[n].id),t[n].isMoment()&&this._removeMoment(t[n])},_removeMoment:function(e){delete this._moments[e.id]},getIndexOf:function(e){for(var t,n,i=0,r=this.length,s=e.get(this.comparator);i<r;)if(t=Math.floor((i+r)/2),(n=this.at(t).get(this.comparator))<s)i=t+1;else{if(!(n>s))return t;r=t}return-1},getFirstItemForCallId:function(e){return this.find(function(t){return t.get("call_id")==e||t.get("entry_point_call_id")===e})},getLastItemForTargetKey:function(e){var t,n,i=e.id||e;for(t=this.length-1;t>=0;t--)if(this.models[t].get("target_key")===i){n=this.models[t];break}return n},_addListeners:function(){this.listenTo(r,"talkiq",this._onTalkIqPusherEvent),this.listenTo(this,"add",this._maybeSetRelatedEvents),this.listenTo(this,"change:payload",this._maybeSetRelatedEvents),this.listenTo(h,"add",this._maybeDequeueMessages),this.listenTo(o,"change:local:participants",this._maybeDequeueMessages),this.listenTo(s,"change:local:participants",this._maybeDequeueMessages),this.listenTo(d,"add",this._maybeDequeueMessages),this.listenTo(a,"add",this._maybeDequeueMessages)},_getQueuedMessagesForModel:function(e){var t=e.get("id"),n=this._queuedMessages[t];return n&&delete this._queuedMessages[t],n},_getQueuedMessages:function(e){var t;switch(e.type){case"CallAiLeg":case"BattleCard":t=[e];break;default:t=e.getCallAiLegs()}for(var n=[],i=0;i<t.length;i++){var r=this._getQueuedMessagesForModel(t[i]);r&&(n=n.concat(r))}return n.length&&n},_maybeDequeueMessages:function(e){var t=this._getQueuedMessages(e);if(t&&t.length){console.log("TALK IQ LIST: dequeueing messages (",t.length,") for",e.type,e.get("id"));for(var n=0;n<t.length;n++)this._onTalkIq(t[n],t[n].event)}},_onTalkIqPusherEvent:function(e,t){n.logVoiceAiSocketLatency(e),this._onTalkIq(e,t)},_onTalkIq:function(e,t){var n;switch(t){case"transcription":n=this._getTranscriptionAttrs(e,t);break;case"sentiment":n=this._getSentimentAttrs(e,t);break;case"recommendations":case"popup":case"moment":n=this._getMomentAttrs(e,t);break;case"calldata":console.log("TALK IQ LIST: call data",e,t);break;case"transcriptionstart":this._addCallLeg(e,t);break;case"transcriptionend":console.log("TALK IQ LIST: transcription end",e,t)}n&&this.addToCollection(n,{merge:!0})},_addCallLeg:function(e,t){var n=this._createTalkIqFeedItem(e,t);n.id=n.call_leg_id,n.callai_legs=[{id:n.callai_leg_id,call_leg_id:n.call_leg_id,date_started:n.payload}],h.add(n,{parse:!0,merge:!0})},_getTranscriptionAttrs:function(e,t){if(e.feed_type)return this._extendAttributesWithCallInfo(e);var n=this._createTalkIqFeedItem(e,t);return e.text||i.getText(n)?this._extendAttributesWithCallInfo(n):void 0},_getSentimentAttrs:function(e,t){var n=this._createTalkIqFeedItem(e,t);return this._extendAttributesWithCallInfo(n)},_extendMomentAttrs:function(e,t){return(e=this._extendAttributesWithCallInfo(e))&&"recommendations"===t&&(e=this._extendAttributesWithBattleCardInfo(e)),e},_getMomentAttrs:function(e,t){if(e.feed_type)return this._extendMomentAttrs(e,t);for(var n=this._createTalkIqFeedItem(e,t),i=[],r=0;r<n.payload.length;r++){var s=_.extend({},n,{payload:[n.payload[r]],payload_index:r}),o=this._extendMomentAttrs(s,t);o&&i.push(o)}return!!i.length&&i},_createTalkIqFeedItem:function(e,t){if(e.feedType)return e;var n=e.tag.split("|");return _.extend({},e,{feed_type:this._getFeedType(t),call_id:parseInt(e.parent_call_id),callai_leg_id:e.voiceai_id,call_leg_id:e.call_id,original_orientation:n[0],entry_point_call_id:parseInt(n[1]||e.parent_call_id),event:t,original_socket_message:e,payload:"string"==typeof e.payload?JSON.parse(e.payload):e.payload})},_getFeedType:function(e){switch(e){case"recommendations":return"CallRecommendation";case"transcription":return"CallTranscription";case"moment":return"CallMoment";case"popup":return"CallPopup";case"sentiment":return"CallSentiment";case"calldata":return"CallData";case"transcriptionstart":return"CallStart";case"transcriptionend":return"CallEnd"}},_fetchCall:function(e){var t=s.get(e)||o.get(e);t||(o.add({id:e,operator_target:{}}),t=o.get(e)),t.fetchExtendedInfoForTalkIq()},_extendAttributesWithBattleCardInfo:function(e){var t=!!e.battle_card_id;e.battle_card_id=e.battle_card_id||e.payload[0][0];var n=a.getOrFetch(e.battle_card_id,e.target_key,t);if(n)return _.extend(e,{battle_card:n.toJSON()}),e;this._queueMessage(e)},_extendAttributesWithCallInfo:function(e){var t=h.getCallLeg(e.call_leg_id),n=this.getParticipantInfo(e.call_leg_id,e.entry_point_call_id),i=h.getCallAiLeg(e.callai_leg_id,e.call_leg_id);if(t&&n&&i)return _.extend(e,{start_time_ms:t.getRecordingTime()}),this._extendAttributesWithParticipant(e,n);this._queueMessage(e)},getParticipantInfo:function(e,t){var n=u.getCallParticipantInfo(e);return n||this._fetchCall(t),n},_queueMessage:function(e){var t;switch(e.feed_type){case"CallRecommendation":t=e.battle_card_id||e.callai_leg_id;break;default:t=e.callai_leg_id}this._queuedMessages[t]||(this._queuedMessages[t]=[]),console.log("TALK IQ LIST: queueing messages for",e.feed_type,t),this._queuedMessages[t].push(e)},_extendAttributesWithParticipant:function(e,t){var n=e.original_orientation,r=i.isForGroup(e);e.contact_key=t.call_contact_key,e.target_key=t.call_target_key,e.sender_key=r?"internal"===n?t.call_target_key:t.call_contact_key:"internal"===n?e.target_key:e.contact_key;var s=t.participant_type;return r&&("operator"===s||"supervisor"===s)&&(e.sender_key=t.contact_key),l.get(e.sender_key)&&(e.sender=l.get(e.sender_key).toJSON()),e.orientation=n,e},getLatestSentimentByCall:function(e){var t=this._getAnyByCallId(e.getRootCallId()),n=null;if(t>-1)return(n=this._searchBelowForSentiment(e,t))||(n=this._searchAboveForSentiment(e,Math.max(0,t-1))),n},_getAnyByCallId:function(e){for(var t,n,i=0,r=this.length;i<r;)if(t=Math.floor((i+r)/2),(n=this.at(t).get("entry_point_call_id"))<e)i=t+1;else{if(!(n>e))return t;r=t}return-1},_searchBelowForSentiment:function(e,t){for(var n=null,i=e.getRootCallId(),r=e.get("contact_key"),s=t;s<this.models.length;s+=1){var o=this.at(s),a=i===o.get("entry_point_call_id");if(a&&o.isSentimentForContact(r))n=o;else if(!a)break}return n},_searchAboveForSentiment:function(e,t){for(var n=null,i=e.getRootCallId(),r=e.get("contact_key"),s=t;s>=0;s-=1){var o=this.at(s),a=i===o.get("entry_point_call_id");if(a&&o.isSentimentForContact(r)){n=o;break}if(!a)break}return n},getRelatedEvents:function(e){var t=this;return((e.id?e:this.get(e)).getRelatedEventIds()||[]).reduce(function(e,n){return t.get(n)&&e.push(t.get(n)),e},[])},findTranscriptionsForMoment:function(e){if(e.isRecommendation()){var t,n,i=this.getIndexOf(e),r=[];for(t=i;t>=0&&((n=this.at(t)).isTranscription()&&e.overlaps(n)&&r.push(n),n.getCallId()===e.getCallId()&&(!n.isTranscription()||e.overlaps(n)));t--);for(t=i+1;t<this.length&&((n=this.at(t)).isTranscription()&&e.overlaps(n)&&r.push(n),n.getCallId()===e.getCallId()&&(!n.isTranscription()||e.overlaps(n)));t++);return r}},_maybeSetRelatedEvents:function(e){if(e.isRecommendation()&&this._setRelatedEventsOnMoment(e),e.isTranscription())for(var t in this._moments){var n=this.get(t);n&&n.getCallId()===e.getCallId()&&n.overlaps(e)&&this._setRelatedEventsOnMoment(n)}},_setRelatedEventsOnMoment:function(e){e.setRelatedEvents(this.findTranscriptionsForMoment(e)),this._moments[e.id]=1},addToCollection:function(e,t,n){var r=_.extend({merge:!0,parse:!0},t);e=_.isArray(e)?e:[e];var s=_.extend({},n);this.add(e,r);for(var o=0;o<e.length;o++){var a=i.getTalkIqId(e[o]),c=this.get(a);c&&(c.hasOriginalSocketMessage()&&_.extend(s,{live:1,"feed:descending":1}),c.addLocalSource(s))}}}),m=t.create(g,"talkIqList");return m._addListeners(),m}),define("objects/ipc_manager",["require","backbone","fslib/singleton","objects/common/ipc_manager","models/current_user","models/session","collections/active_calls","collections/affinity_list","collections/unread_feed_list","collections/talk_iq_list","collections/voiceai/battle_card_list"],function(require){var e=require("backbone"),t=require("fslib/singleton"),n=require("objects/common/ipc_manager"),i=require("models/current_user"),r=require("models/session"),s=require("collections/active_calls"),o=require("collections/affinity_list"),a=require("collections/unread_feed_list"),c=require("collections/talk_iq_list"),l=require("collections/voiceai/battle_card_list"),u=n.extend({start:function(){n.prototype.start.call(this,{currentUser:i,session:r}),this.listenTo(e,"localstorage:sync",this._syncLocalStorageToOtherWindows),"single"===window.name?(this.listenTo(a,"count:change",this._changeBadge),this.listenTo(s,"add",this._sendActiveCallsToOtherWindows),this.listenTo(s,"change",this._sendActiveCallsToOtherWindows),this.listenTo(s,"remove",this._sendActiveCallsToOtherWindows),this.listenTo(c,"add",this._sendVoiceAiToOtherWindows),this.listenTo(c,"change",this._sendVoiceAiToOtherWindows),this.listenTo(c,"change:local:related",this._sendVoiceAiToOtherWindows),this.listenTo(l,"add",this._sendBattleCardToOtherWindows),this.listenTo(l,"change",this._sendBattleCardToOtherWindows),this.listenTo(o,"change",this._maybeSendCallWithAffinityToOtherWindows),i.isDpEverywhereEnabled()&&this.toggleVisibility("mini",!1)):"notification"!==window.name&&"mini"!==window.name||(this.listenTo(e,"native:current_user",this._updateCurrentUser),this.listenTo(e,"native:active_calls",this._updateActiveCalls),this.listenTo(e,"native:voiceai",this._updateTalkIq),this.listenTo(e,"native:battle_card",this._updateBattleCardList))},_changeBadge:_.throttle(function(){var e=_.reduce(a.collections,_.bind(function(e,t){return e+a.missedFeedForCollection(t)},this),0);e!==this._lastCount&&(e?(console.log("Changing Badge to "+e),this.badge(e.toString())):(console.log("Clearing Badge"),this.badge("")),this._lastCount=e)},200),callManager:function(e,t){if(this.started){var n={};t&&(n=t.toJSON()),this.ipc.send("call_manager",e,n)}},modelManager:function(){if(this.started){var e=["model_manager"].concat(Array.prototype.slice.call(arguments));this.ipc.send.apply(this.ipc,e)}},videoManager:function(e,t){if(this.started){var n={};t&&(n=t.toJSON()),this.ipc.send("video_manager",e,n)}},conferenceManager:function(e,t){this.started&&("open"===e&&console.log("Opening UberConference window using URL",t),this.ipc.send("conference_manager",e,t))},_syncLocalStorageToOtherWindows:function(e){var t={data:e,windowName:"single"===window.name?"main":window.name};this.ipc.send("local_storage",t)},_sendActiveCallsToOtherWindows:function(){console.log("Pushing Active Calls to Other Windows"),this.ipc.send("active_calls",s.toJSON())},_updateActiveCalls:function(e){s.set(e)},_sendVoiceAiToOtherWindows:function(e){var t=this;c.getRelatedEvents(e).forEach(function(e){t.ipc.send("voiceai",e.toJSON({localState:!0}))}),this.ipc.send("voiceai",e.toJSON({localState:!0}))},_updateTalkIq:function(e){c.addToCollection(e,null,e.localState.sources)},_sendBattleCardToOtherWindows:function(e){this.ipc.send("battle_card",e.toJSON({localState:!0}))},_updateBattleCardList:function(e){l.add(e,{merge:!0})},remoteAction:function(e){console.log("Sending remote action",e),this.ipc.send("remote_action",e)},_maybeSendCallWithAffinityToOtherWindows:function(e){if(e.hasViewableCall()){var t=s.callForContact(e.get("key"),e.get("target_key"));t&&(t.set({contact:e.toJSON()},{silent:!0}),this._sendActiveCallsToOtherWindows())}},integrationChange:function(e,t,n){var i=o.getContactAffinity(t,n);i&&i.hasViewableCall()&&this.ipc.send("integration",e,t,n,window.name)}});return t.create(u,"ipcManager")}),define("models/common/media",["backbone","config","fslib/fsutil","models/common/model","models/session","underscore"],function(e,t,n,i,r,s){return i.extend({initialize:function(){i.prototype.initialize.apply(this,arguments),t.disableWebRtc||(this._checkMediaDevices(),this.prewarmMedia())},MEDIA:{AUDIO:"audio",VIDEO:"video",SINK:"audiooutput",ID:"id",SOUNDS_SINK:"soundsoutput",VOLUME:"globalvolume"},CONSTRAINTS:{mandatory:{audio:!1,video:!1},optional:{audio:[{chromeRenderToAssociatedSink:!0},{googNoiseSuppression2:!0},{googDucking:!1}],video:[]}},currentMedia:{},getMediaInfo:function(e){var t=s.bind(function(t){this.currentMedia.mediaInfos=t||[],e&&e.apply(this,arguments)},this);n.supportsMediaDevices()?navigator.mediaDevices.enumerateDevices().then(t):"undefined"!=typeof MediaStreamTrack&&s.isFunction(MediaStreamTrack.getSources)?MediaStreamTrack.getSources(t):s.isFunction(e)&&s.defer(e)},_checkMediaDevices:function(){n.supportsMediaDevices()&&s.extend(this.MEDIA,{AUDIO:"audioinput",VIDEO:"videoinput",ID:"deviceId"}),this.currentMedia[this.MEDIA.AUDIO]={media:{},mediaInfos:{}},this.currentMedia[this.MEDIA.VIDEO]={media:{},mediaInfos:{}},this.currentMedia[this.MEDIA.SINK]={media:{},mediaInfos:{}},this.currentMedia[this.MEDIA.SOUNDS_SINK]={media:{},mediaInfos:{}},this.currentMedia[this.MEDIA.VOLUME]={}},getExternalMediaConfig:function(){return n.isElectron()&&_electron.sync&&_electron.sync.currentMedia},_saveMedia:function(e,t){for(var n,i=t&&t[this.MEDIA.ID]?t[this.MEDIA.ID]:t,s=e,o=this._getMediaType(e),a=this.currentMedia[o].mediaInfos,c=0;c<a.length;c++)if(a[c][this.MEDIA.ID]===i){n=a[c];break}if(n){var l={label:n.label,kind:s};l[this.MEDIA.ID]=i,r.setLocal(s,l)}else r.setLocal(s,"")},_getMediaType:function(e){return e===this.MEDIA.SOUNDS_SINK?this.MEDIA.SINK:e},_getSession:function(){throw new Error("implement getSession")},_getSavedMedia:function(e,t){var n=r.getLocal(e);this.getMediaInfo(s.bind(function(i){this._onGetSavedMedia(e,n,i,t)},this))},mediaInfoIsSavedMedia:function(e,t){var n=this._getMediaFromLocalStorage(t||e.kind),i=n.label&&n.label===e.label,r=this._getMediaType(n.kind||t)===e.kind,s=n[this.MEDIA.ID]===e[this.MEDIA.ID];return s=s||!n[this.MEDIA.ID]&&"default"===e[this.MEDIA.ID],r&&(s||i)},_onGetSavedMedia:function(e,t,n,i){var r;if(n){for(var s=0;s<n.length;s++)if(this.mediaInfoIsSavedMedia(n[s],e)){r=n[s];break}r||((r={kind:e})[this.MEDIA.ID]="")}i&&i(r,n)},getAudioSource:function(e){this._getSavedMedia(this.MEDIA.AUDIO,e)},getAudioSink:function(e){this._getSavedMedia(this.MEDIA.SINK,e)},getSoundsAudioSink:function(e){this._getSavedMedia(this.MEDIA.SOUNDS_SINK,e)},getVideoSource:function(e){this._getSavedMedia(this.MEDIA.VIDEO,e)},getVolume:function(e){r.getLocal(this.MEDIA.VOLUME,e)},getVolumeValue:function(e){this.getVolume(s.bind(function(t){var n=t;n="muted"==n||0==n?0:n||1,e(parseFloat(n))},this))},saveAudioSource:function(e){this._saveMedia(this.MEDIA.AUDIO,e)},saveAudioSink:function(e){this._saveMedia(this.MEDIA.SINK,e)},saveSoundsAudioSink:function(e){this._saveMedia(this.MEDIA.SOUNDS_SINK,e)},saveVideoSource:function(e){this._saveMedia(this.MEDIA.VIDEO,e)},saveVolume:function(e){r.setLocal(this.MEDIA.VOLUME,e)},getForgottenMedia:function(e){return r.getLocal("forgottenMedia",e)||{}},forgetMedia:function(e,t){var n=this.getForgottenMedia();n[e]||(n[e]={});var i=this.getLabel(t,e);n[e][t]=i||!0,i&&(n[e][i]=t||!0),console.info("MEDIA: User chose to forget (",e,":",t,")",i),r.setLocal("forgottenMedia",n)},unforgetMedia:function(e,t){var n=this.getForgottenMedia();if(n[e]&&n[e].hasOwnProperty(t)){console.info("MEDIA: User chose to remember (",e,":",t,")",n[e][t]),delete n[e][t];var i=this.getLabel(t,e);i&&delete n[e][i],r.setLocal("forgottenMedia",n)}},resetForgottenMedia:function(){console.info("MEDIA: User resetting all forgotten media."),r.setLocal("forgottenMedia",null)},isMediaForgotten:function(e,t){if(!this.prewarmedForgottenMedia)return!0;var n=this.getForgottenMedia(),i=n[e],s=i&&!!i[t],o=!!s||this._hasForgottenLabel(e,t),a=n[e]&&(s||o);if(a){console.info("MEDIA: User plugged in forgotten media (",e,":",t,")",this.getLabel(t,e));var c=r.getLocal(e);console.info("MEDIA: Users default for (",e,") is: ",c?JSON.stringify(c):"null")}return a},_hasForgottenLabel:function(e,t){var n=this.getLabel(t,e),i=this.getForgottenMedia()[e]||{};if(i[n])return!0;for(var r in i)if(i.hasOwnProperty(r)&&i[r]===n)return!0;return!1},prewarmMedia:function(){this._prewarmAudio(),this._prewarmAudioSink(),this._prewarmSoundsAudioSink(),this._prewarmVideo(),this._prewarmForgottenMedia(),this._prewarmVolume()},_prewarmAudio:function(){this.getAudioSource(s.bind(function(e,t){this._onPrewarm(e,t,this.MEDIA.AUDIO)},this))},_prewarmVideo:function(){this.getVideoSource(s.bind(function(e,t){this._onPrewarm(e,t,this.MEDIA.VIDEO)},this))},_prewarmAudioSink:function(){this.getAudioSink(s.bind(function(e,t){this._onPrewarm(e,t,this.MEDIA.SINK)},this))},_prewarmSoundsAudioSink:function(){this.getSoundsAudioSink(s.bind(function(e,t){this._onPrewarm(e,t,this.MEDIA.SOUNDS_SINK)},this))},_prewarmForgottenMedia:function(){this.getForgottenMedia(s.bind(function(){this.prewarmedForgottenMedia=!0},this))},_prewarmVolume:function(){this.getVolume(s.bind(this._onSetCurrentVolume,this))},_onPrewarm:function(e,t,n){t=this._filterMediaInfosForKind(t,n),this._updateCurrentMedia(e,t,n)},_getStream:function(e,t,n){var i=s.bind(function(){this._getSavedMedia(e,s.bind(function(i,r){this._onGetSavedMediaForStream(e,i,r,t,n)},this))},this);if(!t)return new Promise(function(e,n){t=function(t){t?e(t):n()},i()});i()},_onGetSavedMediaForStream:function(e,t,n,i,r){t||((t={kind:e})[this.MEDIA.ID]=""),this._getStreamFromMedia(t,i,r)},_getStreamFromMedia:function(e,t,n){var i=this._getConstraintsFromMedia(e,n),r=s.bind(function(n){this._onGetUserMediaSuccess(n,i,e,t)},this),o=s.bind(function(n){this._onGetUserMediaError(n,i,e,t)},this);getUserMedia(i,r,o)},_getConstraintsFromMedia:function(e,t){for(var n=[],i=e.kind.indexOf("audio")>-1?"audio":"video",r=this.CONSTRAINTS.optional[i]||[],o=0;o<r.length;o++)n.push(r[o]);if("audio"===i){var a=this.getSipAudioConstraints();for(o=0;o<a.length;o++)n.push(a[o])}e[this.MEDIA.ID]&&n.unshift({sourceId:e[this.MEDIA.ID]});var c={};return c[i]={},(n[0]||{}).hasOwnProperty("sourceId")?c[i].deviceId={exact:n[0].sourceId}:n.length?c[i].optional=n:c[i]=!0,(this.CONSTRAINTS[i]||t)&&(s.isObject(c[i])||(c[i]={})),this.CONSTRAINTS[i]&&s.extend(c[i],this.CONSTRAINTS[i]),t&&t[i]&&s.extend(c[i],t[i]),c},_onGetUserMediaSuccess:function(e,t,n,i){console.log("MEDIA: Successfully got media (",n.kind,") using constraints:",JSON.stringify(t)),i(e,n)},_onGetUserMediaError:function(e,t,n,i){console.error("MEDIA: Error getting media (",n.kind,") using constraints",JSON.stringify(t),". Returned with error:",e),i(null,n)},getAudioStream:function(e){return this._getStream(this.MEDIA.AUDIO,e)},getVideoStream:function(e){return this._getStream(this.MEDIA.VIDEO,e)},getAudioVideoStream:function(e){var t,n,i=new Promise(s.bind(function(e){this._getSavedMedia(this.MEDIA.AUDIO,e)},this)),r=new Promise(s.bind(function(e){this._getSavedMedia(this.MEDIA.VIDEO,e)},this)),o=s.bind(function(){var i=s.bind(function(i){this._onGetUserMediaSuccess(i,t,n,e)},this),r=s.bind(function(i){this._onGetUserMediaError(i,t,n,e)},this);getUserMedia(t,i,r)},this);return new Promise(s.bind(function(a,c){Promise.all([i,r]).then(s.bind(function(i){n={kind:"AV",audio:i[0],video:i[1]},t=s.extend({},this._getConstraintsFromMedia(i[0]),this._getConstraintsFromMedia(i[1])),e?o():(e=s.bind(function(e){e?a(e):this.getAudioStream().then(a).catch(c)},this),o())},this)).catch(c)},this))},getThumbnailStream:function(e){return this._getStream(this.MEDIA.VIDEO,e,{video:{width:{max:176,ideal:176},height:{max:144,ideal:144},frameRate:{max:15}}})},getSimulcastStream:function(e){var t=[],n=s.bind(function(){return!1===e.audio?Promise.resolve(new MediaStream):this.getAudioStream()},this);return e.video?t.push(this.getAudioVideoStream()):t.push(this.getAudioStream()),e.thumbnail&&t.push(this.getThumbnailStream()),new Promise(function(e,i){Promise.all(t).then(function(t){var n=t[0],i=t[1],r=i&&i.getVideoTracks()[0];r&&n.addTrack(r),e(n)}).catch(function(){return n()}).then(e).catch(i)})},getMediaStreams:function(e,t){var n=0,i=[],r=function(t){n++,t&&i.push(t),2===n&&e(i)};t?this._getStreamFromMedia({kind:this.MEDIA.AUDIO},r):this._getStream(this.MEDIA.AUDIO,r),t?this._getStreamFromMedia({kind:this.MEDIA.VIDEO},r):this._getStream(this.MEDIA.VIDEO,r)},getSipAudioConstraints:function(){throw new Error("implement getSipAudioConstraints")},_setCurrentMedia:function(){this.getAudioSource(s.bind(this._onSetCurrentMediaAudio,this)),this.getAudioSink(s.bind(this._onSetCurrentMediaAudioSink,this)),this.getVideoSource(s.bind(this._onSetCurrentMediaVideo,this)),this.getSoundsAudioSink(s.bind(this._onSetCurrentMediaSoundsAudioSink,this)),this.getVolume(s.bind(this._onSetCurrentVolume,this))},_onSetCurrentMedia:function(e,t,n){e||((e={kind:n})[this.MEDIA.ID]=""),t=this._filterMediaInfosForKind(t,e.kind),this._updateCurrentMedia(e,t)},_updateCurrentMedia:function(e,t,n){if(e){var i=n||e.kind;this.currentMedia[i]={media:e,mediaInfos:t},this.trigger("currentMediaUpdated",i)}},_sortMediaInfos:function(e,t){return e[this.MEDIA.ID]>t[this.MEDIA.ID]?1:e[this.MEDIA.ID]<t[this.MEDIA.ID]?-1:0},_onSetCurrentMediaAudio:function(e,t){this._onSetCurrentMedia(e,t,this.MEDIA.AUDIO)},_onSetCurrentMediaVideo:function(e,t){this._onSetCurrentMedia(e,t,this.MEDIA.VIDEO)},_onSetCurrentMediaAudioSink:function(e,t){this._onSetCurrentMedia(e,t,this.MEDIA.SINK)},_onSetCurrentMediaSoundsAudioSink:function(e,t){this._onSetCurrentMedia(e,t,this.MEDIA.SOUNDS_SINK)},_onSetCurrentVolume:function(e){var t=this.MEDIA.VOLUME,n=0===e?"muted":e;return this.currentMedia[t]=n,this.trigger("currentMediaUpdated",t),n},_filterMediaInfosForKind:function(e,t){return t=this._getMediaType(t),s.filter(e,function(e){return e.kind===t}).sort(s.bind(this._sortMediaInfos,this))},getScreenStream:function(e){t.isNative?this._getScreenStreamElectron():this._getScreenStreamChrome(e)},_getScreenStreamChrome:function(e){chrome.desktopCapture.chooseDesktopMedia(["screen","window"],null,s.bind(function(t){this.getScreenStreamBySource(t,e)},this))},_getScreenStreamElectron:function(){this.getScreenSourcesElectron(function(t){e.trigger("overlay","screen-sharing",{sources:t})})},getScreenSourcesElectron:function(e,t,n){var i=n||["window","screen"];_electron.desktopCapturer.getSources({types:i},s.bind(function(n,i){n?console.error("MEDIA: ELECTRON Error getting screen sources",n):e&&e(t?this.formatScreenSourcesElectron(i):i)},this))},formatScreenSourcesElectron:function(e){for(var t=[],n=0;n<e.length;n++)t.push({name:e[n].name,id:e[n].id,thumbnail:e[n].thumbnail.toDataURL()});return t},getScreenStreamBySource:function(e,t){if(!e)return t?null:Promise.resolve();var n={video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxWidth:1920,maxHeight:1200}}},i=function(){getUserMedia(n,s.bind(function(e){t&&t(e)},this),function(){console.error("MEDIA: Error getting screen stream for sourceId",e,"with constraints",n)})};if(!t)return new Promise(function(e,n){t=function(t){t?e(t):n()},i()});i()},didCurrentAudioChange:function(e){var t=s.bind(function(t,n){this._compareSavedAudio(t,n,e)},this);this.getAudioSource(t)},didCurrentAudioSinkChange:function(e){var t=s.bind(function(t,n){this._compareSavedAudioSink(t,n,e)},this);this.getAudioSink(t)},didCurrentSoundsAudioSinkChange:function(e){var t=s.bind(function(t,n){this._compareSavedSoundsAudioSink(t,n,e)},this);this.getSoundsAudioSink(t)},didCurrentVideoChange:function(e){var t=s.bind(function(t,n){this._compareSavedVideo(t,n,e)},this);this.getVideoSource(t)},didCurrentVolumeChange:function(e){var t=s.bind(function(t){this._compareSavedVolume(t,e)},this);this.getVolume(t)},_compareSavedMedia:function(e,t,n,i){e=e||{kind:this._getMediaType(n),id:""},t=this._filterMediaInfosForKind(t,n);var r=this.currentMedia[n].media,s=r[this.MEDIA.ID],o=e[this.MEDIA.ID]!==this.currentMedia[n].media[this.MEDIA.ID];"video"===n&&!s&&o&&(o=!1);var a=this._compareMediaInfos(t,this.currentMedia[n].mediaInfos),c=!!a.added.length,l=!!a.removed.length;this._updateCurrentMedia(e,t,n);var u={kind:n,previousMedia:r,media:e,changedMedia:a,mediaPluggedIn:c,mediaUnplugged:l,mediaInfos:t};o&&this.trigger("mediaChanged",u),i(o,u)},_compareMediaInfos:function(e,t){for(var n={},i={},r=0;r<e.length;r++)i[e[r][this.MEDIA.ID]]=e[r];for(r=0;r<t.length;r++)n[t[r][this.MEDIA.ID]]=t[r];var s=[];for(r=0;r<t.length;r++)i[t[r][this.MEDIA.ID]]||s.push(t[r][this.MEDIA.ID]);var o=[];for(r=0;r<e.length;r++)n[e[r][this.MEDIA.ID]]||o.push(e[r][this.MEDIA.ID]);return{removed:s,added:o,changed:s.length||o.length}},_compareSavedAudio:function(e,t,n){this._compareSavedMedia(e,t,this.MEDIA.AUDIO,n)},_compareSavedAudioSink:function(e,t,n){this._compareSavedMedia(e,t,this.MEDIA.SINK,n)},_compareSavedSoundsAudioSink:function(e,t,n){this._compareSavedMedia(e,t,this.MEDIA.SOUNDS_SINK,n)},_compareSavedVideo:function(e,t,n){this._compareSavedMedia(e,t,this.MEDIA.VIDEO,n)},_compareSavedVolume:function(e,t){var n=this.MEDIA.VOLUME,i=this.currentMedia[n],r=this._onSetCurrentVolume(e),s=r!==i,o={kind:n,previousMedia:i,media:r};s&&this.trigger("mediaChanged",o),t(s,o)},findCorrespondingSpeakers:function(e){var t="string"==typeof e?this.getAudioById(e):e,n=t?t.groupId:void 0,i=t?t.label:void 0;if(!t)return null;var r=this.currentMedia.mediaInfos,o=this.MEDIA.SINK;return s.findWhere(r,{groupId:n,kind:o})||this.getAudioSinkFromLabel(i)},_getMediaFromLabel:function(e,t){var i=this.currentMedia.mediaInfos,r=s.findWhere(i,{label:e,kind:t});if(t===this.MEDIA.SINK&&n.isWindows()&&!r){var o=e.match(/\(([^\)]*)\)/);e=o&&o.length?o[1]:e,r=s.find(i,function(n){return n.kind===t&&n.label.indexOf(e)>-1})}return r},getAudioSourceFromLabel:function(e){return this._getMediaFromLabel(e,this.MEDIA.AUDIO)},getAudioSinkFromLabel:function(e){return this._getMediaFromLabel(e,this.MEDIA.SINK)},getVideoSourceFromLabel:function(e){return this._getMediaFromLabel(e,this.MEDIA.VIDEO)},getLabel:function(e,t){if(t===this.MEDIA.VIDEO&&!e){var n=this.currentMedia[this.MEDIA.VIDEO].mediaInfos[0];e=n?n[this.MEDIA.ID]:""}e=e||"default";var i=this._getMediaInfoById(e,t);return i?i.label:null},_getMediaInfoById:function(e,t){var n={kind:t};return n[this.MEDIA.ID]=e,s.findWhere(this.currentMedia.mediaInfos,n)},getAudioById:function(e){return this._getMediaInfoById(e,this.MEDIA.AUDIO)},getAudioSourceLabel:function(e){return this.getLabel(e,this.MEDIA.AUDIO)},getAudioSinkLabel:function(e){return this.getLabel(e,this.MEDIA.SINK)},getVideoSourceLabel:function(e){return this.getLabel(e,this.MEDIA.VIDEO)},getDefaultSpeakersId:function(e){var t,n,i,r=this.currentMedia[this.MEDIA.SINK].mediaInfos;return r.length?(s.each(r,function(r){var s=r[this.MEDIA.ID].toLowerCase(),o=(r.label||"").toLowerCase();"default"===s?n=r:"communications"===s?t=r:"built-in output"===o&&e&&(i=r)},this),(t||i||n||r[0])[this.MEDIA.ID]):""},getDefaultSoundsId:function(){return this.getDefaultSpeakersId(!0)},getCurrentAudioId:function(){return this.currentMedia[this.MEDIA.AUDIO].media[this.MEDIA.ID]},getCurrentSpeakersId:function(){return this.currentMedia[this.MEDIA.SINK].media[this.MEDIA.ID]||this.getDefaultSpeakersId()},getCurrentSoundsId:function(){return this.currentMedia[this.MEDIA.SOUNDS_SINK].media[this.MEDIA.ID]||this.getDefaultSoundsId()},getCurrentVideoId:function(){return this.currentMedia[this.MEDIA.VIDEO].media[this.MEDIA.ID]},hasVideoSources:function(){return this.currentMedia[this.MEDIA.VIDEO].mediaInfos.length},hasAudioSources:function(){return this.currentMedia[this.MEDIA.AUDIO].mediaInfos.length},getCurrentSpeakersLabel:function(){var e=this.getCurrentSpeakersId();return this.getAudioSinkLabel(e)||e},getCurrentSoundsLabel:function(){var e=this.getCurrentSoundsId();return this.getAudioSinkLabel(e)||e},getCurrentAudioLabel:function(){var e=this.getCurrentAudioId();return this.getAudioSourceLabel(e)||e},getCurrentVideoLabel:function(){var e=this.getCurrentVideoId();return this.getVideoSourceLabel(e)},_getTypeFromKind:function(e){var t="UNKNOWN";switch(e){case this.MEDIA.AUDIO:t="MICROPHONE";break;case this.MEDIA.SINK:t="SPEAKERS";break;case this.MEDIA.VIDEO:t="VIDEO";break;case this.MEDIA.SOUNDS_SINK:t="SOUNDS SPEAKER"}return t},_logMedia:function(e,t,n){if(t.hasOwnProperty(e)){var i=t[e]||"Default",r=this.getLabel(i,e)||"Default",s=this._getTypeFromKind(e);console.info("MEDIA:",n,s,"(",r,"):",i),this._logSavedMedia(e)}},_logSavedMedia:function(e){var t=this._getMediaFromLocalStorage(e),n=this._getTypeFromKind(e),i=t[this.MEDIA.ID]||"default",r=t.label||t.derivedLabel||"Default";console.info("MEDIA: Logging saved",n,"(",r,"):",i)},getCurrentMediaIds:function(){var e={};return e[this.MEDIA.AUDIO]=this.currentMedia[this.MEDIA.AUDIO].media[this.MEDIA.ID],e[this.MEDIA.SINK]=this.currentMedia[this.MEDIA.SINK].media[this.MEDIA.ID],e[this.MEDIA.VIDEO]=this.currentMedia[this.MEDIA.VIDEO].media[this.MEDIA.ID],e},logMedia:function(e,t){var n="Logging current";switch(t){case"call":n="Audio Call connected with";break;case"video":n="Video Call connected with"}this._logMedia(this.MEDIA.AUDIO,e,n),this._logMedia(this.MEDIA.SINK,e,n),this._logMedia(this.MEDIA.VIDEO,e,n),console.info("MEDIA:",n,this.MEDIA.VOLUME,":",this.currentMedia[this.MEDIA.VOLUME])},_getMediaFromLocalStorage:function(e){var t=r.getLocal(e);if(!t||"object"!==(void 0===t?"undefined":_typeof(t))){var n=t||"";(t={kind:e})[this.MEDIA.ID]=n,t.derivedLabel="undefined"===n?"Never Saved":n?"Not Saved b/c it was set before we started saving labels":"Default"}return t},getAudioStreamById:function(e,t){var n=this.getAudioById(e);n?this._getStreamFromMedia(n,t):t&&t(null,n)},stopStream:function(e){e&&s.each(e.getTracks(),this._stopTrack)},_stopTrack:function(e){e.stop&&e.stop()},_pathReg:/(?:\/static\/mp3\/)*([^\.][^m][^p][^3]+)(?:\.mp3)*$/,_path:function(e){var t=(e||"").match(this._pathReg),i=t&&t[1]?t[1]:e;return n.getLocalUrl("/static/mp3/"+i+".mp3")},getStreamFromFile:function(e){return new Promise(function(t,n){var i=this._path(e),r=i+"_stream";if(this[r])t(this[r]);else{var s=new(window.AudioContext||window.webkitAudioContext),o=s.createBufferSource(),a=new XMLHttpRequest;a.open("GET",i,!0),a.responseType="arraybuffer",a.onload=function(){if(200!==a.status)return console.warn("MEDIA: Could not get stream from path:",i),void n();s.decodeAudioData(a.response).then(function(e){o.buffer=e,o.connect(s.destination),o.loop=!0;var n=s.createMediaStreamDestination();this[r]=n.stream,t(n.stream)}.bind(this)).catch(n)},a.send()}}.bind(this))}})}),define("models/media",["config","models/common/media","models/session"],function(e,t,n){return t.extend({getSipAudioConstraints:function(){return n.getSipConfig().audioConstraintsOptional||[]}})}),define("fslib/notifications",["backbone","config","fslib/singleton"],function(e,t,n){var i=e.View.extend({DELAY:1e3,initialize:function(){_.bindAll(this),this.delay=this.DELAY,this.errorCount=0,this.errorCountSinceMessage=0,this._setStatus("init")},getStatus:function(){return this.status},isConnected:function(){return!(!this.socket||1!=this.socket.readyState)||(this.frame?this.hasConnected:this.isPolling())},createChannel:function(e){if(this.isPolling())console.log("Can't create channel while polling");else if(t.disableChannels)console.log("Channels disabled via config");else if(this.token=e||this.token,this.frame=document.getElementById("channel_api"),this.autoConnect=!0,this.hasConnected=!1,this._failOnClose=!1,clearTimeout(this.delayConnectId),this.socket||this._frameLoaded())console.log("Already have a socket");else if(this.token){if(this.delay=2*this.delay,console.log("channel token: "+this.token+" delay="+this.delay),this.frame)this.createChannelFrame();else try{this.socket=new goog.appengine.Channel(this.token).open(this)}catch(e){return console.log("goog socket failed to instantiate"),console.log(e),this.autoConnect=!1,this._setStatus("failed")}this._setStatus("connecting"),this.delayConnectId=_.delay(this._connectTimeout,5e3)}else console.log("No token to create channel")},_connectTimeout:function(){this.hasConnected||(console.log("Failed to connect after 5 seconds...closing socket"),this._closeChannel())},destroyChannel:function(){console.log("destroy channel"),this.autoConnect=!1,this._closeChannel()},probeChannel:function(){if(this.token&&this.socket&&this.autoConnect)return this.socket.readyState>=3?(this.socket=null,this.createChannel(),!0):void 0},_closeChannel:function(){if(this._setStatus("disconnecting"),this.hasConnected=!1,this.frame)this._frameLoaded()&&(this._delayDisconnect(),this._sendFrameMessage("CLOSE"));else{try{this.socket&&this.socket.readyState<3&&(this._delayDisconnect(),this.socket.close())}catch(e){}this.socket=null}},onopen:function(){this.hasConnected=!0,clearTimeout(this.delayConnectId),console.log("Channel Open"),this.delay=this.DELAY,this.errorCount=0,this._setStatus("connect")},onmessage:function(e){var t,n;console.log("Channel Message");try{n=(t=JSON.parse(e.data)).type,console.log(t),this.errorCount=0,this.errorCountSinceMessage=0,this._setStatus("connect")}catch(t){console.log("Failed to load message:"),console.log(t),console.log(e.data)}t&&(this.trigger(n,t),this.trigger("all",t))},onerror:function(e){if(console.log("Channel Error"),console.log(e),this.errorCountSinceMessage++,this.errorCountSinceMessage>=5)return this.destroyChannel(),void(this._failOnClose=!0);var t=parseInt(e.code||0);return 401==t?(this.autoConnect=!1,this.token=null,void this._setStatus("unauthorized")):-1!=t?400==t&&(this.errorCount++,2==this.errorCount)?(this._setStatus("warning"),void this._closeChannel()):void 0:void this._closeChannel()},onclose:function(e){clearTimeout(this.delayDisconnectId),this.destroyChannelFrame(),this._closeChannel(),console.log("Channel Close"),console.log(e);var t=this.autoConnect;this._setStatus("disconnect"),t&&(this._setStatus("connecting"),_.delay(this.createChannel,this.delay)),this._failOnClose&&this._setStatus("failed")},createChannelFrame:function(){$(window).on("message",this._onFrameMessage),this.frame.src=t.domain+"/_ah/channel/webview",this.frame.addEventListener("loadstop",this._initializeFrame)},destroyChannelFrame:function(){this.frame&&($(window).off("message",this._onFrameMessage),this.frame.removeEventListener("loadstop",this._initializeFrame),this.frame.src="bogus")},_initializeFrame:function(){this._sendFrameMessage("INITIALIZE")},_openFrameChannel:function(){this._sendFrameMessage("OPEN",{channel_token:this.token})},_onFrameMessage:function(e){var t=e.originalEvent.data;switch(t.type){case"INITIALIZE":this._openFrameChannel();break;case"OPEN":this.onopen();break;case"MESSAGE":this.onmessage(t);break;case"ERROR":this.onerror(t.data);break;case"CLOSE":this.onclose();break;default:console.log("received event: "+t.type)}},_sendFrameMessage:function(e,n){var i={type:e,data:n};this.frame.contentWindow.postMessage(i,t.domain)},_setStatus:function(e){e!=this.status&&(this.status=e,console.log("status="+this.status),this.trigger(e),this.trigger("status",e))},_addWindowListeners:function(){this.hasListeners||(this.hasListeners=!0,$(window).on("mousedown",this._onInteract),$(window).on("focus",this._onInteract))},_onInteract:function(e){this.delay=this.DELAY,this.poll()},createPolling:function(e,t){clearTimeout(this.delayConnectId),this.pollUrl=e,this.pollParams=t||{},this.delay=this.DELAY,this._addWindowListeners(),this.poll()},isPolling:function(){return"polling"==this.status},destroyPolling:function(){this.isPolling()&&(clearTimeout(this.pollId),this.pollRequest=null,this._setStatus("disconnect"))},poll:function(){this.pollRequest||(clearTimeout(this.pollId),this._setStatus("polling"),this.pollRequest=$.ajax({url:this.pollUrl,data:this.pollParams,complete:this._pollComplete,success:this._pollSuccess}))},_pollSuccess:function(e){var t=e.data.channel||[];if(e.data.kill)return this.destroyPolling(),void console.warn("Channel kill request received. Polling stopped.");t.length&&(this.delay=this.DELAY,console.log("Received messages: "),console.log(t)),_.each(t,_.bind(function(e){var t=e.type;this.trigger(t,e)},this))},_pollComplete:function(e){var t=e&&e.status,n=t>=400?t:null;this.pollRequest=null,n&&console.error("Channel polling error "+n+". URL = "+this.pollUrl),this.isPolling()&&(this.delay=2*this.delay,this._delayPoll())},_delayPoll:function(){clearTimeout(this.pollId),console.log("polling delay="+this.delay),this.pollId=_.delay(this.poll,this.delay)},_frameLoaded:function(){return!!this.frame&&(!!this.frame.src&&!(this.frame.src.search("bogus")>=0))},_delayDisconnect:function(){clearTimeout(this.delayDisconnectId),this.delayDisconnectId=_.delay(this.onclose,1e3)}}),r=n.create(i,"notifications");return _.extend(r,e.Events),_notif=r,r}),function(e){if("object"===("undefined"==typeof exports?"undefined":_typeof(exports))&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define("lib/adapter",[],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).adapter=e()}}(function(){return function(){return function e(t,n,i){function r(o,a){if(!n[o]){if(!t[o]){var c="function"==typeof require&&require;if(!a&&c)return c(o,!0);if(s)return s(o,!0);var l=new Error("Cannot find module '"+o+"'");throw l.code="MODULE_NOT_FOUND",l}var u=n[o]={exports:{}};t[o][0].call(u.exports,function(e){return r(t[o][1][e]||e)},u,u.exports,e,t,n,i)}return n[o].exports}for(var s="function"==typeof require&&require,o=0;o<i.length;o++)r(i[o]);return r}}()({1:[function(require,e,exports){var t=require("sdp");function n(e,n,i,r,s){var o=t.writeRtpDescription(e.kind,n);if(o+=t.writeIceParameters(e.iceGatherer.getLocalParameters()),o+=t.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===i?"actpass":s||"active"),o+="a=mid:"+e.mid+"\r\n",e.rtpSender&&e.rtpReceiver?o+="a=sendrecv\r\n":e.rtpSender?o+="a=sendonly\r\n":e.rtpReceiver?o+="a=recvonly\r\n":o+="a=inactive\r\n",e.rtpSender){var a=e.rtpSender._initialTrackId||e.rtpSender.track.id;e.rtpSender._initialTrackId=a;var c="msid:"+(r?r.id:"-")+" "+a+"\r\n";o+="a="+c,o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+c,e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+c,o+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return o+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+t.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(o+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+t.localCName+"\r\n"),o}function i(e,t){var n={codecs:[],headerExtensions:[],fecMechanisms:[]},i=function(e,t){e=parseInt(e,10);for(var n=0;n<t.length;n++)if(t[n].payloadType===e||t[n].preferredPayloadType===e)return t[n]},r=function(e,t,n,r){var s=i(e.parameters.apt,n),o=i(t.parameters.apt,r);return s&&o&&s.name.toLowerCase()===o.name.toLowerCase()};return e.codecs.forEach(function(i){for(var s=0;s<t.codecs.length;s++){var o=t.codecs[s];if(i.name.toLowerCase()===o.name.toLowerCase()&&i.clockRate===o.clockRate){if("rtx"===i.name.toLowerCase()&&i.parameters&&o.parameters.apt&&!r(i,o,e.codecs,t.codecs))continue;(o=JSON.parse(JSON.stringify(o))).numChannels=Math.min(i.numChannels,o.numChannels),n.codecs.push(o),o.rtcpFeedback=o.rtcpFeedback.filter(function(e){for(var t=0;t<i.rtcpFeedback.length;t++)if(i.rtcpFeedback[t].type===e.type&&i.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var i=0;i<t.headerExtensions.length;i++){var r=t.headerExtensions[i];if(e.uri===r.uri){n.headerExtensions.push(r);break}}}),n}function r(e,t,n){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(n)}function s(e,t){var n=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return n||e.addRemoteCandidate(t),!n}function o(e,t){var n=new Error(t);return n.name=e,n.code={NotSupportedError:9,InvalidStateError:11,InvalidAccessError:15,TypeError:void 0,OperationError:void 0}[e],n}e.exports=function(e,a){function c(t,n){n.addTrack(t),n.dispatchEvent(new e.MediaStreamTrackEvent("addtrack",{track:t}))}function l(t,n,i,r){var s=new Event("track");s.track=n,s.receiver=i,s.transceiver={receiver:i},s.streams=r,e.setTimeout(function(){t._dispatchEvent("track",s)})}var u=function(n){var i=this,r=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){i[e]=r[e].bind(r)}),this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this._localDescription=null,this._remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.connectionState="new",this.iceGatheringState="new",n=JSON.parse(JSON.stringify(n||{})),this.usingBundle="max-bundle"===n.bundlePolicy,"negotiate"===n.rtcpMuxPolicy)throw o("NotSupportedError","rtcpMuxPolicy 'negotiate' is not supported");switch(n.rtcpMuxPolicy||(n.rtcpMuxPolicy="require"),n.iceTransportPolicy){case"all":case"relay":break;default:n.iceTransportPolicy="all"}switch(n.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:n.bundlePolicy="balanced"}if(n.iceServers=function(e,t){var n=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var i=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var r="string"==typeof i;return r&&(i=[i]),i=i.filter(function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||n?0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp"):(n=!0,!0)}),delete e.url,e.urls=r?i[0]:i,!!i.length}})}(n.iceServers||[],a),this._iceGatherers=[],n.iceCandidatePoolSize)for(var s=n.iceCandidatePoolSize;s>0;s--)this._iceGatherers.push(new e.RTCIceGatherer({iceServers:n.iceServers,gatherPolicy:n.iceTransportPolicy}));else n.iceCandidatePoolSize=0;this._config=n,this.transceivers=[],this._sdpSessionId=t.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0,this._isClosed=!1};Object.defineProperty(u.prototype,"localDescription",{configurable:!0,get:function(){return this._localDescription}}),Object.defineProperty(u.prototype,"remoteDescription",{configurable:!0,get:function(){return this._remoteDescription}}),u.prototype.onicecandidate=null,u.prototype.onaddstream=null,u.prototype.ontrack=null,u.prototype.onremovestream=null,u.prototype.onsignalingstatechange=null,u.prototype.oniceconnectionstatechange=null,u.prototype.onconnectionstatechange=null,u.prototype.onicegatheringstatechange=null,u.prototype.onnegotiationneeded=null,u.prototype.ondatachannel=null,u.prototype._dispatchEvent=function(e,t){this._isClosed||(this.dispatchEvent(t),"function"==typeof this["on"+e]&&this["on"+e](t))},u.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this._dispatchEvent("icegatheringstatechange",e)},u.prototype.getConfiguration=function(){return this._config},u.prototype.getLocalStreams=function(){return this.localStreams},u.prototype.getRemoteStreams=function(){return this.remoteStreams},u.prototype._createTransceiver=function(e,t){var n=this.transceivers.length>0,i={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,associatedRemoteMediaStreams:[],wantReceive:!0};if(this.usingBundle&&n)i.iceTransport=this.transceivers[0].iceTransport,i.dtlsTransport=this.transceivers[0].dtlsTransport;else{var r=this._createIceAndDtlsTransports();i.iceTransport=r.iceTransport,i.dtlsTransport=r.dtlsTransport}return t||this.transceivers.push(i),i},u.prototype.addTrack=function(t,n){if(this._isClosed)throw o("InvalidStateError","Attempted to call addTrack on a closed peerconnection.");var i;if(this.transceivers.find(function(e){return e.track===t}))throw o("InvalidAccessError","Track already exists.");for(var r=0;r<this.transceivers.length;r++)this.transceivers[r].track||this.transceivers[r].kind!==t.kind||(i=this.transceivers[r]);return i||(i=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(n)&&this.localStreams.push(n),i.track=t,i.stream=n,i.rtpSender=new e.RTCRtpSender(t,i.dtlsTransport),i.rtpSender},u.prototype.addStream=function(e){var t=this;if(a>=15025)e.getTracks().forEach(function(n){t.addTrack(n,e)});else{var n=e.clone();e.getTracks().forEach(function(e,t){var i=n.getTracks()[t];e.addEventListener("enabled",function(e){i.enabled=e.enabled})}),n.getTracks().forEach(function(e){t.addTrack(e,n)})}},u.prototype.removeTrack=function(t){if(this._isClosed)throw o("InvalidStateError","Attempted to call removeTrack on a closed peerconnection.");if(!(t instanceof e.RTCRtpSender))throw new TypeError("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.");var n=this.transceivers.find(function(e){return e.rtpSender===t});if(!n)throw o("InvalidAccessError","Sender was not created by this connection.");var i=n.stream;n.rtpSender.stop(),n.rtpSender=null,n.track=null,n.stream=null,-1===this.transceivers.map(function(e){return e.stream}).indexOf(i)&&this.localStreams.indexOf(i)>-1&&this.localStreams.splice(this.localStreams.indexOf(i),1),this._maybeFireNegotiationNeeded()},u.prototype.removeStream=function(e){var t=this;e.getTracks().forEach(function(e){var n=t.getSenders().find(function(t){return t.track===e});n&&t.removeTrack(n)})},u.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},u.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},u.prototype._createIceGatherer=function(t,n){var i=this;if(n&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var r=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(r,"state",{value:"new",writable:!0}),this.transceivers[t].bufferedCandidateEvents=[],this.transceivers[t].bufferCandidates=function(e){var n=!e.candidate||0===Object.keys(e.candidate).length;r.state=n?"completed":"gathering",null!==i.transceivers[t].bufferedCandidateEvents&&i.transceivers[t].bufferedCandidateEvents.push(e)},r.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),r},u.prototype._gather=function(n,i){var r=this,s=this.transceivers[i].iceGatherer;if(!s.onlocalcandidate){var o=this.transceivers[i].bufferedCandidateEvents;this.transceivers[i].bufferedCandidateEvents=null,s.removeEventListener("localcandidate",this.transceivers[i].bufferCandidates),s.onlocalcandidate=function(e){if(!(r.usingBundle&&i>0)){var o=new Event("icecandidate");o.candidate={sdpMid:n,sdpMLineIndex:i};var a=e.candidate,c=!a||0===Object.keys(a).length;if(c)"new"!==s.state&&"gathering"!==s.state||(s.state="completed");else{"new"===s.state&&(s.state="gathering"),a.component=1,a.ufrag=s.getLocalParameters().usernameFragment;var l=t.writeCandidate(a);o.candidate=Object.assign(o.candidate,t.parseCandidate(l)),o.candidate.candidate=l,o.candidate.toJSON=function(){return{candidate:o.candidate.candidate,sdpMid:o.candidate.sdpMid,sdpMLineIndex:o.candidate.sdpMLineIndex,usernameFragment:o.candidate.usernameFragment}}}var u=t.getMediaSections(r._localDescription.sdp);u[o.candidate.sdpMLineIndex]+=c?"a=end-of-candidates\r\n":"a="+o.candidate.candidate+"\r\n",r._localDescription.sdp=t.getDescription(r._localDescription.sdp)+u.join("");var h=r.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});"gathering"!==r.iceGatheringState&&(r.iceGatheringState="gathering",r._emitGatheringStateChange()),c||r._dispatchEvent("icecandidate",o),h&&(r._dispatchEvent("icecandidate",new Event("icecandidate")),r.iceGatheringState="complete",r._emitGatheringStateChange())}},e.setTimeout(function(){o.forEach(function(e){s.onlocalcandidate(e)})},0)}},u.prototype._createIceAndDtlsTransports=function(){var t=this,n=new e.RTCIceTransport(null);n.onicestatechange=function(){t._updateIceConnectionState(),t._updateConnectionState()};var i=new e.RTCDtlsTransport(n);return i.ondtlsstatechange=function(){t._updateConnectionState()},i.onerror=function(){Object.defineProperty(i,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:n,dtlsTransport:i}},u.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var n=this.transceivers[e].iceTransport;n&&(delete n.onicestatechange,delete this.transceivers[e].iceTransport);var i=this.transceivers[e].dtlsTransport;i&&(delete i.ondtlsstatechange,delete i.onerror,delete this.transceivers[e].dtlsTransport)},u.prototype._transceive=function(e,n,r){var s=i(e.localCapabilities,e.remoteCapabilities);n&&e.rtpSender&&(s.encodings=e.sendEncodingParameters,s.rtcp={cname:t.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(s.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(s)),r&&e.rtpReceiver&&s.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&a<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),e.recvEncodingParameters.length?s.encodings=e.recvEncodingParameters:s.encodings=[{}],s.rtcp={compound:e.rtcpParameters.compound},e.rtcpParameters.cname&&(s.rtcp.cname=e.rtcpParameters.cname),e.sendEncodingParameters.length&&(s.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(s))},u.prototype.setLocalDescription=function(e){var n,s,a=this;if(-1===["offer","answer"].indexOf(e.type))return Promise.reject(o("TypeError",'Unsupported type "'+e.type+'"'));if(!r("setLocalDescription",e.type,a.signalingState)||a._isClosed)return Promise.reject(o("InvalidStateError","Can not set local "+e.type+" in state "+a.signalingState));if("offer"===e.type)n=t.splitSections(e.sdp),s=n.shift(),n.forEach(function(e,n){var i=t.parseRtpParameters(e);a.transceivers[n].localCapabilities=i}),a.transceivers.forEach(function(e,t){a._gather(e.mid,t)});else if("answer"===e.type){n=t.splitSections(a._remoteDescription.sdp),s=n.shift();var c=t.matchPrefix(s,"a=ice-lite").length>0;n.forEach(function(e,n){var r=a.transceivers[n],o=r.iceGatherer,l=r.iceTransport,u=r.dtlsTransport,h=r.localCapabilities,d=r.remoteCapabilities;if(!(t.isRejected(e)&&0===t.matchPrefix(e,"a=bundle-only").length)&&!r.rejected){var f=t.getIceParameters(e,s),p=t.getDtlsParameters(e,s);c&&(p.role="server"),a.usingBundle&&0!==n||(a._gather(r.mid,n),"new"===l.state&&l.start(o,f,c?"controlling":"controlled"),"new"===u.state&&u.start(p));var g=i(h,d);a._transceive(r,g.codecs.length>0,!1)}})}return a._localDescription={type:e.type,sdp:e.sdp},"offer"===e.type?a._updateSignalingState("have-local-offer"):a._updateSignalingState("stable"),Promise.resolve()},u.prototype.setRemoteDescription=function(n){var u=this;if(-1===["offer","answer"].indexOf(n.type))return Promise.reject(o("TypeError",'Unsupported type "'+n.type+'"'));if(!r("setRemoteDescription",n.type,u.signalingState)||u._isClosed)return Promise.reject(o("InvalidStateError","Can not set remote "+n.type+" in state "+u.signalingState));var h={};u.remoteStreams.forEach(function(e){h[e.id]=e});var d=[],f=t.splitSections(n.sdp),p=f.shift(),g=t.matchPrefix(p,"a=ice-lite").length>0,m=t.matchPrefix(p,"a=group:BUNDLE ").length>0;u.usingBundle=m;var _=t.matchPrefix(p,"a=ice-options:")[0];return u.canTrickleIceCandidates=!!_&&_.substr(14).split(" ").indexOf("trickle")>=0,f.forEach(function(r,o){var l=t.splitLines(r),f=t.getKind(r),_=t.isRejected(r)&&0===t.matchPrefix(r,"a=bundle-only").length,v=l[0].substr(2).split(" ")[2],y=t.getDirection(r,p),b=t.parseMsid(r),S=t.getMid(r)||t.generateIdentifier();if(_||"application"===f&&("DTLS/SCTP"===v||"UDP/DTLS/SCTP"===v))u.transceivers[o]={mid:S,kind:f,protocol:v,rejected:!0};else{var C,w,T,k,E,A,x,R,I;!_&&u.transceivers[o]&&u.transceivers[o].rejected&&(u.transceivers[o]=u._createTransceiver(f,!0));var L,M,P=t.parseRtpParameters(r);_||(L=t.getIceParameters(r,p),(M=t.getDtlsParameters(r,p)).role="client"),x=t.parseRtpEncodingParameters(r);var O=t.parseRtcpParameters(r),D=t.matchPrefix(r,"a=end-of-candidates",p).length>0,N=t.matchPrefix(r,"a=candidate:").map(function(e){return t.parseCandidate(e)}).filter(function(e){return 1===e.component});if(("offer"===n.type||"answer"===n.type)&&!_&&m&&o>0&&u.transceivers[o]&&(u._disposeIceAndDtlsTransports(o),u.transceivers[o].iceGatherer=u.transceivers[0].iceGatherer,u.transceivers[o].iceTransport=u.transceivers[0].iceTransport,u.transceivers[o].dtlsTransport=u.transceivers[0].dtlsTransport,u.transceivers[o].rtpSender&&u.transceivers[o].rtpSender.setTransport(u.transceivers[0].dtlsTransport),u.transceivers[o].rtpReceiver&&u.transceivers[o].rtpReceiver.setTransport(u.transceivers[0].dtlsTransport)),"offer"!==n.type||_){if("answer"===n.type&&!_){w=(C=u.transceivers[o]).iceGatherer,T=C.iceTransport,k=C.dtlsTransport,E=C.rtpReceiver,A=C.sendEncodingParameters,R=C.localCapabilities,u.transceivers[o].recvEncodingParameters=x,u.transceivers[o].remoteCapabilities=P,u.transceivers[o].rtcpParameters=O,N.length&&"new"===T.state&&(!g&&!D||m&&0!==o?N.forEach(function(e){s(C.iceTransport,e)}):T.setRemoteCandidates(N)),m&&0!==o||("new"===T.state&&T.start(w,L,"controlling"),"new"===k.state&&k.start(M)),!i(C.localCapabilities,C.remoteCapabilities).codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&C.sendEncodingParameters[0].rtx&&delete C.sendEncodingParameters[0].rtx,u._transceive(C,"sendrecv"===y||"recvonly"===y,"sendrecv"===y||"sendonly"===y),!E||"sendrecv"!==y&&"sendonly"!==y?delete C.rtpReceiver:(I=E.track,b?(h[b.stream]||(h[b.stream]=new e.MediaStream),c(I,h[b.stream]),d.push([I,E,h[b.stream]])):(h.default||(h.default=new e.MediaStream),c(I,h.default),d.push([I,E,h.default])))}}else{(C=u.transceivers[o]||u._createTransceiver(f)).mid=S,C.iceGatherer||(C.iceGatherer=u._createIceGatherer(o,m)),N.length&&"new"===C.iceTransport.state&&(!D||m&&0!==o?N.forEach(function(e){s(C.iceTransport,e)}):C.iceTransport.setRemoteCandidates(N)),R=e.RTCRtpReceiver.getCapabilities(f),a<15019&&(R.codecs=R.codecs.filter(function(e){return"rtx"!==e.name})),A=C.sendEncodingParameters||[{ssrc:1001*(2*o+2)}];var F,j=!1;if("sendrecv"===y||"sendonly"===y){if(j=!C.rtpReceiver,E=C.rtpReceiver||new e.RTCRtpReceiver(C.dtlsTransport,f),j)I=E.track,b&&"-"===b.stream||(b?(h[b.stream]||(h[b.stream]=new e.MediaStream,Object.defineProperty(h[b.stream],"id",{get:function(){return b.stream}})),Object.defineProperty(I,"id",{get:function(){return b.track}}),F=h[b.stream]):(h.default||(h.default=new e.MediaStream),F=h.default)),F&&(c(I,F),C.associatedRemoteMediaStreams.push(F)),d.push([I,E,F])}else C.rtpReceiver&&C.rtpReceiver.track&&(C.associatedRemoteMediaStreams.forEach(function(t){var n,i,r=t.getTracks().find(function(e){return e.id===C.rtpReceiver.track.id});r&&(n=r,(i=t).removeTrack(n),i.dispatchEvent(new e.MediaStreamTrackEvent("removetrack",{track:n})))}),C.associatedRemoteMediaStreams=[]);C.localCapabilities=R,C.remoteCapabilities=P,C.rtpReceiver=E,C.rtcpParameters=O,C.sendEncodingParameters=A,C.recvEncodingParameters=x,u._transceive(u.transceivers[o],!1,j)}}}),void 0===u._dtlsRole&&(u._dtlsRole="offer"===n.type?"active":"passive"),u._remoteDescription={type:n.type,sdp:n.sdp},"offer"===n.type?u._updateSignalingState("have-remote-offer"):u._updateSignalingState("stable"),Object.keys(h).forEach(function(t){var n=h[t];if(n.getTracks().length){if(-1===u.remoteStreams.indexOf(n)){u.remoteStreams.push(n);var i=new Event("addstream");i.stream=n,e.setTimeout(function(){u._dispatchEvent("addstream",i)})}d.forEach(function(e){var t=e[0],i=e[1];n.id===e[2].id&&l(u,t,i,[n])})}}),d.forEach(function(e){e[2]||l(u,e[0],e[1],[])}),e.setTimeout(function(){u&&u.transceivers&&u.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),Promise.resolve()},u.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._isClosed=!0,this._updateSignalingState("closed")},u.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this._dispatchEvent("signalingstatechange",t)},u.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout(function(){if(t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t._dispatchEvent("negotiationneeded",e)}},0))},u.prototype._updateIceConnectionState=function(){var e,t={new:0,closed:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++}),e="new",t.failed>0?e="failed":t.checking>0?e="checking":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0?e="connected":t.completed>0&&(e="completed"),e!==this.iceConnectionState){this.iceConnectionState=e;var n=new Event("iceconnectionstatechange");this._dispatchEvent("iceconnectionstatechange",n)}},u.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++,t[e.dtlsTransport.state]++}),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":t.connected>0&&(e="connected"),e!==this.connectionState){this.connectionState=e;var n=new Event("connectionstatechange");this._dispatchEvent("connectionstatechange",n)}},u.prototype.createOffer=function(){var i=this;if(i._isClosed)return Promise.reject(o("InvalidStateError","Can not call createOffer after close"));var r=i.transceivers.filter(function(e){return"audio"===e.kind}).length,s=i.transceivers.filter(function(e){return"video"===e.kind}).length,c=arguments[0];if(c){if(c.mandatory||c.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==c.offerToReceiveAudio&&(r=!0===c.offerToReceiveAudio?1:!1===c.offerToReceiveAudio?0:c.offerToReceiveAudio),void 0!==c.offerToReceiveVideo&&(s=!0===c.offerToReceiveVideo?1:!1===c.offerToReceiveVideo?0:c.offerToReceiveVideo)}for(i.transceivers.forEach(function(e){"audio"===e.kind?--r<0&&(e.wantReceive=!1):"video"===e.kind&&--s<0&&(e.wantReceive=!1)});r>0||s>0;)r>0&&(i._createTransceiver("audio"),r--),s>0&&(i._createTransceiver("video"),s--);var l=t.writeSessionBoilerplate(i._sdpSessionId,i._sdpSessionVersion++);i.transceivers.forEach(function(n,r){var s=n.track,o=n.kind,c=n.mid||t.generateIdentifier();n.mid=c,n.iceGatherer||(n.iceGatherer=i._createIceGatherer(r,i.usingBundle));var l=e.RTCRtpSender.getCapabilities(o);a<15019&&(l.codecs=l.codecs.filter(function(e){return"rtx"!==e.name})),l.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1"),n.remoteCapabilities&&n.remoteCapabilities.codecs&&n.remoteCapabilities.codecs.forEach(function(t){e.name.toLowerCase()===t.name.toLowerCase()&&e.clockRate===t.clockRate&&(e.preferredPayloadType=t.payloadType)})}),l.headerExtensions.forEach(function(e){(n.remoteCapabilities&&n.remoteCapabilities.headerExtensions||[]).forEach(function(t){e.uri===t.uri&&(e.id=t.id)})});var u=n.sendEncodingParameters||[{ssrc:1001*(2*r+1)}];s&&a>=15019&&"video"===o&&!u[0].rtx&&(u[0].rtx={ssrc:u[0].ssrc+1}),n.wantReceive&&(n.rtpReceiver=new e.RTCRtpReceiver(n.dtlsTransport,o)),n.localCapabilities=l,n.sendEncodingParameters=u}),"max-compat"!==i._config.bundlePolicy&&(l+="a=group:BUNDLE "+i.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),l+="a=ice-options:trickle\r\n",i.transceivers.forEach(function(e,r){l+=n(e,e.localCapabilities,"offer",e.stream,i._dtlsRole),l+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===i.iceGatheringState||0!==r&&i.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,l+="a="+t.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(l+="a=end-of-candidates\r\n"))});var u=new e.RTCSessionDescription({type:"offer",sdp:l});return Promise.resolve(u)},u.prototype.createAnswer=function(){var r=this;if(r._isClosed)return Promise.reject(o("InvalidStateError","Can not call createAnswer after close"));if("have-remote-offer"!==r.signalingState&&"have-local-pranswer"!==r.signalingState)return Promise.reject(o("InvalidStateError","Can not call createAnswer in signalingState "+r.signalingState));var s=t.writeSessionBoilerplate(r._sdpSessionId,r._sdpSessionVersion++);r.usingBundle&&(s+="a=group:BUNDLE "+r.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),s+="a=ice-options:trickle\r\n";var c=t.getMediaSections(r._remoteDescription.sdp).length;r.transceivers.forEach(function(e,t){if(!(t+1>c)){if(e.rejected)return"application"===e.kind?"DTLS/SCTP"===e.protocol?s+="m=application 0 DTLS/SCTP 5000\r\n":s+="m=application 0 "+e.protocol+" webrtc-datachannel\r\n":"audio"===e.kind?s+="m=audio 0 UDP/TLS/RTP/SAVPF 0\r\na=rtpmap:0 PCMU/8000\r\n":"video"===e.kind&&(s+="m=video 0 UDP/TLS/RTP/SAVPF 120\r\na=rtpmap:120 VP8/90000\r\n"),void(s+="c=IN IP4 0.0.0.0\r\na=inactive\r\na=mid:"+e.mid+"\r\n");var o;if(e.stream)"audio"===e.kind?o=e.stream.getAudioTracks()[0]:"video"===e.kind&&(o=e.stream.getVideoTracks()[0]),o&&a>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1});var l=i(e.localCapabilities,e.remoteCapabilities);!l.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,s+=n(e,l,"answer",e.stream,r._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(s+="a=rtcp-rsize\r\n")}});var l=new e.RTCSessionDescription({type:"answer",sdp:s});return Promise.resolve(l)},u.prototype.addIceCandidate=function(e){var n,i=this;return e&&void 0===e.sdpMLineIndex&&!e.sdpMid?Promise.reject(new TypeError("sdpMLineIndex or sdpMid required")):new Promise(function(r,a){if(!i._remoteDescription)return a(o("InvalidStateError","Can not add ICE candidate without a remote description"));if(e&&""!==e.candidate){var c=e.sdpMLineIndex;if(e.sdpMid)for(var l=0;l<i.transceivers.length;l++)if(i.transceivers[l].mid===e.sdpMid){c=l;break}var u=i.transceivers[c];if(!u)return a(o("OperationError","Can not add ICE candidate"));if(u.rejected)return r();var h=Object.keys(e.candidate).length>0?t.parseCandidate(e.candidate):{};if("tcp"===h.protocol&&(0===h.port||9===h.port))return r();if(h.component&&1!==h.component)return r();if((0===c||c>0&&u.iceTransport!==i.transceivers[0].iceTransport)&&!s(u.iceTransport,h))return a(o("OperationError","Can not add ICE candidate"));var d=e.candidate.trim();0===d.indexOf("a=")&&(d=d.substr(2)),(n=t.getMediaSections(i._remoteDescription.sdp))[c]+="a="+(h.type?d:"end-of-candidates")+"\r\n",i._remoteDescription.sdp=t.getDescription(i._remoteDescription.sdp)+n.join("")}else for(var f=0;f<i.transceivers.length&&(i.transceivers[f].rejected||(i.transceivers[f].iceTransport.addRemoteCandidate({}),(n=t.getMediaSections(i._remoteDescription.sdp))[f]+="a=end-of-candidates\r\n",i._remoteDescription.sdp=t.getDescription(i._remoteDescription.sdp)+n.join(""),!i.usingBundle));f++);r()})},u.prototype.getStats=function(t){if(t&&t instanceof e.MediaStreamTrack){var n=null;if(this.transceivers.forEach(function(e){e.rtpSender&&e.rtpSender.track===t?n=e.rtpSender:e.rtpReceiver&&e.rtpReceiver.track===t&&(n=e.rtpReceiver)}),!n)throw o("InvalidAccessError","Invalid selector.");return n.getStats()}var i=[];return this.transceivers.forEach(function(e){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(t){e[t]&&i.push(e[t].getStats())})}),Promise.all(i).then(function(e){var t=new Map;return e.forEach(function(e){e.forEach(function(e){t.set(e.id,e)})}),t})};["RTCRtpSender","RTCRtpReceiver","RTCIceGatherer","RTCIceTransport","RTCDtlsTransport"].forEach(function(t){var n=e[t];if(n&&n.prototype&&n.prototype.getStats){var i=n.prototype.getStats;n.prototype.getStats=function(){return i.apply(this).then(function(e){var t=new Map;return Object.keys(e).forEach(function(n){var i;e[n].type={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[(i=e[n]).type]||i.type,t.set(n,e[n])}),t})}}});var h=["createOffer","createAnswer"];return h.forEach(function(e){var t=u.prototype[e];u.prototype[e]=function(){var e=arguments;return"function"==typeof e[0]||"function"==typeof e[1]?t.apply(this,[arguments[2]]).then(function(t){"function"==typeof e[0]&&e[0].apply(null,[t])},function(t){"function"==typeof e[1]&&e[1].apply(null,[t])}):t.apply(this,arguments)}}),(h=["setLocalDescription","setRemoteDescription","addIceCandidate"]).forEach(function(e){var t=u.prototype[e];u.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]||"function"==typeof e[2]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)},function(t){"function"==typeof e[2]&&e[2].apply(null,[t])}):t.apply(this,arguments)}}),["getStats"].forEach(function(e){var t=u.prototype[e];u.prototype[e]=function(){var e=arguments;return"function"==typeof e[1]?t.apply(this,arguments).then(function(){"function"==typeof e[1]&&e[1].apply(null)}):t.apply(this,arguments)}}),u}},{sdp:2}],2:[function(require,e,exports){var t={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};t.localCName=t.generateIdentifier(),t.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},t.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},t.getDescription=function(e){var n=t.splitSections(e);return n&&n[0]},t.getMediaSections=function(e){var n=t.splitSections(e);return n.shift(),n},t.matchPrefix=function(e,n){return t.splitLines(e).filter(function(e){return 0===e.indexOf(n)})},t.parseCandidate=function(e){for(var t,n={foundation:(t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" "))[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],address:t[4],port:parseInt(t[5],10),type:t[7]},i=8;i<t.length;i+=2)switch(t[i]){case"raddr":n.relatedAddress=t[i+1];break;case"rport":n.relatedPort=parseInt(t[i+1],10);break;case"tcptype":n.tcpType=t[i+1];break;case"ufrag":n.ufrag=t[i+1],n.usernameFragment=t[i+1];break;default:n[t[i]]=t[i+1]}return n},t.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.address||e.ip),t.push(e.port);var n=e.type;return t.push("typ"),t.push(n),"host"!==n&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),(e.usernameFragment||e.ufrag)&&(t.push("ufrag"),t.push(e.usernameFragment||e.ufrag)),"candidate:"+t.join(" ")},t.parseIceOptions=function(e){return e.substr(14).split(" ")},t.parseRtpMap=function(e){var t=e.substr(9).split(" "),n={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),n.name=t[0],n.clockRate=parseInt(t[1],10),n.channels=3===t.length?parseInt(t[2],10):1,n.numChannels=n.channels,n},t.writeRtpMap=function(e){var t=e.payloadType;void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType);var n=e.channels||e.numChannels||1;return"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==n?"/"+n:"")+"\r\n"},t.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},t.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},t.parseFmtp=function(e){for(var t,n={},i=e.substr(e.indexOf(" ")+1).split(";"),r=0;r<i.length;r++)n[(t=i[r].trim().split("="))[0].trim()]=t[1];return n},t.writeFmtp=function(e){var t="",n=e.payloadType;if(void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var i=[];Object.keys(e.parameters).forEach(function(t){e.parameters[t]?i.push(t+"="+e.parameters[t]):i.push(t)}),t+="a=fmtp:"+n+" "+i.join(";")+"\r\n"}return t},t.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},t.writeRtcpFb=function(e){var t="",n=e.payloadType;return void 0!==e.preferredPayloadType&&(n=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+n+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},t.parseSsrcMedia=function(e){var t=e.indexOf(" "),n={ssrc:parseInt(e.substr(7,t-7),10)},i=e.indexOf(":",t);return i>-1?(n.attribute=e.substr(t+1,i-t-1),n.value=e.substr(i+1)):n.attribute=e.substr(t+1),n},t.parseSsrcGroup=function(e){var t=e.substr(13).split(" ");return{semantics:t.shift(),ssrcs:t.map(function(e){return parseInt(e,10)})}},t.getMid=function(e){var n=t.matchPrefix(e,"a=mid:")[0];if(n)return n.substr(6)},t.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},t.getDtlsParameters=function(e,n){return{role:"auto",fingerprints:t.matchPrefix(e+n,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(e,t){var n="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){n+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),n},t.getIceParameters=function(e,n){var i=t.splitLines(e);return{usernameFragment:(i=i.concat(t.splitLines(n))).filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:i.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},t.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},t.parseRtpParameters=function(e){for(var n={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},i=t.splitLines(e)[0].split(" "),r=3;r<i.length;r++){var s=i[r],o=t.matchPrefix(e,"a=rtpmap:"+s+" ")[0];if(o){var a=t.parseRtpMap(o),c=t.matchPrefix(e,"a=fmtp:"+s+" ");switch(a.parameters=c.length?t.parseFmtp(c[0]):{},a.rtcpFeedback=t.matchPrefix(e,"a=rtcp-fb:"+s+" ").map(t.parseRtcpFb),n.codecs.push(a),a.name.toUpperCase()){case"RED":case"ULPFEC":n.fecMechanisms.push(a.name.toUpperCase())}}}return t.matchPrefix(e,"a=extmap:").forEach(function(e){n.headerExtensions.push(t.parseExtmap(e))}),n},t.writeRtpDescription=function(e,n){var i="";i+="m="+e+" ",i+=n.codecs.length>0?"9":"0",i+=" UDP/TLS/RTP/SAVPF ",i+=n.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",i+="c=IN IP4 0.0.0.0\r\n",i+="a=rtcp:9 IN IP4 0.0.0.0\r\n",n.codecs.forEach(function(e){i+=t.writeRtpMap(e),i+=t.writeFmtp(e),i+=t.writeRtcpFb(e)});var r=0;return n.codecs.forEach(function(e){e.maxptime>r&&(r=e.maxptime)}),r>0&&(i+="a=maxptime:"+r+"\r\n"),i+="a=rtcp-mux\r\n",n.headerExtensions&&n.headerExtensions.forEach(function(e){i+=t.writeExtmap(e)}),i},t.parseRtpEncodingParameters=function(e){var n,i=[],r=t.parseRtpParameters(e),s=-1!==r.fecMechanisms.indexOf("RED"),o=-1!==r.fecMechanisms.indexOf("ULPFEC"),a=t.matchPrefix(e,"a=ssrc:").map(function(e){return t.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),c=a.length>0&&a[0].ssrc,l=t.matchPrefix(e,"a=ssrc-group:FID").map(function(e){return e.substr(17).split(" ").map(function(e){return parseInt(e,10)})});l.length>0&&l[0].length>1&&l[0][0]===c&&(n=l[0][1]),r.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var t={ssrc:c,codecPayloadType:parseInt(e.parameters.apt,10)};c&&n&&(t.rtx={ssrc:n}),i.push(t),s&&((t=JSON.parse(JSON.stringify(t))).fec={ssrc:c,mechanism:o?"red+ulpfec":"red"},i.push(t))}}),0===i.length&&c&&i.push({ssrc:c});var u=t.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substr(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substr(5),10)*.95-16e3:void 0,i.forEach(function(e){e.maxBitrate=u})),i},t.parseRtcpParameters=function(e){var n={},i=t.matchPrefix(e,"a=ssrc:").map(function(e){return t.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];i&&(n.cname=i.value,n.ssrc=i.ssrc);var r=t.matchPrefix(e,"a=rtcp-rsize");n.reducedSize=r.length>0,n.compound=0===r.length;var s=t.matchPrefix(e,"a=rtcp-mux");return n.mux=s.length>0,n},t.parseMsid=function(e){var n,i=t.matchPrefix(e,"a=msid:");if(1===i.length)return{stream:(n=i[0].substr(7).split(" "))[0],track:n[1]};var r=t.matchPrefix(e,"a=ssrc:").map(function(e){return t.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return r.length>0?{stream:(n=r[0].value.split(" "))[0],track:n[1]}:void 0},t.generateSessionId=function(){return Math.random().toString().substr(2,21)},t.writeSessionBoilerplate=function(e,n,i){var r=void 0!==n?n:2;return"v=0\r\no="+(i||"thisisadapterortc")+" "+(e||t.generateSessionId())+" "+r+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},t.writeMediaSection=function(e,n,i,r){var s=t.writeRtpDescription(e.kind,n);if(s+=t.writeIceParameters(e.iceGatherer.getLocalParameters()),s+=t.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===i?"actpass":"active"),s+="a=mid:"+e.mid+"\r\n",e.direction?s+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?s+="a=sendrecv\r\n":e.rtpSender?s+="a=sendonly\r\n":e.rtpReceiver?s+="a=recvonly\r\n":s+="a=inactive\r\n",e.rtpSender){var o="msid:"+r.id+" "+e.rtpSender.track.id+"\r\n";s+="a="+o,s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+o,e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+o,s+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return s+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+t.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(s+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+t.localCName+"\r\n"),s},t.getDirection=function(e,n){for(var i=t.splitLines(e),r=0;r<i.length;r++)switch(i[r]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return i[r].substr(2)}return n?t.getDirection(n):"sendrecv"},t.getKind=function(e){return t.splitLines(e)[0].split(" ")[0].substr(2)},t.isRejected=function(e){return"0"===e.split(" ",2)[1]},t.parseMLine=function(e){var n=t.splitLines(e)[0].substr(2).split(" ");return{kind:n[0],port:parseInt(n[1],10),protocol:n[2],fmt:n.slice(3).join(" ")}},t.parseOLine=function(e){var n=t.matchPrefix(e,"o=")[0].substr(2).split(" ");return{username:n[0],sessionId:n[1],sessionVersion:parseInt(n[2],10),netType:n[3],addressType:n[4],address:n[5]}},t.isValidSDP=function(e){if("string"!=typeof e||0===e.length)return!1;for(var n=t.splitLines(e),i=0;i<n.length;i++)if(n[i].length<2||"="!==n[i].charAt(1))return!1;return!0},"object"===(void 0===e?"undefined":_typeof(e))&&(e.exports=t)},{}],3:[function(require,e,exports){(function(t){var n=require("./adapter_factory.js");e.exports=n({window:t.window})}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./adapter_factory.js":4}],4:[function(require,e,exports){var t=require("./utils");e.exports=function(e,n){var i=e&&e.window,r={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var s in n)hasOwnProperty.call(n,s)&&(r[s]=n[s]);var o=t.log,a=t.detectBrowser(i),c=require("./chrome/chrome_shim")||null,l=require("./edge/edge_shim")||null,u=require("./firefox/firefox_shim")||null,h=require("./safari/safari_shim")||null,d=require("./common_shim")||null,f={browserDetails:a,commonShim:d,extractVersion:t.extractVersion,disableLog:t.disableLog,disableWarnings:t.disableWarnings};switch(a.browser){case"chrome":if(!c||!c.shimPeerConnection||!r.shimChrome)return o("Chrome shim is not included in this adapter release."),f;o("adapter.js shimming chrome."),f.browserShim=c,d.shimCreateObjectURL(i),c.shimGetUserMedia(i),c.shimMediaStream(i),c.shimSourceObject(i),c.shimPeerConnection(i),c.shimOnTrack(i),c.shimAddTrackRemoveTrack(i),c.shimGetSendersWithDtmf(i),c.shimSenderReceiverGetStats(i),c.fixNegotiationNeeded(i),d.shimRTCIceCandidate(i),d.shimMaxMessageSize(i),d.shimSendThrowTypeError(i);break;case"firefox":if(!u||!u.shimPeerConnection||!r.shimFirefox)return o("Firefox shim is not included in this adapter release."),f;o("adapter.js shimming firefox."),f.browserShim=u,d.shimCreateObjectURL(i),u.shimGetUserMedia(i),u.shimSourceObject(i),u.shimPeerConnection(i),u.shimOnTrack(i),u.shimRemoveStream(i),u.shimSenderGetStats(i),u.shimReceiverGetStats(i),u.shimRTCDataChannel(i),d.shimRTCIceCandidate(i),d.shimMaxMessageSize(i),d.shimSendThrowTypeError(i);break;case"edge":if(!l||!l.shimPeerConnection||!r.shimEdge)return o("MS edge shim is not included in this adapter release."),f;o("adapter.js shimming edge."),f.browserShim=l,d.shimCreateObjectURL(i),l.shimGetUserMedia(i),l.shimPeerConnection(i),l.shimReplaceTrack(i),d.shimMaxMessageSize(i),d.shimSendThrowTypeError(i);break;case"safari":if(!h||!r.shimSafari)return o("Safari shim is not included in this adapter release."),f;o("adapter.js shimming safari."),f.browserShim=h,d.shimCreateObjectURL(i),h.shimRTCIceServerUrls(i),h.shimCreateOfferLegacy(i),h.shimCallbacksAPI(i),h.shimLocalStreamsAPI(i),h.shimRemoteStreamsAPI(i),h.shimTrackEventTransceiver(i),h.shimGetUserMedia(i),d.shimRTCIceCandidate(i),d.shimMaxMessageSize(i),d.shimSendThrowTypeError(i);break;default:o("Unsupported browser!")}return f}},{"./chrome/chrome_shim":5,"./common_shim":7,"./edge/edge_shim":8,"./firefox/firefox_shim":11,"./safari/safari_shim":13,"./utils":14}],5:[function(require,e,exports){var t=require("../utils.js"),n=t.log;function i(e,t,n){var i=n?"outbound-rtp":"inbound-rtp",r=new Map;if(null===t)return r;var s=[];return e.forEach(function(e){"track"===e.type&&e.trackIdentifier===t.id&&s.push(e)}),s.forEach(function(t){e.forEach(function(n){n.type===i&&n.trackId===t.id&&function e(t,n,i){n&&!i.has(n.id)&&(i.set(n.id,n),Object.keys(n).forEach(function(r){r.endsWith("Id")?e(t,t.get(n[r]),i):r.endsWith("Ids")&&n[r].forEach(function(n){e(t,t.get(n),i)})}))}(e,n,r)})}),r}e.exports={shimGetUserMedia:require("./getusermedia"),shimMediaStream:function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},shimOnTrack:function(e){if("object"!==(void 0===e?"undefined":_typeof(e))||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype)t.wrapPeerConnectionEvent(e,"track",function(e){return e.transceiver||Object.defineProperty(e,"transceiver",{value:{receiver:e.receiver}}),e});else{Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)},enumerable:!0,configurable:!0});var n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var t=this;return t._ontrackpoly||(t._ontrackpoly=function(n){n.stream.addEventListener("addtrack",function(i){var r;r=e.RTCPeerConnection.prototype.getReceivers?t.getReceivers().find(function(e){return e.track&&e.track.id===i.track.id}):{track:i.track};var s=new Event("track");s.track=i.track,s.receiver=r,s.transceiver={receiver:r},s.streams=[n.stream],t.dispatchEvent(s)}),n.stream.getTracks().forEach(function(i){var r;r=e.RTCPeerConnection.prototype.getReceivers?t.getReceivers().find(function(e){return e.track&&e.track.id===i.id}):{track:i};var s=new Event("track");s.track=i,s.receiver=r,s.transceiver={receiver:r},s.streams=[n.stream],t.dispatchEvent(s)})},t.addEventListener("addstream",t._ontrackpoly)),n.apply(t,arguments)}}},shimGetSendersWithDtmf:function(e){if("object"===(void 0===e?"undefined":_typeof(e))&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var n=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,i){var r=n.apply(this,arguments);return r||(r=t(this,e),this._senders.push(r)),r};var i=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){i.apply(this,arguments);var t=this._senders.indexOf(e);-1!==t&&this._senders.splice(t,1)}}var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var n=this;n._senders=n._senders||[],r.apply(n,[e]),e.getTracks().forEach(function(e){n._senders.push(t(n,e))})};var s=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._senders=t._senders||[],s.apply(t,[e]),e.getTracks().forEach(function(e){var n=t._senders.find(function(t){return t.track===e});n&&t._senders.splice(t._senders.indexOf(n),1)})}}else if("object"===(void 0===e?"undefined":_typeof(e))&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var o=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=o.apply(e,[]);return t.forEach(function(t){t._pc=e}),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},shimSenderReceiverGetStats:function(e){if("object"===(void 0===e?"undefined":_typeof(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver){if(!("getStats"in e.RTCRtpSender.prototype)){var n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=n.apply(e,[]);return t.forEach(function(t){t._pc=e}),t});var r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=r.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return i(t,e.track,!0)})}}if(!("getStats"in e.RTCRtpReceiver.prototype)){var s=e.RTCPeerConnection.prototype.getReceivers;s&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=s.apply(e,[]);return t.forEach(function(t){t._pc=e}),t}),t.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){var e=this;return this._pc.getStats().then(function(t){return i(t,e.track,!1)})}}if("getStats"in e.RTCRtpSender.prototype&&"getStats"in e.RTCRtpReceiver.prototype){var o=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){var t,n,i,r=arguments[0];return this.getSenders().forEach(function(e){e.track===r&&(t?i=!0:t=e)}),this.getReceivers().forEach(function(e){return e.track===r&&(n?i=!0:n=e),e.track===r}),i||t&&n?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):t?t.getStats():n?n.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return o.apply(this,arguments)}}}},shimSourceObject:function(e){var t=e&&e.URL;"object"===(void 0===e?"undefined":_typeof(e))&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var n=this;this._srcObject=e,this.src&&t.revokeObjectURL(this.src),e?(this.src=t.createObjectURL(e),e.addEventListener("addtrack",function(){n.src&&t.revokeObjectURL(n.src),n.src=t.createObjectURL(e)}),e.addEventListener("removetrack",function(){n.src&&t.revokeObjectURL(n.src),n.src=t.createObjectURL(e)})):this.src=""}}))},shimAddTrackRemoveTrackWithNative:function(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(function(t){return e._shimmedLocalStreams[t][0]})};var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){if(!n)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};var i=t.apply(this,arguments);return this._shimmedLocalStreams[n.id]?-1===this._shimmedLocalStreams[n.id].indexOf(i)&&this._shimmedLocalStreams[n.id].push(i):this._shimmedLocalStreams[n.id]=[n,i],i};var n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var t=this;this._shimmedLocalStreams=this._shimmedLocalStreams||{},e.getTracks().forEach(function(e){if(t.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")});var i=t.getSenders();n.apply(this,arguments);var r=t.getSenders().filter(function(e){return-1===i.indexOf(e)});this._shimmedLocalStreams[e.id]=[e].concat(r)};var i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[e.id],i.apply(this,arguments)};var r=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;return this._shimmedLocalStreams=this._shimmedLocalStreams||{},e&&Object.keys(this._shimmedLocalStreams).forEach(function(n){var i=t._shimmedLocalStreams[n].indexOf(e);-1!==i&&t._shimmedLocalStreams[n].splice(i,1),1===t._shimmedLocalStreams[n].length&&delete t._shimmedLocalStreams[n]}),r.apply(this,arguments)}},shimAddTrackRemoveTrack:function(e){var n=t.detectBrowser(e);if(e.RTCPeerConnection.prototype.addTrack&&n.version>=65)return this.shimAddTrackRemoveTrackWithNative(e);var i=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=i.apply(this);return e._reverseStreams=e._reverseStreams||{},t.map(function(t){return e._reverseStreams[t.id]})};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var n=this;if(n._streams=n._streams||{},n._reverseStreams=n._reverseStreams||{},t.getTracks().forEach(function(e){if(n.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")}),!n._reverseStreams[t.id]){var i=new e.MediaStream(t.getTracks());n._streams[t.id]=i,n._reverseStreams[i.id]=t,t=i}r.apply(n,[t])};var s=e.RTCPeerConnection.prototype.removeStream;function o(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var i=e._reverseStreams[t],r=e._streams[i.id];n=n.replace(new RegExp(r.id,"g"),i.id)}),new RTCSessionDescription({type:t.type,sdp:n})}e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._streams=t._streams||{},t._reverseStreams=t._reverseStreams||{},s.apply(t,[t._streams[e.id]||e]),delete t._reverseStreams[t._streams[e.id]?t._streams[e.id].id:e.id],delete t._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,n){var i=this;if("closed"===i.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var r=[].slice.call(arguments,1);if(1!==r.length||!r[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(i.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError");i._streams=i._streams||{},i._reverseStreams=i._reverseStreams||{};var s=i._streams[n.id];if(s)s.addTrack(t),Promise.resolve().then(function(){i.dispatchEvent(new Event("negotiationneeded"))});else{var o=new e.MediaStream([t]);i._streams[n.id]=o,i._reverseStreams[o.id]=n,i.addStream(o)}return i.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this,t=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(e,[function(n){var i=o(e,n);t[0].apply(null,[i])},function(e){t[1]&&t[1].apply(null,e)},arguments[2]]):n.apply(e,arguments).then(function(t){return o(e,t)})}});var a=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(e,t){var n=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var i=e._reverseStreams[t],r=e._streams[i.id];n=n.replace(new RegExp(i.id,"g"),r.id)}),new RTCSessionDescription({type:t.type,sdp:n})}(this,arguments[0]),a.apply(this,arguments)):a.apply(this,arguments)};var c=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=c.get.apply(this);return""===e.type?e:o(this,e)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t,n=this;if("closed"===n.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(!(e._pc===n))throw new DOMException("Sender was not created by this connection.","InvalidAccessError");n._streams=n._streams||{},Object.keys(n._streams).forEach(function(i){n._streams[i].getTracks().find(function(t){return e.track===t})&&(t=n._streams[i])}),t&&(1===t.getTracks().length?n.removeStream(n._reverseStreams[t.id]):t.removeTrack(e.track),n.dispatchEvent(new Event("negotiationneeded")))}},shimPeerConnection:function(e){var i=t.detectBrowser(e);!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=function(t,i){return n("PeerConnection"),t&&t.iceTransportPolicy&&(t.iceTransports=t.iceTransportPolicy),new e.webkitRTCPeerConnection(t,i)},e.RTCPeerConnection.prototype=e.webkitRTCPeerConnection.prototype,e.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.webkitRTCPeerConnection.generateCertificate}}));var r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,t,n){var i=this,s=arguments;if(arguments.length>0&&"function"==typeof e)return r.apply(this,arguments);if(0===r.length&&(0===arguments.length||"function"!=typeof arguments[0]))return r.apply(this,[]);var o=function(e){var t={};return e.result().forEach(function(e){var n={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){n[t]=e.stat(t)}),t[n.id]=n}),t},a=function(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};if(arguments.length>=2){return r.apply(this,[function(e){s[1](a(o(e)))},arguments[0]])}return new Promise(function(e,t){r.apply(i,[function(t){e(a(o(t)))},t])}).then(t,n)},i.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=arguments,t=this,i=new Promise(function(i,r){n.apply(t,[e[0],i,r])});return e.length<2?i:i.then(function(){e[1].apply(null,[])},function(t){e.length>=3&&e[2].apply(null,[t])})}}),i.version<52&&["createOffer","createAnswer"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"===_typeof(arguments[0])){var t=1===arguments.length?arguments[0]:void 0;return new Promise(function(i,r){n.apply(e,[i,r,t])})}return n.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}});var s=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?s.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}},fixNegotiationNeeded:function(e){t.wrapPeerConnectionEvent(e,"negotiationneeded",function(e){if("stable"===e.target.signalingState)return e})},shimGetDisplayMedia:function(e,t){"getDisplayMedia"in e.navigator||("function"==typeof t?navigator.getDisplayMedia=function(e){return t(e).then(function(t){return e.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:t,maxFrameRate:e.video.frameRate||3}},navigator.mediaDevices.getUserMedia(e)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}}},{"../utils.js":14,"./getusermedia":6}],6:[function(require,e,exports){var t=require("../utils.js"),n=t.log;e.exports=function(e){var i=t.detectBrowser(e),r=e&&e.navigator,s=function(e){if("object"!==(void 0===e?"undefined":_typeof(e))||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(n){if("require"!==n&&"advanced"!==n&&"mediaSource"!==n){var i="object"===_typeof(e[n])?e[n]:{ideal:e[n]};void 0!==i.exact&&"number"==typeof i.exact&&(i.min=i.max=i.exact);var r=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==i.ideal){t.optional=t.optional||[];var s={};"number"==typeof i.ideal?(s[r("min",n)]=i.ideal,t.optional.push(s),(s={})[r("max",n)]=i.ideal,t.optional.push(s)):(s[r("",n)]=i.ideal,t.optional.push(s))}void 0!==i.exact&&"number"!=typeof i.exact?(t.mandatory=t.mandatory||{},t.mandatory[r("",n)]=i.exact):["min","max"].forEach(function(e){void 0!==i[e]&&(t.mandatory=t.mandatory||{},t.mandatory[r(e,n)]=i[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},o=function(e,t){if(i.version>=61)return t(e);if((e=JSON.parse(JSON.stringify(e)))&&"object"===_typeof(e.audio)){var o=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])};o((e=JSON.parse(JSON.stringify(e))).audio,"autoGainControl","googAutoGainControl"),o(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=s(e.audio)}if(e&&"object"===_typeof(e.video)){var a=e.video.facingMode;a=a&&("object"===(void 0===a?"undefined":_typeof(a))?a:{ideal:a});var c,l=i.version<66;if(a&&("user"===a.exact||"environment"===a.exact||"user"===a.ideal||"environment"===a.ideal)&&(!r.mediaDevices.getSupportedConstraints||!r.mediaDevices.getSupportedConstraints().facingMode||l))if(delete e.video.facingMode,"environment"===a.exact||"environment"===a.ideal?c=["back","rear"]:"user"!==a.exact&&"user"!==a.ideal||(c=["front"]),c)return r.mediaDevices.enumerateDevices().then(function(i){var r=(i=i.filter(function(e){return"videoinput"===e.kind})).find(function(e){return c.some(function(t){return-1!==e.label.toLowerCase().indexOf(t)})});return!r&&i.length&&-1!==c.indexOf("back")&&(r=i[i.length-1]),r&&(e.video.deviceId=a.exact?{exact:r.deviceId}:{ideal:r.deviceId}),e.video=s(e.video),n("chrome: "+JSON.stringify(e)),t(e)});e.video=s(e.video)}return n("chrome: "+JSON.stringify(e)),t(e)},a=function(e){return i.version>=64?e:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[e.name]||e.name,message:e.message,constraint:e.constraint||e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}};r.getUserMedia=function(e,t,n){o(e,function(e){r.webkitGetUserMedia(e,t,function(e){n&&n(a(e))})})};var c=function(e){return new Promise(function(t,n){r.getUserMedia(e,t,n)})};if(r.mediaDevices||(r.mediaDevices={getUserMedia:c,enumerateDevices:function(){return new Promise(function(t){var n={audio:"audioinput",video:"videoinput"};return e.MediaStreamTrack.getSources(function(e){t(e.map(function(e){return{label:e.label,kind:n[e.kind],deviceId:e.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),r.mediaDevices.getUserMedia){var l=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(e){return o(e,function(e){return l(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return Promise.reject(a(e))})})}}else r.mediaDevices.getUserMedia=function(e){return c(e)};void 0===r.mediaDevices.addEventListener&&(r.mediaDevices.addEventListener=function(){n("Dummy mediaDevices.addEventListener called.")}),void 0===r.mediaDevices.removeEventListener&&(r.mediaDevices.removeEventListener=function(){n("Dummy mediaDevices.removeEventListener called.")})}},{"../utils.js":14}],7:[function(require,e,exports){var t=require("sdp"),n=require("./utils");e.exports={shimRTCIceCandidate:function(e){if(e.RTCIceCandidate&&!(e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var i=e.RTCIceCandidate;e.RTCIceCandidate=function(e){if("object"===(void 0===e?"undefined":_typeof(e))&&e.candidate&&0===e.candidate.indexOf("a=")&&((e=JSON.parse(JSON.stringify(e))).candidate=e.candidate.substr(2)),e.candidate&&e.candidate.length){var n=new i(e),r=t.parseCandidate(e.candidate),s=Object.assign(n,r);return s.toJSON=function(){return{candidate:s.candidate,sdpMid:s.sdpMid,sdpMLineIndex:s.sdpMLineIndex,usernameFragment:s.usernameFragment}},s}return new i(e)},e.RTCIceCandidate.prototype=i.prototype,n.wrapPeerConnectionEvent(e,"icecandidate",function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t})}},shimCreateObjectURL:function(e){var t=e&&e.URL;if("object"===(void 0===e?"undefined":_typeof(e))&&e.HTMLMediaElement&&"srcObject"in e.HTMLMediaElement.prototype&&t.createObjectURL&&t.revokeObjectURL){var i=t.createObjectURL.bind(t),r=t.revokeObjectURL.bind(t),s=new Map,o=0;t.createObjectURL=function(e){if("getTracks"in e){var t="polyblob:"+ ++o;return s.set(t,e),n.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),t}return i(e)},t.revokeObjectURL=function(e){r(e),s.delete(e)};var a=Object.getOwnPropertyDescriptor(e.HTMLMediaElement.prototype,"src");Object.defineProperty(e.HTMLMediaElement.prototype,"src",{get:function(){return a.get.apply(this)},set:function(e){return this.srcObject=s.get(e)||null,a.set.apply(this,[e])}});var c=e.HTMLMediaElement.prototype.setAttribute;e.HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=s.get(arguments[1])||null),c.apply(this,arguments)}}},shimMaxMessageSize:function(e){if(!e.RTCSctpTransport&&e.RTCPeerConnection){var i=n.detectBrowser(e);"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get:function(){return void 0===this._sctp?null:this._sctp}});var r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e,n,s,o;if(this._sctp=null,s=arguments[0],(o=t.splitSections(s.sdp)).shift(),o.some(function(e){var n=t.parseMLine(e);return n&&"application"===n.kind&&-1!==n.protocol.indexOf("SCTP")})){var a,c=function(e){var t=e.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(null===t||t.length<2)return-1;var n=parseInt(t[1],10);return n!=n?-1:n}(arguments[0]),l=(e=c,n=65536,"firefox"===i.browser&&(n=i.version<57?-1===e?16384:2147483637:i.version<60?57===i.version?65535:65536:2147483637),n),u=function(e,n){var r=65536;"firefox"===i.browser&&57===i.version&&(r=65535);var s=t.matchPrefix(e.sdp,"a=max-message-size:");return s.length>0?r=parseInt(s[0].substr(19),10):"firefox"===i.browser&&-1!==n&&(r=2147483637),r}(arguments[0],c);a=0===l&&0===u?Number.POSITIVE_INFINITY:0===l||0===u?Math.max(l,u):Math.min(l,u);var h={};Object.defineProperty(h,"maxMessageSize",{get:function(){return a}}),this._sctp=h}return r.apply(this,arguments)}}},shimSendThrowTypeError:function(e){if(e.RTCPeerConnection&&"createDataChannel"in e.RTCPeerConnection.prototype){var t=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){var e=t.apply(this,arguments);return i(e,this),e},n.wrapPeerConnectionEvent(e,"datachannel",function(e){return i(e.channel,e.target),e})}function i(e,t){var n=e.send;e.send=function(){var i=arguments[0],r=i.length||i.size||i.byteLength;if("open"===e.readyState&&t.sctp&&r>t.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+t.sctp.maxMessageSize+" bytes)");return n.apply(e,arguments)}}}}},{"./utils":14,sdp:2}],8:[function(require,e,exports){var t=require("../utils"),n=require("./filtericeservers"),i=require("rtcpeerconnection-shim");e.exports={shimGetUserMedia:require("./getusermedia"),shimPeerConnection:function(e){var r=t.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),r.version<15025)){var s=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){s.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCDtmfSender&&!e.RTCDTMFSender&&(e.RTCDTMFSender=e.RTCDtmfSender);var o=i(e,r.version);e.RTCPeerConnection=function(e){return e&&e.iceServers&&(e.iceServers=n(e.iceServers)),new o(e)},e.RTCPeerConnection.prototype=o.prototype},shimReplaceTrack:function(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}}},{"../utils":14,"./filtericeservers":9,"./getusermedia":10,"rtcpeerconnection-shim":1}],9:[function(require,e,exports){var t=require("../utils");e.exports=function(e,n){var i=!1;return(e=JSON.parse(JSON.stringify(e))).filter(function(e){if(e&&(e.urls||e.url)){var r=e.urls||e.url;e.url&&!e.urls&&t.deprecated("RTCIceServer.url","RTCIceServer.urls");var s="string"==typeof r;return s&&(r=[r]),r=r.filter(function(e){return 0===e.indexOf("turn:")&&-1!==e.indexOf("transport=udp")&&-1===e.indexOf("turn:[")&&!i?(i=!0,!0):0===e.indexOf("stun:")&&n>=14393&&-1===e.indexOf("?transport=udp")}),delete e.url,e.urls=s?r[0]:r,!!r.length}})}},{"../utils":14}],10:[function(require,e,exports){e.exports=function(e){var t=e&&e.navigator,n=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return n(e).catch(function(e){return Promise.reject(function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}}(e))})}}},{}],11:[function(require,e,exports){var t=require("../utils");e.exports={shimGetUserMedia:require("./getusermedia"),shimOnTrack:function(e){"object"!==(void 0===e?"undefined":_typeof(e))||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var n=new Event("track");n.track=t,n.receiver={track:t},n.transceiver={receiver:n.receiver},n.streams=[e.stream],this.dispatchEvent(n)}.bind(this))}.bind(this))},enumerable:!0,configurable:!0}),"object"===(void 0===e?"undefined":_typeof(e))&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(e){"object"===(void 0===e?"undefined":_typeof(e))&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(e){var n=t.detectBrowser(e);if("object"===(void 0===e?"undefined":_typeof(e))&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){e.RTCPeerConnection||(e.RTCPeerConnection=function(t,i){if(n.version<38&&t&&t.iceServers){for(var r=[],s=0;s<t.iceServers.length;s++){var o=t.iceServers[s];if(o.hasOwnProperty("urls"))for(var a=0;a<o.urls.length;a++){var c={url:o.urls[a]};0===o.urls[a].indexOf("turn")&&(c.username=o.username,c.credential=o.credential),r.push(c)}else r.push(t.iceServers[s])}t.iceServers=r}return new e.mozRTCPeerConnection(t,i)},e.RTCPeerConnection.prototype=e.mozRTCPeerConnection.prototype,e.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.mozRTCPeerConnection.generateCertificate}}),e.RTCSessionDescription=e.mozRTCSessionDescription,e.RTCIceCandidate=e.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var n=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),n.apply(this,arguments)}});var i=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var r={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},s=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,t,i){return s.apply(this,[e||null]).then(function(e){if(n.version<48&&(e=function(e){var t=new Map;return Object.keys(e).forEach(function(n){t.set(n,e[n]),t[n]=e[n]}),t}(e)),n.version<53&&!t)try{e.forEach(function(e){e.type=r[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach(function(t,n){e.set(n,Object.assign({},t,{type:r[t.type]||t.type}))})}return e}).then(t,i)}}},shimSenderGetStats:function(e){if("object"===(void 0===e?"undefined":_typeof(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)){var t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){var e=this,n=t.apply(e,[]);return n.forEach(function(t){t._pc=e}),n});var n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){var e=n.apply(this,arguments);return e._pc=this,e}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}},shimReceiverGetStats:function(e){if("object"===(void 0===e?"undefined":_typeof(e))&&e.RTCPeerConnection&&e.RTCRtpSender&&!(e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)){var n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){var e=this,t=n.apply(e,[]);return t.forEach(function(t){t._pc=e}),t}),t.wrapPeerConnectionEvent(e,"track",function(e){return e.receiver._pc=e.srcElement,e}),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}},shimRemoveStream:function(e){!e.RTCPeerConnection||"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){var n=this;t.deprecated("removeStream","removeTrack"),this.getSenders().forEach(function(t){t.track&&-1!==e.getTracks().indexOf(t.track)&&n.removeTrack(t)})})},shimRTCDataChannel:function(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)},shimGetDisplayMedia:function(e,t){"getDisplayMedia"in e.navigator||(navigator.getDisplayMedia=function(e){if(!e||!e.video){var n=new DOMException("getDisplayMedia without video constraints is undefined");return n.name="NotFoundError",n.code=8,Promise.reject(n)}return!0===e.video?e.video={mediaSource:t}:e.video.mediaSource=t,navigator.mediaDevices.getUserMedia(e)})}}},{"../utils":14,"./getusermedia":12}],12:[function(require,e,exports){var t=require("../utils"),n=t.log;e.exports=function(e){var i=t.detectBrowser(e),r=e&&e.navigator,s=e&&e.MediaStreamTrack,o=function(e){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},a=function(e,t,s){var a=function(e){if("object"!==(void 0===e?"undefined":_typeof(e))||e.require)return e;var require=[];return Object.keys(e).forEach(function(t){if("require"!==t&&"advanced"!==t&&"mediaSource"!==t){var n=e[t]="object"===_typeof(e[t])?e[t]:{ideal:e[t]};if(void 0===n.min&&void 0===n.max&&void 0===n.exact||require.push(t),void 0!==n.exact&&("number"==typeof n.exact?n.min=n.max=n.exact:e[t]=n.exact,delete n.exact),void 0!==n.ideal){e.advanced=e.advanced||[];var i={};"number"==typeof n.ideal?i[t]={min:n.ideal,max:n.ideal}:i[t]=n.ideal,e.advanced.push(i),delete n.ideal,Object.keys(n).length||delete e[t]}}}),require.length&&(e.require=require),e};return e=JSON.parse(JSON.stringify(e)),i.version<38&&(n("spec: "+JSON.stringify(e)),e.audio&&(e.audio=a(e.audio)),e.video&&(e.video=a(e.video)),n("ff37: "+JSON.stringify(e))),r.mozGetUserMedia(e,t,function(e){s(o(e))})};if(r.mediaDevices||(r.mediaDevices={getUserMedia:function(e){return new Promise(function(t,n){a(e,t,n)})},addEventListener:function(){},removeEventListener:function(){}}),r.mediaDevices.enumerateDevices=r.mediaDevices.enumerateDevices||function(){return new Promise(function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},i.version<41){var c=r.mediaDevices.enumerateDevices.bind(r.mediaDevices);r.mediaDevices.enumerateDevices=function(){return c().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(i.version<49){var l=r.mediaDevices.getUserMedia.bind(r.mediaDevices);r.mediaDevices.getUserMedia=function(e){return l(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("The object can not be found here.","NotFoundError");return t},function(e){return Promise.reject(o(e))})}}if(!(i.version>55&&"autoGainControl"in r.mediaDevices.getSupportedConstraints())){var u=function(e,t,n){t in e&&!(n in e)&&(e[n]=e[t],delete e[t])},h=r.mediaDevices.getUserMedia.bind(r.mediaDevices);if(r.mediaDevices.getUserMedia=function(e){return"object"===(void 0===e?"undefined":_typeof(e))&&"object"===_typeof(e.audio)&&(e=JSON.parse(JSON.stringify(e)),u(e.audio,"autoGainControl","mozAutoGainControl"),u(e.audio,"noiseSuppression","mozNoiseSuppression")),h(e)},s&&s.prototype.getSettings){var d=s.prototype.getSettings;s.prototype.getSettings=function(){var e=d.apply(this,arguments);return u(e,"mozAutoGainControl","autoGainControl"),u(e,"mozNoiseSuppression","noiseSuppression"),e}}if(s&&s.prototype.applyConstraints){var f=s.prototype.applyConstraints;s.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"===(void 0===e?"undefined":_typeof(e))&&(e=JSON.parse(JSON.stringify(e)),u(e,"autoGainControl","mozAutoGainControl"),u(e,"noiseSuppression","mozNoiseSuppression")),f.apply(this,[e])}}}r.getUserMedia=function(e,n,s){if(i.version<44)return a(e,n,s);t.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),r.mediaDevices.getUserMedia(e).then(n,s)}}},{"../utils":14}],13:[function(require,e,exports){var t=require("../utils");e.exports={shimLocalStreamsAPI:function(e){if("object"===(void 0===e?"undefined":_typeof(e))&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getStreamById=function(e){var t=null;return this._localStreams&&this._localStreams.forEach(function(n){n.id===e&&(t=n)}),this._remoteStreams&&this._remoteStreams.forEach(function(n){n.id===e&&(t=n)}),t}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),-1===this._localStreams.indexOf(e)&&this._localStreams.push(e);var n=this;e.getTracks().forEach(function(i){t.call(n,i,e)})},e.RTCPeerConnection.prototype.addTrack=function(e,n){return n&&(this._localStreams?-1===this._localStreams.indexOf(n)&&this._localStreams.push(n):this._localStreams=[n]),t.call(this,e,n)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);var t=this._localStreams.indexOf(e);if(-1!==t){this._localStreams.splice(t,1);var n=this,i=e.getTracks();this.getSenders().forEach(function(e){-1!==i.indexOf(e.track)&&n.removeTrack(e)})}})}},shimRemoteStreamsAPI:function(e){if("object"===(void 0===e?"undefined":_typeof(e))&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){this._onaddstream&&this.removeEventListener("addstream",this._onaddstream),this.addEventListener("addstream",this._onaddstream=e)}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var e=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(t){t.streams.forEach(function(t){if(e._remoteStreams||(e._remoteStreams=[]),!(e._remoteStreams.indexOf(t)>=0)){e._remoteStreams.push(t);var n=new Event("addstream");n.stream=t,e.dispatchEvent(n)}})}),t.apply(e,arguments)}}},shimCallbacksAPI:function(e){if("object"===(void 0===e?"undefined":_typeof(e))&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,n=t.createOffer,i=t.createAnswer,r=t.setLocalDescription,s=t.setRemoteDescription,o=t.addIceCandidate;t.createOffer=function(e,t){var i=arguments.length>=2?arguments[2]:arguments[0],r=n.apply(this,[i]);return t?(r.then(e,t),Promise.resolve()):r},t.createAnswer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],r=i.apply(this,[n]);return t?(r.then(e,t),Promise.resolve()):r};var a=function(e,t,n){var i=r.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i};t.setLocalDescription=a,a=function(e,t,n){var i=s.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i},t.setRemoteDescription=a,a=function(e,t,n){var i=o.apply(this,[e]);return n?(i.then(t,n),Promise.resolve()):i},t.addIceCandidate=a}},shimGetUserMedia:function(e){var t=e&&e.navigator;t.getUserMedia||(t.webkitGetUserMedia?t.getUserMedia=t.webkitGetUserMedia.bind(t):t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,n,i){t.mediaDevices.getUserMedia(e).then(n,i)}.bind(t)))},shimRTCIceServerUrls:function(e){var n=e.RTCPeerConnection;e.RTCPeerConnection=function(e,i){if(e&&e.iceServers){for(var r=[],s=0;s<e.iceServers.length;s++){var o=e.iceServers[s];!o.hasOwnProperty("urls")&&o.hasOwnProperty("url")?(t.deprecated("RTCIceServer.url","RTCIceServer.urls"),(o=JSON.parse(JSON.stringify(o))).urls=o.url,delete o.url,r.push(o)):r.push(e.iceServers[s])}e.iceServers=r}return new n(e,i)},e.RTCPeerConnection.prototype=n.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return n.generateCertificate}})},shimTrackEventTransceiver:function(e){"object"===(void 0===e?"undefined":_typeof(e))&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimCreateOfferLegacy:function(e){var t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(e){var n=this;if(e){void 0!==e.offerToReceiveAudio&&(e.offerToReceiveAudio=!!e.offerToReceiveAudio);var i=n.getTransceivers().find(function(e){return e.sender.track&&"audio"===e.sender.track.kind});!1===e.offerToReceiveAudio&&i?"sendrecv"===i.direction?i.setDirection?i.setDirection("sendonly"):i.direction="sendonly":"recvonly"===i.direction&&(i.setDirection?i.setDirection("inactive"):i.direction="inactive"):!0!==e.offerToReceiveAudio||i||n.addTransceiver("audio"),void 0!==e.offerToReceiveVideo&&(e.offerToReceiveVideo=!!e.offerToReceiveVideo);var r=n.getTransceivers().find(function(e){return e.sender.track&&"video"===e.sender.track.kind});!1===e.offerToReceiveVideo&&r?"sendrecv"===r.direction?r.setDirection("sendonly"):"recvonly"===r.direction&&r.setDirection("inactive"):!0!==e.offerToReceiveVideo||r||n.addTransceiver("video")}return t.apply(n,arguments)}}}},{"../utils":14}],14:[function(require,e,exports){var t=!0,n=!0;function i(e,t,n){var i=e.match(t);return i&&i.length>=n&&parseInt(i[n],10)}e.exports={extractVersion:i,wrapPeerConnectionEvent:function(e,t,n){if(e.RTCPeerConnection){var i=e.RTCPeerConnection.prototype,r=i.addEventListener;i.addEventListener=function(e,i){if(e!==t)return r.apply(this,arguments);var s=function(e){var t=n(e);t&&i(t)};return this._eventMap=this._eventMap||{},this._eventMap[i]=s,r.apply(this,[e,s])};var s=i.removeEventListener;i.removeEventListener=function(e,n){if(e!==t||!this._eventMap||!this._eventMap[n])return s.apply(this,arguments);var i=this._eventMap[n];return delete this._eventMap[n],s.apply(this,[e,i])},Object.defineProperty(i,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)},enumerable:!0,configurable:!0})}},disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+(void 0===e?"undefined":_typeof(e))+". Please use a boolean."):(t=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},disableWarnings:function(e){return"boolean"!=typeof e?new Error("Argument type: "+(void 0===e?"undefined":_typeof(e))+". Please use a boolean."):(n=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},log:function(){if("object"===("undefined"==typeof window?"undefined":_typeof(window))){if(t)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},deprecated:function(e,t){n&&console.warn(e+" is deprecated, please use "+t+" instead.")},detectBrowser:function(e){var t=e&&e.navigator,n={browser:null,version:null};if(void 0===e||!e.navigator)return n.browser="Not a browser.",n;if(t.mozGetUserMedia)n.browser="firefox",n.version=i(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia)n.browser="chrome",n.version=i(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))n.browser="edge",n.version=i(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!e.RTCPeerConnection||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return n.browser="Not a supported browser.",n;n.browser="safari",n.version=i(t.userAgent,/AppleWebKit\/(\d+)\./,1)}return n}},window.attachMediaStream=function(e,t){void 0!==e.srcObject?e.srcObject=t||null:void 0!==e.mozSrcObject?e.mozSrcObject=t||null:void 0!==e.src?e.src=t?URL.createObjectURL(t):"":console.log("Error attaching stream to element.")},window.reattachMediaStream=function(e,t){e.src=t.src},window.getUserMedia=function(){return navigator.getUserMedia.apply(navigator,arguments)};var r=navigator&&navigator.mediaDevices&&navigator.userAgent.match(/Edge\/(\d+).(\d+)$/),s=!1;r&&function e(){if(!s)if(window.RTCPeerConnection){s=!0;var t=window.RTCPeerConnection.prototype.close;window.RTCPeerConnection.prototype.close=function(){this.getLocalStreams().forEach(function(e){e.getTracks().forEach(function(e){e.stop()})}),t.apply(this,arguments)}}else setTimeout(e,0)}()},{}]},{},[3])(3)}),define("objects/peer_connection",["lib/adapter","models/session","fslib/object","fslib/fsutil"],function(e,t,n,i){var r,s="ready",o="connected",a="failed",c=/a=rtpmap:(\d+) \w+\/\d+/;return n.extend({ICE_TYPE:{HOST:"typ host",STUN:"typ srflx",TURN:"typ relay"},_iceGatheringTimeout:3500,initialize:function(){n.prototype.initialize.apply(this,arguments),this._resetPC(),this._setConnectionState(s),this.validCandidates={turn:1,stun:1,host:1}},_setConnectionState:function(e){this.connectionState=e},open:function(e){this.useTurnOnly(),this._createPC(e)},close:function(){if(this._resetPC(),this._pc){this._log("Closing Connection");try{_.each(this._pc.getLocalStreams(),this._stopStream),"closed"!==this._pc.signalingState&&this._pc.close(),this._pc=null}catch(e){this._warn("Exception disposing peer connection",e)}this.signalingState=null,this.iceConnectionState=null,this.iceGatheringState=null,this.trigger("closed")}},isClosed:function(){return!this._pc},_stopStream:function(e){e&&_.each(e.getTracks(),this._stopTrack)},_stopTrack:function(e){e.stop&&e.stop()},_resetPC:function(){this._gatheringDone=!1,this._dontGatherCandidates=!1,this._establishingBetterConnection=!1,this._hasEstablishedBetterConnection=!1,this._candidateQueue=[],this._candidateReceivedCt=0,this._candidateGatheredCt=0,this._eventQueue=[],this._removeListeners(),this._resetPcItems(),this._clearIceGatheringTimeout()},_resetPcItems:function(){this._gatheredPcItems={candidates:[],offer:"",answer:""},this._processedPcItems={candidates:[],offer:"",answer:""},this._queuedPcItems={candidates:[]}},_addPcItem:function(e,t){var n="gathered"===t?this._gatheredPcItems:this._processedPcItems;switch(e.type){case"offer":n.offer=e;break;case"answer":n.answer=e;break;default:n.candidates.push(e)}},_addProcessedPcItem:function(e){this._addPcItem(e,"processed")},_addGatheredPcItem:function(e){"offer"===e.type&&(this._gatheredPcItems.candidates=[]),this._addPcItem(e,"gathered")},_addQueuedPcItem:function(e){this._queuedPcItems.candidates.push(e)},_sendQueuedCandidates:function(){this._log("SENDING QUEUED CANDIDATES (",this._queuedPcItems.candidates.length,") to establish better connection");for(var e=0;e<this._queuedPcItems.candidates.length;e++)this.trigger("iceCandidate",this._queuedPcItems.candidates[e]);this._queuedPcItems.candidates=[]},retryCandidates:function(){this._log("RETRY (Candidates)");for(var e=0;e<this._gatheredPcItems.candidates.length;e++)this.trigger("iceCandidate",this._gatheredPcItems.candidates[e])},retryOffer:function(){this._log("RETRY (Offer)"),this.trigger("offerCreated",this._gatheredPcItems.offer),this.retryCandidates()},retryAnswer:function(){this._log("RETRY (Answer)"),this.trigger("answerCreated",this._gatheredPcItems.answer),this.retryCandidates()},_alreadyProcessedOffer:function(e){return!!this._processedPcItems.offer&&this._processedPcItems.offer.sdp===e},_alreadyProcessedAnswer:function(e){return!!this._processedPcItems.answer&&this._processedPcItems.answer.sdp===e},canEstablishConnection:function(){return this._pc&&"stable"===this._pc.signalingState&&this._pc.remoteDescription&&this._pc.remoteDescription.sdp},_createPC:function(){this._pc&&this.close(),this.config=this._getConfiguration(),this._log("Creating Peer Connection with configuration",this.config),this._pc=new RTCPeerConnection(this.config),this._addListeners()},_addListeners:function(){this._pc.oniceconnectionstatechange=this._onIceConnectionStateChange,this._pc.onsignalingstatechange=this._onSignalingStateChange,this._pc.onicecandidate=this._onIceCandidate,this.listenTo(this,"icegatheringstatechange:jssip",this._onIceGatheringStateChange)},_removeListeners:function(){this._pc&&(this._pc.oniceconnectionstatechange=null,this._pc.onsignalingstatechange=null,this._pc.onicecandidate=null,this._pc.onicegatheringstatechange=null,this.stopListening(this,"icegatheringstatechange:jssip"))},_getConfiguration:function(){return r&&r.iceServers?r:this._buildConfiguration()},_buildConfiguration:function(){for(var e,n=t.getSipConfig(),i=[],s={},o=n.stunServers||[],a=0;a<o.length;a++)!s[e=o[a]]&&i.push(this._buildIceServer(e)),s[e]=1;for(a=0;a<5;a++)!s[e="stun:stun"+(a||"")+".l.google.com:19302"]&&i.push(this._buildIceServer(e)),s[e]=1;var c=n.turnServers;for(a=0;a<c.length;a++){var l=c[a];!s[e=l.server]&&i.push(this._buildIceServer(e,l.username||"fstelephony",l.password||"firespotter1234")),s[e]=1}return(r=r||{}).iceServers=i,r},_buildIceServer:function(e,t,n){n=n||t;var i={urls:e};return t&&(i.username=t),n&&(i.credential=n),i},_onIceConnectionStateChange:function(e){var t=e.target.iceConnectionState;switch(this._log("Ice Connection State",t),t){case"connected":this._connectedTime=(new Date).getTime(),this.useAllCandidates(),this._setConnectionState(o);break;case"completed":this._dontGatherCandidates=!1;break;case"disconnected":break;case"failed":this._setConnectionState(a),this._error("Ice Connection failed For at least one component:",e.target);break;case"closed":this._setConnectionState(s)}this.iceConnectionState=t,this.trigger("iceConnectionStateChanged",t),this.trigger("iceconnectionstatechange",t)},_onSignalingStateChange:function(e){var t=this._getSignalingState();this._log("Signaling state change:",t),"stable"===t&&this._drainIceQueue(),this.signalingState=t,this.trigger("signalingstatechange",t)},_onIceGatheringStateChange:function(e){if(this.iceGatheringState!==e.state){var t=this._getGatheringState();this._log("Gathering state change:",t),this.iceGatheringState=t,this.trigger("icegatheringstatechange",t)}},_getSignalingState:function(){return this._pc?this._pc.signalingState:"closed"},_getGatheringState:function(){return this._pc?this._pc.iceGatheringState:"new"},_drainIceQueue:function(){for(this._log("Draining Ice Candidate Queue (",this._candidateQueue.length,"candidates in queue)");this._candidateQueue.length;){var e=this._candidateQueue.shift();this._addIceCandidate(e)}},_addIceCandidate:function(e){var t=_.bind(function(){this._onAddIceCandidateSuccess(e)},this),n=_.bind(function(t){this._onAddIceCandidateError(e,t)},this);this._pc.addIceCandidate(e,t,n)},_onAddIceCandidateSuccess:function(e){this._log("Successfully added candidate",e.candidate),this._addProcessedPcItem(e)},_onAddIceCandidateError:function(e,t){this._error("Error adding candidate",e,":",t.message)},_onIceCandidate:function(e){var t=e.candidate;t&&!this._dontGatherCandidates?(this._triggerOrQueueCandidate(t),this._iceGatheringTo||(this._iceGatheringTo=setTimeout(this._onIceGatheringTimeout,this._iceGatheringTimeout)),this._gatheringDone=!1):t||this._dontGatherCandidates?t&&this._dontGatherCandidates&&(this._warn("Ice Candidate came after the gathering timeout",t.candidate),this._triggerOrQueueCandidate(t)):(this.trigger("iceCandidateGatheringDone"),this._gatheringDone=!0,this._log("Ice Candidate gathering finished"),this._clearIceGatheringTimeout(),this._gatheredPcItems.candidates.length||(this._warn("Ice candidates finished gathering and no preferred candidates were found. Sending the queued candidates."),this.establishBetterConnection())),this.trigger("icegatheringstatechange:jssip",{state:this._pc.iceGatheringState})},_triggerOrQueueCandidate:function(e){this._filterIceCandidate(e)?(this._log("Ice Candidate Gathered (#",this._candidateGatheredCt++,")",e.candidate),this._addGatheredPcItem(e),this.trigger("iceCandidate",e)):(this._warn("Ice Candidate Ignored and queued (#",this._candidateGatheredCt++,")",e.candidate),this._addQueuedPcItem(e))},_onIceGatheringTimeout:function(){this._onIceCandidate({}),this._dontGatherCandidates=!0,this._clearIceGatheringTimeout()},_clearIceGatheringTimeout:function(){clearTimeout(this._iceGatheringTo),this._iceGatheringTo=null},_filterIceCandidate:function(e){return this.validCandidates.turn&&this._isTurnCandidate(e)||this.validCandidates.stun&&this._isStunCandidate(e)||this.validCandidates.host&&this._isHostCandidate(e)},_isTurnCandidate:function(e){return e.candidate.indexOf(this.ICE_TYPE.TURN)>-1},_isStunCandidate:function(e){return e.candidate.indexOf(this.ICE_TYPE.STUN)>-1},_isHostCandidate:function(e){return e.candidate.indexOf(this.ICE_TYPE.HOST)>-1},useTurnOnly:function(){this.validCandidates.stun=0,this.validCandidates.host=0},useAllCandidates:function(){this.validCandidates.stun=1,this.validCandidates.host=1,this.validCandidates.turn=1},establishBetterConnection:function(){this._hasEstablishedBetterConnection||(this.useAllCandidates(),this._sendQueuedCandidates(),this._hasEstablishedBetterConnection=!0)},hasEstablishedBetterConnection:function(){return this._hasEstablishedBetterConnection},iceRestart:function(e){this.createOffer(e,{mandatory:{IceRestart:!0}})},restartWithTurnOnly:function(e){this.useTurnOnly(),this.iceRestart(e)},_hasCandidate:function(e){for(var t=this._processedPcItems.candidates||[],n=0;n<t.length;n++)if(e(t[n]))return!0;return!1},hasStunCandidates:function(){return this._hasCandidate(this._isStunCandidate)},hasTurnCandidates:function(){return this._hasCandidate(this._isTurnCandidate)},hasHostCandidates:function(){return this._hasCandidate(this._isHostCandidate)},addIceCandidate:function(e){switch(e=new RTCIceCandidate(e),this._log("Ice candidate (",this._candidateReceivedCt++,") received",e.candidate),this._getSignalingState()){case"closed":this._error("Error adding Ice Candidate -- Peer Connection object is closed.");break;case"stable":if(this.canEstablishConnection()){this._addIceCandidate(e);break}default:this._log("Queuing Ice candidate (",this._candidateReceivedCt-1,")",e.candidate),this._candidateQueue.push(e)}},_processOfferAnswer:function(e,t,n){if(this._log("SDP",e,"received",t),"closed"===this._getSignalingState())return this._error("Error processing",e,"-- The Peer Connection is closed."),void(n&&n("Peer Connection is closed"));var i=new RTCSessionDescription({type:e,sdp:t});i=this._mangleSdp(i),this._addProcessedPcItem(i);var r=_.bind(function(){this._setRemoteDescriptionSuccess(i,n,"answer"===e)},this),s=_.bind(function(e){this._setRemoteDescriptionError(i,n,e)},this);this._pc.setRemoteDescription(i,r,s)},_setRemoteDescriptionSuccess:function(e,t,n){if(!this.hasStarted())return this._log("Trying to set remote description without getting local media first. Queuing remote description until local media acquired."),this._queueEvent(this._setRemoteDescriptionSuccess,arguments,"_setRemoteDescriptionSuccess");this._log("Successfully set remote description (",e.type,")"),this._setRemoteStreams(),n?t&&t(null,e.sdp):this.createAnswer(t)},_setRemoteDescriptionError:function(e,t,n){this._error("Error setting remote description (",e.type,"):",n.message),this._endNegotiations(),t&&t("Error setting remote description")},_setLocalDescriptionSuccess:function(e,t){this._log("Successfully set local description(",e.type,")"),this._addGatheredPcItem(e),this.trigger("icegatheringstatechange:jssip",{state:this._pc.iceGatheringState});var n=_.bind(function(){this._onOfferAnswerSuccess(e,t)},this);this._establishingBetterConnection?this.listenToOnce(this,"iceCandidateGatheringDone",n):n()},_onOfferAnswerSuccess:function(e,t){this._establishingBetterConnection&&this._log("Sending up offer/answer (",e.type,") now that the ice candidates have been gathered to establish a better connection."),this._clearIceGatheringTimeout(),this.trigger("answer"===e.type?"answerCreated":"offerCreated",e),t&&t(null,e.sdp)},_setLocalDescriptionError:function(e,t,n){this._error("Error setting local description (",e.type,"):",e.sdp),this._error("Error given:",n.message),this.trigger("icegatheringstatechange:jssip",{state:this._pc.iceGatheringState}),t&&t("Error setting local description")},_setRemoteStreams:function(){for(var e=this._pc.getRemoteStreams(),t=0;t<e.length;t++)this._setRemoteStream(e[t]);this._endNegotiations()},_setRemoteStream:function(e){var t=this._setStream("remote",e);t&&this.trigger("remoteStreamChanged",t)},_setStream:function(e,t){for(var n=t.getTracks(),i={},r=0;r<n.length;r++){"video"===n[r].kind?this._setVideoStream(e,t)&&(i.video=t):this._setAudioStream(e,t)&&(i.audio=t)}return i.audio||i.video?i:null},_setVideoStream:function(e,t){var n="remote"===e?this._remoteStreamVideo:this._localStreamVideo;return"remote"===e?this._remoteStreamVideo=t:this._localStreamVideo=t,this._didStreamChange(n,t)},_setAudioStream:function(e,t){var n="remote"===e?this._remoteStreamAudio:this._localStreamAudio;return"remote"===e?this._remoteStreamAudio=t:this._localStreamAudio=t,this._didStreamChange(n,t)},_didStreamChange:function(e,t){var n=(e?e.id:"")!==t.id;return n&&(this._stopStream(e),e&&this._pc.removeStream(e)),n},processOffer:function(e,t){this._alreadyProcessedOffer(e)||(this._processOfferAnswer("offer",e,t),this._startNegotiations())},createOffer:function(e,t){this._createOfferAnswer("offer",e,t),this._startNegotiations()},createAnswer:function(e){this._createOfferAnswer("answer",e)},_createOfferAnswer:function(e,t,n){this._log("Creating ",e);var i=_.bind(function(e){this._createOfferAnswerSuccess(e,t)},this),r=_.bind(function(n){this._createOfferAnswerError(e,t,n)},this);this._pc["answer"===e?"createAnswer":"createOffer"](i,r,n||{})},_createOfferAnswerSuccess:function(e,t){this._log("Successfully created offer/answer (",e.type,"):",e.sdp),e=this._mangleSdp(e);var n=_.bind(function(){this._setLocalDescriptionSuccess(e,t)},this),i=_.bind(function(n){this._setLocalDescriptionError(e,t,n)},this);this._pc.setLocalDescription(e,n,i)},_mangleSdp:function(e){var t=e.sdp,n=this._preferOpus(t);return n=this._removeCN(n),n=this._preferVp9(n),t=this._toSdp(n),t=i.isEdge()?t.replace(" H264"," X-H264UC"):t.replace("X-H264UC","H264"),this._log("Mangled SDP of",e.type,"to:",t),new RTCSessionDescription({type:e.type,sdp:t})},_createOfferAnswerError:function(e,t,n){this._error("Error creating",e,":",n.message),t&&t("Error creating "+e+".")},processAnswer:function(e,t){this._alreadyProcessedAnswer(e)||this._processOfferAnswer("answer",e,t)},_startNegotiations:function(){this.negotiating=!0,this.trigger("negotiationStarted")},_endNegotiations:function(){this.negotiating=!1,this.trigger("negotiationDone")},_getStreams:function(e,t){var n="remote"===e?this._remoteStreamAudio:this._localStreamAudio,i="remote"===e?this._remoteStreamVideo:this._localStreamVideo;return t?this._pc["remote"===e?"getRemoteStreams":"getLocalStreams"]():{audio:n,video:i}},hasStarted:function(){return this._pc&&this._pc.getLocalStreams().length},getLocalStreams:function(e){return this._getStreams("local",e)},getRemoteStreams:function(e){return this._getStreams("remote",e)},removeLocalVideo:function(){this._removeLocalStream("video")},_removeLocalStream:function(e){var t=this.getLocalStreams()[e];t&&(this._stopStream(t),this._pc.removeStream(t))},_getTrackIds:function(e){var t=this._getStreams(e),n=t.audio?t.audio.getAudioTracks()[0]:null,i=t.video?t.video.getVideoTracks()[0]:null;return{audio:n?n.id:"",video:i?i.id:""}},getLocalTrackIds:function(){return this._getTrackIds("local")},getRemoteTrackIds:function(){return this._getTrackIds("remote")},getTrackIds:function(){return{local:this.getLocalTrackIds(),remote:this.getRemoteTrackIds()}},setLocalStreams:function(e){if(e){this._log("setting local streams."),e=e.length?e:[e];for(var t=0;t<e.length;t++)this._setLocalStream(e[t]);this.audioMuted&&this.muteAudio(),this.videoMuted&&this.muteVideo(),this._drainEventQueue()}},_setLocalStream:function(e){if(this._pc){var t=this._setStream("local",e);this._pc.addStream(e),t&&this.trigger("localStreamChanged",t)}},_hasKind:function(e){for(var t=this._pc.getLocalStreams(),n=0;n<t.length;n++)for(var i=t[n].getTracks(),r=0;r<i.length;r++)if(i[r].kind===e)return!0;return!1},hasVideo:function(){return this._hasKind("video")},hasAudio:function(){return this._hasKind("audio")},_mute:function(e,t){this._pc&&_.each(this._pc.getLocalStreams(),function(n){_.each(n.getTracks(),function(n){n.kind===t&&(n.enabled=!!e)})})},muteAudio:function(e){this._mute(e,"audio"),this.audioMuted=!e},muteVideo:function(e){this._mute(e,"video"),this.videoMuted=!e},_queueEvent:function(e,t,n){this._log("Queuing event:",n),this._eventQueue.push({fn:e,args:t})},_drainEventQueue:function(){this._log("Draining the event queue now that we have local media. (",this._eventQueue.length,")");for(var e=0;e<this._eventQueue.length;e++){var t=this._eventQueue[e];t.fn.apply(this,t.args)}this._eventQueue=[]},_preferOpus:function(e){return this._preferCodec(e,"audio","opus/48000")},_preferVp9:function(e){return this._preferCodec(e,"video","VP9")},_removeCN:function(e){return this._removeCodec(e,"audio","CN")},_preferCodec:function(e,t,n){this._log("Attempting to set (",t,") codec (",n,") as default.");var i=this._toSdpLines(e),r=this._getMLineIndex(t,i);if(null===r)return this._log("Could not find (",t,") in sdp. Aborting preference."),i;var s=this._getCodecPayloadType(i,n);return s?(this._log("Successfully found payload (",s,") for codec (",n,")"),this._log("Changing sdp mLine from:",i[r]),i[r]=this._setDefaultCodec(i[r],s),this._log("to:",i[r])):this._log("Could not find the payload for the codec (",n,") in the sdp. Aborting preference."),i},_removeCodec:function(e,t,n){this._log("Attempting to remove all (",t,") codecs (",n,") from sdp.");var i=this._toSdpLines(e),r=this._getMLineIndex(t,i),s=i[r],o=this._getCodecIndex(i,n);if(!o)return this._log("Failed to find codec (",n,") in sdp. Aborting."),i;for(;o;){var a=this._getCodecPayloadTypeFromLine(i[o]);this._log("Successfully found payload (",a,") for codec (",n,") and removing it."),s=this._removeDefaultCodec(s,a),i.splice(o,1),o=this._getCodecIndex(i,n,o)}return this._log("Changing sdp mLine from:",i[r]),i[r]=s,this._log("to:",i[r]),i},_toSdpLines:function(e){return"string"==typeof e?e.split("\r\n"):e},_toSdp:function(e){return e&&e.join?e.join("\r\n"):e},_getMLineIndex:function(e,t){return this._findLine(t,"m=",e)},_findLine:function(e,t,n,i){return this._findLineInRange(e,i||0,-1,t,n)},_findLineInRange:function(e,t,n,i,r){for(var s=-1!==n?n:e.length,o=t;o<s;++o)if(0===e[o].indexOf(i)&&(!r||-1!==e[o].toLowerCase().indexOf(r.toLowerCase())))return o;return null},_getCodecPayloadType:function(e,t){var n=this._getCodecIndex(e,t);return n?this._getCodecPayloadTypeFromLine(e[n]):null},_getCodecIndex:function(e,t,n){return this._findLine(e,"a=rtpmap",t,n)},_getCodecPayloadTypeFromLine:function(e){var t=e.match(c);return t&&2===t.length?t[1]:null},_setDefaultCodec:function(e,t){if(!e||!t)return e;var n=e.split(" "),i=n.slice(0,3);i.push(t);for(var r=3;r<n.length;r++)n[r]!==t&&i.push(n[r]);return i.join(" ")},_removeDefaultCodec:function(e,t){if(!e||!t)return e;var n=e.split(" "),i=n.indexOf(t);return-1!==i&&n.splice(i,1),n.join(" ")},_console:function(e,t){console[e].apply(console,["VIDEO: (PEER CONNECTION)"].concat(Array.prototype.slice.call(t,0)))},_log:function(){this._console("log",arguments)},_warn:function(){this._console("warn",arguments)},_error:function(){this._console("error",arguments)},canSafelyGatherStats:function(){var e="completed"===this.iceConnectionState;return e||"connected"!==this.iceConnectionState||(e=(new Date).getTime()-this._connectedTime>this._iceGatheringTimeout),e&&"stable"===this.signalingState&&!this.negotiating},getStats:function(){this._pc&&this._pc.getStats.apply(this._pc,arguments)},_onStats:function(e){var t=e.result(),n={};_.each(t,_.bind(function(e){var t=this._onStatsReport(e);_.isEmpty(t)||(n[e.id]=t)},this)),this.trigger("stats",n)},_onStatsReport:function(e){var t=e.names()||[],n={};return _.each(t,function(t){n[t]=e.stat(t)}),n},getRemoteDescription:function(){if(this._pc)return this._pc.remoteDescription},getRawPc:function(){return this._pc}})}),define("objects/stats_monitor",["config","models/webrtc_stats","models/current_user","models/session","objects/stats_monitor_wrapper","objects/common/stats_monitor"],function(e,t,n,i,r,s){var o=s.extend({initialize:function(){s.prototype.initialize.apply(this,arguments),this._addAlertListeners()},resetStats:function(){s.prototype.resetStats.apply(this,arguments),this._resetAlerts()}});return _.extend(o.prototype,r),o}),define("models/video_signal",["models/base","config"],function(e,t){return e.extend({urlRoot:t.REQUEST_URL+"videosignal/"})}),define("models/video_heartbeat",["models/base","config"],function(e,t){return e.extend({urlRoot:t.REQUEST_URL+"videoheartbeat/"})}),define("models/video_call",["models/media","fslib/singleton","fslib/notifications","models/session","fslib/webrtc","objects/peer_connection","objects/stats_monitor","models/video_signal","models/video_heartbeat","config"],function(e,t,n,i,r,s,o,a,c,l){return e.extend({urlRoot:l.REQUEST_URL+"videocall/",_retryTime:3500,_heartbeatTime:6e4,_statsPollTime:300,isCalling:function(){return this.isRequesting()},isRequesting:function(){return"requesting"===this.get("state")},isRinging:function(){return"ringing"===this.get("state")},isAccepted:function(){return"accepted"===this.get("state")},isConnected:function(){return"connected"===this.get("state")},isStateConnected:function(){return this.isConnected()},isConnecting:function(){return this.isAccepted()},isDeclined:function(){return"declined"===this.get("state")},isCancelled:function(){return"cancelled"===this.get("state")},isBusy:function(){return"busy"===this.get("state")},isEnded:function(){return"ended"===this.get("state")},isOnHold:function(){return"hold"===this.get("state")},isOnRemoteHold:function(){return this.getLocalState("remoteHold")},isInAHoldState:function(){return this.isOnHold()||this.isOnRemoteHold()},isActive:function(){return this.isRequesting()||this.isAccepted()||this.isConnected()||this.isOnHold()},hasConnectedSuccessfully:function(){return this.isConnected()||this.isOnHold()||this.isOnRemoteHold()},isVideo:function(){return!0},isDummy:function(){return!1},equals:function(e){return!!e&&this.get("contact_key")===e.get("contact_key")},isSharingScreen:function(){return this.getLocalState("sharingScreen")},setStartTime:function(){this.get("startTime")||this.set("startTime",(new Date).getTime())},getStartTime:function(){return this.get("startTime")},isOnMute:function(){return!this.getLocalState("localAudio")},wasPutOnMute:function(){return!this.getLocalState("remoteAudio")},isInViewableState:function(){return this.isActive()||this.hasConnectedSuccessfully()||this.isCalling()},canScreenShare:function(){return this.isConnected()&&!this.isOnRemoteHold()},hasEstablishedBetterConnection:function(){return this.pc&&this.pc.hasEstablishedBetterConnection()},isConnectionComplete:function(){return this.getLocalState("connectionComplete")},wasEndedRemotely:function(){return this.isDeclined()||this.getLocalState("hungUpRemotely")},wasEndedLocally:function(){return this.isCancelled()||this.getLocalState("hungUpLocally")},wasHungUp:function(){return this.getLocalState("hungUpRemotely")||this.getLocalState("hungUpLocally")},hasEnded:function(){return this.isDeclined()||this.isBusy()||this.isCancelled()||this.isEnded()||this.wasHungUp()},setWebrtcRegistered:function(e){var t=e||r.isRegistered();t||console.log("VIDEO: (VIDEO_CALL) (contact key: ",this.get("contact_key"),":",this.get("other_video_id"),"): webrtc was unregistered while trying to answer call!"),this.adjustLocalState("webrtcRegistered",t,!0)},wasUnregisteredInWebrtc:function(){return!this.getLocalState("webrtcRegistered")},canFullScreen:function(){return!this.isInAHoldState()&&this.getLocalState("remoteVideo")},processFullScreen:function(){this.adjustLocalState("processingFullScreen",!0)},isProcessingFullScreen:function(){return this.getLocalState("processingFullScreen")},setFullScreen:function(e){this.adjustLocalState("processingFullScreen",!1,!0),this.adjustLocalState("fullScreen",!!e)},isFullScreen:function(){return this.getLocalState("fullScreen")},shouldStartRecordingCallStats:function(){return this.isInViewableState()},shouldPauseRecordingCallStats:function(){return this.isInAHoldState()},shouldStopRecordingCallStats:function(){return this.isEnded()||this.isDeclined()||this.isCancelled()},LOCAL_STATE:{remoteVideo:!0,localVideo:!0,localAudio:!0,remoteHold:!1,sharingScreen:!1,hungUpRemotely:!1,hungUpLocally:!1,connectionComplete:!1,webrtcRegistered:!0,fullScreen:!1,processingFullScreen:!1},isNewer:function(e){return!this.has("date_modified")||parseInt(e.date_modified||0)>parseInt(this.get("date_modified")||0)},initialize:function(t,n){e.prototype.initialize.apply(this,arguments),this._sentMessages={},this._receivedMesssages={},this._remotePeerCanConfirm=!0,this._cameraOn=!0,this._audioOn=!0,this._holdOn=!1,this._started=!1,this._useMessageRetrying=!0,this._messageQueue=[],this._createStatsMonitor(),this.on("remove",_.bind(this.stop,this))},addPeerConnection:function(){this.pc=new s,this._openConnection(),this.listenTo(this.pc,"iceCandidate",this._onIceCandidateGathered),this.listenTo(this.pc,"offerCreated",this._onOfferAnswerCreated),this.listenTo(this.pc,"answerCreated",this._onOfferAnswerCreated),this.listenTo(this.pc,"localStreamChanged",this._onLocalStreamChanged),this.listenTo(this.pc,"remoteStreamChanged",this._onRemoteStreamChanged),this.listenTo(this.pc,"iceConnectionStateChanged",this._onIceConnectionStateChange),this.listenTo(this.pc,"closed",this._onPeerConnectionClosed),this.listenTo(this.pc,"stats",this._onStats),this.listenTo(this.pc,"negotiationDone",this._onNegotiationDone)},updateCallStats:function(){this.statsMonitor&&this.id&&this.statsMonitor.updateCallStatsWithCall(this)},_createStatsMonitor:function(){this.statsMonitor=new o,this.listenTo(this.statsMonitor,"audio:local:muted",this._onStatsLocalAudioMuted),this.listenTo(this.statsMonitor,"audio:remote:muted",this._onStatsRemoteAudioMuted),this.listenTo(this.statsMonitor,"error:connection",this._onStatsConnection)},_onStatsLocalAudioMuted:function(e){this.isInAHoldState()||this.isOnMute()||this.hasEnded()||this.statsMonitor.showMicAlert(e)},_onStatsRemoteAudioMuted:function(e){this.isInAHoldState()||this.wasPutOnMute()||this.hasEnded()||(this.statsMonitor.showRemoteMicAlert(e),r.fixRemoteAudioStream())},_onStatsConnection:function(e){this.isInAHoldState()||this.statsMonitor.showConnectionAlert(e)},_openConnection:function(){this.pc.open(),this.statsMonitor.setPeerConnection(this.pc),this.updateCallStats()},_stripCandidate:function(e){for(var t=["candidate","sdpMLineIndex","sdpMid"],n={},i=0;i<t.length;i++)n[t[i]]=e[t[i]];return n},_onIceCandidateGathered:function(e){this._sendMessage({type:"candidate",candidate:this._stripCandidate(e)})},_onOfferAnswerCreated:function(e){this._sendMessage({type:e.type,sdp:e.sdp})},_onLocalStreamChanged:function(e){e.audio&&(this._localStreamAudio=e.audio),e.video&&(this._localStreamVideo=e.video),this.trigger("localStreamChanged",e)},_onRemoteStreamChanged:function(e){e.audio&&(this._remoteStreamAudio=e.audio),e.video&&(this._remoteStreamVideo=e.video),this.trigger("remoteStreamChanged",e)},onMessage:function(e){var t=e.message.rtc_message;console.log("VIDEO: (VIDEO_CALL) (contact key: ",this.get("contact_key"),") received message of type:",t.type),this._useMessageRetrying&&this._alreadyReceivedMessage(t)||(this._onRtcMessage(t),this._maybeConfirmMessage(t))},_onRtcMessage:function(e){switch(e.type){case"offer":this.pc.processOffer(e.sdp);break;case"accept":this.isRequesting()&&this.accept();break;case"answer":this.isRequesting()&&this.accept(),this.pc.processAnswer(e.sdp);break;case"candidate":this.pc.addIceCandidate(e.candidate);break;case"hangup":this._onHangUp();break;case"decline":this._onDecline();break;case"camera":this.adjustLocalState("remoteVideo",e.cameraOn);break;case"hold":this._onRemoteHold(e.hold);break;case"holdConfirmation":this._onRemoteHoldConfirmation(e.hold);break;case"retry":this._requestedRetry=!0,this._pickRetry(),this.pc.retryOffer();break;case"messageConfirmation":this._onMessageConfirmation(e)}},_sendHeartbeat:function(){this._clearHeartbeat(),this._heartbeat=new c({id:this.get("id")}),this._heartbeat.save(),console.log("VIDEO: (VIDEO_CALL) (contact key: ",this.get("contact_key"),":",this.get("other_video_id"),") sending heartbeat (",(new Date).getTime(),")"),this.isInViewableState()&&(this._heartbeatTimeout=_.delay(_.bind(this._sendHeartbeat,this),this._heartbeatTime))},_clearHeartbeat:function(){clearTimeout(this._heartbeatTimeout)},_sendMessage:function(e,t){var n=this;if(this.get("other_video_id")){this._videoSignal=new a({id:this.get("contact_key")}),e.id||(e.id=this.id),e.other_video_id=this.get("other_video_id"),e.messageId||(e.messageId=this._createMessageId());var i="number"==typeof t?t:3,r=3-i;console.log("VIDEO: (VIDEO_CALL) (contact key: ",this.get("contact_key"),":",this.get("other_video_id"),") sending message (",e.type,"):",e.messageId,"try number:",r),this._videoSignal.save({rtc_message:e},{error:function(e,t,i){429==t.status&&(console.error("Giving up VideoCall because rate limited"),n.hangUp())}}),(this.hasConnectedSuccessfully()||"accept"===e.type)&&this._setMessageTimeout(e,i),this._heartbeat||this._sendHeartbeat()}else this._enqueueMessage(e)},_enqueueMessage:function(e){console.log("VIDEO: (VIDEO_CALL) (contact key: ",this.get("contact_key"),") queueing message (",e.type,")"),this._messageQueue.push(e)},sendQueuedMessages:function(){for(console.log("VIDEO: (VIDEO_CALL) (contact key: ",this.get("contact_key"),":",this.get("other_video_id"),") sending queued messages(",this._messageQueue.length,")");this._messageQueue.length;)this._sendMessage(this._messageQueue.shift())},_createMessageId:function(){return this._lastMessageId=this._lastMessageId||1,this._lastMessageId++},_setMessageTimeout:function(e,t){var n=t||0,i=this._isImportantMessage(e);if(this._remotePeerCanConfirm&&i&&n){this._clearMessageTimeout(e);var r={message:e};r.timeout=_.delay(_.bind(function(){console.log("VIDEO: (VIDEO_CALL) message timeout reached for message (",e.type,"). Re-sending message:",e),this._sendMessage(e,n-1)},this),3500),this._sentMessages[e.messageId]=r}else console.log("VIDEO: (VIDEO_CALL) Ignoring setting",e.type,"message (",e.messageId,") retry b/c remotePeerCanConfirm:",this._remotePeerCanConfirm,"isImportantMessage:",i,"retries:",n)},_clearMessageTimeout:function(e){var t=this._sentMessages[e.messageId]||{};clearTimeout(t.timeout),t.timeout=null},_alreadyReceivedMessage:function(e){if(!e.messageId&&this._remotePeerCanConfirm)return console.warn("VIDEO: (VIDEO_CALL) remote peer (",this.get("contact_key"),":",this.get("other_video_id"),") is using an old version that does not support message retrying."),this._remotePeerCanConfirm=!1,void this._clearAllOutstandingMessages();var t=!!this._receivedMesssages[e.messageId];return t&&this._maybeConfirmMessage(e),t},_maybeConfirmMessage:function(e){this._remotePeerCanConfirm&&(this.hasConnectedSuccessfully()||this.isAccepted())&&this._isImportantMessage(e)&&this._sendMessageConfirmation(e)},_sendMessageConfirmation:function(e){var t=e.messageId;this._receivedMesssages[t]=1,this._sendMessage({type:"messageConfirmation",receivedMessageId:t})},_onMessageConfirmation:function(e){var t=this._sentMessages[e.receivedMessageId]||{message:{}};console.log("VIDEO: (VIDEO_CALL) remote peer (",this.get("contact_key"),":",this.get("other_video_id"),") received message (",e.receivedMessageId,"):",t.message.type),this._clearMessageTimeout(t.message)},_clearAllOutstandingMessages:function(){_.each(this._sentMessages,_.bind(function(e){this._clearMessageTimeout(e.message)},this))},_isImportantMessage:function(e){if(!this._useMessageRetrying)return!1;var t=e.type;return-1===["candidate","messageConfirmation"].indexOf(t)},requestRetry:function(){this.isAnswer&&(this.pc.canEstablishConnection()?this.pc.retryAnswer():(console.log("VIDEO: (VIDEO_CALL) (contact key: ",this.get("contact_key"),") requesting a retry."),this.requestedRetry=!0,this._sendMessage({type:"retry"})))},giveUp:function(){console.error("VIDEO: (VIDEO_CALL) Video call with (contact key:",this.get("contact_key"),":",this.get("other_video_id"),") had to give up."),this.hangUp(),Backbone.trigger("webrtc:nocandidates")},_establishBetterConnection:function(){this.pc.establishBetterConnection()},_onPeerConnectionClosed:function(){this.trigger("peerConnectionClosed",this)},start:function(e,t){this._cameraOn=t,this.isAnswer=e,this.refreshAudioSink(),this.getMediaStreams(_.bind(this._startCall,this))},_startCall:function(e){this._started=!0,this._setLocalStreams(e),this.isAnswer?this.accept():this.request()},request:function(){!this.getStartTime()&&this.trigger("requesting",this),this.pc.createOffer()},accept:function(){this.setWebrtcRegistered(),this.set("state","accepted"),this.save(null,{wait:!1}),this._setRetry(),this.isAnswer&&this._sendMessage({type:"accept"})},_pickRetry:function(){this._requestedRetry?this._setGiveUp():this._setRetry()},_setRetry:function(){this._retryTimeout=_.delay(this.requestRetry,this._retryTime)},_setGiveUp:function(){this._giveUpTimeout=_.delay(this.giveUp,3*this._retryTime)},_clearRetry:function(){clearTimeout(this._retryTimeout)},_clearGiveUp:function(){clearTimeout(this._giveUpTimeout)},_clearRetries:function(){this._requestedRetry=!1,this._clearRetry(),this._clearGiveUp()},decline:function(e){this.hasConnectedSuccessfully()||(this._sendMessage({type:"decline"}),this.stop(),this.set("state","declined"),this.save(null,{success:function(t){e&&e(t)}}))},_onDecline:function(){this.set("state","declined"),this.stop(),this.save()},hangUp:function(e){if(this.isRequesting())this.set("state","cancelled"),this.save();else{if(this.isBusy())return void this.stop();this.wasEndedRemotely()||(this.set("state","ended"),this.adjustLocalState("hungUpLocally",!0),this._sendMessage({type:"hangup"}),this.save())}e?_.delay(this.stop,4e3):this.stop()},_onHangUp:function(){this.adjustLocalState("hungUpRemotely",!0),this.stop(),this.trigger("hangUp",this)},stop:function(){if(!this._stopped){this._clearAllOutstandingMessages(),this.clearStats(),this._clearRetries(),this._clearHeartbeat();var e=this.pc&&"failed"===this.pc.iceConnectionState;this.pc&&this._closePc(),this._stopped=!0,console.log("VIDEO: (VIDEO_CALL) (contact key: ",this.get("contact_key"),":",this.get("other_video_id"),") ending with state (",this.get("state"),")"),this._sendLogs("video_"+(e?"ice_failed":this.get("state")))}},_closePc:function(){this.pc.close(),this.toggleScreenShareFlag(!1),this.trigger("pcClosed"),this.statsMonitor.unsetPeerConnection()},_onIceConnectionStateChange:function(e){switch(e){case"connected":this._videoConnected();break;case"completed":break;case"closed":this._videoClosed();break;case"failed":console.error("VIDEO: (VIDEO_CALL) (contact key: ",this.get("contact_key"),":",this.get("other_video_id"),") ICE CONNECTION FAILED!!"),this.trigger("iceFailed",this),this.trigger("hangUp",this)}},_sendLogs:function(e){this._logsSent||(Backbone.trigger("jslog:send",{type:"video",sub_type:e}),this._logsSent=!0)},_videoConnected:function(){this.setWebrtcRegistered(!0),this.connected=!0,this.trigger("connected",this),this._clearRetries(),_.delay(_.bind(function(){this.setStartTime(),this.set("state","connected"),this.save(),!this.hasEstablishedBetterConnection()&&this._establishBetterConnection(),this.trigger("connectionComplete")},this),300)},_videoClosed:function(){this.isInAHoldState()||this.trigger("hangUp",this)},muteAudio:function(e){if(this.isInAHoldState())return this._audioOn=e,void this.adjustLocalState("localAudio",this._audioOn);if(!this.pc.hasAudio()){if(this.hasAudioSources())return void this._requestAudioStream(_.bind(function(t){this.changeStream(t),this.muteAudio(e)},this));e=!1}e=!!e,this._audioOn=e,this.pc.muteAudio(this._audioOn),this.adjustLocalState("localAudio",this._audioOn),this._sendMessage({type:"audio",audioOn:this._audioOn})},toggleAudio:function(){this.muteAudio(!this._audioOn)},muteVideo:function(e){if(this.isInAHoldState())return this._cameraOn=e,void this.adjustLocalState("localVideo",this._cameraOn);if(!this.pc.hasVideo()){if(this.hasVideoSources())return void this._requestVideoStream(_.bind(function(t){this.changeStream(t),this.muteVideo(e)},this));e=!1}e=!!e,this._cameraOn=e,this.pc.muteVideo(this._cameraOn),this.adjustLocalState("localVideo",this._cameraOn),this._sendMessage({type:"camera",cameraOn:this._cameraOn})},toggleVideo:function(){this.muteVideo(!this._cameraOn)},holdOn:function(){this.isOnHold()||(this.set("state","hold"),this.save(),this._sendMessage({type:"hold",hold:!0}),this.trigger("viewStateChange",this),this.pc.muteAudio(),this.pc.muteVideo())},holdOff:function(){this.isOnHold()&&(this._audioOn&&this.pc.muteAudio(!0),this._cameraOn&&this.pc.muteVideo(!0),this.set("state","accepted"),this.save(),this._sendMessage({type:"hold",hold:!1}))},_onRemoteHold:function(e){this.isOnHold()||(e?this._onRemoteHoldOn():this._onRemoteHoldOff()),this.adjustLocalState("remoteHold",e),this._sendMessage({type:"holdConfirmation",hold:e})},_onRemoteHoldOn:function(){this._closePc(),this._streamHoldMusic()},_onRemoteHoldOff:function(){this._openConnection(),this.start(!0,this._cameraOn)},_onRemoteHoldConfirmation:function(e){e?this._onHoldConfirmation():this._onUnholdConfirmation()},_onHoldConfirmation:function(){this._closePc()},_onUnholdConfirmation:function(){if(this.isOnRemoteHold())return this.set("state","connected"),this._streamHoldMusic(),void this.trigger("viewStateChange",this);this._openConnection(),this.start(!1,this._cameraOn)},toggleHold:function(){this.isOnHold()?this.holdOff():this.holdOn()},_streamHoldMusic:function(){},_setLocalStreams:function(e){this.pc.setLocalStreams(e),this.muteVideo(this._cameraOn&&this.pc.hasVideo()),this.muteAudio(this._audioOn&&this.pc.hasAudio())},changeStream:function(e){console.log("VIDEO: (VIDEO_CALL) changing local stream."),this._setLocalStreams(e),this._onRemoteStreamChanged({audio:this.pc.getRemoteStreams().audio}),this.refreshAudioSink(),this.pc.createOffer()},_refresh:function(e){if(this.isConnected())if(this.pc.negotiating)this.listenToOnce(this.pc,"negotiationDone",e===this.MEDIA.AUDIO?this.refreshAudio:this.refreshVideo);else{var t=_.bind(this.changeStream,this);e===this.MEDIA.AUDIO?this.getAudioStream(t):this.getVideoStream(t)}else this.once("connected",e===this.MEDIA.AUDIO?this.refreshAudio:this.refreshVideo)},refreshAudio:function(){this._refresh(this.MEDIA.AUDIO)},refreshAudioSink:function(){this.getAudioSink(_.bind(function(e){e=e||{},console.info("VIDEO CALL: Setting webrtc SPEAKERS to: ",e.label||"Default"),r.updateAudioSinkId(e[this.MEDIA.ID])},this))},refreshVideo:function(){this._refresh(this.MEDIA.VIDEO)},shareScreen:function(){l.isNative?this._requestScreenStream(_.bind(this.changeStream,this)):chrome.permissions.request({permissions:["desktopCapture"]},_.bind(function(e){e&&this._requestScreenStream(_.bind(this.changeStream,this))},this))},unshareScreen:function(){this._requestVideoStream(_.bind(function(e){e?this.changeStream(e):this._removeScreenStream(),this.toggleScreenShareFlag(!1)},this))},toggleScreenShare:function(){this.isInAHoldState()||(this.isSharingScreen()?this.unshareScreen():this.shareScreen())},_requestScreenStream:function(e){this.getScreenStream(_.bind(function(e){this.setVideoToScreen(e)},this))},setVideoToScreen:function(e,t){if(this.canScreenShare()){var n=t||"Name not captured on Chrome App";console.log("VIDEO: (VIDEO_CALL) Sharing screen (",n,") stream:",e.id),this.toggleScreenShareFlag(!0),this._cameraOn=!0,this.changeStream(e)}},_requestVideoStream:function(e){this.getVideoStream(_.bind(function(t){e(t)},this))},_requestAudioStream:function(e){this.getAudioStream(_.bind(function(t){e(t)},this))},_removeScreenStream:function(){this._cameraOn=!1,this.pc.removeLocalVideo(),this.muteVideo(this._cameraOn&&this.pc.hasVideo())},toggleScreenShareFlag:function(e){this.adjustLocalState("sharingScreen",!!e),this.trigger("screenSharingToggled",!!e)},isStarted:function(){return this._isStarted},getRemoteVideoStream:function(){if(this.pc)return this.pc.getRemoteStreams().video},getLocalVideoStream:function(){if(this.pc)return this.pc.getLocalStreams().video},getVideoStreams:function(){return{local:this.getLocalVideoStream(),remote:this.getRemoteVideoStream()}},_onNegotiationDone:function(){console.log("VIDEO: (VIDEO_CALL) Negotiation finished, logging out media.");var e=r.getMediaIds();e[this.MEDIA.VIDEO]=this.getCurrentVideoId(),this.logMedia(e,"video"),this.getStats()},getStats:function(){this.clearStats(),this.pc.getStats(),this._statsTimeout=_.delay(_.bind(this.getStats,this),this._statsPollTime)},clearStats:function(){clearTimeout(this._statsTimeout)},_onStats:function(e){this.trigger("videoStats",e,this.pc.getTrackIds())}})}),define("collections/video_calls",["collections/common/cursor_collection","config","fslib/webrtc","fslib/singleton","models/video_call"],function(e,t,n,i,r){var s=e.extend({model:r,url:t.REQUEST_URL+"video",initialize:function(){e.prototype.initialize.apply(this,arguments),this._messageQueue={},!this.wrapper&&this._addListeners()},_addListeners:function(){this.listenTo(this,"add",this._onAdd),this.listenTo(this,"change",this._onChange),this.listenTo(this,"remove",this._onRemove)},_getContactKey:function(e){return e&&e.get?e.get("key"):e},byContact:function(e){return this.findWhere({contact_key:this._getContactKey(e)})},onVideoWithContact:function(e){return _.some(this.where({contact_key:this._getContactKey(e)}),function(e){return e.isActive()})},isConnecting:function(){return!!this.find(function(e){return e.isConnecting()||e.isCalling()})},getActiveCall:function(){return this.findWhere({state:"connected"})},getViewableCall:function(){return this.find(function(e){return e.isInViewableState()})},isOnVideo:function(){return!!this.find(function(e){return!e.hasConnectedSuccessfully()})},isRinging:function(){return!!this.findWhere({state:"ringing"})},inProgress:function(){return this.isConnecting()||this.isRinging()},hangUpAllCalls:function(){this.each(function(e){e.pc&&e.hangUp()})},callForContact:function(e,t){return this.findWhere({contact_key:e,target_key:t})},_getAttrFromMessage:function(e,t){return((e.message||{}).rtc_message||{})[t]},_getIdFromMessage:function(e){return this._getAttrFromMessage(e,"other_video_id")},onMessage:function(e){var t=this.findWhere({id:this._getIdFromMessage(e)});t?t.onMessage(e):this._queueMessage(e)},_queueMessage:function(e){var t=this._getIdFromMessage(e);console.log("VIDEO: (VIDEO CALLS) queuing message for video call (contact key:",e.contact_key,", id:",t,"):",e);var n=this._messageQueue[e.contact_key]||{},i=n[t]||[];i.push(e),n[t]=i,this._messageQueue[e.contact_key]=n},drainMessageQueueForVideoCall:function(e){var t=(this._messageQueue[e.get("contact_key")]||{})[e.id]||[];t.length&&console.log("VIDEO: (VIDEO MANAGER) draining message queue for video call (contact key:",e.get("contact_key"),"): (",t.length,")");for(var n=0;n<t.length;n++)e.onMessage(t[n]);this._messageQueue[e.get("contact_key")]=null},_onAdd:function(e){this._updateCallStatsForCall(e)},_onChange:function(e){this._updateCallStatsForCall(e)},_updateCallStatsForCall:function(e){e.id&&e.updateCallStats()},_onRemove:function(){"ready"===n.getCallState()&&!this.length&&Backbone.trigger("alertbar:close","statsConnectionAlert")}});return i.create(s,"videoCalls")}),define("objects/window_manager",["config","fslib/object","models/current_user","models/session","objects/ipc_manager","collections/active_calls","collections/video_calls","fslib/singleton"],function(e,t,n,i,r,s,o,a){var c=t.extend({LOG:0,INFO:1,WARN:2,ERROR:3,WINDOW_SELECTORS:["single","notification","mini","alert"],initialize:function(){t.prototype.initialize.call(this),this.last=e.isSingle?"single":"main",this.launched={},this.failures=0,this.clobbers=0,this.launches=0,this.windowVisibility={},this.overlayVisibility={},this.alertbarVisibility={},this.delayLaunch=null,this.listenTo(Backbone,"restart",this.restart),this.listenTo(Backbone,"quit",this.quit),this.listenTo(Backbone,"window:resize",this.resize),this.listenTo(Backbone,"blur:single",this.toggleMini),this.listenTo(Backbone,"focus:single",this.toggleMini),this.listenTo(Backbone,"dialogAdded",this._onDialogAdded),this.listenTo(Backbone,"dialogRemoved",this._onDialogRemoved),this.listenTo(Backbone,"alertbar:added",this._onAlertbarAdded),this.listenTo(Backbone,"alertbar:removed",this._onAlertbarRemoved),this.listenTo(s,"add",this.toggleMini),this.listenTo(s,"remove",this.toggleMini),this.listenTo(s,"change",this.toggleMini),e.isNative&&this._listenToIpcManager()},navigate:function(t,n,i){if(i=i||{},e.isSingle&&-1==this.WINDOW_SELECTORS.indexOf(t)?t="single":e.isSalesforce?t="salesforce":e.isIframe&&(t="iframe"),console.log("Window name: "+window.name+" windowSelector: "+t,i),e.isNative&&window.name!=t)return"notification"==t||"mini"==t||i.noFocus||this.show(t,n,i),void r.navigate(t,n,i);var s=this.getWindow(t);globals.notifications&&"notification"==t&&n.match(/voicemail|message/)?this.log("suppress in-app notification window"):(s&&s.starting?(i.noFocus||this.show(t,n,i),_.defer(_.bind(function(){this.trigger("navigate",t,n,i)},this))):(this.log("window launch: "+t+":"+n),this.launch(t,n)),this.last=t)},hide:function(t){if(this.log("window_manager.hide: "+t),this._toggleWindowVisibility(t,!1),clearTimeout(this.delayLaunch),this.launched[t]=!1,globals.deferredRoutes&&(globals.deferredRoutes[t]=null),e.isSalesforce)"incoming"==i.getLocal("route")&&(console.log("Window Manager: Hide Salesforce app overlay"),Backbone.trigger("overlay"));else{if(e.isNative)return this.trigger("hide",t),void r.toggleVisibility(t,!1);var n=this.getWindow(t);n&&(e.isHarness?n.hidden=!0:a.currentWindow()&&"main"!=t?n.hidden||(_.delay(function(){n.hidden=!0,n.close()},100),this.destroy(t),n.hidden=!0,n.close(),this.allHidden()&&this.quit()):globals.background.quit())}},bounce:function(t){if(e.isApp&&(!(t=!!_.isUndefined(t)||t)||!this.isAppFocused())){var n=this.getPrimaryWindow();n&&(t?n.drawAttention():(n.clearAttention(),_.defer(function(){n.clearAttention()})))}},restart:function(t,n){if(n)return Backbone.trigger("jslogs:send"),void _.delay(_.bind(this.restart,this,t),1e3);if(console.log("WindowManager: restart"),o.hangUpAllCalls(),e.isApp)chrome.runtime.reload();else if(e.isNative){var i;t&&(i=this.getRoute("single")),r.restart(i)}else document.location.reload()},logout:function(){console.log("WindowManager: logout"),o.hangUpAllCalls(),e.isApp?chrome.runtime.reload():e.isNative?r.logout(!0):e.isSalesforce||e.isIframe?document.location.reload():document.location.href="/logout"},quit:function(){this.launched={},e.isApp?globals.background.quit():e.isNative&&r.quit()},launchDeferredRoute:function(e){if(window.globals&&globals.deferredRoutes&&globals.deferredRoutes[e]){var t=globals.deferredRoutes[e];return globals.deferredRoutes[e]=null,this.launches=0,this.log("Found deferred route: "+e+":"+t),this.navigate(e,t),t}},show:function(t,n,i){var s="notification"!=t;if(this._toggleWindowVisibility(t,n||Backbone.history.fragment||!0),e.isNative)r.toggleVisibility(t,n||Backbone.history.fragment||!0,s);else{var o=this.getWindow(t);o.hidden=!1,e.isHarness||e.isSalesforce||e.isIframe||o.show(s)}},focus:function(t){if(!e.isHarness&&!e.isSalesforce){var n=this.getWindow(t);this.last=t,n.focus()}},minimize:function(t){e.isHarness||e.isSalesforce||this.getWindow(t).minimize()},resize:function(t){if(e.isApp){var n=this.getWindow(t).getBounds(),i=n.width,r=n.height,s="notification"==t?20:1;this.resizeTo(t,i,r+s),_.delay(_.bind(function(){this.resizeTo(t,i,r)},this),10)}},resizeTo:function(t,n,i,s){if(e.isHarness||e.isApp||e.isNative){!1;var o=this.getWindow(t),a=globals.display&&globals.display.multiplier||1,c=168,l=null;switch(t||o.id){case"single":n=n||1040,i=i||700,c=620,l=700;break;case"main":case"target":n=n||276,i=i||700,c=400;break;case"alert":case"notification":n=n||400,c=i=i||100;break;case"mini":n=n||250,c=i=i||60;break;default:n=n||300,i=i||300}if(n=Math.round(n*a),i=Math.round(i*a),c=Math.round(c*a),i=Math.min(window.screen.availHeight-100,i),e.isNative)r.resize(t,n,i);else{if(e.isApp){var u=o.outerBounds;return u.minHeight&&(u.minHeight=c),u.minWidth&&(u.minWidth=l||n),u.maxWidth&&(u.maxWidth=n),u.maxHeight&&(u.maxHeight=i),this.log("Resizing "+t+" to bounds "+JSON.stringify(u)),this.lastWidth=n,this.lastHeight=i,void o.resizeTo(n,i)}e.isHarness&&(o.height=i,o.width=n)}}},getPrimaryWindow:function(){return e.isSingle?globals.singleWindow:globals.mainWindow},getWindow:function(t){if(!t&&e.isApp)try{return chrome.app.window.current()}catch(e){this.log("Failed to get current window")}if(globals&&globals.windows){if(e.isSingle&&"notification"!=t)return globals.singleWindow;if(e.isSalesforce)return globals.salesforceWindow;if(e.isIframe)return globals.iframeWindow;switch(t){case"main":return globals.mainWindow;case"target":return globals.targetWindow;case"notification":return globals.notificationWindow}}},launch:function(e,t){var n=this.getWindow(e);if(globals.deferredRoutes){if(globals.deferredRoutes[e]=t,n)return this.log(e+" already launched"),this.clobbers++,void(this.clobbers>=3&&(this.log("Too many launches without a success...close the window"),this.clobbers=0,this.hide(e)));if(this.launched[e])return console.log("Already in process of launching "+e),this.failures++,void(this.failures>=3&&(this.log("quitting because too many failures"),this.quit()));clearTimeout(this.delayLaunch);var i=this;switch(this.delayLaunch=_.delay(function(){i.log("clearing launched: "+e),i.launched[e]=!1;var t=globals.deferredRoutes[e];t&&i.launches<2&&(i.launches++,i.log("retrying deffered route attempt="+i.launches+": "+t),i.launch(e,t))},1e3),this.launched[e]=!0,e){case"main":return globals.background.createMain();case"target":return globals.background.createMain(!1),void _.delay(function(){globals.background.createTarget(!0)},100);case"notification":return globals.background.createNotification(),void this._toggleWindowVisibility(e,t)}}else console.log("No deferred routes...so no launching")},relaunch:function(t,n){e.isApp&&(globals.deferredRoutes[t]=n,globals.background.relaunch())},destroy:function(e){this.log("Destroying selector:"+e),!e&&o.hangUpAllCalls(),this.trigger("destroy",e)},isHidden:function(e){return!this.windowVisibility[e]},isVisible:function(e){return!!this.windowVisibility[e]},allHidden:function(){_.each(this.launched,function(e){e&&!1}),_.each(globals.windows,function(e){e.hidden||!1})},isFocused:function(e){var t=this.getWindow(e);return t&&t.focused},isAppFocused:function(e){var t=!1;return _.each(globals.windows,function(n){n.id!=e&&(n.hidden||n.focused&&(t=!0))}),t},log:function(t,n){try{n===this.INFO?console.info(t):n===this.WARN?console.warn(t):n===this.ERROR?console.error(t):console.log(t),e.isNative&&"notification"==window.name&&r.log(window.name+": "+t),globals.background.log(t)}catch(e){}},setWindowState:function(e,t){var n=this.getWindow(e);clearTimeout(this.delayLaunch),this.launched[e]=!1,this.failures=0,this.clobbers=0,n?(n[t]=!0,n.state=t,this.log(e+" window has state: "+t)):this.log("no windows in setWindowState")},focusWindow:function(e){var t=this.getWindow(e),n=t.ownerDocument;(n?n.defaultView||n.parentWindow:t).parent.focus()},toggleMini:function(){if(e.isNative&&n.isDpEverywhereEnabled()&&i.getLocal("mini_on"))if("single"==window.name)if(this.isFocused("single")&&!n.inExperiment("dpeverywhere_always"))this.hide("mini");else{var t=s.getCallFullyConnectedToClient();t||(t=s.isCallingOut()),t&&t.id?(this.navigate("mini","call/"+t.id),Backbone.trigger("track:event","dpe: mini_start"),this.show("mini")):s.models.length?console.log("WINDOW MANAGER: Toggle Mini: Has active calls, but not valid",s.models):s.hasInternalLeg()||(console.log("WINDOW MANAGER: Toggle Mini: No more active calls. Make sure mini is hidden"),this.hide("mini"))}else console.log("Only toggling mini from the main window")},_listenToIpcManager:function(){_electron.ipcRenderer.on("window:visibility",_.bind(function(e,t,n){this._toggleWindowVisibility(t,n)},this))},_toggleWindowVisibility:function(e,t){this.windowVisibility[e]=t,console.log("Toggle window visibility of (",e,") to:",t)},isShowingWindow:function(e,t){return t?this.windowVisibility[e]===t:!!this.windowVisibility[e]},getRoute:function(e){return this.windowVisibility[e]||""},isShowingOverlay:function(e,t){if(!e)return!_.isEmpty(this.overlayVisibility);var n=this.overlayVisibility[e];if(!n)return!1;var i=t||{};for(var r in i)if(n[r]!==i[r])return!1;return!0},isShowingAlertbar:function(e,t){if(!e)return!_.isEmpty(this.alertbarVisibility);var n=this.alertbarVisibility[e];if(!n)return!1;var i=t||{};for(var r in i)if(n[r]!==i[r])return!1;return!0},_toggleDialogVisibility:function(e,t,n){var i=e||{},r=!!t,s=i.overlayId||i.id;s&&(r?n[s]=i:delete n[s],console.log("Toggled dialog visibility for (",s,") to:",r))},_onDialogAdded:function(e){this._toggleDialogVisibility(e,!0,this.overlayVisibility)},_onDialogRemoved:function(e){this._toggleDialogVisibility(e,!1,this.overlayVisibility)},_onAlertbarAdded:function(e){this._toggleDialogVisibility(e,!0,this.alertbarVisibility)},_onAlertbarRemoved:function(e){this._toggleDialogVisibility(e,!1,this.alertbarVisibility)}});return a.create(c,"windowManager")}),define("objects/talkiq_manager",["require","fslib/object","fslib/collection_wrapper","utils/latency_tracking_util","models/session","models/call","objects/window_manager","collections/talk_iq_list","collections/active_calls","models/current_user","fslib/singleton","fslib/fsutil"],function(require){var e=require("fslib/object"),t=require("fslib/collection_wrapper"),n=require("utils/latency_tracking_util"),i=require("models/session"),r=require("models/call"),s=require("objects/window_manager"),o=require("collections/talk_iq_list"),a=require("collections/active_calls"),c=require("models/current_user"),l=require("fslib/singleton"),u=require("fslib/fsutil"),h=e.extend({initialize:function(){e.prototype.initialize.apply(this,arguments),this._cursors={},this._collections={},this._polling={},this.listenTo(o,"add",this._onAdd),this.listenTo(this,"recommendation",this._maybeShowRecommendation)},getCollectionForCall:function(e,t,n,i,s,o){if(e){var a=e.attributes||e,c={call_id:a.id||a,entry_point_call_id:e.getRootCallId&&e.getRootCallId(),operator_call_id:a.operator_call_id,target_key:i||a.entry_point&&a.entry_point.key||a.target_key,date_ended:a.date_ended,sortOrder:s||"descending",peekFeedKey:o};e.id&&e.id!==c.call_id&&(c.participants=r.createParticipantsDict(e));var l=_.extend({CallTranscription:!0,CallMoment:!0,CallSentiment:!0,CallRecommendation:!0},t),u=this._getFilteredCollectionForCall(c,l,n);return this._updateCollectionWithFetchOptions(c,u),u}},_onAdd:function(e){e.get("original_socket_message")&&n.logVoiceAiModelLatency(e.toJSON({localState:!0,cached:!0})),this._checkForUniqueRecommendation(e)},_checkForUniqueRecommendation:function(e){if(e.isRecommendation()){var t=e.get("call_id"),n=e.get("battle_card_id");1===o.where({battle_card_id:n,call_id:t}).length&&this.trigger("recommendation",e)}},isShowingRecommendation:function(e){return s.isShowingWindow("notification",this._getRecommendationRoute(e))},_getRecommendationRoute:function(e){return"recommendation/"+e.id},_maybeShowRecommendation:function(e){var t=!e.isRecommendation(),n=!u.isChromeApp(),i=u.isChromeApp()&&s.isFocused("single");if(!(t||n||i)){var r=e.getCallId(),o=a.getByRootCallId(r),l=!!o&&o.isOperator(c.get("key"));if(o&&l){var h=this._getRecommendationRoute(o),d=s.isVisible("notification"),f=s.getRoute("notification").indexOf("recommendation")>-1;if(!d||f){var p=this.getCollectionForCall(o,{CallTranscription:!1,CallMoment:!1,CallSentiment:!1,CallRecommendation:!0}).where({battle_card_id:e.get("battle_card_id")}).length>1;if(this.destroyCollectionForCall(o),p)console.info("Not showing Recommendation (",e.get("battle_card_id"),") for call (",o.id,") bc it was already shown once before.");else{var g=s.isShowingWindow("notification",h);Backbone.trigger("track:event","voiceai: recommendation card: display",{location:"notification",call_id:r,already_showing:g}),g||s.navigate("notification",h)}}else console.warn("Not showing Recommendation notification for call (",o.id,") bc notification window already showing.")}}},hideNotification:function(){s.hide("notification")},_getFilteredCollectionForCall:function(e,n,i){this._maybeCleanUpItemsForCall(e);var r,s,a=this._filterFunction.bind(this,e,n),c=this._getCallId(e);i?((r=(s=i).wrapper).filterFunction=a,r.reset()):(s=(r=new t).wrap(o,a,!0),this._collections[c]=s),s.parse=this._parseFunction.bind(this,e,s);var l="polling:done:"+c;return s.__pollingFinished__&&s.stopListening(this,l,s.__pollingFinished__),s.__pollingFinished__=this._onPollingFinished.bind(this,s,e),s.listenTo(this,l,s.__pollingFinished__),s},_maybeCleanUpItemsForCall:function(e){(e.sortOrder||"descending")!==(this._getCursorObject(e)||{sortOrder:"descending"}).sortOrder&&this.removeAllForCall(e)},_parseFunction:function(e,t,n,i){o.addToCollection(n||[],{merge:!0,parse:!0},_defineProperty({},"feed:"+i.data.sort_order,1));var r=window.Object.getPrototypeOf(t).parse.call(t,[],i);return this.isPolling(e)&&this._onPollSuccess(e,t,n||[]),r},_onPollingFinished:function(e,t){this._getCursorForCall(t)!==e.cursor&&e.setFetchOptions(this._getFetchOptions(t)),this.trigger("cursor",this._getCallId(t))},destroyCollectionForCall:function(e){var t=this._getCallId(e),n=this._collections[t];n&&n.wrapper.unwrap(),delete this._collections[t]},setCursorForCall:function(e,t,n){this.isPolling(e)||(t=t||"done",this._cursors[this._getCallId(e)]={cursor:t,sortOrder:n||"descending"})},hasCursorForCall:function(e){return!this.isPolling(e)&&!!this._getRawCursorValue(e)},removeAllForCall:function(e){var t=this._getCallId(e);o.removeAllForCall(t),delete this._cursors[t],delete this._polling[t]},_filterFunction:function(e,t,n,i){if("remove:filtered"==i||!t[n.get("feed_type")]||"ascending"===e.sortOrder&&!n.get("feed_key"))return!1;var r=n.get("call_id"),s=this._getCallId(e);return r==s||n.get("entry_point_call_id")==s},_getCallId:function(e){var t=e.attributes||e;return(e.getRootCallId?e.getRootCallId():t.entry_point_call_id)||t.call_id||t.id||t},_getCallTarget:function(e){return(e.attributes||e).target_key},_getCallDateEnded:function(e){return(e.attributes||e).date_ended},_getCursorObject:function(e){var t=this._getCallId(e);return this._cursors[t]},_getRawCursorValue:function(e){var t=this._getCursorObject(e);return t&&t.cursor},_getCursorForCall:function(e){var t=this._getRawCursorValue(e);return"done"!==t&&t},_getPeekFeedKeyForCall:function(e){return e.peekFeedKey},_getFetchOptions:function(e){var t={call_id:this._getCallId(e),target_key:this._getCallTarget(e),limit:50,sort_order:e.sortOrder},n=this._getPeekFeedKeyForCall(e);n&&(t.peek_feed_key=n);var i=this._getCursorForCall(e);return i&&(t.cursor=i),{data:t,remove:!1,merge:!0,reset:!1}},_isDoneFetchingForCall:function(e){return"done"===this._getRawCursorValue(e)},_updateCollectionWithFetchOptions:function(e,t){if(!this.isPolling(e)){var n=this._getFetchOptions(e);t.setFetchOptions(n),this._isDoneFetchingForCall(e)||t.cursor||this._poll(e,t)}},_poll:function(e,t,n){this._setPolling(e,t,!0),n?t.next():t.fetch(this._getFetchOptions(e))},_getItemTime:function(e){if(e)return(e.attributes||e).date_created},_getFirstItemTime:function(e){var t=o.getFirstItemForCallId(this._getCallId(e));return this._getItemTime(t)||this._getCallDateEnded(e)||i.getServerTime()},isPolling:function(e){var t=this._polling[this._getCallId(e)];return t&&!!t.isPolling},_setPolling:function(e,t,n,i){var r=this._getCallId(e),s={isPolling:!!n,firstTime:i||this._getPollingFirstTime(e)||this._getFirstItemTime(e)};s.isPolling&&(s.collection=t,i||(s.ct=this._getPollingCt(e)+1)),this._polling[r]=s,s.isPolling||(this.setCursorForCall(e,t.cursor,e.sortOrder),this.trigger("polling:done:"+r))},_getPollingFirstTime:function(e){return(this._polling[this._getCallId(e)]||{}).firstTime},_getPollingCollection:function(e){return(this._polling[this._getCallId(e)]||{}).collection},_getPollingCt:function(e){return(this._polling[this._getCallId(e)]||{}).ct||0},_onPollSuccess:function(e,t,n){var i=this._getPollingFirstTime(e),r=this._getPollDirection(i,e,t,n);switch(console.log("TALKIQ MANAGER: Polling",r.type,"for call",this._getCallId(e)),r.type){case"inPlace":case"fetch":r.minTime<i&&this._setPolling(e,t,!0,r.minTime),_.delay(_.bind(function(){this._poll(e,t)},this),r.fetchDelay||1e3);break;case"next":this._poll(e,t,!0);break;case"stop":case"done":this._setPolling(e,t,!1)}},_getPollDirection:function(e,t,n,i){var r={type:null,minTime:1e15};if(!i.length&&(this._getCallDateEnded(t)||this._getPollingCt(t)>5))return r.type="done",r;if(!i.length)return r.type="fetch",r.fetchDelay=5e3,r;if(i.length&&!n.cursor||this._getCallDateEnded(t)===e)return r.type="done",r;var s=this._getTimes(i);return r.minTime=s.min,s.min>=e?(r.type="next",r):s.min<e&&s.max>=e?(r.type="stop",r):s.min<e&&s.max<e?(r.type="inPlace",r):(console.warn("TALKIQ MANAGER: Should not have gotten here.",e,n.length,i.length,s.min,s.max),r)},_getTimes:function(e){for(var t=1e15,n=-1,i=0;i<e.length;i++){var r=this._getItemTime(e[i]);r<t&&(t=r),r>n&&(n=r)}return{min:t,max:n}}});return l.create(h,"talkIqManager")}),define("models/phone",["models/base","config"],function(e,t){return e.extend({urlRoot:t.REQUEST_URL+"phone"})}),define("collections/feed_list",["collections/common/cursor_collection","config","fslib/singleton","objects/contact_wrapper","models/feed_item","models/session"],function(e,t,n,i,r,s){var o=e.extend({model:r,url:t.REQUEST_URL+"feed/",cacheKey:t.useCache&&"feed",session:s,initialize:function(){e.prototype.initialize.call(this),this.wrapper||this.listenTo(Backbone,"affinity:destroyed",this.markAsRead)},markAsRead:function(e,t){var n=this.where({contact_key:e,feed_target:t});_.each(n,_.bind(function(e){e.markAsRead(),this.add(e,{merge:!0})},this))},getCacheKey:function(e){var t=this.cacheKey+":"+(e.contact_key||"contact");return t+=":"+(e.target_key||"me"),t+=":"+(e.filter||"filter"),t+=":"+(e.search||"search")},getOrFetch:function(e){var t=this;return new Promise(function(n,i){var r=t.get(e);r&&!r.isFetching()?n(r):r&&r.isFetching()?t.listenToOnce(r,"change:local:fetching",function(){r.hasError()?i(r):n(r)}):r||(r=new t.model({feed_key:e}),t.add(r),r.fetch({success:n,error:i}))})},_onCachedItems:function(e){var t=this,n=e.length;_.each(e,function(i){s.getLocal(i.contact_key,function(r){i.contact=r,0==--n&&(t.set(e,{sort:!0,cached:!0}),t._onCachedComplete())})})},_setItem:function(e){if(e&&e.contact){var t=e.feed_key,n=_.clone(e),r=_.clone(n.contact);return delete n.contact,s.setLocal(t,n),s.setLocal(r.key,i.stripAffinity(r)),t}}});return n.create(o,"feedList")}),define("models/text_message",["models/feed_item","collections/affinity_list","config"],function(e,t,n){return e.extend({urlRoot:n.REQUEST_URL+"textmessage",idAttribute:"feed_key",LOCAL_STATE:_.extend({oldFeedKey:"",newFeedKey:"",sent:!1,preview:null},e.prototype.LOCAL_STATE),initialize:function(t,n){e.prototype.initialize.apply(this,arguments),n&&n.update||console.log("TEXT MESSAGE: Created",this.getSentFeedKey(),this._getAddressLogString())},parse:function(){var t=this.attributes.feed_key,n=e.prototype.parse.apply(this,arguments);return t!==n.feed_key&&(this.adjustLocalState("newFeedKey",n.feed_key),this.adjustLocalState("oldFeedKey",t)),this.logSendTime(),n},getSentFeedKey:function(){return this.getLocalState("oldFeedKey")||this.get("feed_key")},getTimeToSend:function(){var e=this.getLocalState("newFeedDate"),t=this.getLocalState("oldFeedDate")||this.attributes.feed_date;return e?e-t:t},logSendTime:function(){this.getLocalState("sent")||"internal"!==this.get("orientation")||this.getTimeToSend()!==this.attributes.feed_date&&(console.log("TEXT MESSAGE: Sent",this.getSentFeedKey(),"in",this.getTimeToSend(),"ms",this._getAddressLogString()),this.adjustLocalState("sent",!0,!0))},logErrorTime:function(){var e=this.getLocalState("oldFeedDate")||this.attributes.feed_date;console.error("TEXT MESSAGE: Error",this.getSentFeedKey(),"in",Date.now()-e,"ms",this._getAddressLogString())},_getAddressLogString:function(){var e=this.get("target_key"),n=this.get("contact_key"),i=t.getContact(n,e);return"to "+(i?i.get("display_name"):"Contact not fetched or created yet")+" ( "+n+" ) from ( "+e+" )"}})}),define("collections/text_message_list",["collections/common/cursor_collection","config","models/text_message"],function(e,t,n){return e.extend({model:n,url:t.REQUEST_URL+"textmessage"})}),define("objects/message_manager",["fslib/singleton","models/current_user","models/session","collections/feed_list","collections/affinity_list","collections/text_message_list","models/text_message","fslib/object"],function(e,t,n,i,r,s,o,a){var c=0,l=a.extend({CLEAN_INTERVAL:6e4,SEND_IN_ORDER:!0,pendingMessages:{},initialize:function(){a.prototype.initialize.apply(this,arguments),this.listenTo(Backbone,"resend",this.resendMessage),this.listenTo(Backbone,"navigated:before",this._onNavigated),this.pendingTexts={},this.cachedMessages={},this.lastCleaned=(new Date).getTime()},_onNavigated:function(e,n,i){i=i||[],this._currentContactKey=i[0],this._currentTargetKey=i[1]||t.get("key")},_extendDefaultOptions:function(e){var i=_.extend({feed_type:"TextMessage",orientation:"internal",image_url:t.get("image_url"),sender_key:t.get("key"),feed_date:n.getServerTime(),client_id:n.getClientId()},e||{});return i.feed_target=i.target_key,i.feed_key||(i.feed_key=this._createRandomFeedKey()),i},_getCreateOptions:function(e){var t=this._extendDefaultOptions(e);return t.action="new",t},sendMessage:function(e,t,n){t=this._getOptionsFromMessage(t),this._shouldCacheMessage(t)?this.cacheMessage(e,t,n):this._addPendingMessage(e,t,n).then(this._onAddPendingMessageSuccess).catch(this.onError)},_onAddPendingMessageSuccess:function(e,t){this.SEND_IN_ORDER?this._sendNextMessageToAffinity(e):this._sendMessageToServer(e,t)},_sendNextMessageToAffinity:function(e){var t=this._getNextPendingMessageFor(e);t&&this.SEND_IN_ORDER&&(t.status="sending",this._sendMessageToServer(t.message,t.isUpdate))},_shouldCacheMessage:function(e){return!!this.getAffinityOptions(e).tempKey},resendMessage:function(e){var t=e.attributes,n=e.attributes.text;this.sendMessage(n,t,!0)},_addPendingMessage:function(e,t,n){var r=this;return new Promise(function(s,a){var c=t.mms_url&&!t.mms,l=r._extendDefaultOptions(t);l.text=c?"":e;var u=r._getPreviewAttributes(l),h=i.get(l.feed_key)||new o(l),d={pending:!0};_.isEmpty(u)||(d.preview=u),h.adjustLocalState(d),h.addLocalSource("feed");var f=r._createPendingMessage(h,n);i.add(h,{merge:!0,update:n}),r.pendingTexts[h.id]=h,c?r._uploadMms(f,t,n).then(s).catch(a):s(h,n)})},_uploadMms:function(e,t,n){var i=e.message;e.status="uploading";var r=t.mmsUploadModel.get("path"),s=i.getSentFeedKey();return console.log("MESSAGE MANAGER:",s,"needs to upload file:",r),t.mmsUploadModel.upload().then(function(){return e.status="ready",console.log("MESSAGE MANAGER:",s,"successfully uploaded file:",r),i}).catch(function(){return console.error("MESSAGE MANAGER:",s,"failed to upload file:",r),i})},_getOptionsFromMessage:function(e){var t=e.attributes||e;if(t.mms&&t.mmsUploadModel&&delete t.mmsUploadModel,t.mmsUploadModel&&t.mmsUploadModel.uploaded){var n=t.mmsUploadModel.toJSON();delete n.mmsUploadModel,delete t.mmsUploadModel,t=_.extend(t,n)}return t},_sendMessageToServer:function(e,t,n){var r=this._getCreateOptions(this._getOptionsFromMessage(e)),s=r.feed_key,o={feed_key:s,preview:this._getPreviewAttributes(r),update:!0,wait:!1,success:_.bind(function(e){this.onCreated.apply(this,arguments),n&&n(e)},this),error:_.bind(function(e){this.onError.apply(this,arguments),n&&callack(e)},this)},a=i.get(s);a&&a!==e&&(a.destroying=!1,i.remove(a)),i.add(e,{merge:!0});var c=i.get(e);c.addLocalSource("feed"),c.setLocalCursor("feed",{cursor:"DONE"}),delete r.previewUrl,delete r.mmsPreviewOptions,e.save(r,o),t&&this._triggerEventForModel("resend",e)},onCreated:function(e,t,n){if(delete this.pendingTexts[n.feed_key],e.adjustLocalState("pending",!1),this._removePendingMessage(e,"created"),!e.error){var i=e.get("contact");i.date_description=e.get("feed_date"),i.interact=!0,r.addContact(i,e.get("feed_target"))}this._sendNextMessageToAffinity(e)},_getPreviewAttributes:function(e){var t={};return e.previewUrl&&(t.previewUrl=e.previewUrl),e.mmsPreviewOptions&&(t.mmsPreviewOptions=e.mmsPreviewOptions),e.mmsPreviewOptions&&e.mmsPreviewOptions.mmsType&&(t.mmsType=e.mmsPreviewOptions.mmsType),t},onError:function(e,t,n){e.error=!0,delete this.pendingTexts[e.id],e.logErrorTime(),this._removePendingMessage(e,"error",t),this._sendNextMessageToAffinity(e)},_triggerEventForModel:function(e,t,n){this.trigger(e+":"+t.get("contact_key")+":"+t.get("target_key"),t.id,t,n)},_createRandomFeedKey:function(){return"sent"+c++},cacheMessage:function(e,t){var n=(new Date).getTime();this.cachedMessages[t.tempKey]||(this.cachedMessages[t.tempKey]={time:n,messages:[]});var i=this.cachedMessages[t.tempKey];i.messages.push({inputVal:e,options:t}),i.time=n,this._cleanCache(n)},getCachedMessages:function(e){var t=this.cachedMessages[e];return t&&t.messages.length?t.messages:null},clearCachedMessages:function(e){delete this.cachedMessages[e]},_cleanCache:function(e){if(!(e-this.lastCleaned<this.CLEAN_INTERVAL)){var t={};for(var n in this.cachedMessages)this.cachedMessages[n]&&e-this.cachedMessages[n].time<this.CLEAN_INTERVAL&&(t[n]=this.cachedMessages[n]);this.cachedMessages=t,this.lastCleaned=e}},sendCachedMessagesFrom:function(e,t,n){if(this.cachedMessages[e]){var i=this.cachedMessages[e].messages;this.cachedMessages[e]=null;for(var r=0;r<i.length;r++){var s=i[r],o=s.options;o.target_key=n,o.contact_key=t,this.sendMessage(s.inputVal,o)}}else console.info("MESSAGE MANAGER: trying to send messages from cache key (",e,") that is not in cached messages.")},getAffinityOptions:function(e){var t=e.tempKey,n=e.contactKey||e.contact_key,i=e.targetKey||e.target_key;return e.tempKey&&!(n&&i)?{tempKey:t}:{contact_key:n,target_key:i}},inCurrentConversation:function(e){if(!e)return!1;var t=e.get?e.attributes:e;return t.contact_key===this._currentContactKey&&t.target_key===this._currentTargetKey},_getPendingMessagesFor:function(e){var t=this.getAffinityOptions(e.attributes||e),n=r.getPath(t.contact_key,t.target_key);return this.pendingMessages[n]||(this.pendingMessages[n]=[]),this.pendingMessages[n]},_createPendingMessage:function(e,t){var n={message:e,status:"ready",isUpdate:t};return this._getPendingMessagesFor(e).push(n),this._triggerEventForModel("pending",e),n},_removePendingMessage:function(e,t,n){for(var i=this._getPendingMessagesFor(e),r=-1,s=e.getSentFeedKey(),o=0;o<i.length;o++)if(i[o].message.getSentFeedKey()===s){r=o;break}-1!==r&&(i.splice(r,1),t&&this._triggerEventForModel(t,e,n))},_getNextPendingMessageFor:function(e){var t=this._getPendingMessagesFor(e)[0];return t&&"ready"===t.status&&t},numPendingMessagesFor:function(e){var t=this._getPendingMessagesFor(e);return t?t.length:0},getPendingMessages:function(e,t){return this._getPendingMessagesFor({contactKey:e,targetKey:t}).map(function(e){return e.message})}});return e.create(l,"messageManager")}),define("models/active_contact",["models/affinity","config"],function(e,t){return e.extend({idAttribute:"path",initialize:function(){e.prototype.initialize.call(this)},getContactKey:function(){return this.contact.get("key")},getTargetKey:function(){return this.get("target_key")},destroy:function(){this.stopListening(),this.setActive(!1),this.conversation=null,this.wrapper&&(this.wrapper.unwrap(),this.wrapper=null),this.collection&&this.collection.remove(this)},updateFilter:function(e){this.filter=e}})}),define("collections/active_contact_list",["collections/common/collection","config","fslib/singleton","models/current_user","models/active_contact"],function(e,t,n,i,r){var s=e.extend({model:r,initialize:function(){e.prototype.initialize.call(this),this.selected=null},addContact:function(e,n,s){var o=n;if("undefined"==o&&(console.error("Passing in target as 'undefined' string...assuming user."),o=null),_.isObject(n)&&(o=n.id),e)if(i.get("key"))if(e!=i){if(!t.isSingle){e.setActive(!0),(s=s||{}).merge=!0,o=o||i.get("key");var a=e.toJSON();a.target_key=o,a.path=e.get("key")+"/"+o;var c=new r(a);this.add(c,s);var l=this.get(c);return l.addContactListeners(e),l}}else console.error("check yourself before you wreck yourself");else console.error("no current user yet");else console.error("no contact to add")},getContact:function(e,t){var n=e+"/"+t;return this.get(n)},getCurrentContact:function(){return this.current},removeContact:function(e,t){var n=this.getContact(e,t);n&&(n.setActive(!1),n.destroy())}});return n.create(s,"activeContactList")}),define("models/channel",["models/contact","config"],function(e,t){return e.extend({urlRoot:t.REQUEST_URL+"channel"})}),define("models/channel_member",["models/base","models/contact","models/channel","collections/contact_list","config"],function(e,t,n,i,r){return e.extend({urlRoot:r.REQUEST_URL+"channelmembers",getMember:function(){var e=this.get("member");if(e)return new t(e)},getChannel:function(){var e=this.get("channel");if(e)return new n(e)},addMention:function(e){var t=e.get("sender");if(!t){e.get("sender_key");if(!t)return console.log("Fetching full item: "+JSON.stringify(e.attributes)),e.fetch({success:this.addMention})}var n=this.get("recent_mentions")||[];n.unshift(e.attributes),this.set("recent_mentions",n),this.set("recent_mention_keys",_.map(n,function(e){return e.feed_key})),this.set("num_mentions",n.length)},removeMention:function(e){var t=_.filter(this.get("recent_mentions")||[],function(t){return t.feed_key!=e.id});this.set("recent_mentions",t),this.set("recent_mention_keys",_.map(t,function(e){return e.feed_key})),this.set("num_mentions",t.length)},isNotifyOn:function(){return"always"==(this.get("notify")||"always")},parse:function(e,t){if(e.unread&&!e.count){var n=this.collection.get(e.id)||this;e.count=n.attributes.count}return this.clear({silent:!0}),e}})}),define("collections/channel_memberships",["collections/common/cursor_collection","config","fslib/singleton","objects/pusher","models/channel_member"],function(e,t,n,i,r){var s=e.extend({model:r,url:t.REQUEST_URL+"channelmembers/me",initialize:function(){e.prototype.initialize.apply(this,arguments),this.listenToOnce(this,"sync",this._subscribe)},removeMention:function(e){this.getByChannel(e.get("contact_key")).removeMention(e)},getByChannel:function(e){return this.findWhere({channel_key:e})},_subscribe:function(){var e=this.pluck("channel_short_key");i.subscribeToChannels(e),this.listenTo(this,"add",this._subscribeOne)},_subscribeOne:function(e){var t=e.get("channel_short_key");console.log("Adding channel: "+t),i.subscribeToChannels([t])},getLineCss:function(e){return"line-"+(this.indexOf(e)%6+1)}});return n.create(s,"channelMembers")}),define("collections/office_group_list",["collections/common/cursor_collection","config","fslib/singleton","models/group"],function(e,t,n,i){var r=e.extend({model:i,url:t.REQUEST_URL+"group",comparator:function(e){return e.get("name")}});return n.create(r,"officeGroupList")}),define("collections/user_list",["collections/common/cursor_collection","config","fslib/singleton","models/user"],function(e,t,n,i){var r=e.extend({model:i,url:t.REQUEST_URL+"user",collectByFilter:function(e,t){_.isArray(t)||(t=[t]);var n=this.filter(function(n){return t.indexOf(n.get(e))>-1});return new r(n)},adminCount:function(){return this.filter(function(e){return e.isAdmin()}).length}});return n.create(r,"usersList")}),define("models/user_invite",["models/base","config"],function(e,t){return e.extend({idAttribute:"primary_email"})}),define("collections/user_invite_list",["collections/common/cursor_collection","config","fslib/fsutil","fslib/singleton","models/user_invite"],function(e,t,n,i,r){var s=e.extend({model:r,url:t.REQUEST_URL+"user",add:function(t,i){if(t instanceof Backbone.Model){var r=t.get("primary_email"),s=i.domain;if(r&&!n.emailMatchesDomain(r,s)&&t.has("emails")){var o=n.findEmailThatMatchesDomain(t.get("emails"),s);o&&(console.log("switching primary email from "+r+" to "+o),t.set({primary_email:o}))}}return e.prototype.add.call(this,t,i)}});return i.create(s,"userInviteList")}),define("objects/cache_wrapper",["models/session"],function(e){return{preFetch:function(e){e&&e.forceUpdate||this._setModelToCachedValue()},preSave:function(){this.updateCache(this)},parse:function(t,n){return this._hasFetchedValue=!0,e.setLocal(this._getCacheKey(),t),t},updateCache:function(t){e.setLocal(this._getCacheKey(),t.toJSON())},_setModelToCachedValue:function(t){if(!this._hasAttemptedCacheFetch){this._hasAttemptedCacheFetch=!0;var n=function(e){this._onCacheHit(e,t)}.bind(this),i=e.getLocal(this._getCacheKey(),n);return i&&this._onCacheHit(i,t),i}},_onCacheHit:function(e,t){this._hasFetchedValue||(this._hasFetchedValue=!0,e&&(this.set(e),this.trigger("sync",e)),t&&t(e))},_getCacheKey:function(){return"cachedmodel:"+_.result(this,"url")}}}),define("models/cached_model_base",["models/session","models/base","objects/cache_wrapper"],function(e,t,n){var i=t.extend({fetch:function(n){var i=this;this.preFetch(),this.stopListening(e,"ajax:done");var r=arguments;if(!e.isMakingAjaxCall())return t.prototype.fetch.apply(this,arguments);this.listenToOnce(e,"ajax:done",function(){return i.fetch.apply(i,r)})},save:function(e){return this.preSave(),t.prototype.save.apply(this,arguments)}});return _.extend(i.prototype,n),i}),define("models/integrations/integration_base",["models/cached_model_base","models/session","models/current_user","config"],function(e,t,n,i){return e.extend({urlRoot:i.REQUEST_URL+"integrations/",CONNECT_SAFELINK:{safeLink:'<span class="wlink subhead-2" id="connect-integration">',safeEndLink:"</span>"},url:function(){return this.urlRoot+this.endpoint},isNew:function(){return!1},isConnected:function(){return this.get("connected")},shouldShowConnectPrompt:function(){return!0},getData:function(){return this.get("data")},getError:function(){var e=this.get("error");return e?this.getErrorText(e):null},shouldHandleError:function(){return!1},getErrorText:function(e){return this.translate("An error has occurred. Please reconnect or try again later.")},getConfiguration:function(){return{required_permissions_message:this.translate("You do not have sufficient permissions.")}},fetch:function(t){return _.extend(t,{error:this._onServerError}),e.prototype.fetch.call(this,t)},_isMicrosoft:function(){return"microsoft"==n.get("remote_service")},_onServerError:function(e,t){this.set("error",t.responseJSON)},_getCacheKey:function(){return e.prototype._getCacheKey.call(this)+this.contactKey+this.getConfiguration().serviceName},getMiniTopLinks:function(){},getMiniBottomLinks:function(){}})}),define("models/integrations/linkedin",["models/integrations/integration_base"],function(e){return e.extend({endpoint:"linkedin",getConfiguration:function(){return{title:this.translate("LinkedIn"),serviceName:"linkedin",iconClassName:"icon-linkedin",iconRef:"#linkedin",oauthEventName:"linkedin",oauthPath:"/auth/linkedin",oauthUseSource:!0,headerLinkText:this.translate("View profile"),headerLink:this.getProfileUrl(),connectHtml:this.translate("[safeLink]Connect LinkedIn®[safeEndLink] to see more about your contacts.",this.CONNECT_SAFELINK),loadingText:this.translate("Loading shared connections")}},getMatches:function(){var e=this.getData();return e?e.matches:null},getProfile:function(){var e=this.getData();return e?e.profile:null},getNumConnections:function(){var e=this.getData();if(!e)return null;var t=e.connections;return t?t.num_connections:null},getConnectionProfiles:function(){var e=this.getData();if(!e)return null;var t=e.connections;return t?t.profiles:null},getProfileUrl:function(){var e=this.getProfile();return e?e.profile_url:null},needsReconnect:function(){var e=this.getData();return e?e.reconnect:null},hasProfile:function(){return!$.isEmptyObject(this.getProfile())},hasInfo:function(){return this.hasProfile()||this.hasMatches()},hasMatches:function(){return!$.isEmptyObject(this.getMatches())},getMiniBottomLinks:function(){if(this.getProfileUrl())return[{text:this.translate("View Profile"),href:this.getProfileUrl()}]}})}),define("collections/contact_info_list",["collections/common/collection","fslib/singleton","models/integrations/linkedin","models/current_user"],function(e,t,n,i){var r=e.extend({model:n});return t.create(r,"contactInfoList")}),define("models/voiceai_summary_event",["require","models/talk_iq"],function(require){return require("models/talk_iq").extend({idAttribute:"key",url:function(){return this.get("feed_key")?this.urlRoot+"/"+this.get("feed_key"):this.urlRoot},isForSummary:function(){return!0},isFirstMomentOfType:function(){if(this.isMoment()&&this.collection){var e=this.collection.indexOf(this),t=this.collection.at(e-1);return!t||t.getMomentText()!==this.getMomentText()}},isLastMomentOfType:function(){if(this.isMoment()&&this.collection){var e=this.collection.indexOf(this),t=this.collection.at(e+1);return!t||t.getMomentText()!==this.getMomentText()}}})}),define("collections/voiceai_summary_event_list",["require","collections/common/cursor_collection","collections/talk_iq_list","models/voiceai_summary_event"],function(require){require("collections/common/cursor_collection");var e=require("collections/talk_iq_list"),t=require("models/voiceai_summary_event");return e.getPrototype().extend({model:t,comparator:"date_created",url:null,_addListeners:function(){}})}),define("collections/voiceai_summary_moment_list",["require","collections/voiceai_summary_event_list","models/session"],function(require){var e=require("collections/voiceai_summary_event_list"),t=require("models/session");return e.extend({INTERESTING_MOMENT_ORDER:["action_item","bookmark"],initialize:function(){e.prototype.initialize.apply(this,arguments),this._momentWeights=this._createMomentWeights(),this._interestingMomentPlaceholders=this._createInterestingMomentPlaceholders(),this._maybeTogglePlaceholders(),this.listenTo(this,"add",this._onAdd),this.listenTo(this,"remove",this._onRemove)},hasInterestingMomentType:function(e){for(var t,n,i,r=0,s=this.length,o=this._momentWeights[e]||1e4;r<s;)if(t=Math.floor((r+s)/2),n=this.at(t),(i=this._getMomentWeight(n))<o)r=t+1;else{if(!(i>o||o===i&&n.get("isPlaceholder")))return!0;s=t}return!1},_createInterestingMomentPlaceholders:function(){var e=this,n=t.getServerTime()+864e5;return _.reduce(this.INTERESTING_MOMENT_ORDER,function(t,i){return t[i]=e._createMomentPlaceholder(i,n),t},{})},_createMomentPlaceholder:function(e,n){return new this.model({key:this._getPlaceholderKey(e),feed_type:"CallMoment",isPlaceholder:!0,moment:e,related:[],date_created:n||t.getServerTime()})},_getPlaceholderKey:function(e){return e+"Placeholder"},_createMomentWeights:function(){return _.reduce(this.INTERESTING_MOMENT_ORDER,function(e,t,n){return e[t]=n+1,e},{})},comparator:function(e,t){return t?(e=e.attributes||e,t=t.attributes||t,this._compareMomentOrder(e,t)||this._compareMomentName(e,t)||this._compareMomentDate(e,t)):-1},_compareMomentOrder:function(e,t){return this._getMomentWeight(e)-this._getMomentWeight(t)},_getMomentWeight:function(e){var t=e.attributes||e;return this._momentWeights[t.moment]||1e4},_compareMomentName:function(e,t){var n=e.moment,i=t.moment;return n>i?1:n<i?-1:0},_compareMomentDate:function(e,t){return e.date_created-t.date_created},_onAdd:function(){this._maybeTogglePlaceholders.apply(this,arguments)},_onRemove:function(){this._maybeTogglePlaceholders.apply(this,arguments)},_maybeTogglePlaceholders:function(){_.each(this.INTERESTING_MOMENT_ORDER,this._maybeTogglePlaceholder)},_maybeTogglePlaceholder:function(e){var t=this.get(this._getPlaceholderKey(e));this.hasInterestingMomentType(e)&&t?this.remove(t,{silent:!0}):this.hasInterestingMomentType(e)||t||this.add(this._interestingMomentPlaceholders[e],{silent:!0})}})}),define("models/voiceai/share_link",["require","models/base","config"],function(require){var e=require("models/base"),t=require("config");return e.extend({urlRoot:t.REQUEST_URL+"callai/sharelink"})}),define("models/voiceai_summary",["require","config","models/base","collections/voiceai_summary_event_list","collections/voiceai_summary_moment_list","models/voiceai/share_link","collections/talk_iq_list","models/talk_iq"],function(require){var e=require("config"),t=require("models/base"),n=require("collections/voiceai_summary_event_list"),i=require("collections/voiceai_summary_moment_list"),r=require("models/voiceai/share_link"),s=require("collections/talk_iq_list"),o=require("models/talk_iq");return t.extend({idAttribute:"call_id",urlRoot:e.REQUEST_URL+"callai/summary",LOCAL_STATE:{length:null,notes:null,fetching:!1,error:null,processingNotes:null,audioIsPlaying:!1,audioUtc:0},initialize:function(){for(var e=arguments.length,r=Array(e),s=0;s<e;s++)r[s]=arguments[s];t.prototype.initialize.apply(this,r),this.moments=new i,this.transcriptions=new n,this._addListeners(),this.buildMomentsList(),this.buildTranscriptionsList(),this.resetLocalNotes()},parse:function(e,n){return this._addSummaryEventsToStore(e),t.prototype.parse.apply(this,arguments)},_addSummaryEventsToStore:function(e){var t=e.moments,n=void 0===t?[]:t,i=e.recommendations,r=void 0===i?[]:i,a=e.transcriptions,c=void 0===a?[]:a,l=[].concat(_toConsumableArray(n),_toConsumableArray(r),_toConsumableArray(c));s.add(l,{merge:!0,parse:!0});var u=l.map(function(e){return o.getTalkIqId(e)}),h="voiceaisummary:"+e.call_id;u.forEach(function(e){s.get(e).addLocalSource(h)})},_addListeners:function(){this.listenTo(this,"sync",this._onSync),this.listenTo(this,"request",this._onRequest),this.listenTo(this,"error",this._onError),this.listenTo(this,"change:moments",this.buildMomentsList),this.listenTo(this,"change:transcriptions",this.buildTranscriptionsList)},buildMomentsList:function(){this.moments.set(this.get("moments"),{merge:!0}),this._resetLength()},buildTranscriptionsList:function(){this.transcriptions.set(this.get("transcriptions"),{merge:!0}),this._resetLength()},getTranscriptionsForMoment:function(e){for(var t=[],n=e.get("related")||[],i=0;i<n.length;i++){var r=this.transcriptions.get(n[i]);r&&t.push(r)}return t},getSearchParamsForMoment:function(e){var t=this.getTranscriptionsForMoment(e);if(t.length){var n=t[0];return{searchTerm:n.get("text"),peekFeedKey:n.get("feed_key")}}},getShareLink:function(){var e=this;return new Promise(function(t,n){e.shareLink||(e.shareLink=new r);var i=function(){t(e.shareLink.get("share_url"))};e.shareLink.get("share_url")?i():e.shareLink.isRequesting()?e.listenToOnce(e.shareLink,"sync",i):e.shareLink.fetch({data:{call_id:e.id},success:i,error:n})})},_resetLength:function(){this.adjustLocalState("length",null,!1)},_calculateLength:function(){var e=0;return this.moments.each(function(t){e+=1+(t.get("related")||[]).length}),e},length:function(){return null===this.getLocalState("length")&&this.adjustLocalState("length",this._calculateLength(),!1),this.getLocalState("length")},setLocalNotes:function(e){this.adjustLocalState("notes",e)},getNotes:function(){return this.getLocalState("notes")||this.get("notes")},resetLocalNotes:function(){this.adjustLocalState("notes",this.get("notes"))},canSaveNotes:function(){if(this.getLocalState("processingNotes"))return!1;var e=this.getLocalState("notes"),t=this.get("notes");return!(!t&&!e)&&e!==t},saveNotes:function(){this.saveAndAdjustLocalState({notes:this.getLocalState("notes")},"processingNotes")},_onSync:function(){this._wasEmpty&&!this.isEmpty()&&(this.resetLocalNotes(),this._wasEmpty=!1),this.adjustLocalState("error",null,!0),this._setFetching(!1)},_onError:function(e,t){var n=t.responseJSON?t.responseJSON.message:"No server response";this.adjustLocalState("error",n,!0),this._setFetching(!1)},_onRequest:function(){this._wasEmpty=this.isEmpty(),this._setFetching(!0)},_setFetching:function(e){this.adjustLocalState("fetching",e)},isFetching:function(){return this.getLocalState("fetching")},isLoading:function(){return this.isFetching()&&this.isEmpty()},hasError:function(){return!!this.getError()},getError:function(){return this.getLocalState("error")},isEmpty:function(){return!this.attributes.hasOwnProperty("moments")},needsToFetch:function(e){return e?!this.isFetching():!this.isFetching()&&this.isEmpty()},isSavingNotes:function(){return this.getLocalState("processingNotes")}})}),define("collections/voiceai_summary_list",["require","models/current_user","collections/common/cursor_collection","models/voiceai_summary","fslib/singleton","config"],function(require){var e=require("models/current_user"),t=require("collections/common/cursor_collection"),n=require("models/voiceai_summary"),i=require("fslib/singleton"),r=(require("config"),t.extend({model:n,initialize:function(){t.prototype.initialize.call(this),this.wrapper||this._addListeners()},_addListeners:function(){},getSummaryForCall:function(t,n){var i=this,r=this._getCallId(t);return new Promise(function(t,s){if(!e.hasVoiceAiSummary())return s();var o=i.get(r)||i._createSummaryForCall(r);o.needsToFetch()?o.fetch({success:t,error:s}):o.isFetching()?i.listenToOnce(o,"change:local:fetching",function(){o.getError()?s(o):t(o)}):(n&&o.fetch({merge:!0}),t(o))})},_getCallId:function(e){if(e){var t=e.get||function(t){return e[t]};return t("entry_point_call_id")||t("id")||e}},_createSummaryForCall:function(e){var t=new this.model({call_id:e});return this.add(t),this.get(e)}}));return i.create(r,"voiceAiSummaryList")}),define("objects/model_manager",["config","views/common/view","objects/window_manager","objects/ipc_manager","objects/message_manager","objects/pusher","models/current_user","models/call","models/video_call","models/affinity","models/contact","models/feed_item","models/session","models/text_message","fslib/fsutil","fslib/notifications","fslib/singleton","fslib/webrtc","collections/active_calls","collections/video_calls","collections/active_contact_list","collections/affinity_list","collections/call_history","collections/channel_memberships","collections/contact_list","collections/feed_list","collections/group_list","collections/office_group_list","collections/unread_feed_list","collections/user_list","collections/user_invite_list","collections/contact_info_list","collections/voiceai_summary_list"],function(e,t,n,i,r,s,o,a,c,l,u,h,d,f,p,g,m,v,y,b,S,C,w,T,k,E,A,x,R,I,L,M,P){var O=t.extend({CHANNEL_LATENCY:5e3,stickyPrefix:"conversation:stickypath:",initialize:function(){t.prototype.initialize.call(this),this._resetRefreshFlags(),this.recentNotifications=[],this.useChannels()&&(g.on("all",this._onChannel),g.on("all",this._onMessage)),this.listenTo(s,"user",this._onPusherMessage),this.listenTo(s,"notify",this._onMessage),this.listenTo(v,"sipMessage",this._onMessage),this.listenTo(o,"change",this._onCurrentUserChange),this.firstNotification=window.globals&&globals.notification,this.firstNotification&&(globals.notification=null,n.log("Model Manager found notification on init: "),n.log(this.firstNotification)),e.isNative&&this._listenIpcModelManager()},useChannels:function(){return!e.disableChannels},_onPusherMessage:function(){console.info("AELOG: Pusher Message"),this.notify.apply(this,arguments)},notify:function(e){if(e||(n.log("grabbing first notification: "+this.firstNotification),e=this.firstNotification),this.notification=e,e)if(this.firstNotification=null,n.log("Socket: model manager notify:",1),n.log(e),globals.notification=null,e.user_id&&e.user_id!=o.get("user_id"))this._onUserMismatch(e);else{switch(e.type){case"call":this._fetchCall(e.call_uuid),this._onGCM(e.call_uuid);break;case"video":this._onVideoRequest(e);break;case"text_message":case"fax_message":this._fetchText(e.key),this._onGCM(e.key);break;case"recording":this._fetchRecording(e.feed_key),this._onGCM(e.feed_key);break;case"user":e.me&&o.fetch();break;case"quit":return void _.defer(this._onQuit);case"relaunch":return void _.defer(this._onRelaunch);case"search":return void this._onSearch(e);case"new_call":return void this._onNewCall(e);case"execute_call":return void this._onExecuteCall(e);case"feed":this._onFeed(e);break;case"contact":this._onContact(e);break;case"send_logs":this._onSendLogs(e);break;case"call_log":this._onCallLogged(e);break;default:console.log(e)}this.trigger("notification",e)}else n.log("no notification to notify")},_onMessage:function(e){if(e)if(e.user_id&&e.user_id!=o.get("user_id"))this._onUserMismatch(e);else{var t=e.call||e.text_message||e.recording||e.fax_message,i=null;switch(t&&!t.contact&&t.contact_key&&(t.target_key||t.feed_target)&&(i=C.getContactAffinity(t.contact_key,t.target_key||t.feed_target))&&(t.contact=i.toJSON()),e.type){case"text_message":if(!t.contact)return console.log("Fetching full text message missing contact: "+t.key),this._fetchText(t.feed_key);this._onTextMessage(e);break;case"fax_message":if(!t.contact)return console.log("Fetching full fax message missing contact: "+t.key),this._fetchFax(t.feed_key);this._onFaxMessage(e);break;case"call":if(!t.contact&&!t.participants)return console.log("Fetching full call missing contact: "+t.id),this._fetchCall(t);this._onCall(e);break;case"recording":if(!t.contact)return console.log("Fetching full recording missing contact: "+t.key),this._fetchRecording(t.id);this._onRecording(e);break;case"typing":this._onTyping(e);break;case"affinity":this._onAffinity(e);break;case"user":e.me?(o.duty_setter=e.user.duty_setter,o.fetch()):this._onUserChange(e);break;case"channel":this._onChannelEvent(e);break;case"video":e.state?this._onVideoRequest(e):this._onVideoSignal(e);break;case"linkedin":this._onLinkedIn(e);break;case"relaunch":_.defer(this._onRelaunch);break;case"search":this._onSearch(e);break;case"new_call":this._onNewCall(e);break;case"execute_call":return void this._onExecuteCall(e);case"feed":this._onFeed(e);break;case"contact":this._onContact(e);break;case"send_logs":this._onSendLogs(e);break;case"call_log":this._onCallLogged(e);break;case"voiceai_summary":this._onVoiceAiSummary(e);break;default:n.log("unhandled sip message: "+e.type)}}},_onChannelEvent:function(e){switch(console.log("Received channel event: "+JSON.stringify(e)),e.event){case"member_add":case"member_remove":case"create":case"delete":case"refetch":T.fetch()}},_onTalkIQCall:function(t){console.log("_onTalkIQCall"),console.log(t);var n=(t.user_id||o.getShortKey()).replace(":","-"),i=t.call_id||t.id,r=e.talkiq_url+"&call_id="+i+"&user_id="+n;console.log("talkiq iframe url: "+r),$("#talkiq-wrapper").removeClass("hide"),$("#talkiq-iframe").attr("src",r)},start:function(){this.started||(this.started=!0,this.notify(),this._addListeners(),(new k.constructor).fetch({data:{filter:"cooperators"},remove:!1,success:function(e){k.add(e.models,{merge:!0})}}),x.fetch(),_.delay(this._getFrequentContacts,1500),R.start(),this.refetch(!1,!0,!0))},_addListeners:function(){e.talkiq_url&&this.listenTo(Backbone,"talkiq:showcall",this._onTalkIQCall),this.listenTo(Backbone,"app:refresh",this._onAppRefresh),this.listenTo(R,"sync",this._pluckContacts),this.listenTo(d,"online",this._onOnline),this.listenTo(d,"active",this.refetch),this.listenTo(v,"onCallState",this._onWebrtcCallStateChanged),this._addActiveCallsListeners(),this._addVideoCallsListeners()},_addActiveCallsListeners:function(){this.listenTo(y,"add",this._onCallAdd),this.listenTo(y,"change",this._onCallChange),this.listenTo(y,"localStateChange",this._onCallChange),this.listenTo(y,"remove",this._onCallRemove),this.listenTo(y,"dummyRemoved",this._onCallAdd),this.listenTo(y,"call:swapped",this._onCallSwapped),this.listenTo(y,"call:swapped:finished",this._onCallSwappedSuccess)},_addVideoCallsListeners:function(){this.listenTo(b,"add",this._onCallAdd),this.listenTo(b,"change",this._onCallChange),this.listenTo(b,"localStateChange",this._onCallChange),this.listenTo(b,"remove",this._onCallRemove)},_onWebrtcCallStateChanged:function(e){switch(e){case"ringing":this._updateAffinityForCall(y.getRingingCall())}},logRefresh:function(e){console.log("App Refresh: "+e+" "+p.formatTime(performance.now()-this.startRefreshTime,!0)+" from when started.")},_resetRefreshFlags:function(){this.startRefreshTime=performance.now(),this.refreshing=!1,this.webRtcAlreadyStopped=!1,this.loginAlreadyRefreshed=!1,this.webRtcAlreadyStarted=!1,this.modelsAlreadyRefreshed=!1},_onAppRefresh:function(e){this.refreshing?this.logRefresh("AlreadyRefreshing"):(this._resetRefreshFlags(),this.logRefresh("Starting"),this.refreshing=!0,Backbone.trigger("app:refresh:start"),v.isStateReady()?this._stopWebRtc(e):this._refreshModels(e))},_stopWebRtc:function(e){var t=this;this.logRefresh("Stopping WebRTC"),this.listenToOnce(v,"unregistered",this._onWebRtcStop.bind(this,e)),v.stop(),this.webRtcStopFallback=setTimeout(function(){t.logRefresh("Refresh stalled at WebRTC Stop, continuing onwards"),t._onWebRtcStop(e,null,!0)},1e3)},_onWebRtcStop:function(e,t,n){this.webRtcAlreadyStopped||(!n&&this.logRefresh("WebRTC Stopped"),this.webRtcAlreadyStopped=!0,clearTimeout(this.webRtcStopFallback),this._sessionLogin(e))},_sessionLogin:function(e){var t=this;this.logRefresh("Refreshing login"),d.login({force:!0,silent:!0},this._onSessionLogin.bind(this,e)),this.refreshLoginFallback=setTimeout(function(){t.logRefresh("Refresh failed at session login, continuing onwards"),t._onSessionLogin(e,!0)},2e3)},_onSessionLogin:function(e,t){this.loginAlreadyRefreshed||(!t&&this.logRefresh("Login refresh finished"),this.loginAlreadyRefreshed=!0,clearTimeout(this.refreshLoginFallback),this._startWebRtc(e))},_startWebRtc:function(e){var t=this;this.logRefresh("Starting Webrtc"),this.listenToOnce(v,"registered",this._onWebRtcStart.bind(this,e)),v.start(d.getWebrtcSipConfig(),!0),this.webrtcStartFallback=setTimeout(function(){t.logRefresh("Refresh stalled at WebRTC Start, continuing onwards"),t._onWebRtcStart(e,null,!0)},5e3)},_onWebRtcStart:function(e,t,n){this.webRtcAlreadyStarted||(!n&&this.logRefresh("WebRTC Started"),this.webRtcAlreadyStarted=!0,clearTimeout(this.webrtcStartFallback),this._refreshModels(e))},_refreshModels:function(e){var t=this;this.logRefresh("Re-fetching models"),this.refetch(!0,null,null,this._onRefreshModels.bind(this,e)),this.refreshModelsFallback=setTimeout(function(){t.logRefresh("Refresh stalled at Re-fetching Models, continuing onwards"),t._onRefreshModels(e,!0)},3e3)},_onRefreshModels:function(e,t){this.modelsAlreadyRefreshed||(!t&&this.logRefresh("Re-fetched models"),this.modelsAlreadyRefreshed=!0,clearTimeout(this.refreshModelsFallback),this._onAppRefreshFinished(e))},_onAppRefreshFinished:function(e){this.refreshing=!1,e&&e(),this.logRefresh("Finished"),Backbone.trigger("app:refresh:stop")},_onCallAdd:function(t){e.talkiq_url&&t&&!t.isVideo()&&this._onTalkIQCall.apply(this,arguments),this._updateAffinityForCall(t)},_onCallChange:function(e){this._updateAffinityForCall(e)},_onCallRemove:function(e){this._updateAffinityForCall(e)},_updateAffinityForCall:function(e){if(e){var t=e.get("contact")||k.get(e.get("contact_key")),n=e.get("state"),i=!!y.get(e)||!!b.get(e);if(console.log("ccv._onCall:",e.id,"webrtc state:",v.getCallState(),"call state:",n,"contact:",t&&t.id),t){t=t.attributes||t;var r=C.getContactAffinity(t.key,t.target_key||e.get("target_key"));if(r){var s=e.isRinging()&&i,o=e.isCalling()&&i,a={callRinging:s,callCalling:o,callViewable:e.isInViewableState()&&i};e.get("id")&&(a[e.isVideo()?"videoCallId":"callId"]=e.get("id")),(s&&!r.hasRingingCall()||o&&!r.hasCallingCall())&&(console.log("ccv._onCall SETTING SESSION TIME"),r.setInteractionTime()),console.info("ADJUSTING LOCAL STATE:",e.get("state"),e.isConnecting(),JSON.stringify(a)),r.adjustLocalState(a)}else console.log("No Affinity found for this call:",e.id)}}},_onCallSwapped:function(e){var t=e.id;console.log("MODEL MANAGER: received call:swapped event for swapped call (",t,"). Sending call to _onMessage."),this._onMessage({type:"call",call:e})},_onCallSwappedSuccess:function(e){var t=e.get("swap_call"),n=t.contact_key,i=t.target_key,r=t.id;console.log("MODEL MANAGER: finished swapping call (",r,"). Selecting contact: (",n,"/",i,")");var s=function(){_.delay(e.finishSwapping,0)};this.selectContact(n,i,null,r,s)&&s()},_onOnline:_.throttle(function(){this._wasOffline=!0,this.refetch(!0)},5e3,{trailing:!1}),refetch:function(e,t,i,r){var s=this,o=this._lastDate&&Date.now()-this._lastDate<6e4&&!e;if(!this.started||!d.online||o)return o&&n.log("refetch too soon"),void(r&&r());this.trigger("refetch");this._refetch(e,t).then(function(){return s._onRefetchSuccess(i,r)}).catch(function(){return s._onRefetchError(r)})},_refetch:function(e,t){this._refetchStartedDate=Date.now(),n.log("ModelManager refetch"),this.currDept=-1;var i=[];return t||i.push(this._refetchCurrentUser()),i.push(this._refetchActiveCalls()),t||i.push(this._refetchAffinities()),i.push(this._refetchUnreadFeed()),o.isChannelsEnabled()&&i.push(this._refetchChannelMemberships()),Promise.all(i)},_refetchCurrentUser:function(){return new Promise(function(e,t){o.fetch({success:e,error:t})})},_refetchActiveCalls:function(){var e=this;return new Promise(function(t,n){e._isFetchingCalls=!0,y.fetch({success:t,error:n,remove:!0})})},_refetchUnreadFeed:function(){return new Promise(function(e,t){R.fetch({success:e,error:t})})},_refetchChannelMemberships:function(){return new Promise(function(e,t){T.fetch({success:e,error:t})})},_refetchAffinities:function(){return new Promise(function(e,t){var n=new C.constructor;n.fetch().then(function(){C.add(n.toJSON(),{merge:!0}),e()}).catch(t)})},_onRefetch:function(e){e&&e(),this._isFetchingCalls=!1,this._lastDate=Date.now()},_onRefetchSuccess:function(e,t){n.log("MODEL MANAGER: refetch success: "+(Date.now()-this._refetchStartedDate)),e&&this._isOnCall(),this._wasOffline=!1,this._onRefetch(t)},_onRefetchError:function(e){n.log("MODEL MANAGER: refetch error: "+(Date.now()-this._refetchStartedDate)),this._onRefetch(e)},isRefetching:function(){var e=this._lastDate||0;return this._refetchStartedDate&&this._refetchStartedDate>e},isFetchingCallsAfterDisconnect:function(){return this._wasOffline&&this._isFetchingCalls},_isOnCall:function(){var e=y.getActiveCall();e&&n.isVisible("main")&&this.selectContact(e.get("contact"),e.get("target_key"))},_updateFeed:function(t){if(t&&t.feed_key){var i="target";e.isSingle&&(i="single");var s=d.getLocal("target:"+i)||o.get("key"),a=s==t.feed_target,c="feed"==d.getLocal("route:"+i),l=d.getLocal("contact:"+i)==t.contact_key,u=n.isFocused("target"),f=u&&l&&c&&a;f?t.feed_tags=_.without(t.feed_tags,"unread"):(c||console.log("Not marking unread because not on feed route: ",d.getLocal("route:"+i)),l||console.log("Not marking unread because not on contact: ",d.getLocal("contact:"+i)),a||console.log("Not marking unread because target not matched: ",s),u||console.log("Not marking unread because window is not focused.")),E.get(t.feed_key)||"TextMessage"!==t.feed_type||(t=new h(t),r.inCurrentConversation(t)&&t.adjustReceivedFeedDate()),E.add(t,{merge:!0});var p=E.get(t.feed_key||t.id);p.addLocalSource("feed");var g=p.get("contact");if("channel"==g.type){var m=T.findWhere({channel_key:g.id});m&&(m.set("count",(m.get("count")||0)+1),_.contains(p.get("feed_tags"),"mention_"+o.getShortKey())&&m.addMention(p))}var v=p.get("feed_tags")||[];if(_.contains(v,"unread")&&R.add(p,{merge:!0}),f&&g.unread)return g.unread=0,this.updateContacts(g),void this.markContactAsRead(p.get("contact_key"),p.get("feed_target"));this.updateContacts(g)}},_pluckContacts:function(e){var t=e.pluck("contact");C.addContacts(t,{merge:!0})},_getContactParams:function(e,t){var n=_.isObject(e)?e:null,i=_.isString(e)?e:null;if(i||n&&n.id){var r=null,s=null;if(n&&(n.attributes?(s=n.attributes,i=n.get("key"),r=n.get("target_key")):(s=n,i=n.key,r=n.target_key)),s||(s=(n=k.get(i))?n.attributes:{}),"channel"==s.type){_.extend(s,{affinity:0,can_sms:!0,date_description:"channel"});C.addContact(s,i),t=i}return r=t||r||o.get("key"),{affinity:C.getContactAffinity(i,r),contact:s,contactKey:i,targetKey:r}}console.log("You must have an id to select a contact")},selectContact:function(t,i,r,s,a,c,u){n.log("selecting contact: "+t+" with target "+i+" and call Id "+s),e.isDev&&console.trace();var h=this._getContactParams(t,i);if(h){var d=e.isSingle?"single":"target",f=h.targetKey,p=h.contactKey,g=h.affinity,m=h.contact;this._selectContactParamHash=p+"-"+f+"-"+(r||"noPath");var v=this._selectContactParamHash,y=_.bind(function(e){v===this._selectContactParamHash?(n.log("Reselecting contact "+e.id),this.updateContacts(e),"force"!==c&&(c=!1),this.selectContact(e,i,r,s,null,c,u),a&&a(e)):console.warn("Tried to select (",v,") but have navigated to (",this._selectContactParamHash,")")},this);if(!g||!g.has("affinity")||!("can_sms"in g.attributes)||g.isContactGroup()&&!g.get("contacts")){if(n.log("Missing full contact affinity for selectContact...fetching now:"+p,n.INFO),c||n.navigate(d,"loading",u),!g)g=new l({key:p,path:p+"/"+f});var b={target_key:f,on_nav:!c};return _.extend(b,m),void g.save(b,{patch:!1,success:y})}if(c||g.get("date_description")){!r&&e.isSalesforce&&(r="sfcall"),r||(r=this._getStickyPath(p,f));var S=f==o.id?o:A.get(f);if(S?console.log("Selecting contact "+g.get("display_name")+" for target: "+S.get("display_name")):console.log("Unknown Target: "+f),this.updateContacts(g),!c){this._saveStickyPath(r,p,f);var C=r+"/"+p+"/"+f;s&&(C+="/"+s);var w={};u&&(C+="?"+$.param(u),w.noFocus=u.noFocus),n.navigate(d,C,w),g.set("interact",!0)}return g}g.save({target_key:f,on_nav:!0},{patch:!1,success:y})}},getLastAffinity:function(){var e=d.getLocal("contact"),t=d.getLocal("target");if(e)if(t){var n=C.getContactAffinity(e,t);if(n)return n;console.log("no affinity for contact "+e+" / target "+t)}else console.log("no target for contact "+e);else console.log("no contact")},addNewContact:function(e,t){var n=new l,i=$.trim(t),r="phone"===e?[i]:i,s="phone"===e?{phones:r}:{display_name:r};return this.listenToOnce(n,"sync",function(e){this.selectContact(e,null,null,null,null,null,{editContact:1})}),n.save(s)},deleteContact:function(e,t,i){n.log("deleting contact: "+e);var r=this._getContactParams(e,t);r&&r.affinity&&r.affinity.destroy({wait:!0,success:function(){Backbone.trigger("navigate","contacts")},error:function(){i&&i()}})},_getStickyPath:function(e,t){var n=this.stickyPrefix+e+"_"+t,i=d.getLocal(n);return i||(i="feed"),i},_saveStickyPath:function(e,t,n){var i=this.stickyPrefix+t+"_"+n;d.setLocal(i,e)},markContactAsRead:function(e,t){if(e){var n=C.getContactAffinity(e,t);if(n){if(!n.isChannel()){this.listenToOnce(n,"sync",this._onMarkedRead);var i={mark_unread:1};t&&(i.target_key=t),n.save(i,{patch:!0})}}else console.log("no affinity to mark as read!")}},_onMarkedRead:function(e){R.markAsRead(e.get("key"),e.get("target_key")),E.markAsRead(e.get("key"),e.get("target_key")),this.updateContacts(e)},_onAffinity:function(e){if(e&&e.affinity){var t=e.affinity;this.updateContacts(t),0==t.unread&&(R.markAsRead(t.key,t.target_key),E.markAsRead(t.key,t.target_key))}},markAllAsRead:function(t){$.ajax({type:"POST",url:e.domain+"/ajax/markallasread",contentType:"application/json",data:JSON.stringify({target_key:t}),complete:function(){console.log("mark all as read completed")}});var n=R.getCollection(t).pluck("contact");_.each(n,_.bind(function(e){e.unread=0,R.markAsRead(e.key,e.target_key),E.markAsRead(e.key,e.target_key),this.updateContacts(e)},this)),R.triggerCount()},updateContacts:function(e){e&&e.id&&C.addContacts(e,{merge:!0})},fetchContact:function(e,t){var n=new u({id:e});k.add(n,{merge:!0}),n.fetch({success:function(e){t&&t(e)},error:function(){t&&t()}})},_onUserMismatch:function(e){console.error("Mismatched user: got push message for user "+e.user_id),Backbone.trigger("jslog:send",{type:d.type,sub_type:"mismatched_user"})},_onTextMessage:function(t){if(t&&t.text_message){var i=t.text_message;t.text_message.client_id!==d.getClientId()&&this._updateFeed(i);var r=t.text_message.contact;if(r){this.updateContacts(r);var s=t.text_message.sender;if(s&&this.updateContacts(s),n.isVisible("target")){var a=C.getContactAffinity(r.key,r.target_key);S.addContact(a,r.target_key)}}var c="external"==i.orientation&&o.get("key")==i.feed_target,l=r&&"channel"==r.type&&i.sender_key!=o.get("key"),h=e.isNative&&(p.isMacOSX()||p.isWindows10()),f=e.isHarness||h;if((c||l)&&!n.isAppFocused("notification")){if(this._muteAll(t))return;if(this._muteSound()?console.log("Sound disabled"):Backbone.trigger("playSound","new_message"),this._muteNotification())return void console.log("Notifications disabled");var g="message/"+i.feed_key;if(globals.notifications)globals.background.createNativeTextMessageNotification(i);else if(f){var m="feed/"+i.contact_key+"/"+i.feed_target,v=i.text;i.mms_url&&(v=this.translate("Image / video received"));var y=i.contact.display_name;if("contact_group"==i.contact.type){var b,w=C.getContact(i.contact_key,i.target_key).get("contacts");w?(b=_.findWhere(w,{id:i.sender_key}))&&(b=new u(b)):b=C.getContactAffinity(i.sender_key,i.target_key),b&&(v=b.getShortName()+": "+v)}else l&&(y+=" ("+i.sender.display_name+")");this._createHTML5Notification(y,v,m,i.contact.image_url)}else{if(e.isSalesforce||e.isIframe)return;n.navigate("notification",g)}}}},_onFaxMessage:function(e){if(e&&e.fax_message){var t=e.fax_message;this._updateFeed(t);var i=e.fax_message.contact;if(i){this.updateContacts(i);var r=e.fax_message.sender;if(r&&this.updateContacts(r),n.isVisible("target")){var s=C.getContactAffinity(i.key,i.target_key);S.addContact(s,i.target_key)}}}},_onCall:function(e){n.log("onCall: "),n.log(JSON.stringify(e));var t=e.call;t.id||(t.id=e.call_uuid);var i=y.get(t.id);if(i&&!i.isNewer(t))return console.log("Stale data for call: "),void console.log(t);if(this._updateFeed(t),t.contact?(t.contact.interact=!0,C.addContacts(t.contact,{merge:!0})):console.log("No contact for call"),this._maybeShowDirectTransferNotification(e),!i&&"hangup"==t.state)return console.log("Call already removed: "),console.log(t),void this.trigger("hungUpCallUpdate",t);var r=w.get(t.id);if(r&&r.wasHungUp())return console.log("Call already exists in call history as hungup. Not adding to active calls."),void console.log(t);r&&console.log("Call already exists in call history with state: "+r.get("state")),t.now&&d.setTimeDiff(t.now),y.add(t,{merge:!0})},_shouldShowDirectTransferNotification:function(e,t){if(!["hold","voicemail"].includes(t))return!1;if(n.isAppFocused("notification"))return!1;var i=e.attributes||e;return i.target_key===o.get("key")&&("hold"===t?a.STATES.HOLD==e.state:i.recording_id&&[a.STATES.HANGUP,a.STATES.VOICEMAIL].includes(e.state))},_maybeShowDirectTransferNotification:function(t){var i=t.call,r=i.state===a.STATES.HOLD?"hold":"voicemail",s=this._muteNotification(t);if(!s&&this._shouldShowDirectTransferNotification(i,r)){var o=e.isNative&&(p.isMacOSX()||p.isWindows10()),c=e.isHarness||o,l=t.title;if(l||"voicemail"!==r||(l=this.translate("Voicemail from [displayName]",{displayName:i.contact.display_name})),globals.notifications)globals.background.createNativeCallNotification(i,r,l);else if(c){var u="feed/"+i.contact_key+"/"+i.feed_target;this._createHTML5Notification(i.contact.display_name,l,u,i.contact.image_url)}else if(!e.isSalesforce&&"voicemail"===r){var h="voicemail/"+i.id;n.navigate("notification",h)}}else s&&console.log("Skipping direct transfer notification because notifications are disabled")},_onVideoRequest:function(e){console.log("VIDEO: (Push Message)",e.state);var t,n=b.get(e.id);!n||n.isNewer(e)||_.contains(["declined","ended","cancelled"],e.state)?"declined"==e.state?(b.add(e,{merge:!0}),(t=b.findWhere({contact_key:e.contact_key})).isStarted()?_.delay(_.partial(b.remove,e),4e3):b.remove(e)):"ended"==e.state||"cancelled"==e.state?(b.add(e,{merge:!0}),b.remove(e)):"accepted"==e.state?b.get(e.id)&&"ringing"==b.get(e.id).get("state")&&b.remove(e):(t=new c(e),this.listenToOnce(t,"sync",this._onVideoFetch),t.fetch()):console.log("VIDEO: (Repeat Push Message)")},_onVideoFetch:function(e){b.add(e,{merge:!0})},_onVideoSignal:function(e){b.onMessage(e)},_onRecording:function(e){if(e&&e.recording){var t=e.recording;"VoiceRecording"!==t.feed_type&&(this._updateFeed(t),t.call_id&&this.trigger("recording:"+t.call_id,t))}},_onCurrentUserChange:function(e){I.add(e,{merge:!0}),this.updateContacts(e.attributes)},_onUserChange:function(e){I.add(e.user,{merge:!0}),this.updateContacts(e.user)},_onProbe:function(){var e=d.getChannelId();e&&o.save({add_channel:e})},_onQuit:function(){n.quit()},_onRelaunch:function(){n.restart()},_onTyping:function(e){g.trigger("typing",e)},_onLinkedIn:function(e){M.add(e.linkedin)},_fetchCall:function(e){var t="object"===(void 0===e?"undefined":_typeof(e))?e:{id:e},n=y.get(t.id);n&&n.isNewer(t)&&n.set(t),new a({id:t.id}).fetch({success:this._onCallFetch})},_onCallFetch:function(e){var t={call:e.attributes};this._onCall(t)},_fetchText:function(e){var t=new h({feed_key:e});this.listenToOnce(t,"sync",this._onTextFetch),t.fetch()},_onTextFetch:function(e){var t={text_message:e.attributes};this._onTextMessage(t)},_fetchFax:function(e){var t=new h({feed_key:e});this.listenToOnce(t,"sync",this._onFaxFetch),t.fetch()},_onFaxFetch:function(e){var t={fax_message:e.attributes};this._onFaxMessage(t)},_fetchRecording:function(e){var t=new h({feed_key:e});this.listenToOnce(t,"sync",this._onRecordingFetch),t.fetch()},_onRecordingFetch:function(e){var t={recording:e.attributes};this._onRecording(t)},_onGCM:function(e){this.useChannels()&&e&&(n.log("GCM: "+e),clearTimeout(this.reconnectTimeoutId),_.contains(this.recentNotifications,e)||(this.recentNotifications.push(e),this.recentNotifications.length>10&&this.recentNotifications.shift(),this.reconnectTimeoutId=setTimeout(this.reconnectChannels,this.CHANNEL_LATENCY)))},_onChannel:function(e){if(this.useChannels()){var t;if(clearTimeout(this.reconnectTimeoutId),e.text_message)t=e.text_message.id;else{if(!e.call)return;t=e.call.id}t&&(n.log("CHANNEL: "+t),this.recentNotifications.push(t),this.recentNotifications=_.uniq(this.recentNotifications),this.recentNotifications.length>10&&this.recentNotifications.shift())}},_onSearch:function(e){if(e.query){var t="search/"+e.query;n.navigate("main",t)}},_onNewCall:function(e){if(e.query){var t="newcall/"+e.query;n.navigate("main",t)}},_onExecuteCall:function(e){if(e.query){var t="autocall/"+e.query;n.navigate("main",t)}},_onFeed:function(e){var t=e.feed_key;"deleted"==e.action&&(E.remove(t),R.remove(t))},_onContact:function(e){var t=e.key,n=k.get(t);"deleted"==e.state?(k.remove(n),k._onDestroy(n),_.each(C.where({key:t}),function(e){C.remove(e),C._onDestroy(e)})):(e.not_editable&&n.set({editable:!1}),this.fetchContact(t,function(e){k.add(e,{merge:!0})}))},_onCallLogged:function(e){console.log("Got logged call for",e.service," with id",e.external_id),Backbone.trigger("call_logged:"+e.service,e.external_id,e.contact_key)},_onVoiceAiSummary:function(e){var t=e.call_uuid,n=e.feed_key;console.log("Got VoiceAi summary for call",t,"( feed key:",n,")");var i=[E.getOrFetch(e.feed_key),P.getSummaryForCall(t)];Promise.all(i).then(this._onVoiceAiSummaryFetched).catch(this._onVoiceAiSummaryError.bind(this,t,n))},_onVoiceAiSummaryFetched:function(t){if(n.isVisible("notification"))console.warn("Not showing VoiceAi Summary notification for call (",t[0].get("id"),") bc notification window already showing.");else{var i=t[0];if(n.isShowingOverlay("voice_ai_summary")){var r=n.overlayVisibility.voice_ai_summary,s=r.feedKey===i.id;s&&r.view.options.isShowingTranscriptionOnly?(console.log("Replacing the transcription-only voiceai summary with the full summary for call (",t[0].get("id"),")."),Backbone.trigger("overlay","voice_ai_summary",{feedKey:i.id})):s&&console.log("Not showing VoiceAi Summary notification for call (",t[0].get("id"),") bc the overlay is already showing")}else{var o=function(){if(!e.isSalesforce){var t="voiceaisummary/"+i.get("feed_key");n.navigate("notification",t)}};A.get(i.get("target_key"))?A.getExtended(i.get("target_key")).then(o).catch(function(){console.warn("Not showing VoiceAi Summary notification for call (",t[0].get("id"),") bc there was an error fetching the extended json for target (",t[0].get("target_key"),")")}):o()}}},_onVoiceAiSummaryError:function(e,t){console.error("Error fetching the VoiceAi summary for call:",e,"feed_key:",t,"(",arguments,")")},_onSendLogs:function(t){e.isNative?i.sendErrorReport():Backbone.trigger("jslog:send",{type:d.type,sub_type:"error_report"})},reconnectChannels:function(){this.useChannels()&&(n.log("Reconnecting Channels"),g.destroyChannel(),setTimeout(function(){g.createChannel()},this.CHANNEL_LATENCY))},_getFrequentContacts:function(){(new k.constructor).fetch({data:{filter:"frequent",limit:10},remove:!1,success:function(e){k.add(e.models,{merge:!0})}})},_muteNotification:function(){return!d.getLocal("notifications_on")},_muteSound:function(){return!d.getLocal("sounds_on")},_muteAll:function(e){if(o.isDND())return console.log("Notification and sound disabled due to DND"),!0;if(e.mute)return console.log("Notification and sound disabled due to muted message"),!0;var t=e[e.type],n=t&&t.contact_key,i=T.getByChannel(n);return!(!i||i.isNotifyOn())},_createHTML5Notification:function(e,t,i,r){console.log("Creating HTML5 notification.");var s=new Notification(e,{body:t,silent:!0,icon:r});s.onclick=function(e){n.navigate("single",i),n.focusWindow(),s.close()}},_listenIpcModelManager:function(){var e=_electron.ipcRenderer;e.on("model_manager",_.bind(function(e,t){if("selectContact"==t){var n=Array.prototype.slice.call(arguments,2);this.selectContact.apply(this,n)}},this)),e.on("archive_affinity",_.bind(function(e,t){var n=t.split("/contact/")[1].split("?")[0];C.getContactAffinity(n,o.id).archive()},this)),e.on("toggle_favorite",function(e,t){var n=t.split("/contact/")[1].split("?")[0];C.getContactAffinity(n,o.id).toggleFavorite()}.bind(this))}});return m.create(O,"modelManager")}),define("objects/remote",["require","fslib/fsutil"],function(require){var e=require("fslib/fsutil");return{BASE_URL:"dialpad://action/?",_callProtocol:function(t){var n=this.BASE_URL+$.param(t);console.log("Launching URL",n),e.isEdge()?navigator.msLaunchUri(n):document.getElementById("sf-navigation").src=n},call:function(e,t,n){var i={action:"call",phone_number:e};t&&(i.target_key=t),n&&(i.contact_key=n),this._callProtocol(i)},answer:function(e){this._callProtocol({action:"answer",call_id:e.id})},switchToThisDevice:function(e){this._callProtocol({action:"switch",call_id:e})},eavesdrop:function(e){this._callProtocol({action:"eavesdrop",call_id:e.id})},cancelEavesdrop:function(e){this._callProtocol({action:"cancelEavesdrop",call_id:e.id})},hangUp:function(e){e?this._callProtocol({action:"hangup",call_id:e.id}):this._callProtocol({action:"hangup"})},mute:function(){this._callProtocol({action:"mute"})},unmute:function(){this._callProtocol({action:"unmute"})},hold:function(e){this._callProtocol({action:"hold",call_id:e.id})},start:function(){this._callProtocol({action:"start"})}}}),define("objects/call_manager",["config","collections/active_calls","collections/affinity_list","collections/call_history","collections/contact_list","objects/window_manager","objects/webrtc_monitor","objects/talkiq_manager","fslib/fsutil","fslib/object","fslib/singleton","fslib/webrtc","models/affinity","models/call","models/current_user","models/phone","models/session","objects/ipc_manager","objects/model_manager","objects/remote"],function(e,t,n,i,r,s,o,a,c,l,u,h,d,f,p,g,m,v,y,b){var S=l.extend({MIN_RETRY_TIME:2500,MAX_RETRY_TIME:3e4,start:function(){this.started||(this.started=!0,this._lastContactCalled=null,this._lastCall=null,this._outboundContact=null,this._outboundTarget=null,this._delayMultiplier=1,this.listenTo(t,"add",this._onCallState),this.listenTo(t,"remove",this._onCallState),this.listenTo(t,"change",this._onCallState),this.listenTo(t,"change:local:connecting",this._onCallState),this.listenTo(h,"callRinging",this._onWebRTCRing),e.isRemote||(this.listenTo(h,"onCallState",this._onWebRTCCallState),this.listenTo(h,"callError",this._onWebRTCError),this.listenTo(h,"callEnded",this._onWebRTCEnd)),this.listenTo(h,"disconnected",this._onWebRTCFail),this.listenTo(h,"unregistered",this._onWebRTCFail),this.listenTo(h,"registrationFailed",this._onWebRTCFail),this.listenTo(h,"jssipLoadError",this._jsSipLoadError),this.listenTo(h,"preload:timeout",this._onWebRTCPreloadTimeout),this.listenTo(h,"registered",this._onWebRTCRegistered),this.listenTo(y,"hungUpCallUpdate",this._onHungUpCallUpdate),m.isLoggedIn()?this._startWebrtc():this.listenToOnce(m,"login",this._startWebrtc),e.isNative&&this._listenIpcCallManager(),this._onCallState(t.first()))},stop:function(){this.stopListening(),h.stop(),this.started=!1},reset:function(e){this.stop(),this.start(),this.listenToOnce(h,"unregistered",_.bind(function(){this._preanswerState=null,e&&e()},this))},hasActiveCalls:function(){return t.hasInternalLeg()},_startWebrtc:function(){var e=m.getWebrtcSipConfig();console.log("CALL MANAGER: Starting webrtc with options:",JSON.stringify(e)),h.start(e),h.register||(console.log("CALL MANAGER: started webrtc and setting preanswer state to ready"),this._preanswerState="ready",this._registerAfterPcCloses())},_registerAfterPcCloses:function(){this._listeningToPcClose||(console.log("CALL MANAGER: Setting a listener to register once the peer connection closes"),this._listeningToPcClose=!0,this.listenToOnce(h,"peerconnection:closed",_.bind(function(){this._listeningToPcClose=!1,this._registerOnHangup()},this)))},callInToCall:function(t){e.isRemote?b.switchToThisDevice(t):this._callIn(null,t)},_callIn:function(e,t,n,i){if("ready"==h.getCallState()){var r=[];e&&(r.push("X-UV-STATE: "+e),"preanswer"===e&&r.push("X-UV-DTMF-PREANSWER: 1")),t&&r.push("X-UV-CALL: "+t),n&&r.push("X-UV-CONTACT: "+n),i&&r.push("X-UV-TARGET: "+i),h.call(h.getIdentity(),r)}else console.log("ERROR: WebRTC unavailable.")},_callOut:function(t,n,i,r,s){if(e.isRemote)b.call(t,n,i);else if("ready"==h.getCallState()){var o=[];n&&o.push("X-UV-TARGET: "+n),i&&o.push("X-UV-CONTACT: "+i),(r||s)&&this._updateExtraHeadersWithCallerId(o,r,s),h.call(t,o)}else console.log("ERROR: WebRTC unavailable.")},_userIsCallingSelf:function(e,t){return e===p.get("key")},_updateExtraHeadersWithCallerId:function(e,t,n){if(n)e.push("X-UV-PRIVACY:"+n);else switch(t){case"office":break;case"masking":e.push("Privacy: id")}},_startPreAnswer:function(e){"ready"==h.getCallState()&&e.isCallStateRinging()?(console.log("CALL MANAGER: Cold starting this call:",e.id),this._preanswerState="calling",this._callIn("preanswer",e.get("id"))):(console.log("CALL MANAGER: Trying to cold start a call when webrtc state is (",h.getCallState(),") and call (",e.id,") state is (",e.get("state"),"). Canceling preanswer."),this._preanswerCall=null,this._preanswerState=null,h.isPcClosed()||h.register?h.isPcClosed()&&!h.register&&this._registerOnHangup():this._registerAfterPcCloses())},answer:function(n){var i=h.getCallState();if(console.log("CALL MANAGER: Answering  a call when webrtc state is (",i,") and call (",n.id,") state is (",n.get("state"),")."),!n.isConnected()||n.isEavesdropping()){if(e.isRemote)return console.log("CALL MANGER: client is remote"),void b.answer(n);if("ringing"==i||"preloading"==i)h.answer(),n.setConnecting();else if("connected"==i)n.isPreanswerCall()?n.preanswer():n.connect();else if(t.hasInternalLeg())n.connect(function(e,t){console.log(t.status),412==t.status&&this._callIn("answer",e.get("id"))}.bind(this));else if("waiting"==i);else if(n.isVoicemail()){var s=r.get(n.get("contact")),o={e164:s.getCallableNumber(),display:s.getDisplayPhone()};this.callContact(s,n.get("target_key"),null,o)}else this._callIn("answer",n.get("id"))}else console.log("CALL MANAGER: Call (",n.id,") has already been answered (state:",n.get("state"),"). Not answering again.")},decline:function(e,t){this.stopRingTone();var n=h.getCallState();e.setRejected(),"ringing"==n||h.isPreloading()?h.reject():e.isSecondary()||e.sendToVoicemail(t)},callContact:function(i,r,o,a,c,l){var u=_.isObject(i)?i:null,d=_.isString(i)?i:null;d=d||u.get("key");var f=r||p.get("key");if(m.online){if(this._userIsCallingSelf(d,f))return console.error("CALL MANAGER: User tried to call themselves."),void Backbone.trigger("call:yourself");var g=_.bind(function(e){s.log("Recalling contact after creating contact from "+e.id),y.updateContacts(e),this.callContact(e.get("key"),e.get("target_key"),o,a,c,l)},this);if(!n.cloningWithNewTarget(u,d,f,g)){var v=t.callForContact(d,f);if(!(v&&!v.isVoicemail()||this.isCallingContact(d,f)))if(v&&this._sendCallToHistory(v),this.canDialOut())if(h.verifyConnection()){var b=_.bind(function(e){s.log("Recalling contact "+e.id),this.callContact(e.get("key"),f,o,a,c,l)},this);if(u=y.selectContact(d,f,null,null,b,null,l)){var S=a&&a.e164||u.get("primary_phone");if(!S)return console.log("cannot call contact "+d+" from "+f),void Backbone.trigger("alert",{title:this.translate("No Phone Number"),message:d});var C={contact_key:d,state:t.getCallingState()};r&&(r!=p.get("key")&&(C.is_secondary=1),C.target_key=r),this._outboundContact=this._lastContactCalled=d,this._outboundTarget=f;var w=this._getCallCreateOptions(o,c);C.target_key=C.target_key||f,C.contact_key=C.contact_key||d,"connected"==h.getCallState()?(this._updateCallDataWithCallerId(C,c),t.create(C,w)):t.hasInternalLeg()?(w.error=_.bind(function(e,t){console.log(t.status),412==t.status&&this._callOut(S,f,d,c)},this),t.create(C,w)):(this._callOut(S,f,d,c),p.inExperiment("fast_dial")&&(C.fast_call=1)),t.generateDummy(C,w),console.info("call_manager.callContact to="+S),e.isSingle||e.isIframe||Backbone.trigger("navigate","",{windowId:"main"});var T=n.getContactAffinity(d,f);return T&&(T.setInteractionTime(),a&&(T.userSelectedPhone=a)),!0}console.warn("no contact yall!")}else console.log("webrtc is not connected...can't call contact");else this.cannotDialOutAlert()}}else Backbone.trigger("call:offline")},switchToClient:function(){t.hasInternalLeg()&&"ready"==h.callState&&this._callIn()},callUberConference:function(e,i,r){if(m.online){if(!this.canDialOut())return y.selectContact(r),void this.cannotDialOutAlert();var s=p.get("key"),o={state:t.getCallingState(),external_endpoint:e,contact_key:r,target_key:s},a={wait:!0,uc_pin:i},c=["X-UV-CONTACT: "+r];i&&c.push("X-UC-PIN: "+i),"connected"==h.getCallState()?t.create(o,a):t.hasInternalLeg()?(a.error=_.bind(function(t,n){console.log(n.status),412==n.status&&h.call(e,c)},this),t.create(o,a)):h.call(e,c),t.generateDummy(o,a),this._outboundContact=this._lastContactCalled=r,this._outboundTarget=s;var l=n.getContactAffinity(r,s);l&&l.setInteractionTime(),y.selectContact(r,s)}else Backbone.trigger("call:offline")},unparkCall:function(e){if(this._unparkingCall||!this.canDialOut())return this._unparkingCall&&console.warn("CALL MANAGER: Can not unpark (",e.id,") - already unparking (",e.id,")"),void(!this.canDialOut()&&this.cannotDialOutAlert());this._unparkingCall=e,e.unpark().then(this._onUnparkSuccess).catch(this._onUnparkError)},_onUnparkSuccess:function(e){var t=e.get("contact");y.updateContacts(t),this.callPhoneNumber(e.getPhoneNumber(),t.id),this._unparkingCall=null},_onUnparkError:function(e){var t=e.model,n=e.xhr,i=n?n.status:"";switch(console.warn("CALL MANAGER: Call (",t.id,") failed to be unparked -- got status code: ",i),i){case 404:break;case 409:console.warn("CALL MANAGER: Tried to unpark a call (",t.id,") that is already in the active calls list (",t.get("external_endpoint"),")")}this._unparkingCall=null},callPhoneNumber:function(e,i,r,s,o,a,c){var l=r||p.get("key");if(m.online){if(this._userIsCallingSelf(i,l))return console.error("CALL MANAGER: User tried to call themselves."),void Backbone.trigger("call:yourself");var u=t.callForContact(i,l),d=this._getCallCreateOptions(s);if(u&&!u.isVoicemail()||this.isCallingContact(i,l))y.selectContact(i,l,null,null,null,null,a);else{if(u&&this._sendCallToHistory(u),!this.canDialOut())return y.selectContact(i,l,null,null,null,null,a),void this.cannotDialOutAlert();var f={state:t.getCallingState(),external_endpoint:e};r&&(r!=p.get("key")&&(f.is_secondary=1),f.target_key=r),(f=_.extend(f,c||{})).target_key=f.target_key||l,f.contact_key=f.contact_key||i,"connected"==h.getCallState()?t.create(f,d):t.hasInternalLeg()?(d.error=_.bind(function(t,n){console.log(n.status),412==n.status&&this._callOut(e,l,null,null,o)},this),t.create(f,d)):this._callOut(e,l,null,null,o),t.generateDummy(f,d),this._outboundContact=this._lastContactCalled=i,this._outboundTarget=l;var g=n.getContactAffinity(i,l);g&&g.setInteractionTime(),y.selectContact(i,l,null,null,null,null,a)}}else Backbone.trigger("call:offline")},callPhone:function(e,t,n,i,r){var s=this;if(!this.phone)return this.phone=new g({phone_number:e,target_key:t,caller_id_change:i}),this.phone.save().then(function(){return s._onPhone(e,t,n,r)},this.onPhoneError);console.log("Already trying to call: "+this.phone.id)},_onPhone:function(e,t,n,i){var r=this.phone.get("contact"),s=this.phone.get("id"),o=this.phone.get("privacy_override")||null;this.phone=null,console.log("Calling contact:"),console.log(r),y.updateContacts(r),"shortcode"!=r.type?this.callPhoneNumber(s,r.key,t,null,o,n,_.extend({contact:r},i)):Backbone.trigger("alert",{title:this.translate("This contact cannot be called.")})},onPhoneError:function(e){this.phone=null;var t="",n=JSON.parse(e.responseText);n.errors&&n.errors[0]&&(t=n.errors[0]);var i=this.translate("Cannot complete this call"),r=this.translate("We seem to have a problem connecting your call. If you continue to have issues, please reach out to us at [support_url].",{support_url:p.getSupportUrl()});switch(t){case"INVALID_NUMBER":r=this.translate("The number that you are trying to dial is not valid. Please check the number and try again.");break;case"missing_number":r=this.translate("The contact you are trying to reach has no phone number. Please add a number and try again.");break;case"limit_to_domestic":r=this.translate("Your account does not have international dialing enabled. Please contact your admin for assistance.")}Backbone.trigger("alert",{title:i,message:r})},_eavesdropCallIn:function(e){var n=t.get(e);n.isVoicemail()&&("ready"==h.getCallState()?this._callIn("eavesdrop",n.get("id")):_.delay(this._eavesdropCallIn,500,e))},eavesdrop:function(n){if(e.isRemote)b.eavesdrop(n);else{var i=h.getCallState();"ringing"==i||h.isPreloading()?h.answer(["X-Ignore-Precache-XML: True"]):"connected"==i?n.eavesdrop():t.hasInternalLeg()?n.eavesdrop(function(e,t){console.log(t.status),412==t.status&&this.decline(n,_.bind(this._eavesdropCallIn,this,n.get("id")))}.bind(this)):this.decline(n,_.bind(this._eavesdropCallIn,this,n.get("id")))}},cancelEavesdrop:function(e){e.sendToVoicemail()},hold:function(e,t){e.hold(t)},record:function(e,t){e.record(t)},bridge:function(e){e.bridge()},merge:function(e){e.merge()},mute:function(e){p.mute()},unmute:function(e){p.unMute()},hangUp:function(n,i){var r=this._outboundContact,s=this._outboundTarget;t.canMerge()?n.hangUp(null,null,i):(n&&(n.hangUp(null,!0,i),this._onCallState(n)),h.hangUp(),this.stopRingTone()),this._clearOutboundCallData(n),this.trigger("hangup:contact:"+r+":target:"+s),e.isRemote&&b.hangUp(n)},hangUpAllCalls:function(){t.each(_.bind(function(e){this.hangUp(e,"call manager (hang up all calls)")},this))},isCallingContact:function(e,n){var i=n||p.get("key");if(e!=this._outboundContact||i!=this._outboundTarget)return!1;var r=t.callForContact(e,i),s=h.getCallState(),o=r&&!r.isCalling();return!(!r||o||!_.contains(["calling","connected"],s))},canDialOut:function(){return h.canCallOut()&&!t.inProgress()},cannotDialOutAlert:function(){h.forcePreloadingCallToRing()||(console.error("CALL MANAGER: cannot dial out alert shown."),console.error("CALL MANAGER: Webrtc State:",h.getCallState()),console.error("CALL MANAGER: Loading JsSIP:",h.isLoading()),console.error("CALL MANAGER: Active Calls is connecting:",t.isConnecting()),console.error("Active Calls has ringing call:",t.getRingingCall()?t.getRingingCall().id:"false"),Backbone.trigger("alert",{title:this.translate("Cannot Initiate Outgoing Call"),message:this.translate("You currently have an outgoing call in progress. Please wait until this call has been connected before initiating another outgoing call.")}))},_jsSipLoadError:function(){window.started?(console.log("Showing Restart Dialog because of jssip error"),Backbone.trigger("alert",{title:this.translate("Oops"),message:this.translate("We detected a problem loading the application. Please restart the application and try again."),relaunch:!0}),Backbone.trigger("jslog:send",{type:"webrtc",sub_type:"jssip_load_fail"})):setTimeout(this._jsSipLoadError,500)},isConnected:function(e){return e.isFullyConnected()},getLastContactCalled:function(){return this._lastContactCalled},getLastCall:function(){return"dummy"!==this._lastCall?this._lastCall:""},_clearOutboundCallData:function(e){var t=null,n=null,i=null;e&&(t=e.get("contact_key")==this._outboundContact,i=e.get("target_key")==this._outboundTarget,n=e&&e.isCalling()),(!e||t&&i&&!n)&&(this._outboundContact=null,this._outboundTarget=null)},_onWebRTCRing:function(e,n,i){var r=this;s.log("WebRTC Ring: "+e);var o=i||0,a=t.get(e);if(a||!o)a&&a.isRinging()?this._showNotification(e):console.warn("CALL MANAGER: Aborting showing notification for webrtc ring for call (",e,") bc call is not in active calls or call is no longer ringing.");else{console.warn("CALL MANAGER: Trying to show notification before getting a push message for the call. Fetching Active Calls ( retries =",o,")");var c=function(){return r._onWebRTCRing(e,n,o-1)};t.fetch({success:c,error:c})}},_onWebRTCEnd:function(){this._hideNotification(),this._isConnected=!1,!this._hasIncomingCall()&&this.stopRingTone(),this._clearOutboundCallData(),this._activeWebRtcCall?this._recordWebRtcStats(this._activeWebRtcCall):o.clearStatsForServer(),this._activeWebRtcCall=null,console.log("webrtc session end");var e=t.hasDummyCall();e&&e.hangUp(),clearTimeout(this._refetchTo),this._refetchTo=_.delay(function(){"ready"===h.getCallState()&&y.refetch(!0)},5e3)},_onWebRTCCallState:function(e){switch(console.log("WebRTC Call State: "+e),e){case"ready":this._preanswerCall&&"ready"==this._preanswerState?this._startPreAnswer(this._preanswerCall):this._preanswerState&&(this._preanswerState=null,this._preanswerCall=null),this._clearOutboundCallData();break;case"connected":this._preanswerCall&&(console.log("CALL MANAGER: webrtc is now connected. Showing notification window for preanswer call (",this._preanswerCall.get("id"),")"),this._showNotification(this._preanswerCall),this._preanswerState=null,this._preanswerCall=null);break;case"preloading":case"waiting":break;default:this.stopRingTone()}"ready"!==e&&(clearTimeout(this._showRingingTo),this._showRingingTo=null)},_shouldPreanswer:function(){return h.isRegistered()&&"calling"!==this._preanswerState&&("ready"===this._preanswerState&&Backbone.trigger("jslog:send",{type:"webrtc",sub_type:"unexpected_preanswer"}),this._preanswerState=null,this._preanswerCall=null),"ready"===this._preanswerState},_onCallState:function(e,n){if(h.isReady())if(e&&e.id){this._lastCall=e.id;var i=e.get("state");if(!i)return console.log("Got a call without a state: "),void console.log(e.attributes);var r=h.getCallState();if(console.info("Call State: "+i+" WebrtcCallState: "+r),this._shouldPreanswer())console.log("PreAnswerState is ready"),this._preanswerCall=e,e.setPreanswer(),"ready"==r&&this._startPreAnswer(this._preanswerCall);else if("connected"==r)switch(i){case"ringing":e.isRinging()&&this._showNotification(e);break;case"connected":this.stopRingTone(),this._isConnected=!0,this._activeWebRtcCall||(this._activeWebRtcCall=e),h.onCallConnected(e);break;case"eavesdrop":this.stopRingTone();break;case"hangup":this._clearOutboundCallData(e);break;default:this.stopRingTone()}else"ready"===r&&e.isCallStateRinging()&&p.isFastAnswer()&&(console.log("CALL MANAGER: received ringing call but do not have a session yet (webrtc registered: ",!!h.isRegistered(),") -- maybe did not receive sip message yet."),h.isRegistered()?this._showRingingTo||(this._showRingingTo=_.delay(_.bind(function(){this._showRingingTo=null;var n=t.get(e.id);"ready"===h.getCallState()&&n&&n.isCallStateRinging()&&!n.isVoicemail()&&(this._refreshOnHangup=!0,console.log("CALL MANAGER: still no webrtc session for the ringing call (",n.id,")."),this._onCallState(n))},this),1e3)):(console.log("CALL MANAGER: Preanswering the call (",e.id,")"),this._preanswerCall=e,this._startPreAnswer(e)));if("hangup"==i){if(t.maybeSwapCall(e),e.isSwapping()||e.isTakingOver())return;this._sendCallToHistory(e),this.stopRingTone(),this._preanswerCall&&e.get("id")==this._preanswerCall.get("id")&&(this._preanswerCall=null,this._preanswerState="complete",this.stopRingTone(),h.hangUp()),e.isRateable()&&(console.log("Rating Call for : ",e.get("contact_key")),this.trigger("ratecall:"+e.get("contact_key"),e)),this._hasIncomingCall()?this.startRingTone():this.trigger("nps:survey"),this._refreshOnHangup&&h.isStateReady()&&(this._refreshOnHangup=!1,Backbone.trigger("app:refresh"))}e.isCallStateRinging()||"preanswer"==i||"eavesdrop"==i||this._hideNotification(e),!e.isTranscribingVoicemail()||e.isSecondary()||this._isShowingNotification()||p.isDND()||this._showNotification(e),"ready"===r&&!t.hasIncomingCall()&&this.stopRingTone()}else console.log("No valid call");else this.listenToOnce(h,"ready",_.bind(function(){this._onCallState(e,n)},this))},_sendCallToHistory:function(e){console.log("CALL MANAGER: Sending call (",e&&e.id,") to call history."),t.remove(e),i.add(e,{merge:!0}),this._isShowingNotification(e)&&(console.log("CALL MANAGER: hiding notification window"),s.hide(this._getNotificationWindowName()))},_isShowingNotification:function(e){return e?s.isShowingWindow(this._getNotificationWindowName(),"incoming/"+e.id):s.isShowingWindow(this._getNotificationWindowName())},_getNotificationWindowName:function(){return e.isSalesforce?"salesforce":"notification"},_onWebRTCError:function(e){var i;if(this._preanswerState&&(this._preanswerCall=null,this._preanswerState=null),t.each(function(t){this._isConnected&&t.isConnectedToContact()&&console.log("WEBRTC ERROR: CONNECTED CALL: "+t.id),t.isFastCall()&&(console.warn("Scheduling fast_call hangup"),t.xhr&&t.xhr.then(function(){console.warn("Hanging up fast_call due to error: "+e.cause),t.save({state:"hangup"},{patch:!0})}));var i=t.get("contact_key"),r=t.get("target_key");if(i&&r){var s=n.getContactAffinity(i,r);s&&s.hasRingingCall()&&(console.log("Removing ringing status from "+s.get("path")),s.adjustLocalState("callRinging",!1))}}),this._isConnected=!1,this.stopRingTone(),console.log("webrtc session error"),e&&"Rejected"==e.cause&&"local"!=e.originator)return Backbone.trigger("alert",{title:this.translate("Unable to make call"),webrtcError:!0,support:!0,relaunch:!0,sendReport:!0}),void s.show("main");e&&"Unavailable"==e.cause&&"local"!=e.originator?(i=t.getCallThatHasNotConnectedYet())&&i.isDummy()&&i.set("state","hangup"):(i=t.getRingingCall(),this._maybeRemoveCallWithError(i,e))},_maybeRemoveCallWithError:function(e,t){if(e){console.log("CALL MANAGER: maybe remove call with error:",t||"no error passed -- very strange");var n=t&&"Canceled"===t.cause&&"local"!==t.originator,i=t&&t.reason?t.reason:"No reason passed.",r=t&&"Rejected"===t.cause,s=-1!==i.indexOf("LOSE_RACE")||-1!==i.indexOf("Call completed elsewhere");n?n&&!s?(console.log("CALL MANAGER: received a cancel for call (",e.id,") that did not have a reason indicating it was completed elsewhere (",i,")."),this._refetchCall(e)):(console.log("CALL MANAGER: NOT removing canceled call (",e.id,"): it was picked up elsewhere. (",t.reason,")"),e.setLocalCallStateConnecting()):(!e.isRejected()||r&&e.isSecondary())&&(console.log("CALL MANAGER: removing call (",e.id,") b/c we received a webrtc session error:",t),e.set("state","hangup"))}},_refetchCall:function(e,t){var n=this;if(e.isRinging()){var i=t||0;console.log("CALL MANAGER: refetching call (",e.id,") in",i,"ms");var r=function(){return n._refetchCall(e,i+1e3)};return setTimeout(function(){return e.fetch({merge:!0,success:r})},i)}},_registerOnHangup:function(){if(!h.register){var e=setTimeout(function(){console.log("CALL MANAGER: Register on hangup timeout actually fired. Not the coolest."),t()},2e3),t=_.bind(function(){clearTimeout(e),console.log("Register on Hangup"),this._startWebrtc()},this);this.listenToOnce(h,"disconnected",t),h.stop()}},startFastRing:function(e){"calling"==e.get("state")&&e.get("onnet")&&(console.log("fast call: play some localling"),Backbone.trigger("playSoundOnly","ringing",{loop:!0}))},startRingTone:function(){var e=this._hasIncomingCall();if(e)if(this._useIpc())v.callManager("startRingTone");else try{var n={loop:!0,call_id:e.id};t.hasInternalLeg()?Backbone.trigger("playSoundOnly","call_waiting",n):Backbone.trigger("playSoundOnly","inbound_ringing",n)}catch(e){console.log(e)}else console.log("Ignoring startRingTone because no incoming call")},stopRingTone:function(){this._useIpc()?v.callManager("stopRingTone"):this._pauseRingTone()},_pauseRingTone:function(e){try{Backbone.trigger("pauseSound",e)}catch(e){console.log(e)}},_onHungUpCallUpdate:function(e){this._useIpc()||(this._isShowingNotification(e)&&(console.warn("CALL MANAGER: notification for call (",e.id,") still showing even though it was removed from active calls already!"),s.hide(this._getNotificationWindowName())),this._pauseRingTone({call_id:e.id}))},dtmf:function(e,t){h.onCall()&&(t&&t.addDialpadInput(e),h.dtmf(e),h.mute(),this._soundTimer&&clearTimeout(this._soundTimer),Backbone.trigger("playSound","dtmf-"+this.keyDesc(e),{volume:.3,setSpeakers:!0}),this._soundTimer=_.delay(function(){h.unmute()},800))},keyDesc:function(e){switch(e){case"#":e="pound";break;case"*":e="star"}return e},_onWebRTCFail:function(){"connected"!=h.getCallState()&&(this._preanswerState="ready",h.verifyConnection()||console.log("WebRTC failed...try to reconnect"))},_onWebRTCRegistered:function(){this._preanswerState&&"ready"==this._preanswerState&&(this._preanswerState=null)},_onWebRTCPreloadTimeout:function(e,n){var i=e||{},r=t.get(i.callId);if(r){var s=r.get("contact_key"),o=r.get("target_key");console.warn("CALL MANAGER: Webrtc preload timeout: fetching contact from call (",r.id,",",s,",",o,")");var a=_.bind(function(e){this.showWebRTCPreloadTimeoutAlert(e,r,n)},this);r.setPreloadError(n);var c=y.selectContact(s,o,null,null,a,"force");c&&a(c)}else console.warn("CALL MANAGER: Webrtc preload timeout fired but we could not find the call for:",e)},showWebRTCPreloadTimeoutAlert:function(e,t,n){var i="CALL MANAGER: Showing preload timeout alert.";e&&(i+="Contact: "+e.id+", "+e.get("display_name")+", "+e.getDisplayPhone()),console.error(i),Backbone.trigger("overlay","network_issues",{contact:e,call:t,localMediaFailed:!!n})},_recordWebRtcStats:function(e){var t=e.id;o.sendStatsToServer(t).then(function(){console.log("CALL MANAGER: sent webrtc stats for call:",t)},this).catch(function(e){e&&e.length&&console.warn("CALL MANAGER: failed to send webrtc stats for call:",t)})},_showNotification:function(e,t){var n=e.id||e,i=t||"incoming/"+n;console.log("CALL MANAGER: showing call notification for route:",i),s.navigate("notification",i)},_hideNotification:function(e){console.log("CALL MANAGER: hideNotification called");var n=t.getRingingCall(),i=m.getLocal("route:notification");if("textreply"==i||n){var r="textreply"==i?e:n;console.log("NotificationRoute:",i,"ringingCall",(r||{}).id)}else if("eavesdrop"==i&&e&&e.isEavesdropping())console.log("NotificationRoute:",i,"callState:",e.get("state"));else{var o=!!e&&a.isShowingRecommendation(e)&&e.hasEnded();"recommendation"===i&&t.length&&!o||(this._isShowingNotification(e)&&e&&e.isTranscribingVoicemail()?console.log("NotificationRoute:",i,"callState: voicemail state"):s.hide("notification"))}},_hasIncomingCall:function(){return t.hasIncomingCall()},_listenIpcCallManager:function(){_electron.ipcRenderer.on("call_manager",_.bind(function(e,n,i){var r=t.get(i.id);r||(r=new f(i)),"answer"==n?this.answer(r):"decline"==n?this.decline(r):"eavesdrop"==n?this.eavesdrop(r):"startRingTone"==n?this.startRingTone():"stopRingTone"==n?this.stopRingTone():"cancelEavesdrop"==n&&this.cancelEavesdrop(r)},this))},_getCallCreateOptions:function(e,t){var n={wait:!0};return e&&(n.success=function(t){t.setWarmTransfer(e)}),n},_updateCallDataWithCallerId:function(e,t){if(t)switch(t){case"office":break;case"masking":e.blocked=!0}},_useIpc:function(){return e.isNative&&("notification"==window.name||"mini"==window.name)}});return u.create(S,"callManager")}),function(e){var t={not_string:/[^s]/,number:/[dief]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-fijosuxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[\+\-]/},n=!1,i=!1;function r(e,t){if(e&&e.length){var r,s=e[0];if("string"==typeof s&&/\%[bcdijefosuxX]/.exec(s)){n=!0,i=t;try{r=o(s,Array.prototype.slice.call(e,1))}catch(e){r="[error formatting string]"}return n=!1,i=!1,r}r="";for(var a=0;a<e.length;++a){var c=e[a];r&&(r+=" "),"object"===(void 0===c?"undefined":_typeof(c))?r+=h(c):r+=c}return i?u(r):r}}function s(){var e=arguments[0],t=s.cache;return t[e]&&t.hasOwnProperty(e)||(t[e]=s.parse(e)),s.format.call(null,t[e],arguments)}s.format=function(e,r){var o,c,l,d,f,p,g,m,_,v=1,y=e.length,b="",S=[],C=!0,w="",T=!1;for(c=0;c<y;c++)if(m=!1,"string"===(b=a(e[c])))S[S.length]=e[c];else if("array"===b){if((d=e[c])[2])for(o=r[v],l=0;l<d[2].length;l++){if(!o.hasOwnProperty(d[2][l]))throw new Error(s("[sprintf] property '%s' does not exist",d[2][l]));o=o[d[2][l]]}else o=d[1]?r[d[1]]:r[v++];if("function"==a(o)&&(o=o()),!n){if(t.not_string.test(d[8])&&t.not_json.test(d[8])&&"number"!=a(o)&&isNaN(o))throw new TypeError(s("[sprintf] expecting number but found %s",a(o)));t.number.test(d[8])&&(C=o>=0)}switch(d[8]){case"b":o=o.toString(2);break;case"c":n?(T=m=i,o=i?{style:o}:""):o=String.fromCharCode(o);break;case"d":case"i":o=parseInt(o,10);break;case"j":o=h(o,null,d[6]?parseInt(d[6]):0);break;case"e":o=d[7]?o.toExponential(d[7]):o.toExponential();break;case"f":o=d[7]?parseFloat(o).toFixed(d[7]):parseFloat(o);break;case"o":o=n?h(o):o.toString(8);break;case"s":o=(o=String(o))&&d[7]?o.substring(0,d[7]):o;break;case"u":o>>>=0;break;case"x":o=o.toString(16);break;case"X":o=o.toString(16).toUpperCase()}m||t.json.test(d[8])?S[S.length]=o:(!t.number.test(d[8])||C&&!d[3]?w="":(w=C?"+":"-",o=o.toString().replace(t.sign,"")),p=d[4]?"0"===d[4]?"0":d[4].charAt(1):" ",g=d[6]-(w+o).length,f=d[6]&&g>0?(_=p,new Array(g+1).join(_)):"",S[S.length]=d[5]?w+o+f:"0"===p?w+f+o:f+w+o)}if(T){for(var k=!1,E="",A=0;A<S.length;++A){var x=S[A];"object"===(void 0===x?"undefined":_typeof(x))?(k&&(E+="</span>"),k=!0,E+='<span style="'+x.style+'">'):E+=u(x)}k&&(E+="</span>"),S=E}else S=S.join(""),i&&(S=u(S));return S},s.cache={},s.parse=function(e){for(var n=e,i=[],r=[],s=0;n;){if(null!==(i=t.text.exec(n)))r[r.length]=i[0];else if(null!==(i=t.modulo.exec(n)))r[r.length]="%";else{if(null===(i=t.placeholder.exec(n)))throw new SyntaxError("[sprintf] unexpected placeholder");if(i[2]){s|=1;var o=[],a=i[2],c=[];if(null===(c=t.key.exec(a)))throw new SyntaxError("[sprintf] failed to parse named argument key");for(o[o.length]=c[1];""!==(a=a.substring(c[0].length));)if(null!==(c=t.key_access.exec(a)))o[o.length]=c[1];else{if(null===(c=t.index_access.exec(a)))throw new SyntaxError("[sprintf] failed to parse named argument key");o[o.length]=c[1]}i[2]=o}else s|=2;if(3===s)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");r[r.length]=i}n=n.substring(i[0].length)}return r};var o=function(e,t,n){return(n=(t||[]).slice(0)).splice(0,0,e),s.apply(null,n)};function a(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}var c=/[<>&]/g,l={"<":"&lt;",">":"&gt;","&":"&amp;"};function u(e){return String(e).replace(c,function(e){return l[e]})}function h(t){var n="";if(e.sprintf_deep_stringify)try{n+="[object JSON]: "+JSON.stringify.apply(null,arguments)}catch(e){n+="[deep object stringify failed - showing lite] "+d.apply(null,arguments)}else n+=d.apply(null,arguments);return n}function d(e){var t="";try{for(var n in e=e.cid&&e.attributes||e)if(e.hasOwnProperty(n)){t.length&&(t+=", ");var i=e[n];"string"==typeof i&&(i="'"+i+"'"),t+=n+": "+i}t=!t.length&&e.toString?e.toString()+"{}":"[object lite] {"+(t.length>0?t:"")+"}"}catch(e){t="[object failed to lite-stringify]"}return t}"undefined"!=typeof exports?(exports.sprintf=s,exports.vsprintf=o,exports.consolesprintf=r):(e.sprintf=s,e.vsprintf=o,e.consolesprintf=r,e.sprintf_deep_stringify=!1,"function"==typeof define&&define.amd&&define("fslib/sprintf_console",[],function(){return{sprintf:s,vsprintf:o,consolesprintf:r}}))}("undefined"==typeof window?this:window),define("fslib/js_logger",["backbone","config","fslib/fsutil","fslib/object","fslib/sprintf_console"],function(e,t,n,i,r){var s=s||void 0;return i.extend({MAX_BUFFER_SIZE:5e3,RATE_LIMIT:1e3,LOG_LEVEL:{LOG:1,DEBUG:2,INFO:3,WARN:4,ERROR:5,DISABLED:0},created:(new Date).getTime(),initialize:function(){var n=this;i.prototype.initialize.apply(this,arguments),this.consoles={},this._resetBuffer(),this.setLogEventLevel(this.LOG_LEVEL.DISABLED),this.listenTo(e,"jslog:send",_.throttle(this.sendBuffer,this.RATE_LIMIT)),t.disableJsLogger||(this._mimeType=t.jsLoggerMimeType,window.onerror=function(){n.logUncaughtException.apply(this,arguments)}),s&&(s.onError=function(e){n.logRequireJsErr(e)})},setLogEventLevel:function(e){this.logLevel=e},start:function(e){if(e&&e.name){var n={};this.consoles[e.name]=n,n.log=e.console.log,n.error=e.console.error,n.debug=e.console.debug,n.info=e.console.info,n.warn=e.console.warn,n.trace=e.console.trace;var i=this;return e.console.log=function(){i._log(e,"LOG",arguments),t.disableConsoleLogs||Function.prototype.apply.call(n.log,e.console,arguments)},e.console.error=function(){i._log(e,"ERROR",arguments),Function.prototype.apply.call(n.error,e.console,arguments)},e.console.warn=function(){i._log(e,"WARN",arguments),t.disableConsoleLogs||Function.prototype.apply.call(n.warn,e.console,arguments)},e.console.info=function(){i._log(e,"INFO",arguments),t.disableConsoleLogs||Function.prototype.apply.call(n.info,e.console,arguments)},e.console.debug=function(){i._log(e,"DEBUG",arguments),t.disableConsoleLogs||Function.prototype.apply.call(n.debug,e.console,arguments)},e.console.trace=function(){var r;try{throw new Error("TRACE")}catch(e){r=e.stack}i._log(e,"TRACE",[r]),t.disableConsoleLogs||Function.prototype.apply.call(n.trace,e.console,arguments)},e.console.remote={log:function(){i._log(e,"LOG",arguments),t.showRemoteLogs&&Function.prototype.apply.call(n.log,e.console,arguments)},error:function(){i._log(e,"ERROR",arguments),t.showRemoteLogs&&Function.prototype.apply.call(n.error,e.console,arguments)},warn:function(){i._log(e,"WARN",arguments),t.showRemoteLogs&&Function.prototype.apply.call(n.warn,e.console,arguments)},info:function(){i._log(e,"INFO",arguments),t.showRemoteLogs&&Function.prototype.apply.call(n.info,e.console,arguments)},debug:function(){i._log(e,"DEBUG",arguments),t.showRemoteLogs&&Function.prototype.apply.call(n.debug,e.console,arguments)},trace:function(){var r;try{throw new Error("TRACE")}catch(e){r=e.stack}i._log(e,"TRACE",[r]),t.showRemoteLogs&&Function.prototype.apply.call(n.trace,e.console,arguments)}},this._logVersion(),!0}},stop:function(e){if(e&&e.name&&this.consoles[e.name]){var t=this.consoles[e.name];return e.console.log=t.log,e.console.error=t.error,e.console.debug=t.debug,e.console.info=t.info,e.console.warn=t.warn,e.console.trace=t.trace,e.console.remote=e.console,!0}},_log:function(e,t,n){var i,s=e.name||e.id||"default",o=new Date;try{i=r.consolesprintf(n,"text/html"===this._mimeType)}catch(e){if(i=n[0],_.isObject(i))try{i=JSON.stringify(i)}catch(e){}}if(Date.prototype.toISOString){var a=s+"|"+t+"|"+o.toISOString()+"|";"text/html"===this._mimeType&&(a="<b>"+a+"</b>"),this._buffer.push(a+i)}this._triggerLogEvent(t,i),this._buffer.length>this.MAX_BUFFER_SIZE&&this._buffer.shift()},_triggerLogEvent:function(t,n){if(this.logLevel&&!(this.logLevel>this.LOG_LEVEL[t])){var i;try{throw new Error(t+" EVENT TRACE")}catch(e){i=e.stack}e.trigger("logger:logevent",{ts:Date.now(),logLevel:t,logLine:n,trace:i})}},logUncaughtException:function(e,t,n,i,r){console.error("Uncaught Exception : "+e+". Script:"+t+". Line:"+n+". Column:"+i+". StackTrace:"+r),r&&console.error(r.stack),this.trigger("logger:uncaughtexception")},logRequireJsErr:function(t){console.error("requirejs.error() : "+(t?t.stack:null)),this.logLevel&&this.logLevel<=this.LOG_LEVEL.ERR&&e.trigger("logger:logevent",{ts:Date.now(),logLevel:"ERROR",logLine:t,trace:t?t.stack:null})},sendBuffer:function(e){console.info("logger:LOGS_REQUESTED");try{e=e||{};var t=this._buffer;if(!t||!t.length)return void(e.complete&&setTimeout(e.complete,0));var n={type:"POST",url:this._getUrl(e),processData:!1,contentType:!1,enctype:this.ENC_TYPE,data:this._getPayload(t,e),success:_.bind(function(t){this._resetBuffer(),e.callback&&e.callback(t)},this)};e.error&&(n.error=e.error),e.complete&&(n.complete=e.complete),$.ajax(n)}catch(e){console.error("Exception sending buffer",e)}},_resetBuffer:function(){this._buffer=[],this._logVersion()},_logVersion:function(){},sendBeacon:function(e){if(navigator.sendBeacon){e=e||{};var t=this._buffer;if(t&&t.length){var n=new Blob([this._getPayload(t,e)],{type:this.ENC_TYPE});return navigator.sendBeacon(this._getUrl(e),n)}}},_getUrl:function(e){return t.domain+this.API},_getPayload:function(){},_safeStringify:function(e){if("object"!=(void 0===e?"undefined":_typeof(e)))return""+e;try{return JSON.stringify(e)}catch(e){}return'{"error": "object failed to stringify"}'},sinceCreated:function(e){var t=(new Date).getTime()-this.created;return e?n.formatTime(t):t}})}),define("objects/js_logger",["config","objects/call_manager","fslib/js_logger","fslib/singleton","models/session"],function(e,t,n,i,r){var s=n.extend({API:"/api/applog/",ENC_TYPE:"text/plain",_getUrl:function(n){n.type=n.type||"webrtc";try{n.call=t.getLastCall()}catch(e){console.log("call manager doesn't exist")}return n.device=r.getDeviceId(),"system"===n.context?e.domain+"/api/systemapplog/?"+$.param(n):e.domain+this.API+"?"+$.param(n)},_logVersion:function(){var t="harness",n=0;e.isNative?(t="native",n=e.appVersion):e.isSingle&&!e.isHarness?(t="packaged",n=e.version):e.isWeb?t="web":e.isSalesforce&&(t="salesforce",n=e.version),console.info("Logging for",t.toUpperCase(),"App VERSION:",n),console.info("App last restarted:",this.sinceCreated(!0),"(",this.sinceCreated(),")ms")},_getPayload:function(e){return e.join("\n")}});return i.create(s,"jsLogger")}),define("hbs!templates/common/mic_visualization",["handlebars"],function(e){return e.template(function(e,t,n,i,r){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=r||{};var s,o="",a=this.escapeExpression;return o+='<canvas class="mic-canvas" width="',o+=a(s=(s=n.width)?s.call(t,{hash:{},data:r}):"function"===(void 0===(s=t.width)?"undefined":_typeof(s))?s.apply(t):s)+'" height="',o+=a(s=(s=n.height)?s.call(t,{hash:{},data:r}):"function"===(void 0===(s=t.height)?"undefined":_typeof(s))?s.apply(t):s)+'"></canvas>'})}),define("views/common/mic_visualization_view",["fslib/fsutil","underscore","views/common/view","hbs!templates/common/mic_visualization"],function(e,t,n,i){return n.extend({template:i,TYPES:{BARS:"bars",WAVE:"wave",LINE:"line",DOTS:"dots",DOTBARS:"dotBars"},DEFAULT_COLOR_RGB:"16,136,248",DEFAULT_DOTS_COLOR_RGB:"0,128,255",DEFAULT_BACKGROUND_RGBA:"255,255,255,0",DOTS_PRESETS:{dots:{leftToRight:!0,vertOrientation:"center",minOpacity:.6,maxOpacity:.8},dotBars:{leftToRight:!1,vertOrientation:"bottom",minOpacity:.5,maxOpacity:1}},initialize:function(e){n.prototype.initialize.call(this,e),this._width=this.options.width||200,this._height=this.options.height||40,this._type=this.options.type||"dots",this._numDots=this.options.numDots||26,this._stream=this.options.stream,this._renderInterval=this.options.renderIntervalMs||null,this._onDraw=this.options.onDraw,this.dotColorRgb=this.options.dotColorRgb||this.DEFAULT_DOTS_COLOR_RGB,this.barColorRgb=this.options.barColorRgb||this.DEFAULT_COLOR_RGB,this.waveColorRgb=this.options.waveColorRgb||this.DEFAULT_COLOR_RGB,this.lineColorRgb=this.options.lineColorRgb||this.DEFAULT_COLOR_RGB,this.backgroundColorRgba=this.options.backgroundColorRgba||this.DEFAULT_BACKGROUND_RGBA,this._dotBarGains=this.options.dotBarGains||[]},getTemplateData:function(){return{width:this._width,height:this._height}},render:function(){return n.prototype.render.apply(this,arguments),this._removeStream(),this._visualizeStream(this._stream),this},remove:function(){this._removeStream(),n.prototype.remove.apply(this,arguments)},setStream:function(e){this._stream=e,this.render()},_onStream:function(e){this._stream=e,this._visualizeStream()},_visualizeStream:function(){if(this._stream&&!this._analyser){var e=this._createAudioContext();this._analyser=e.analyser,this._audioCtx=e.audioCtx,this._setupVisualization(),this._draw()}},_createAudioContext:function(){var e=window.webkitAudioContext?new webkitAudioContext:new AudioContext,t=e.createAnalyser();t.minDecibels=-103,t.maxDecibels=-10,t.smoothingTimeConstant=.85;var n=e.createWaveShaper(),i=e.createGain(),r=e.createBiquadFilter(),s=e.createConvolver();return e.createMediaStreamSource(this._stream).connect(t),t.connect(n),n.connect(r),r.connect(s),s.connect(i),i.connect(e.destination),{audioCtx:e,analyser:t}},_setupVisualization:function(){switch(this._type){case this.TYPES.WAVE:this._setupWaveVisualization();break;case this.TYPES.BARS:this._setupBarsVisualization();break;case this.TYPES.LINE:this._setupLineVisualization();break;case this.TYPES.DOTS:case this.TYPES.DOTBARS:default:this._setupDotsVisualization()}this._dataArray=new Uint8Array(this._bufferLength),this._canvasCtx=t.first(this.$(".mic-canvas")).getContext("2d")},_setupWaveVisualization:function(){this._analyser.fftSize=2048,this._bufferLength=this._analyser.fftSize},_setupBarsVisualization:function(){this._analyser.fftSize=512,this._bufferLength=this._analyser.frequencyBinCount},_setupDotsVisualization:function(){this._analyser.fftSize=512,this._bufferLength=this._analyser.frequencyBinCount},_setupLineVisualization:function(){this._analyser.fftSize=1024,this._bufferLength=this._analyser.frequencyBinCount},_clearCanvas:function(){this._canvasCtx&&(this._canvasCtx.clearRect(0,0,this._width,this._height),this._canvasCtx.fillStyle="rgba("+this.backgroundColorRgba+")",this._canvasCtx.fillRect(0,0,this._width,this._height))},_draw:function(){switch(this._renderInterval?this._micInterval=t.delay(this._draw,this._micInterval):this._micAF=requestAnimationFrame(this._draw),this._clearCanvas(),this._type){case this.TYPES.WAVE:this._drawWave();break;case this.TYPES.BARS:this._drawBars();break;case this.TYPES.LINE:this._drawLine();break;case this.TYPES.DOTS:case this.TYPES.DOTBARS:default:this._drawDots(this.dotColorRgb,this._type)}this._onDraw&&this._onDraw(this._canvasCtx)},_drawWave:function(){this._analyser.getByteTimeDomainData(this._dataArray),this._canvasCtx.lineWidth=1,this._canvasCtx.strokeStyle="rgb("+this.waveColorRgb+")",this._canvasCtx.beginPath();for(var e=1*this._width/this._bufferLength,t=0,n=0;n<this._bufferLength;n++){var i=this._dataArray[n]/128*this._height/2;0===n?this._canvasCtx.moveTo(t,i):this._canvasCtx.lineTo(t,i),t+=e}this._canvasCtx.lineTo(this._width,this._height/2),this._canvasCtx.stroke()},_drawBars:function(){this._analyser.getByteFrequencyData(this._dataArray);for(var e,t=this._width/this._bufferLength*2.5,n=0,i=Math.floor(this._bufferLength/1.6),r=0;r<i;r++)e=this._dataArray[r],this._canvasCtx.fillStyle="rgba("+this.barColorRgb+","+(1-(this._height-e/2)/this._height)+")",this._canvasCtx.fillRect(n,this._height-e/2,t,e/2),n+=t+1},_drawLine:function(){this._analyser.getByteFrequencyData(this._dataArray);for(var e=this._bufferLength,t=0,n=0;n<e;n++)t+=this._dataArray[n];var i=t/e;this._canvasCtx.fillStyle="rgb("+this.lineColorRgb+")",this._canvasCtx.fillRect(0,0,4*i,this._height)},_drawDots:function(e,t){var n=this.DOTS_PRESETS[t];this._analyser.getByteFrequencyData(this._dataArray);var i=this._numDots,r=this._width/(2*i);this._canvasCtx.lineWidth=1;for(var s,o,a=Math.floor(this._bufferLength/4),c=0,l=0,u=0,h=Math.floor(a/i),d=0;d<=a;d++)if(s=n.leftToRight?d:a-d,o=this._dataArray[s],d%h&&d!==a-1)c+=o,l++;else{var f=(u<this._dotBarGains.length-1?this._dotBarGains[u-1]:1)||1;u>0&&this._drawRect(r,c*f/l,u,e,n),c=o,l=1,u++}},_drawRect:function(e,t,n,i,r){var s=1.5*t/255;s>1&&(s=1);var o=s*this._height,a=e/2,c=r.minOpacity,l=r.minOpacity,u=o<2*a?c+o/(2*a)*(l-c):l;o<2*a&&(o=2*a);var h,d="rgba("+i+", "+u+")",f=2*(n-1)*e+a;h="center"===r.vertOrientation?(this._height-o)/2:this._height-o,this._drawRoundedRect(f,h,a,e,o,d)},_drawRoundedRect:function(e,t,n,i,r,s){var o=n,a=n,c=n,l=n;this._canvasCtx.strokeStyle=s,this._canvasCtx.fillStyle=s,this._canvasCtx.beginPath(),this._canvasCtx.moveTo(e+o,t),this._canvasCtx.lineTo(e+i-a,t),this._canvasCtx.quadraticCurveTo(e+i,t,e+i,t+a),this._canvasCtx.lineTo(e+i,t+r-c),this._canvasCtx.quadraticCurveTo(e+i,t+r,e+i-c,t+r),this._canvasCtx.lineTo(e+l,t+r),this._canvasCtx.quadraticCurveTo(e,t+r,e,t+r-l),this._canvasCtx.lineTo(e,t+o),this._canvasCtx.quadraticCurveTo(e,t,e+o,t),this._canvasCtx.closePath(),this._canvasCtx.fill()},_removeStream:function(){cancelAnimationFrame(this._micAF),clearTimeout(this._micInterval),this._micAF=null,this._micInterval=null,this._analyser=null,this._audioCtx&&this._audioCtx.close&&this._audioCtx.close(),this._audioCtx=null,this._clearCanvas()}})}),TestCall.prototype={establishConnection:function(){this.traceEvent({state:"start"}),this.pc1.createOffer(this.gotOffer_.bind(this),function(){console.error("createOffer() failed")})},close:function(){this.traceEvent({state:"end"}),this.pc1.close(),this.pc2.close()},setIceCandidateFilter:function(e){this.iceCandidateFilter_=e},constrainVideoBitrate:function(e){this.constrainVideoBitrateKbps_=e},disableVideoFec:function(){this.constrainOfferToRemoveVideoFec_=!0},gatherStats:function(e,t,n){var i=[],r=[];function s(){"closed"!==e.signalingState?"undefined"!=typeof mozRTCPeerConnection&&e instanceof mozRTCPeerConnection?setTimeout(s,n):setTimeout(e.getStats.bind(e,o),n):t(i,r)}function o(e){for(var t in e.result())i.push(e.result()[t]),r.push(Date.now());s()}s()},gotOffer_:function(e){this.constrainOfferToRemoveVideoFec_&&(e.sdp=e.sdp.replace(/(m=video 1 [^\r]+)(116 117)(\r\n)/g,"$1\r\n"),e.sdp=e.sdp.replace(/a=rtpmap:116 red\/90000\r\n/g,""),e.sdp=e.sdp.replace(/a=rtpmap:117 ulpfec\/90000\r\n/g,"")),this.pc1.setLocalDescription(e),this.pc2.setRemoteDescription(e),this.pc2.createAnswer(this.gotAnswer_.bind(this),function(e){console.error("createAnswer() error",e)})},gotAnswer_:function(e){this.constrainVideoBitrateKbps_&&(e.sdp=e.sdp.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+this.constrainVideoBitrateKbps_+"\r\n")),this.pc2.setLocalDescription(e),this.pc1.setRemoteDescription(e)},onIceCandidate_:function(e,t){if(t.candidate){var n=TestCall.parseCandidate(t.candidate.candidate);this.iceCandidateFilter_(n)&&e.addIceCandidate(t.candidate)}}},TestCall.noFilter=function(){return!0},TestCall.isRelay=function(e){return"relay"===e.type},TestCall.isNotHostCandidate=function(e){return"host"!==e.type},TestCall.isIpv6=function(e){return-1!==e.address.indexOf(":")},TestCall.parseCandidate=function(e){var t=e.indexOf("candidate:")+"candidate:".length,n=e.substr(t).split(" ");return{type:n[7],protocol:n[2],address:n[4]}},TestCall.asyncCreateTurnConfig=function(e,t,n){if("string"==typeof e.turnURI&&""!==e.turnURI){var i={iceServers:[{username:e.turnUsername||"",credential:e.turnCredential||"",urls:e.turnURI.split(",")}]};report.traceEventInstant("turn-config",i),setTimeout(t.bind(null,i),0)}},define("testcall",function(e){return function(){return e.TestCall}}(this)),define("views/common/webrtc_harness",["backbone","fslib/fsutil","config","views/common/view","views/common/mic_visualization_view","testcall","fslib/webrtc"],function(e,t,n,i,r,s,o){var a=i.extend({attributes:{id:"system-call",class:"center"},events:{"click .yes":"passedTest","click .no":"showTroubleshooting","click .retry":"retryTest","click .continue":"failedTest","click .play-again":"playRingTone","click .pause-playback":"pauseRingTone","click #test-return-to-product":"maybeCloseWindow"},SOCKET_CONN_TIMEOUT:25,DATA_THROUGHPUT_TIMEOUT:40,ICE_USERNAME:"fstelephony",ICE_PASSWORD:"firespotter1234",TURN_SERVERS:[{server:"turn:turn.ubervoip.net:443?transport=udp"},{server:"turn:turn.ubervoip.net:443?transport=tcp"}],initialize:function(){i.prototype.initialize.apply(this,arguments),window.AudioContext=window.AudioContext||window.webkitAudioContext,this._supportsStreamSource=!!window.AudioContext&&!!window.AudioContext.prototype&&!!window.AudioContext.prototype.createMediaStreamSource,this.tests=[{name:"start",callback:function(){}},{name:"microphone",callback:this.testMicrophone,disabled:!this._supportsStreamSource},{name:"playback",callback:this.testPlayback},{name:"turn",callback:this.testTurnConnection},{name:"datathroughput",callback:this.testDataThroughput,disabled:t.isFirefox()||t.isEdge()},{name:"connecting",callback:this.startWebRTC},{name:"connection",callback:this.testConnection},{name:"done",callback:this.testComplete}],this.disabledTests={},_.each(this.tests,_.bind(function(e){e.disabled&&(this.disabledTests[e.name]=!0)},this)),this.results={microphone:"",playback:"",datathroughput:"",turn:"",connecting:"",connection:""},this.passedTests=!0,this.webRtcParams={user:c,password:n.webRtcTestPw,name:"Test Harness",realms:n.sipRealm,sipUri:"sip:"+c+"@echo.uberconference.com",trace:!0,productName:"Dialpad"},this._micView=new r({type:"dots",stream:this._stream}),this.addChild(this._micView,"#wh-mic-visualization-container"),$.get(this.TURN_API).done(_.bind(function(e){var t=e.data?e.data.turnServers:e;this.webRtcParams.turnServers=this._setTurnServers(t)},this)).fail(function(){console.warn("No TURN servers configured.")}),_rtcParams=this.webRtcParams,"webrtc"===this.options.param?this.testIndex=2:this.testIndex=-1,this.startWizard()},_setTurnServers:function(e){var t=e||[];return t.length||(console.warn("No turn servers returned in webRtcParams, setting to our defaults."),t=this.TURN_SERVERS),t},startWizard:function(){if(!o.initialized)return console.log("WebRTC dependencies not loaded ... trying in 1 second"),void _.delay(this.startWizard,1e3);if(this._webrtcCompatibility||(this._webrtcCompatibility=o.getCompatibility()),this._webrtcCompatibility.webRtcSupported||(this.step="browserNotSupported"),!this.step){if(o.isReady())return void this.nextTest();this.step="initError"}this.render()},getTemplateData:function(){return{step:this.step,results:this.results,micBlocked:this.micBlocked,disabledTests:this.disabledTests,passedTests:this.passedTests,isFirefox:t.isFirefox(),hasStream:!!this._stream}},sendJSLog:function(t){$(".test-results").hide(),$(".test-results-loading").show(),e.trigger("jslog:send",{context:"system",subContext:"test_results",defer:!1,callback:this.onSendJSLogSuccess})},passedTest:function(){if(this.testIndex>=0){var e=this.tests[this.testIndex];this.results[e.name]="passed"}this.nextTest()},showTroubleshooting:function(){var e="#test-"+this.step+" .question";this.$(e).addClass("hide"),this.$("#troubleshooting").removeClass("hide")},retryTest:function(){var e=this.tests[this.testIndex];this.step=e.name,this.render(),e.callback()},failedTest:function(){var e;this.testIndex>=0&&(e=this.tests[this.testIndex],this.results[e.name]="failed",this.passedTests=!1),this.nextTest()},nextTest:function(){"microphone"==this.step&&this.stopStream(this._stream),this.$("#out").empty();var e=this.tests[++this.testIndex];if(e.disabled)return console.info("Skipping "+e.name+" test because this browser doesn't support it."),void this.nextTest();this.step=e.name,this.render(),e.callback()},_onUserMediaError:function(){this.micBlocked=!0,this.log("Failed to access your microphone"),this.render()},testMicrophone:function(){this.micBlocked=!1,this.log("Requesting access to your microphone.  Make sure you hit 'allow' and that you haven't blocked access."),getUserMedia({audio:!0},this._onUserMedia,this._onUserMediaError)},testPlayback:function(){this.$ringTone=$('<audio src="/static/mp3/ringing.mp3" loop/>'),this.$ringTone[0].oncanplaythrough=this.playRingTone},playRingTone:function(){this.$ringTone.length&&(this.$ringTone[0].play(),this.$ringTone[0].oncanplaythrough=null)},pauseRingTone:function(){this.$ringTone&&this.$ringTone.length&&this.$ringTone[0].pause()},startWebRTC:function(){if(!o.isReady())return console.log("JsSIP not loaded...trying in 1 second"),void _.delay(this.startWebRTC,1e3);console.log("Testing WebRTC with params:"),console.log(this.webRtcParams),this.listenTo(o,"connected",this._onSocketConnect),this.listenTo(o,"disconnected",this._onSocketDisconnect),this.listenTo(o,"onCallState",this._onCallState),this.listenTo(o,"callError",this.callError),this.listenTo(o,"callEnded",this.callEnded),this.log("Connecting to server"),o.start(this.webRtcParams),setTimeout(this._onSocketConnectionTimeout,1e3*this.SOCKET_CONN_TIMEOUT)},callError:function(e){var t=e&&e.type?e.type:"unknown",n=this.tests[this.testIndex];this.results[n.name]="failed",console.log("Call Error: "+t)},callEnded:function(e){this.log("Your test call has ended"),this._stopWebrtc()},stopStream:function(e){e&&_.each(e.getTracks(),this._stopTrack)},_stopTrack:function(e){e.stop&&e.stop()},testComplete:function(){this.analyzeResults(),this.sendJSLog(),this._stopWebrtc()},_stopWebrtc:function(){this.stopListening(o),o.stop()},analyzeResults:function(){var e,t,n="",i=0,r=0;for(e in console.log("-------------------------------------"),console.log("--------- Test Results --------------"),console.log("-------------------------------------"),this.results)n="",this.results[e]&&(r++,"failed"===(t=this.results[e])?n="[FAILED "+e+"]: "+this.analyzeTest(e):"passed"===t&&(n="[passed "+e+"]",i++),console.log(n));console.log("Passed "+i+"/"+r+" tests")},analyzeTest:function(e){switch(e){case"microphone":return this.micBlocked?"The browser has blocked the microphone.":"";case"playback":return"The browser is not properly detecting the intended speakers or the user needs to turn up their volume.";case"turn":return"Your network cannot connect to some of our servers.";case"datathroughput":return"This means it will take longer than normal to connect to a call and the audio will be delayed.Try connecting to a faster network and run the test again.";case"connecting":return"We were unable to obtain a public address to communicate with your computer.This can happen in restrictive network scenarios.";case"connection":return"Your audio is not reaching UberConference. You might beexperiencing a connectivity issue or there might be a problem with your microphone and speaker configuration.";default:return""}},testConnection:function(){"failed"!==this.results.connecting||this.failedTest()},maybeCloseWindow:function(e){t.isElectron()&&(e.preventDefault(),window.close())},log:function(e){this.testIndex>=0&&(e="["+this.tests[this.testIndex].name+"] "+e),console.log(e)},_onSocketConnect:function(){this.log("Requesting access to your microphone. Make sure you click 'allow' for access to the mic."),o.call(c)},_onSocketDisconnect:function(){this.log("Connection with server terminated due to webrtc_error_socket.")},_onCallState:function(){"connected"===o.callState&&this.passedTest()},_onSocketConnectionTimeout:function(){"passed"!==this.results.connecting&&(console.log("Could not connect to socket after "+this.SOCKET_CONN_TIMEOUT+" seconds..."),o.stop(),this.showTroubleshooting())},_onUserMedia:function(e){this._stream=e,this._micView.setStream(this._stream),this.render()},testTurnConnection:function(){console.log("Testing turn connection."),this.turnConfig=this._filterTurnConfig(this.webRtcParams.turnServers),this._gatherCandidates(this.turnConfig,null,s.isRelay)},_filterTurnConfig:function(e){var t,n={},i=[];e=e||[];for(var r=0;r<e.length;r++)n={credential:(t=e[r]).password||this.ICE_PASSWORD,username:t.username||this.ICE_USERNAME,urls:[t.server]},i.push(n);return{iceServers:i}},_gatherCandidates:function(e,t,n){console.log("Connecting to TURN servers");var i,r="";try{i=new RTCPeerConnection(e,t)}catch(e){return r="FAILURE: Failed to create peer connection: "+e,console.log(r),this.showTroubleshooting(),r}i.onicecandidate=_.bind(function(e){if("closed"!==i.signalingState)if(e.candidate){var t=s.parseCandidate(e.candidate.candidate);n(t)&&(console.log("SUCCESS: Gathered candidate with type: "+t.type+" address: "+t.address),i.close(),this.passedTest())}else i.close(),console.log("FAILURE: Failed to gather specified candidates",e),this.showTroubleshooting()},this);i.createOffer(function(e){try{i.setLocalDescription(e).then($.noop).catch(this._gatheringCandidatesError)}catch(t){i.setLocalDescription(e,$.noop,this._gatheringCandidatesError)}},this._gatheringCandidatesError,{offerToReceiveAudio:1})},_gatheringCandidatesError:function(e){console.error("GATHERING CANDIDATES ERROR: ",e),this.showTroubleshooting()},testDataThroughput:function(){this.turnConfig&&"failed"!==this.results.turn?this.dataChannelThroughputTest(this.turnConfig):this.failedTest()},dataChannelThroughputTest:function(e){console.log("Testing data throughput.");var t=new s(e);t.setIceCandidateFilter(s.isRelay);for(var n=5,i=null,r=0,o=0,a=!1,c="",l=!1,u=[],h=100,d=0;1024!==d;++d)c+="h";var f,p=100,g=1024*p,m=0,v=t.pc1.createDataChannel(null);function y(e){o+=e.data.length;var n=new Date;if(!l){if(n-f>=1e3){var s=(o-m)/(n-f);s=Math.round(1e3*s*8)/1e3,console.log("SUCCESS: Transmitting at "+s+" kbps."),u.push(s),m=o,f=n}if(a&&r===o){t.close();var c=Math.round(10*(n-i))/1e4,d=8*o/1e3;console.log("SUCCESS: Total transmitted: "+d+" kilo-bits in "+c+" seconds.");for(var p=0,g=0;g<u.length;g++)u[g]<h&&p++;1*p/u.length>=.5?(console.log("50% of the packets received are less than "+h+" kbps"),this.showTroubleshooting()):this.passedTest()}}}v.addEventListener("open",function e(){var t=new Date;i||(i=t,f=t);for(var s=0;s!==p&&!(v.bufferedAmount>=g);++s)r+=c.length,v.send(c);t-i>=1e3*n?a=!0:setTimeout(e,1)}),setTimeout(_.bind(function(){"passed"!==this.results.datathroughput&&(console.log("[data throughput] Could not transmit all sent packets within "+this.DATA_THROUGHPUT_TIMEOUT+" seconds..."),l=!0,this.showTroubleshooting())},this),1e3*this.DATA_THROUGHPUT_TIMEOUT),t.pc2.addEventListener("datachannel",_.bind(function(e){e.channel.addEventListener("message",_.bind(y,this))},this)),t.establishConnection()}}),c="test-harness";return a}),define("hbs!templates/common/webrtc_harness",["handlebars"],function(e){return e.template(function(e,t,n,i,r){this.compilerInfo=[4,">= 1.0.0"],n=this.merge(n,e.helpers),r=r||{};var s,o="",a="function",c=this.escapeExpression,l=this,u=n.blockHelperMissing,h=n.helperMissing;function d(e,t){return"Call Diagnostics"}function f(e,t){var i,r,s,o="";return o+='\n  <div id="install-temasys" class="test">\n    <svg class="'+c((void 0===(i=null==(i=e.startIcon)||!1===i?i:i.class)?"undefined":_typeof(i))===a?i.apply(e):i)+' center"><use xlink:href="#'+c((void 0===(i=null==(i=e.startIcon)||!1===i?i:i.symbol)?"undefined":_typeof(i))===a?i.apply(e):i)+'"/></svg>\n    <div class="description">\n      <div class="header">',s={hash:{},inverse:l.noop,fn:l.program(2,d,t),data:t},r=(r=n.i18n)?r.call(e,s):(void 0===(r=e.i18n)?"undefined":_typeof(r))===a?r.apply(e):r,n.i18n||(r=u.call(e,r,s)),(r||0===r)&&(o+=r),o+="</div>\n      <div>\n        ",s={hash:{safeLink:'<a class="link" id="download-plugin">',safeEndLink:"</a>"},inverse:l.noop,fn:l.program(6,p,t),data:t},((r=(i=n.i18n||e.i18n)?i.call(e,s):h.call(e,"i18n",s))||0===r)&&(o+=r),o+="\n      </div>\n      <br/><br/>\n    </div>\n  </div>\n  "}function p(e,t){return"\n          Audio plugin required for this browser, please download it [safeLink]here[safeEndLink] and restart your browser.\n        "}function g(e,t){var i,r,s,o="";return o+="\n\n    ",s={hash:{},inverse:l.program(17,S,t),fn:l.program(9,m,t),data:t},((r=(i=n.ifEq||e.ifEq)?i.call(e,e.step,"browserNotSupported",s):h.call(e,"ifEq",e.step,"browserNotSupported",s))||0===r)&&(o+=r),o+="\n  "}function m(e,t){var i,r,s,o="";return o+='\n    <div id="browser-not-supported" class="test">\n      <svg class="'+c((void 0===(i=null==(i=e.startIcon)||!1===i?i:i.class)?"undefined":_typeof(i))===a?i.apply(e):i)+' center"><use xlink:href="#'+c((void 0===(i=null==(i=e.startIcon)||!1===i?i:i.symbol)?"undefined":_typeof(i))===a?i.apply(e):i)+'"/></svg>\n      <div class="description">\n        <div class="header">',s={hash:{},inverse:l.noop,fn:l.program(2,d,t),data:t},r=(r=n.i18n)?r.call(e,s):(void 0===(r=e.i18n)?"undefined":_typeof(r))===a?r.apply(e):r,n.i18n||(r=u.call(e,r,s)),(r||0===r)&&(o+=r),o+="</div>\n        <div>\n          ",s={hash:{productName:e.productName},inverse:l.noop,fn:l.program(10,_,t),data:t},((r=(i=n.i18n||e.i18n)?i.call(e,s):h.call(e,"i18n",s))||0===r)&&(o+=r),o+="\n          ",((r=n.if.call(e,e.linkToPlugin,{hash:{},inverse:l.noop,fn:l.program(12,v,t),data:t}))||0===r)&&(o+=r),o+="\n        </div>\n        <div>\n          </br>\n          ",s={hash:{safeLinkGoogle:'<a target="_blank" class="link" href="//www.google.com/chrome">',safeEndLinkGoogle:"</a>",safeLinkFirefox:'<a target="_blank" class="link" href="//www.mozilla.org/firefox">',safeEndLinkFirefox:"</a>"},inverse:l.noop,fn:l.program(15,b,t),data:t},((r=(i=n.i18n||e.i18n)?i.call(e,s):h.call(e,"i18n",s))||0===r)&&(o+=r),o+="\n        </div>\n      </div>\n    </div>\n    "}function _(e,t){return"This browser does not support audio calling with [productName]."}function v(e,t){var i,r,s,o="";return o+="\n            ",s={hash:{safeLink:'<a class="link" id="download-plugin">',safeEndLink:"</a>"},inverse:l.noop,fn:l.program(13,y,t),data:t},((r=(i=n.i18n||e.i18n)?i.call(e,s):h.call(e,"i18n",s))||0===r)&&(o+=r),o+="\n          "}function y(e,t){return"\n              Internet Explorer and Safari are supported using our [safeLink]Audio Plugin[safeEndLink].\n              Restart your browser after installing the plugin.\n            "}function b(e,t){return"\n            Get [safeLinkGoogle]Google Chrome[safeEndLinkGoogle] or [safeLinkFirefox]Firefox[safeEndLinkFirefox].\n          "}function S(e,t){var i,r,s,o="";return o+="\n\n      ",s={hash:{},inverse:l.program(23,k,t),fn:l.program(18,C,t),data:t},((r=(i=n.ifEq||e.ifEq)?i.call(e,e.step,"initError",s):h.call(e,"ifEq",e.step,"initError",s))||0===r)&&(o+=r),o+="\n    "}function C(e,t){var i,r,s,o="";return o+='\n      <br/>\n      <div id="init-error" class="test">\n        <svg class="'+c((void 0===(i=null==(i=e.unsupportedBrowserIcon)||!1===i?i:i.class)?"undefined":_typeof(i))===a?i.apply(e):i)+' center"><use xlink:href="#'+c((void 0===(i=null==(i=e.unsupportedBrowserIcon)||!1===i?i:i.symbol)?"undefined":_typeof(i))===a?i.apply(e):i)+'"/></svg>\n        <div class="description">\n          <div class="header">',s={hash:{},inverse:l.noop,fn:l.program(2,d,t),data:t},r=(r=n.i18n)?r.call(e,s):(void 0===(r=e.i18n)?"undefined":_typeof(r))===a?r.apply(e):r,n.i18n||(r=u.call(e,r,s)),(r||0===r)&&(o+=r),o+="</div>\n          <div>",s={hash:{},inverse:l.noop,fn:l.program(19,w,t),data:t},r=(r=n.i18n)?r.call(e,s):(void 0===(r=e.i18n)?"undefined":_typeof(r))===a?r.apply(e):r,n.i18n||(r=u.call(e,r,s)),(r||0===r)&&(o+=r),o+="</div>\n          <div>\n            </br></br>\n            ",s={hash:{supportUrl:e.supportUrl,safeLink:'<a target="_blank" class="link" href="[supportUrl]">',safeEndLink:"</a>"},inverse:l.noop,fn:l.program(21,T,t),data:t},((r=(i=n.i18n||e.i18n)?i.call(e,s):h.call(e,"i18n",s))||0===r)&&(o+=r),o+="\n          </div>\n        </div>\n      </div>\n      "}function w(e,t){return"We were unable to set up your browser to run the audio test."}function T(e,t){return"\n              Please report this to [safeLink]Customer Service[safeEndLink].\n            "}function k(e,t){var i,r,s,o="";return o+="\n\n        ",s={hash:{},inverse:l.program(29,R,t),fn:l.program(24,E,t),data:t},((r=(i=n.ifEq||e.ifEq)?i.call(e,e.step,"start",s):h.call(e,"ifEq",e.step,"start",s))||0===r)&&(o+=r),o+="\n      "}function E(e,t){var i,r,s,o="";return o+='\n        <div id="test-start" class="test">\n          <svg class="'+c((void 0===(i=null==(i=e.startIcon)||!1===i?i:i.class)?"undefined":_typeof(i))===a?i.apply(e):i)+' center"><use xlink:href="#'+c((void 0===(i=null==(i=e.startIcon)||!1===i?i:i.symbol)?"undefined":_typeof(i))===a?i.apply(e):i)+'"/></svg>\n          <div class="description">\n              <div class="header">',s={hash:{},inverse:l.noop,fn:l.program(2,d,t),data:t},r=(r=n.i18n)?r.call(e,s):(void 0===(r=e.i18n)?"undefined":_typeof(r))===a?r.apply(e):r,n.i18n||(r=u.call(e,r,s)),(r||0===r)&&(o+=r),o+="</div>\n              <div>",s={hash:{productName:e.productName},inverse:l.noop,fn:l.program(25,A,t),data:t},((r=(i=n.i18n||e.i18n)?i.call(e,s):h.call(e,"i18n",s))||0===r)&&(o+=r),o+='</div>\n          </div>\n\n          <div class="yes ',r=(r=n.buttonClass)?r.call(e,{hash:{},data:t}):(void 0===(r=e.buttonClass)?"undefined":_typeof(r))===a?r.apply(e):r,o+=c(r)+'">',s={hash:{},inverse:l.noop,fn:l.program(27,x,t),data:t},r=(r=n.i18n)?r.call(e,s):(void 0===(r=e.i18n)?"undefined":_typeof(r))===a?r.apply(e):r,n.i18n||(r=u.call(e,r,s)),(r||0===r)&&(o+=r),o+="</div>\n        </div>\n        "}function A(e,t){return"Verify whether your device is able to make an [productName] call over the internet."}function x(e,t){return"Begin Test"}function R(e,t){var i,r,s,o="";return o+="\n\n          ",((r=n.unless.call(e,null==(i=e.disabledTests)||!1===i?i:i.microphone,{hash:{},inverse:l.noop,fn:l.program(30,I,t),data:t}))||0===r)&&(o+=r),o+="\n            ",s={hash:{},inverse:l.noop,fn:l.program(33,M,t),data:t},((r=(i=n.ifEq||e.ifEq)?i.call(e,e.step,"microphone",s):h.call(e,"ifEq",e.step,"microphone",s))||0===r)&&(o+=r),o+="\n\n          ",((r=n.unless.call(e,null==(i=e.disabledTests)||!1===i?i:i.playback,{hash:{},inverse:l.noop,fn:l.program(63,Q,t),data:t}))||0===r)&&(o+=r),o+="\n\n            ",s={hash:{},inverse:l.noop,fn:l.program(66,Z,t),data:t},((r=(i=n.ifEq||e.ifEq)?i.call(e,e.step,"playback",s):h.call(e,"ifEq",e.step,"playback",s))||0===r)&&(o+=r),o+="\n\n          ",((r=n.unless.call(e,null==(i=e.disabledTests)||!1===i?i:i.turn,{hash:{},inverse:l.noop,fn:l.program(73,ie,t),data:t}))||0===r)&&(o+=r),o+="\n\n          ",s={hash:{},inverse:l.noop,fn:l.program(76,se,t),data:t},((r=(i=n.ifEq||e.ifEq)?i.call(e,e.step,"turn",s):h.call(e,"ifEq",e.step,"turn",s))||0===r)&&(o+=r),o+="\n\n          ",((r=n.unless.call(e,null==(i=e.disabledTests)||!1===i?i:i.datathroughput,{hash:{},inverse:l.noop,fn:l.program(83,le,t),data:t}))||0===r)&&(o+=r),o+="\n\n          ",s={hash:{},inverse:l.noop,fn:l.program(86,he,t),data:t},((r=(i=n.ifEq||e.ifEq)?i.call(e,e.step,"datathroughput",s):h.call(e,"ifEq",e.step,"datathroughput",s))||0===r)&&(o+=r),o+="\n\n          ",((r=n.unless.call(e,null==(i=e.disabledTests)||!1===i?i:i.connecting,{hash:{},inverse:l.noop,fn:l.program(97,_e,t),data:t}))||0===r)&&(o+=r),o+="\n\n          ",s={hash:{},inverse:l.noop,fn:l.program(100,ye,t),data:t},((r=(i=n.ifEq||e.ifEq)?i.call(e,e.step,"connecting",s):h.call(e,"ifEq",e.step,"connecting",s))||0===r)&&(o+=r),o+="\n\n          ",((r=n.unless.call(e,null==(i=e.disabledTests)||!1===i?i:i.connection,{hash:{},inverse:l.noop,fn:l.program(105,Ce,t),data:t}))||0===r)&&(o+=r),o+="\n\n          ",s={hash:{},inverse:l.noop,fn:l.program(112,Ee,t),data:t},((r=(i=n.ifEq||e.ifEq)?i.call(e,e.step,"connection",s):h.call(e,"ifEq",e.step,"connection",s))||0===r)&&(o+=r),o+="\n\n          ",s={hash:{},inverse:l.noop,fn:l.program(123,Me,t),data:t},((r=(i=n.ifEq||e.ifEq)?i.call(e,e.step,"done",s):h.call(e,"ifEq",e.step,"done",s))||0===r)&&(o+=r),o+="\n        "}function I(e,t){var i,r,s,o="";return o+='\n          <div class="system-test '+c((void 0===(i=null==(i=e.results)||!1===i?i:i.microphone)?"undefined":_typeof(i))===a?i.apply(e):i)+'" id="microphone-test">\n            ',s={hash:{},inverse:l.noop,fn:l.program(31,L,t),data:t},r=(r=n.i18n)?r.call(e,s):(void 0===(r=e.i18n)?"undefined":_typeof(r))===a?r.apply(e):r,n.i18n||(r=u.call(e,r,s)),(r||0===r)&&(o+=r),o+="\n          </div>\n          "}function L(e,t){return"Microphone"}function M(e,t){var i,r,s,o="";return o+='\n            <div id="test-microphone" class="test">\n              ',((i=n.if.call(e,e.hasStream,{hash:{},inverse:l.program(41,F,t),fn:l.program(34,P,t),data:t}))||0===i)&&(o+=i),o+='\n              <div id="troubleshooting" class="hide">\n                <div class="troubleshooting-title">',s={hash:{},inverse:l.noop,fn:l.program(53,G,t),data:t},i=(i=n.i18n)?i.call(e,s):(void 0===(i=e.i18n)?"undefined":_typeof(i))===a?i.apply(e):i,n.i18n||(i=u.call(e,i,s)),(i||0===i)&&(o+=i),o+='</div>\n                <div class="troubleshooting-description">\n                  ',s={hash:{helpCenterUrl:e.helpCenterUrl,article:(i=e.links,null==i||!1===i?i:i.headset),safeLink:'<a target="_blank" class="link"\n                     href="[helpCenterUrl][article]">',safeEndLink:"</a>"},inverse:l.noop,fn:l.program(55,z,t),data:t},((r=(i=n.i18n||e.i18n)?i.call(e,s):h.call(e,"i18n",s))||0===r)&&(o+=r),o+='\n                </div>\n\n                <div class="troubleshooting-support center">\n                  ',s={hash:{},inverse:l.noop,fn:l.program(57,K,t),data:t},r=(r=n.i18n)?r.call(e,s):(void 0===(r=e.i18n)?"undefined":_typeof(r))===a?r.apply(e):r,n.i18n||(r=u.call(e,r,s)),(r||0===r)&&(o+=r),o+='\n                </div>\n                <div class="feedback-buttons">\n                  <div class="continue ',r=(r=n.buttonClass)?r.call(e,{hash:{},data:t}):(void 0===(r=e.buttonClass)?"undefined":_typeof(r))===a?r.apply(e):r,o+=c(r)+'">',s={hash:{},inverse:l.noop,fn:l.program(59,Y,t),data:t},r=(r=n.i18n)?r.call(e,s):(void 0===(r=e.i18n)?"undefined":_typeof(r))===a?r.apply(e):r,n.i18n||(r=u.call(e,r,s)),(r||0===r)&&(o+=r),o+='</div>\n                  <div class="retry">',s={hash:{},inverse:l.noop,fn:l.program(61,J,t),data:t},r=(r=n.i18n)?r.call(e,s):(void 0===(r=e.i18n)?"undefined":_typeof(r))===a?r.apply(e):r,n.i18n||(r=u.call(e,r,s)),(r||0===r)&&(o+=r),o+="</div>\n                </div>\n              </div>\n            </div>\n            "}function P(e,t){var i,r,s="";return s+='\n              <div class="question">\n                ',r={hash:{},inverse:l.noop,fn:l.program(35,O,t),data:t},i=(i=n.i18n)?i.call(e,r):(void 0===(i=e.i18n)?"undefined":_typeof(i))===a?i.apply(e):i,n.i18n||(i=u.call(e,i,r)),(i||0===i)&&(s+=i),s+='\n                <div id="wh-mic-visualization-container"></div>\n                <div class="feedback-buttons">\n                  <div class="yes ',i=(i=n.buttonClass)?i.call(e,{hash:{},data:t}):(void 0===(i=e.buttonClass)?"undefined":_typeof(i))===a?i.apply(e):i,s+=c(i)+' button-green">',r={hash:{},inverse:l.noop,fn:l.program(37,D,t),data:t},i=(i=n.i18n)?i.call(e,r):(void 0===(i=e.i18n)?"undefined":_typeof(i))===a?i.apply(e):i,n.i18n||(i=u.call(e,i,r)),(i||0===i)&&(s+=i),s+='</div>\n                  <div class="no ',i=(i=n.buttonClass)?i.call(e,{hash:{},data:t}):(void 0===(i=e.buttonClass)?"undefined":_typeof(i))===a?i.apply(e):i,s+=c(i)+' button-red">',r={hash:{},inverse:l.noop,fn:l.program(39,N,t),data:t},i=(i=n.i18n)?i.call(e,r):(void 0===(i=e.i18n)?"undefined":_typeof(i))===a?i.apply(e):i,n.i18n||(i=u.call(e,i,r)),(i||0===i)&&(s+=i),s+="</div>\n                </div>\n              </div>\n              "}function O(e,t){return"Speak into your microphone, is the meter below moving?"}function D(e,t){return"Yes"}function N(e,t){return"No"}function F(e,t){var i,r,s,o="";return o+='\n               <div class="question">\n                ',((i=n.if.call(e,e.micBlocked,{hash:{},inverse:l.program(45,q,t),fn:l.program(42,j,t),data:t}))||0===i)&&(o+=i),o+="\n                ",s={hash:{helpCenterUrl:e.helpCenterUrl,article:(i=e.links,null==i||!1===i?i:i.mic),safeLink:'<a target="_blank" class="link"\n                   href="[helpCenterUrl][article]">',safeEndLink:"</a>"},inverse:l.noop,fn:l.program(48,B,t),data:t},((r=(i=n.i18n||e.i18n)?i.call(e,s):h.call(e,"i18n",s))||0===r)&&(o+=r),o+="\n                ",((r=n.if.call(e,e.micBlocked,{hash:{},inverse:l.noop,fn:l.program(50,H,t),data:t}))||0===r)&&(o+=r),o+=".\n              </div>\n              "}function j(e,t){var i,r,s,o="";return o+="\n                  ",s={hash:{productName:e.productName},inverse:l.noop,fn:l.program(43,U,t),data:t},((r=(i=n.i18n||e.i18n)?i.call(e,s):h.call(e,"i18n",s))||0===r)&&(o+=r),o+="\n                "}function U(e,t){return"\n                    Your browser has blocked [productName] from accessing your microphone.\n                  "}function q(e,t){var i,r,s="";return s+="\n                  ",r={hash:{},inverse:l.noop,fn:l.program(46,V,t),data:t},i=(i=n.i18n)?i.call(e,r):(void 0===(i=e.i18n)?"undefined":_typeof(i))===a?i.apply(e):i,n.i18n||(i=u.call(e,i,r)),(i||0===i)&&(s+=i),s+="\n                "}function V(e,t){return"Please enable access to your microphone, once you do so the tests will automatically begin."}function B(e,t){return"\n                  For instructions, visit our [safeLink]help article[safeEndLink]\n                "}function H(e,t){var i,r;return r={hash:{},inverse:l.noop,fn:l.program(51,W,t),data:t},i=(i=n.i18n)?i.call(e,r):(void 0===(i=e.i18n)?"undefined":_typeof(i))===a?i.apply(e):i,n.i18n||(i=u.call(e,i,r)),i||0===i?i:""}function W(e,t){return" and refresh the page"}function G(e,t){return"Microphone not working?"}function z(e,t){return"\n                    Please ensure your computer and browser are properly detecting the intended\n                    microphone and verify the volume is turned up. [safeLink]Learn More[safeEndLink].\n                  "}function K(e,t){return"Please continue with the tests. At the end, you will be able to contact our support team to help you troubleshoot any issues."}function Y(e,t){return"Continue"}function J(e,t){return"Retry Test"}function Q(e,t){var i,r,s,o="";return o+='\n          <div class="system-test '+c((void 0===(i=null==(i=e.results)||!1===i?i:i.playback)?"undefined":_typeof(i))===a?i.apply(e):i)+'">\n            ',s={hash:{},inverse:l.noop,fn:l.program(64,X,t),data:t},r=(r=n.i18n)?r.call(e,s):(void 0===(r=e.i18n)?"undefined":_typeof(r))===a?r.apply(e):r,n.i18n||(r=u.call(e,r,s)),(r||0===r)&&(o+=r),o+="\n          </div>\n          "}function X(e,t){return"Audio Playback"}function Z(e,t){var i,r,s,o="";return o+='\n            <div id="test-playback" class="test">\n              <div class="question">\n                <div>',s={hash:{},inverse:l.noop,fn:l.program(67,ee,t),data:t},i=(i=n.i18n)?i.call(e,s):(void 0===(i=e.i18n)?"undefined":_typeof(i))===a?i.apply(e):i,n.i18n||(i=u.call(e,i,s)),(i||0===i)&&(o+=i),o+='</div>\n                <div class="feedback-buttons">\n                  <div class="yes pause-playback ',i=(i=n.buttonClass)?i.call(e,{hash:{},data:t}):(void 0===(i=e.buttonClass)?"undefined":_typeof(i))===a?i.apply(e):i,o+=c(i)+' button-green">',s={hash:{},inverse:l.noop,fn:l.program(37,D,t),data:t},i=(i=n.i18n)?i.call(e,s):(void 0===(i=e.i18n)?"undefined":_typeof(i))===a?i.apply(e):i,n.i18n||(i=u.call(e,i,s)),(i||0===i)&&(o+=i),o+='</div>\n                  <div class="no pause-playback ',i=(i=n.buttonClass)?i.call(e,{hash:{},data:t}):(void 0===(i=e.buttonClass)?"undefined":_typeof(i))===a?i.apply(e):i,o+=c(i)+' button-red">',s={hash:{},inverse:l.noop,fn:l.program(39,N,t),data:t},i=(i=n.i18n)?i.call(e,s):(void 0===(i=e.i18n)?"undefined":_typeof(i))===a?i.apply(e):i,n.i18n||(i=u.call(e,i,s)),(i||0===i)&&(o+=i),o+='</div>\n                </div>\n              </div>\n              <div id="troubleshooting" class="hide">\n                <div class="troubleshooting-title">',s={hash:{},inverse:l.noop,fn:l.program(69,te,t),data:t},i=(i=n.i18n)?i.call(e,s):(void 0===(i=e.i18n)?"undefined":_typeof(i))===a?i.apply(e):i,n.i18n||(i=u.call(e,i,s)),(i||0===i)&&(o+=i),o+='</div>\n                <div class="troubleshooting-description">\n                  ',s={hash:{helpCenterUrl:e.helpCenterUrl,article:(i=e.links,null==i||!1===i?i:i.headset),safeLink:'<a target="_blank" class="link"\n                   href="[helpCenterUrl][article]">',safeEndLink:"</a>"},inverse:l.noop,fn:l.program(71,ne,t),data:t},((r=(i=n.i18n||e.i18n)?i.call(e,s):h.call(e,"i18n",s))||0===r)&&(o+=r),o+='\n                </div>\n\n                <div class="troubleshooting-support center">\n                  ',s={hash:{},inverse:l.noop,fn:l.program(57,K,t),data:t},r=(r=n.i18n)?r.call(e,s):(void 0===(r=e.i18n)?"undefined":_typeof(r))===a?r.apply(e):r,n.i18n||(r=u.call(e,r,s)),(r||0===r)&&(o+=r),o+='\n                </div>\n\n                <div class="feedback-buttons">\n                  <div class="continue pause-playback ',r=(r=n.buttonClass)?r.call(e,{hash:{},data:t}):(void 0===(r=e.buttonClass)?"undefined":_typeof(r))===a?r.apply(e):r,o+=c(r)+'">',s={hash:{},inverse:l.noop,fn:l.program(59,Y,t),data:t},r=(r=n.i18n)?r.call(e,s):(void 0===(r=e.i18n)?"undefined":_typeof(r))===a?r.apply(e):r,n.i18n||(r=u.call(e,r,s)),(r||0===r)&&(o+=r),o+='</div>\n                  <div class="play-again retry">',s={hash:{},inverse:l.noop,fn:l.program(61,J,t),data:t},r=(r=n.i18n)?r.call(e,s):(void 0===(r=e.i18n)?"undefined":_typeof(r))===a?r.apply(e):r,n.i18n||(r=u.call(e,r,s)),(r||0===r)&&(o+=r),o+="</div>\n                </div>\n              </div>\n            </div>\n            "}function ee(e,t){return"Can you hear audio coming from your speakers?"}function te(e,t){return"Audio not working?"}function ne(e,t){return"\n                    Please ensure your computer and browser are properly detecting the intended speakers\n                  and your computer volume is turned up. [safeLink]Learn more[safeEndLink].\n                  "}function ie(e,t){var i,r,s,o="";return o+='\n          <div class="system-test '+c((void 0===(i=null==(i=e.results)||!1===i?i:i.turn)?"undefined":_typeof(i))===a?i.apply(e):i)+'">\n           ',s={hash:{},inverse:l.noop,fn:l.program(74,re,t),data:t},r=(r=n.i18n)?r.call(e,s):(void 0===(r=e.i18n)?"undefined":_typeof(r))===a?r.apply(e):r,n.i18n||(r=u.call(e,r,s)),(r||0===r)&&(o+=r),o+="\n          </div>\n          "}function re(e,t){return"Network Connectivity"}function se(e,t){var i,r,s,o="";return o+='\n          <div id="test-turn" class="test">\n            <div class="question">\n              ',s={hash:{},inverse:l.noop,fn:l.program(77,oe,t),data:t},i=(i=n.i18n)?i.call(e,s):(void 0===(i=e.i18n)?"undefined":_typeof(i))===a?i.apply(e):i,n.i18n||(i=u.call(e,i,s)),(i||0===i)&&(o+=i),o+='\n              <div class="loading"></div>\n            </div>\n\n            <div id="troubleshooting" class="hide">\n              <div class="troubleshooting-title">',s={hash:{},inverse:l.noop,fn:l.program(79,ae,t),data:t},i=(i=n.i18n)?i.call(e,s):(void 0===(i=e.i18n)?"undefined":_typeof(i))===a?i.apply(e):i,n.i18n||(i=u.call(e,i,s)),(i||0===i)&&(o+=i),o+='</div>\n              <div class="troubleshooting-description">\n                ',s={hash:{helpCenterUrl:e.helpCenterUrl,article:(i=e.links,null==i||!1===i?i:i.network),safeLink:'<a target="_blank" class="link"\n                   href="[helpCenterUrl][article]">',safeEndLink:"</a>"},inverse:l.noop,fn:l.program(81,ce,t),data:t},((r=(i=n.i18n||e.i18n)?i.call(e,s):h.call(e,"i18n",s))||0===r)&&(o+=r),o+='\n              </div>\n              <div class="troubleshooting-support center">\n                ',s={hash:{},inverse:l.noop,fn:l.program(57,K,t),data:t},r=(r=n.i18n)?r.call(e,s):(void 0===(r=e.i18n)?"undefined":_typeof(r))===a?r.apply(e):r,n.i18n||(r=u.call(e,r,s)),(r||0===r)&&(o+=r),o+='\n              </div>\n              <div class="feedback-buttons">\n                <div class="continue ',r=(r=n.buttonClass)?r.call(e,{hash:{},data:t}):(void 0===(r=e.buttonClass)?"undefined":_typeof(r))===a?r.apply(e):r,o+=c(r)+'">',s={hash:{},inverse:l.noop,fn:l.program(59,Y,t),data:t},r=(r=n.i18n)?r.call(e,s):(void 0===(r=e.i18n)?"undefined":_typeof(r))===a?r.apply(e):r,n.i18n||(r=u.call(e,r,s)),(r||0===r)&&(o+=r),o+='</div>\n                <div class="retry">',s={hash:{},inverse:l.noop,fn:l.program(61,J,t),data:t},r=(r=n.i18n)?r.call(e,s):(void 0===(r=e.i18n)?"undefined":_typeof(r))===a?r.apply(e):r,n.i18n||(r=u.call(e,r,s)),(r||0===r)&&(o+=r),o+="</div>\n              </div>\n            </div>\n          </div>\n          "}function oe(e,t){return"Testing your network connection..."}function ae(e,t){return"Network Connectivity Test Failed"}function ce(e,t){return"\n                  This means that your network cannot connect to some of our servers. To resolve this, verify that your network satisfies the\n                  [safeLink]minimum network requirements[safeEndLink].\n                "}function le(e,t){var i,r,s,o="";return o+='\n          <div class="system-test '+c((void 0===(i=null==(i=e.results)||!1===i?i:i.datathroughput)?"undefined":_typeof(i))===a?i.apply(e):i)+'">\n            ',s={hash:{},inverse:l.noop,fn:l.program(84,ue,t),data:t},r=(r=n.i18n)?r.call(e,s):(void 0===(r=e.i18n)?"undefined":_typeof(r))===a?r.apply(e):r,n.i18n||(r=u.call(e,r,s)),(r||0===r)&&(o+=r),o+="\n          </div>\n          "}function ue(e,t){return"Data Transfer"}function he(e,t){var i,r,s="";return s+='\n          <div id="test-datathroughput" class="test">\n            <div class="question">\n              ',r={hash:{},inverse:l.noop,fn:l.program(87,de,t),data:t},i=(i=n.i18n)?i.call(e,r):(void 0===(i=e.i18n)?"undefined":_typeof(i))===a?i.apply(e):i,n.i18n||(i=u.call(e,i,r)),(i||0===i)&&(s+=i),s+='\n              <div class="loading"></div>\n            </div>\n            <div id="troubleshooting" class="hide">\n              <div class="troubleshooting-title">',r={hash:{},inverse:l.noop,fn:l.program(89,fe,t),data:t},i=(i=n.i18n)?i.call(e,r):(void 0===(i=e.i18n)?"undefined":_typeof(i))===a?i.apply(e):i,n.i18n||(i=u.call(e,i,r)),(i||0===i)&&(s+=i),s+='</div>\n              <div class="troubleshooting-description">\n                ',r={hash:{},inverse:l.noop,fn:l.program(91,pe,t),data:t},i=(i=n.i18n)?i.call(e,r):(void 0===(i=e.i18n)?"undefined":_typeof(i))===a?i.apply(e):i,n.i18n||(i=u.call(e,i,r)),(i||0===i)&&(s+=i),s+='\n                <span style="font-weight: bold;">',r={hash:{},inverse:l.noop,fn:l.program(93,ge,t),data:t},i=(i=n.i18n)?i.call(e,r):(void 0===(i=e.i18n)?"undefined":_typeof(i))===a?i.apply(e):i,n.i18n||(i=u.call(e,i,r)),(i||0===i)&&(s+=i),s+="</span>.\n\n                ",r={hash:{},inverse:l.noop,fn:l.program(95,me,t),data:t},i=(i=n.i18n)?i.call(e,r):(void 0===(i=e.i18n)?"undefined":_typeof(i))===a?i.apply(e):i,n.i18n||(i=u.call(e,i,r)),(i||0===i)&&(s+=i),s+='\n              </div>\n              <div class="troubleshooting-support center">\n                ',r={hash:{},inverse:l.noop,fn:l.program(57,K,t),data:t},i=(i=n.i18n)?i.call(e,r):(void 0===(i=e.i18n)?"undefined":_typeof(i))===a?i.apply(e):i,n.i18n||(i=u.call(e,i,r)),(i||0===i)&&(s+=i),s+='\n              </div>\n              <div class="feedback-buttons">\n                <div class="continue ',i=(i=n.buttonClass)?i.call(e,{hash:{},data:t}):(void 0===(i=e.buttonClass)?"undefined":_typeof(i))===a?i.apply(e):i,s+=c(i)+'">',r={hash:{},inverse:l.noop,fn:l.program(59,Y,t),data:t},i=(i=n.i18n)?i.call(e,r):(void 0===(i=e.i18n)?"undefined":_typeof(i))===a?i.apply(e):i,n.i18n||(i=u.call(e,i,r)),(i||0===i)&&(s+=i),s+='</div>\n                <div class="retry">',r={hash:{},inverse:l.noop,fn:l.program(61,J,t),data:t},i=(i=n.i18n)?i.call(e,r):(void 0===(i=e.i18n)?"undefined":_typeof(i))===a?i.apply(e):i,n.i18n||(i=u.call(e,i,r)),(i||0===i)&&(s+=i),s+="</div>\n              </div>\n            </div>\n          </div>\n          "}function de(e,t){return"This may take a few seconds..."}function fe(e,t){return"Data Transfer Results"}function pe(e,t){return"Your network speed and connectivity is"}function ge(e,t){return"poor"}function me(e,t){return"This means it will take longer than normal to connect to a call and the audio will be delayed.\n                Try connecting to a faster network and run the test again."}function _e(e,t){var i,r,s,o="";return o+='\n          <div class="system-test '+c((void 0===(i=null==(i=e.results)||!1===i?i:i.connecting)?"undefined":_typeof(i))===a?i.apply(e):i)+'">\n            ',s={hash:{},inverse:l.noop,fn:l.program(98,ve,t),data:t},r=(r=n.i18n)?r.call(e,s):(void 0===(r=e.i18n)?"undefined":_typeof(r))===a?r.apply(e):r,n.i18n||(r=u.call(e,r,s)),(r||0===r)&&(o+=r),o+="\n          </div>\n          "}function ve(e,t){return"VOIP"}function ye(e,t){var i,r,s,o="";return o+='\n          <div id="test-connecting" class="test">\n            <div class="question">\n              ',s={hash:{},inverse:l.noop,fn:l.program(87,de,t),data:t},i=(i=n.i18n)?i.call(e,s):(void 0===(i=e.i18n)?"undefined":_typeof(i))===a?i.apply(e):i,n.i18n||(i=u.call(e,i,s)),(i||0===i)&&(o+=i),o+='\n              <div class="loading"></div>\n            </div>\n            <div id="troubleshooting" class="hide">\n              <div class="troubleshooting-title">',s={hash:{},inverse:l.noop,fn:l.program(101,be,t),data:t},i=(i=n.i18n)?i.call(e,s):(void 0===(i=e.i18n)?"undefined":_typeof(i))===a?i.apply(e):i,n.i18n||(i=u.call(e,i,s)),(i||0===i)&&(o+=i),o+='</div>\n              <div class="troubleshooting-description">\n                ',s={hash:{helpCenterUrl:e.helpCenterUrl,article:(i=e.links,null==i||!1===i?i:i.network),safeLink:'<a target="_blank" class="link"\n                   href="[helpCenterUrl][article]">',safeEndLink:"</a>"},inverse:l.noop,fn:l.program(103,Se,t),data:t},((r=(i=n.i18n||e.i18n)?i.call(e,s):h.call(e,"i18n",s))||0===r)&&(o+=r),o+='\n              </div>\n              <div class="troubleshooting-support center">\n                ',s={hash:{},inverse:l.noop,fn:l.program(57,K,t),data:t},r=(r=n.i18n)?r.call(e,s):(void 0===(r=e.i18n)?"undefined":_typeof(r))===a?r.apply(e):r,n.i18n||(r=u.call(e,r,s)),(r||0===r)&&(o+=r),o+='\n              </div>\n              <div class="feedback-buttons">\n                <div class="continue ',r=(r=n.buttonClass)?r.call(e,{hash:{},data:t}):(void 0===(r=e.buttonClass)?"undefined":_typeof(r))===a?r.apply(e):r,o+=c(r)+'">',s={hash:{},inverse:l.noop,fn:l.program(59,Y,t),data:t},r=(r=n.i18n)?r.call(e,s):(void 0===(r=e.i18n)?"undefined":_typeof(r))===a?r.apply(e):r,n.i18n||(r=u.call(e,r,s)),(r||0===r)&&(o+=r),o+='</div>\n                <div class="retry">',s={hash:{},inverse:l.noop,fn:l.program(61,J,t),data:t},r=(r=n.i18n)?r.call(e,s):(void 0===(r=e.i18n)?"undefined":_typeof(r))===a?r.apply(e):r,n.i18n||(r=u.call(e,r,s)),(r||0===r)&&(o+=r),o+="</div>\n              </div>\n            </div>\n          </div>\n          "}function be(e,t){return"VOIP Connectivity Test Failed"}function Se(e,t){return"\n                  This means we were unable to obtain a public address to communicate with your computer.\n                  This can happen in restrictive network scenarios. To resolve this try the following steps as outlined in\n                  [safeLink]this article[safeEndLink].\n                "}function Ce(e,t){var i,r,s,o="";return o+='\n          <div class="system-test ',s={hash:{},inverse:l.program(108,Te,t),fn:l.program(106,we,t),data:t},((r=(i=n.ifEq||e.ifEq)?i.call(e,null==(i=e.results)||!1===i?i:i.connection,"failed",s):h.call(e,"ifEq",null==(i=e.results)||!1===i?i:i.connection,"failed",s))||0===r)&&(o+=r),o+='">\n            ',s={hash:{},inverse:l.noop,fn:l.program(110,ke,t),data:t},r=(r=n.i18n)?r.call(e,s):(void 0===(r=e.i18n)?"undefined":_typeof(r))===a?r.apply(e):r,n.i18n||(r=u.call(e,r,s)),(r||0===r)&&(o+=r),o+="\n          </div>\n          "}function we(e,t){return"failed"}function Te(e,t){var n;return c((void 0===(n=null==(n=e.results)||!1===n?n:n.connection)?"undefined":_typeof(n))===a?n.apply(e):n)}function ke(e,t){return"Audio Input"}function Ee(e,t){var i,r,s,o="";return o+='\n          <div id="test-connection" class="test">\n            <div class="question">\n              <div>',s={hash:{},inverse:l.noop,fn:l.program(113,Ae,t),data:t},i=(i=n.i18n)?i.call(e,s):(void 0===(i=e.i18n)?"undefined":_typeof(i))===a?i.apply(e):i,n.i18n||(i=u.call(e,i,s)),(i||0===i)&&(o+=i),o+='</div>\n              <div class="feedback-buttons">\n                <div class="yes ',i=(i=n.buttonClass)?i.call(e,{hash:{},data:t}):(void 0===(i=e.buttonClass)?"undefined":_typeof(i))===a?i.apply(e):i,o+=c(i)+' button-green">',s={hash:{},inverse:l.noop,fn:l.program(37,D,t),data:t},i=(i=n.i18n)?i.call(e,s):(void 0===(i=e.i18n)?"undefined":_typeof(i))===a?i.apply(e):i,n.i18n||(i=u.call(e,i,s)),(i||0===i)&&(o+=i),o+='</div>\n                <div class="no ',i=(i=n.buttonClass)?i.call(e,{hash:{},data:t}):(void 0===(i=e.buttonClass)?"undefined":_typeof(i))===a?i.apply(e):i,o+=c(i)+' button-red">',s={hash:{},inverse:l.noop,fn:l.program(39,N,t),data:t},i=(i=n.i18n)?i.call(e,s):(void 0===(i=e.i18n)?"undefined":_typeof(i))===a?i.apply(e):i,n.i18n||(i=u.call(e,i,s)),(i||0===i)&&(o+=i),o+='</div>\n              </div>\n            </div>\n            <div id="troubleshooting" class="hide">\n              <div class="troubleshooting-title">',s={hash:{},inverse:l.noop,fn:l.program(115,xe,t),data:t},i=(i=n.i18n)?i.call(e,s):(void 0===(i=e.i18n)?"undefined":_typeof(i))===a?i.apply(e):i,n.i18n||(i=u.call(e,i,s)),(i||0===i)&&(o+=i),o+='</div>\n              <div class="troubleshooting-description">\n                ',s={hash:{productName:e.productName},inverse:l.noop,fn:l.program(117,Re,t),data:t},((r=(i=n.i18n||e.i18n)?i.call(e,s):h.call(e,"i18n",s))||0===r)&&(o+=r),o+="\n                ",s={hash:{},inverse:l.noop,fn:l.program(119,Ie,t),data:t},r=(r=n.i18n)?r.call(e,s):(void 0===(r=e.i18n)?"undefined":_typeof(r))===a?r.apply(e):r,n.i18n||(r=u.call(e,r,s)),(r||0===r)&&(o+=r),o+="\n                ",s={hash:{helpCenterUrl:e.helpCenterUrl,article:(i=e.links,null==i||!1===i?i:i.headset),safeLink:'<a target="_blank" class="link"\n                   href="[helpCenterUrl][article]">',safeEndLink:"</a>"},inverse:l.noop,fn:l.program(121,Le,t),data:t},((r=(i=n.i18n||e.i18n)?i.call(e,s):h.call(e,"i18n",s))||0===r)&&(o+=r),o+='\n              </div>\n\n              <div class="troubleshooting-support center">\n                ',s={hash:{},inverse:l.noop,fn:l.program(57,K,t),data:t},r=(r=n.i18n)?r.call(e,s):(void 0===(r=e.i18n)?"undefined":_typeof(r))===a?r.apply(e):r,n.i18n||(r=u.call(e,r,s)),(r||0===r)&&(o+=r),o+='\n              </div>\n\n              <div class="feedback-buttons">\n                <div class="continue pause-playback ',r=(r=n.buttonClass)?r.call(e,{hash:{},data:t}):(void 0===(r=e.buttonClass)?"undefined":_typeof(r))===a?r.apply(e):r,o+=c(r)+'">',s={hash:{},inverse:l.noop,fn:l.program(59,Y,t),data:t},r=(r=n.i18n)?r.call(e,s):(void 0===(r=e.i18n)?"undefined":_typeof(r))===a?r.apply(e):r,n.i18n||(r=u.call(e,r,s)),(r||0===r)&&(o+=r),o+='</div>\n                <div class="retry">',s={hash:{},inverse:l.noop,fn:l.program(61,J,t),data:t},r=(r=n.i18n)?r.call(e,s):(void 0===(r=e.i18n)?"undefined":_typeof(r))===a?r.apply(e):r,n.i18n||(r=u.call(e,r,s)),(r||0===r)&&(o+=r),o+="</div>\n              </div>\n            </div>\n          </div>\n          "}function Ae(e,t){return"Speak into your microphone. Do you hear yourself?"}function xe(e,t){return"Audio Input Results"}function Re(e,t){return"If you can't hear yourself, this means your audio isn't reaching [productName]."}function Ie(e,t){return"\n                  You might be experiencing a connectivity issue or\n                  there might be a problem with your microphone and speaker configuration.\n                "}function Le(e,t){return"[safeLink]Learn More[safeEndLink].\n                "}function Me(e,t){var i,r="";return r+='\n            <div class="test-results">\n              ',((i=n.if.call(e,e.passedTests,{hash:{},inverse:l.program(131,Fe,t),fn:l.program(124,Pe,t),data:t}))||0===i)&&(r+=i),r+='\n            </div>\n            <div class="test-results-loading loading hide" style="margin: 100px auto 100px auto;"></div>\n          '}function Pe(e,t){var i,r,s,o="";return o+='\n              <div class="test-result-icon">\n                <svg class="'+c((void 0===(i=null==(i=e.passingIcon)||!1===i?i:i.class)?"undefined":_typeof(i))===a?i.apply(e):i)+' center"><use xlink:href="#'+c((void 0===(i=null==(i=e.passingIcon)||!1===i?i:i.symbol)?"undefined":_typeof(i))===a?i.apply(e):i)+'"/></svg>\n              </div>\n              <div class="test-complete-header">',s={hash:{},inverse:l.noop,fn:l.program(125,Oe,t),data:t},r=(r=n.i18n)?r.call(e,s):(void 0===(r=e.i18n)?"undefined":_typeof(r))===a?r.apply(e):r,n.i18n||(r=u.call(e,r,s)),(r||0===r)&&(o+=r),o+='</div>\n              <div class="center" style="max-width: 360px;">\n                ',s={hash:{productName:e.productName,safeLink:'<a id="contact-support" class="link" href="#" target="_blank">',safeEndLink:"</a>"},inverse:l.noop,fn:l.program(127,De,t),data:t},((r=(i=n.i18n||e.i18n)?i.call(e,s):h.call(e,"i18n",s))||0===r)&&(o+=r),o+='\n              </div>\n              <div style="margin: 35px auto 10px auto;">\n                <a id="test-return-to-product" class="',r=(r=n.buttonClass)?r.call(e,{hash:{},data:t}):(void 0===(r=e.buttonClass)?"undefined":_typeof(r))===a?r.apply(e):r,o+=c(r)+'" href="/">',s={hash:{productName:e.productName},inverse:l.noop,fn:l.program(129,Ne,t),data:t},((r=(i=n.i18n||e.i18n)?i.call(e,s):h.call(e,"i18n",s))||0===r)&&(o+=r),o+='</a>\n              </div>\n                <a class="link" href="'+c((void 0===(i=null==(i=e.links)||!1===i?i:i.systemTest)?"undefined":_typeof(i))===a?i.apply(e):i)+'">',s={hash:{},inverse:l.noop,fn:l.program(61,J,t),data:t},r=(r=n.i18n)?r.call(e,s):(void 0===(r=e.i18n)?"undefined":_typeof(r))===a?r.apply(e):r,n.i18n||(r=u.call(e,r,s)),(r||0===r)&&(o+=r),o+="</a>\n\n              "}function Oe(e,t){return"Test Complete"}function De(e,t){return"\n                  You can now start or join any [productName] call confidently. Do you still need help from our customer support team?\n                  [safeLink]Contact Support[safeEndLink] and we'll review your test results.\n                "}function Ne(e,t){return"Back to [productName]"}function Fe(e,t){var i,r,s,o="";return o+='\n              <div class="test-result-icon">\n                <svg class="'+c((void 0===(i=null==(i=e.failingIcon)||!1===i?i:i.class)?"undefined":_typeof(i))===a?i.apply(e):i)+' center"><use xlink:href="#'+c((void 0===(i=null==(i=e.failingIcon)||!1===i?i:i.symbol)?"undefined":_typeof(i))===a?i.apply(e):i)+'"/></svg>\n              </div>\n              <div class="test-complete-header">',s={hash:{},inverse:l.noop,fn:l.program(132,je,t),data:t},r=(r=n.i18n)?r.call(e,s):(void 0===(r=e.i18n)?"undefined":_typeof(r))===a?r.apply(e):r,n.i18n||(r=u.call(e,r,s)),(r||0===r)&&(o+=r),o+='</div>\n              <div class="center" style="max-width: 295px;">\n                ',s={hash:{},inverse:l.noop,fn:l.program(134,Ue,t),data:t},r=(r=n.i18n)?r.call(e,s):(void 0===(r=e.i18n)?"undefined":_typeof(r))===a?r.apply(e):r,n.i18n||(r=u.call(e,r,s)),(r||0===r)&&(o+=r),o+='\n              </div>\n              <div class="feedback-buttons" style="margin: 35px auto 10px auto;">\n                <a id="contact-support" class="',r=(r=n.buttonClass)?r.call(e,{hash:{},data:t}):(void 0===(r=e.buttonClass)?"undefined":_typeof(r))===a?r.apply(e):r,o+=c(r)+'" href="#" target="_blank">',s={hash:{},inverse:l.noop,fn:l.program(136,qe,t),data:t},r=(r=n.i18n)?r.call(e,s):(void 0===(r=e.i18n)?"undefined":_typeof(r))===a?r.apply(e):r,n.i18n||(r=u.call(e,r,s)),(r||0===r)&&(o+=r),o+='</a>\n                <a class="',r=(r=n.buttonClass)?r.call(e,{hash:{},data:t}):(void 0===(r=e.buttonClass)?"undefined":_typeof(r))===a?r.apply(e):r,o+=c(r)+'" href="'+c((void 0===(i=null==(i=e.links)||!1===i?i:i.systemTest)?"undefined":_typeof(i))===a?i.apply(e):i)+'">',s={hash:{},inverse:l.noop,fn:l.program(61,J,t),data:t},r=(r=n.i18n)?r.call(e,s):(void 0===(r=e.i18n)?"undefined":_typeof(r))===a?r.apply(e):r,n.i18n||(r=u.call(e,r,s)),(r||0===r)&&(o+=r),o+='</a>\n              </div>\n              <a id="test-return-to-product" class="link" href="/">',s={hash:{productName:e.productName},inverse:l.noop,fn:l.program(129,Ne,t),data:t},((r=(i=n.i18n||e.i18n)?i.call(e,s):h.call(e,"i18n",s))||0===r)&&(o+=r),o+="</a>\n              "}function je(e,t){return"Test Failed"}function Ue(e,t){return"Please contact our support team, we'll review your test results and provide recommendations."}function qe(e,t){return"Contact Support"}return o+='<div id="system-content">\n  ',((s=n.unless.call(t,t.step,{hash:{},inverse:l.program(4,function(e,t){var i,r,s,o="";return o+="\n\n  ",s={hash:{},inverse:l.program(8,g,t),fn:l.program(5,f,t),data:t},((r=(i=n.ifEq||e.ifEq)?i.call(e,e.step,"installPlugin",s):h.call(e,"ifEq",e.step,"installPlugin",s))||0===r)&&(o+=r),o+="\n  "},r),fn:l.program(1,function(e,t){var i,r,s,o="";return o+='\n  <div id="initializing-test" class="test">\n    <svg class="'+c((void 0===(i=null==(i=e.startIcon)||!1===i?i:i.class)?"undefined":_typeof(i))===a?i.apply(e):i)+' center"><use xlink:href="#'+c((void 0===(i=null==(i=e.startIcon)||!1===i?i:i.symbol)?"undefined":_typeof(i))===a?i.apply(e):i)+'"/></svg>\n    <div class="description">\n      <div class="header">',s={hash:{},inverse:l.noop,fn:l.program(2,d,t),data:t},r=(r=n.i18n)?r.call(e,s):(void 0===(r=e.i18n)?"undefined":_typeof(r))===a?r.apply(e):r,n.i18n||(r=u.call(e,r,s)),(r||0===r)&&(o+=r),o+='</div>\n      <div class="loading"></div>\n    </div>\n  </div>\n  '},r),data:r}))||0===s)&&(o+=s),o+="\n</div>\n"})}),define("guest/views/webrtc_harness_view",["jquery","objects/js_logger","fslib/fsutil","fslib/webrtc","views/common/webrtc_harness","models/current_user","hbs!templates/common/webrtc_harness"],function(e,t,n,i,r,s,o){return r.extend({template:o,TURN_API:"/api/turnsettings",events:_.extend({},r.prototype.events),initialize:function(){r.prototype.initialize.call(this),window.name="uv",t.start(window)},getTemplateData:function(){var e=r.prototype.getTemplateData.call(this),t="/articles/210392943-Audio-Settings",n={productName:"Dialpad",links:{mic:t,headset:t,network:"/articles/209954306-Network-Recommendations#system-requirements",systemTest:"/system"},buttonClass:"btn p-btn",supportUrl:s.getSupportUrl(),helpCenterUrl:s.getHelpCenterUrl(),startIcon:{symbol:"system_start",class:"icon-start-test"},unsupportedBrowserIcon:{symbol:"system_unsupported",class:"icon-start-test"},passingIcon:{symbol:"system_success",class:"icon-success icon-end-test"},failingIcon:{symbol:"system_fail",class:"icon-fail icon-end-test"}};return e=_.extend(e,n)},startWizard:function(){if(!i.initialized)return console.log("WebRTC dependencies not loaded ... trying in 1 second"),void _.delay(this.startWizard,1e3);if(this._webrtcCompatibility||(this._webrtcCompatibility=i.getCompatibility()),!n.isChrome()&&!n.isFirefox()&&!n.isEdge())return this.step="browserNotSupported",void this.render();if(this._webrtcCompatibility.allowWebRtcCallOption||(this.step="browserNotSupported"),!this.step){if(i.isReady())return void this.nextTest();this.step="initError"}this.render()},onSendJSLogSuccess:function(e){var t=e&&e.id?e.id:"",n="/contact-support?subject="+encodeURIComponent("[System Test Results ID: "+t+"]");$("#contact-support").attr("href",n),$(".test-results-loading").hide(),$(".test-results").show()}})}),define("guest_router",["backbone","module","config","fslib/base_router","fslib/singleton","views/common/view","guest/views/guest_view","guest/views/request_trial_view","guest/views/waitlist_view","guest/views/roi_calculator","guest/views/international_form_view","guest/views/event_view","guest/views/mktg_form_view","guest/views/webrtc_harness_view"],function(e,t,n,i,r,s,o,a,c,l,u,h,d){return i.extend({type:"guest",routes:{"":"home","request-trial":"requestTrial","roi-calculator":"roiCalculator",waitlist:"waitlist",internationalwaitlist:"internationalWaitlist",event:"event",system:"system","*notFound":"home"},previousRoutes:{},initialize:function(){_.bindAll(this),e.on("navigate",this.onNavigate),this.start()},start:function(){if(!this.started){this.started=!0;_.first(document.location.href.match(/\w+$/));i.prototype.initialize.call(this),this.appView=new o,/MSIE\s/.test(navigator.userAgent)&&parseFloat(navigator.appVersion.split("MSIE")[1])<10?e.history.start({}):e.history.start({pushState:!0}),t.config().route&&this.onNavigate(t.config().route)}},navigateExternal:function(e){window.location.href=e},onNavigate:function(t,n){if(t.match(/^(\/|https?\:)/))this.navigateExternal(t);else{var i=(t=t||"").split("/"),r=_.first(i),s=_.rest(i,1);n=n||{trigger:!0},this.navigate(t,n),e.trigger("navigated",t,r,s)}},home:function(){this.start(),$("#event-form").length?this.event():$("#mktg-main-form-cont").length?this.mktg_form():$("#trial-main-form-cont").length?this.requestTrial():$("#waitlist-main-form-cont").length&&this.waitlist()},requestTrial:function(){this.loadView("guest/views/request_trial_view")},roiCalculator:function(){this.loadView("guest/views/roi_calculator",{values:{}})},waitlist:function(){this.loadView("guest/views/waitlist_view")},internationalWaitlist:function(){this.loadView("guest/views/international_form_view",{country:t.config().country})},event:function(){this.loadView("guest/views/event_view")},mktg_form:function(){this.loadView("guest/views/mktg_form_view")},system:function(){console.log("System Home"),this.loadView("guest/views/webrtc_harness_view")}})});var uv=uv||{};$.fn.digits=function(){return this.each(function(){$(this).text($(this).text().replace(/(\d)(?=(\d\d\d)+(?!\d))/g,"$1,"))})},$.fn.serializeObject=function(){var e={},t=this.serializeArray();return $.each(t,function(){void 0!==e[this.name]?(e[this.name].push||(e[this.name]=[e[this.name]]),e[this.name].push(this.value||"")):e[this.name]=this.value||""}),e},define("guest_main",["jquery"],function(e){return function(){return e.uv}}(this)),define("youtube",["jquery","youtube_api"],function(e,t){var n,i=e("#youtube-video"),r=e("#video-wrapper"),s="uber-video",o="fullwidth",a="SeIXEvXGtJY",c=!1,l=!1,u=!1;function h(){i.fadeOut(250),setTimeout(function(){n.stopVideo()},250)}function d(e){var i={controls:0,showinfo:0};"modal"===o&&(i.controls=1,i.showinfo=1),n=new t.Player(s,{videoId:e,height:"100%",width:"100%",playerVars:{color:"white",controls:i.controls,enablejsapi:1,html5:1,iv_load_policy:3,rel:0,showinfo:i.showinfo,wmode:"opaque"},events:{onReady:g,onStateChange:m}})}function f(t){e("#watch-video, .watch-video").on("click",function(t){t.preventDefault(),e(this).hasClass("vidyard")||p(this.dataset.ytid)}),e("#close-video").on("click",function(e){e.preventDefault(),h()}),e(window).on("keyup",function(e){27===e.keyCode&&h()}),e(window).on("resize",function(){v()})}function p(e,t){o=t||"fullwidth",a=e||a,c?("modal"===o?r.addClass("modal"):r.removeClass("modal"),v(),n.loadVideoById(a),i.fadeIn(250)):l=a}function g(){f(),c=!0,l&&p(l),u&&_()}function m(e){e.data===t.PlayerState.BUFFERING&&v(),e.data===t.PlayerState.ENDED&&h()}function _(){c?(n.playVideo(),i.fadeIn(250)):u=!0}function v(){var t=e(window).height(),n=e(window).width(),i=r.height(),s=r.width();"modal"===o?(i=.5625*s,r.height(i).css("marginTop",(t-i)/2+"px")):n/t<1?r.width(n).height(t):n/t>1.777777?(s=.5625*t,r.width(n).height(t).css("marginTop","-"+(i-t)/2+"px").css("marginLeft",0)):(i=.5625*n,r.width(n).height(t).css("marginLeft","-"+(s-n)/2+"px").css("marginTop",0))}return{initialize:function(n){i.length||(function(){var e=document.createElement("div"),t=document.createElement("div"),n=document.createElement("div"),i=document.createElement("div");e.id="youtube-video",t.id="video-wrapper",n.id="uber-video",i.id="close-video",i.setAttribute("class","close-video"),i.setAttribute("title","Close Video"),t.appendChild(n),e.appendChild(t),e.appendChild(i),document.body.appendChild(e)}(),i=e("#youtube-video"),r=e("#video-wrapper")),void 0===t||void 0===t.Player?window.onYouTubeIframeAPIReady=function(){d(n)}:d(n)},closeVideo:h,loadVideo:p,playVideo:_}}),define("header",["jquery","underscore","youtube"],function(e,t,n){var i=e(".hd"),r=e("body"),s=e(window),o=e(".hamburger"),a=e(".call-sales-dialog"),c=e(".products-nav, .hd-down"),l=e(".hd .drop-box-wrapper"),u=function(){0===s.scrollTop()?h():h("opaque")},h=function(e){"opaque"===e?i.addClass("opaque"):i.removeClass("opaque")},d=function(e){if(e.stopPropagation(),e.preventDefault(),!0===e.handled)return!1;o.toggleClass("is-active"),i.toggleClass("is-open"),r.toggleClass("scroll-lock"),e.handled=!0},f=function(){if(s.width()>980){var t=e(this).parent();t.hasClass("selected")||t.toggleClass("drop-el-hover")}},p=function(t,n){if(!0===t.handled)return!1;n?e(".call-us-drop").addClass("ghost-hide"):(t.stopPropagation(),t.preventDefault(),e(".call-us-drop").toggleClass("ghost-hide")),t.handled=!0},g=function(t){s.width()<980&&(t.stopPropagation(),t.preventDefault(),!0!==t.handled&&e(t.currentTarget).closest(".hd-main-link").toggleClass("show-hd-drop"))};return{initialize:function(){r.hasClass("opaque-header")||(u(),s.on("scroll",t.throttle(function(){u()},25))),o.on("touchend click",function(e){d(e)}),l.hover(f),c.on("touchend click",function(e){e.target===this&&g(e)}),a.on("touchend click",function(e){p(e)}),s.on("touchend click",function(e){p(e,!0)})}}}),define("menu",["jquery"],function(e){return{initialize:function(){e(".ft-group-header").on("touchend click",this.showFooterMenu)},showFooterMenu:function(t){if(t.stopPropagation(),t.preventDefault(),!0===t.handled)return!1;if(e(t.target).closest(".ft-grouping").toggleClass("is-open"),"ftlink-seo"===t.target.id&&e(window).width()<769)if(e(t.target).closest(".ft-grouping").hasClass("is-open")){var n=16;e("#ftlink-seo-content a").each(function(){n+=e(this).height()}),e("#ftlink-seo-content").height(n)}else e("#ftlink-seo-content").height(0);t.handled=!0}}}),define("newsletter_functionality",["jquery","email","form_verify","marketo"],function(e,t,n,i){var r=function(r,a){var c=e("#newsletter-name").val(),l=e("#newsletter-email").val();if(t.isEmail(l)){if(e(".subscribe-newsletter-form input, .subscript-submit").prop("disabled",!0),"undefined"!=typeof MktoForms2){var u={FirstName:c.split(" ")[0],LastName:c.split(" ")[1]?c.split(" ")[1]:"",Email:l};i.submit(1105,u)}else console.log("Marketo Forms not available. Not sending any data"),s();return o(a),!1}n.checkRequired("#subscribe-newsletter-form",!1)},s=function(){e(".subscribe .form-sending").fadeOut(200,function(){e(".subscribe .form-fail").fadeIn(200),setTimeout(function(){e(".form-error, .form-success, .form-fail").fadeOut(200,function(){e("#subscribe-newsletter-form").fadeIn(200)})},5e3)})},o=function(t){e("#subscribe-newsletter-form").removeClass("required-flagged"),e("#subscribe-newsletter-form").fadeOut(200,function(){e(".form-success").fadeIn(200),t&&setTimeout(function(){t()},5e3)})};return{initialize:function(){e("#subscribe-newsletter-form").on("click","#subscribe-submit",function(e){e.preventDefault(),r(this)})}}}),define("uuid",[],function(){var e=Date.now();return{generate:"xxxx4xxxyxxx".replace(/[xy]/g,function(t){var n=(e+16*Math.random())%16|0;return e=Math.floor(e/16),("x"==t?n:3&n|8).toString(16)})}}),define("user_context",["underscore","js-cookie","uuid","constants","config"],function(e,t,n,i,r){var s=i.COOKIE.NAME,o=i.COOKIE.DOMAIN,a=i.WEB_PROPERTIES.DOMAINS,c=i.OAUTH.DOMAINS,l=i.REFERRAL_BLACKLIST.DOMAINS,u=i.THIRD_PARTY.GA.UTM_PARAMS,h=function(){var t=window.location.search.substring(1);if(t){var n=e.chain(t.split("&")).map(function(e){var t=e.split("=");return-1!==t[0].indexOf("utm_")&&-1!==u.indexOf(t[0].split("_")[1])&&[t[0],decodeURIComponent(t[1])]}).object().omit("undefined").value();return!e.isEmpty(n)&&n}},d=function(){var e=document.createElement("a");return e.href=document.referrer,e&&g(e.hostname)?document.referrer:""},f=function(){return d()?document.URL:""},p=function(){var e={};return r.uvid?(e.uv=r.uvid,e.l=1,e.a=r.accountType):"trial"===r.accountType&&(e.l=1,e.a="onboarding"),e},g=function(e){return-1===c.concat(a,l).join(",").indexOf(e)};return{initialize:function(){var i=t.get(s);i=!!i&&JSON.parse(i),a.push(location.hostname);var c={id:i.id||n.generate,u:h()||i.u,r:i.r||d(),e:i.e||f()};r&&e.extend(c,p()),c&&!e.isEqual(i,c)&&t.set(s,JSON.stringify(c),{expires:30,path:"/",domain:o})}}}),function($){$.fn.unveil=function(e,t){var n,i=$(window),r=e||0,s=window.devicePixelRatio>1?"data-src-retina":"data-src",o=this;function a(){var e=o.filter(function(){var e=$(this);if(!e.is(":hidden")){var t=i.scrollTop(),n=t+i.height(),s=e.offset().top;return s+e.height()>=t-r&&s<=n+r}});n=e.trigger("unveil"),o=o.not(n)}return this.one("unveil",function(){var e=this.getAttribute(s);(e=e||this.getAttribute("data-src"))&&(this.setAttribute("src",e),"function"==typeof t&&t.call(this))}),i.on("scroll.unveil resize.unveil lookup.unveil",a),a(),this}}(window.jQuery||window.Zepto),define("unveil",["jquery"],function(){}),window.linkify=function(){var e=new RegExp("(?:\\b[a-z\\d.-]+://[^<>\\s]+|\\b(?:(?:(?:[^\\s!@#$%^&*()_=+[\\]{}\\\\|;:'\",.<>/?]+)\\.)+(?:ac|ad|aero|ae|af|ag|ai|al|am|an|ao|aq|arpa|ar|asia|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|biz|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|cat|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|coop|com|co|cr|cu|cv|cx|cy|cz|de|dj|dk|dm|do|dz|ec|edu|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gov|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|info|int|in|io|iq|ir|is|it|je|jm|jobs|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mil|mk|ml|mm|mn|mobi|mo|mp|mq|mr|ms|mt|museum|mu|mv|mw|mx|my|mz|name|na|nc|net|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|org|pa|pe|pf|pg|ph|pk|pl|pm|pn|pro|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sy|sz|tc|td|tel|tf|tg|th|tj|tk|tl|tm|tn|to|tp|travel|tr|tt|tv|tw|tz|ua|ug|uk|um|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|xn--0zwm56d|xn--11b5bs3a9aj6g|xn--80akhbyknj4f|xn--9t4b11yi5a|xn--deba0ad|xn--g6w251d|xn--hgbk6aj7f53bba|xn--hlcj6aya9esc7a|xn--jxalpdlp|xn--kgbechtv|xn--zckzah|ye|yt|yu|za|zm|zw)|(?:(?:[0-9]|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5])\\.){3}(?:[0-9]|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5]))(?:[;/][^#?<>\\s]*)?(?:\\?[^#<>\\s]*)?(?:#[^<>\\s]*)?(?!\\w)|(?:mailto:)?[a-z0-9!#$%&'*+/=?^_`{|}~-]+(?:\\.[a-z0-9!#$%&'*+/=?^_`{|}~-]+)*@(?:(?:(?:[^\\s!@#$%^&*()_=+[\\]{}\\\\|;:'\",.<>/?]+)\\.)+(?:ac|ad|aero|ae|af|ag|ai|al|am|an|ao|aq|arpa|ar|asia|as|at|au|aw|ax|az|ba|bb|bd|be|bf|bg|bh|biz|bi|bj|bm|bn|bo|br|bs|bt|bv|bw|by|bz|cat|ca|cc|cd|cf|cg|ch|ci|ck|cl|cm|cn|coop|com|co|cr|cu|cv|cx|cy|cz|de|dj|dk|dm|do|dz|ec|edu|ee|eg|er|es|et|eu|fi|fj|fk|fm|fo|fr|ga|gb|gd|ge|gf|gg|gh|gi|gl|gm|gn|gov|gp|gq|gr|gs|gt|gu|gw|gy|hk|hm|hn|hr|ht|hu|id|ie|il|im|info|int|in|io|iq|ir|is|it|je|jm|jobs|jo|jp|ke|kg|kh|ki|km|kn|kp|kr|kw|ky|kz|la|lb|lc|li|lk|lr|ls|lt|lu|lv|ly|ma|mc|md|me|mg|mh|mil|mk|ml|mm|mn|mobi|mo|mp|mq|mr|ms|mt|museum|mu|mv|mw|mx|my|mz|name|na|nc|net|ne|nf|ng|ni|nl|no|np|nr|nu|nz|om|org|pa|pe|pf|pg|ph|pk|pl|pm|pn|pro|pr|ps|pt|pw|py|qa|re|ro|rs|ru|rw|sa|sb|sc|sd|se|sg|sh|si|sj|sk|sl|sm|sn|so|sr|st|su|sv|sy|sz|tc|td|tel|tf|tg|th|tj|tk|tl|tm|tn|to|tp|travel|tr|tt|tv|tw|tz|ua|ug|uk|um|us|uy|uz|va|vc|ve|vg|vi|vn|vu|wf|ws|xn--0zwm56d|xn--11b5bs3a9aj6g|xn--80akhbyknj4f|xn--9t4b11yi5a|xn--deba0ad|xn--g6w251d|xn--hgbk6aj7f53bba|xn--hlcj6aya9esc7a|xn--jxalpdlp|xn--kgbechtv|xn--zckzah|ye|yt|yu|za|zm|zw)|(?:(?:[0-9]|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5])\\.){3}(?:[0-9]|[1-9]\\d|1\\d{2}|2[0-4]\\d|25[0-5]))(?:\\?[^#<>\\s]*)?(?:#[^<>\\s]*)?(?!\\w))","ig"),t=new RegExp("^[a-z\\d.-]+://","i"),n={"'":"`",">":"<",")":"(","]":"[","}":"{","Â»":"Â«","â€º":"â€¹"},i={callback:function(e,t){return t?'<a href="'+t+'" title="'+t+'">'+e+"</a>":e},punct_regexp:/(?:[!?.,:;'"]|(?:&|&amp;)(?:lt|gt|quot|apos|raquo|laquo|rsaquo|lsaquo);)$/};return function(r,s){s=s||{};var o,a,c,l,u,h,d,f,p,g,m,_,v="",y=[];for(a in i)void 0===s[a]&&(s[a]=i[a]);for(;o=e.exec(r);)if(c=o[0],d=(h=e.lastIndex)-c.length,!/[\/:]/.test(r.charAt(d-1))){do{f=c,_=c.substr(-1),(m=n[_])&&(p=c.match(new RegExp("\\"+m+"(?!$)","g")),g=c.match(new RegExp("\\"+_,"g")),(p?p.length:0)<(g?g.length:0)&&(c=c.substr(0,c.length-1),h--)),s.punct_regexp&&(c=c.replace(s.punct_regexp,function(e){return h-=e.length,""}))}while(c.length&&c!==f);l=c,t.test(l)||(l=(-1!==l.indexOf("@")?l.indexOf("mailto:")?"mailto:":"":l.indexOf("irc.")?l.indexOf("ftp.")?"http://":"ftp://":"irc://")+l),u!=d&&(y.push([r.slice(u,d)]),u=h),y.push([c,l])}for(y.push([r.substr(u)]),a=0;a<y.length;a++)v+=s.callback.apply(window,y[a]);return v||r}}(),define("linkify",function(){}),define("handlebars_helpers",["config","fslib/fsutil","fslib/i18n","linkify","handlebars"],function(e,t,n,i,r){i=window.linkify;var s=/^(\s+)|(?:<br>)(\s+)/g,o=/\s/g,a=/\n/g,c=/\S/g,l={translate:function(e){return n.get(e)},urlEncode:function(e){return encodeURIComponent(e)},imageSrc:function(n,i){parseInt(i)&&(n+="=s"+i+"-c");var r=t.getLocalUrl(n);if(r)return e.isApp&&(r.startsWith("http")||r.startsWith("//"))?" data-url="+r+" ":" src="+r+" "},imageUrl:function(e,n){return parseInt(n)&&(e+="=s"+n+"-c"),t.getLocalUrl(e)},localUrl:function(e){return t.getLocalUrl(e)},commaValueJoin:function(e,t){var n=[];if(e)for(var i=0;i<e.length;i++)n.push(e[i][t]);return n.join(", ")},commaJoin:function(e,t){return e.join(", ")},length:function(e,t){return e.length},ifLength:function(e,t,n){return e&&e.length==t?n.fn(this):n.inverse(this)},unlessFirst:function(e){return e.data.index?e.fn(this):e.inverse(this)},ellipsis:function(e,t){return fsutil.ellipsis(e,parseInt(t)||40)},ifAll:function(){for(var e=arguments[arguments.length-1],t=0;t<=arguments.length-2;t++)if(!arguments[t])return e.inverse(this);return e.fn(this)},ifAny:function(){for(var e=arguments[arguments.length-1],t=0;t<=arguments.length-2;t++)if(arguments[t])return e.fn(this);return e.inverse(this)},unlessAny:function(){for(var e=arguments[arguments.length-1],t=0;t<=arguments.length-2;t++)if(arguments[t])return e.inverse(this);return e.fn(this)},ifEquals:function(e,t,n){return e==t?n.fn(this):n.inverse(this)},ifIsAny:function(){for(var e=arguments[arguments.length-1],t=1;t<=arguments.length-2;t++)if(arguments[0]==arguments[t])return e.fn(this);return e.inverse(this)},ifIn:function(e,t,n){return-1!=_.indexOf(t,e)?n.fn(this):n.inverse(this)},ifNotIn:function(e,t,n){return-1==_.indexOf(t,e)?n.fn(this):n.inverse(this)},unlessEquals:function(e,t,n){return e==t?n.inverse(this):n.fn(this)},ifLessThan:function(e,t,n){return e<t?n.fn(this):n.inverse(this)},ifGreaterThan:function(e,t,n){return t<e?n.fn(this):n.inverse(this)},unlessLessThan:function(e,t,n){return e<t?n.inverse(this):n.fn(this)},unlessGreaterThan:function(e,t,n){return t<e?n.inverse(this):n.fn(this)},defaultTo:function(e,t){return e||t},truncate:function(e,t){return e&&e.length>t?e.substring(0,t)+"...":e},ifOdd:function(e,t){return e%2!=0?t.fn(this):t.inverse(this)},ifDef:function(e,t){return null==e||null==e?t.inverse(this):t.fn(this)},boldQuery:function(e,n,i){var s=t.escapeRegExp($.trim(e));if(!s)return new r.SafeString(r.Utils.escapeExpression(n));var o=new RegExp("("+s+")","gi"),a="";return n.split(o).forEach(function(e){var t=r.escapeExpression(e);a+=e.match(o)?'<span class="'+i+'">'+t+"</span>":t}),new r.SafeString(a)},boldQueryInList:function(e,t,n){return new r.SafeString(_.map(t,function(t){return"<span>"+r.helpers.boldQuery.call(this,e,t,n)+"</span>"}).join(", "))},toLowerCase:function(e){return e?e.toLowerCase():""},toUpperCase:function(e){return e?e.toUpperCase():""},titleCase:function(e){return e.substr(0,1).toUpperCase()+e.substr(1)},locationDisplay:function(e){var t="";if(!e)return t;e.city&&(t+=_.map(e.city.split(" "),function(e){if(e.length)return e[0].toUpperCase()+e.substr(1)}).join(" "));return e.region&&(e.city&&(t+=", "),2==e.region.length&&(e.region=e.region.toUpperCase()),t+=e.region),t},secondsToMinutes:function(e){return parseInt(e/60)+" min"},yesNo:function(e){return e?"Yes":"No"},urlize:function(e){var n=r.Utils.escapeExpression(e),s=i(n,{callback:function(e,t){return t?'<a href="'+t+'" title="'+t+'" target=_blank class="link external" rel="noopener noreferrer">'+e+"</a>":e}});return s=t.linkifyPhoneNumbers(s,function(e,t){return'<a class="phone link" data-phone-number="'+t+'">'+e+"</a>"}),new r.SafeString(s)},highlightTranscriptionMoment:function(e,t){for(var n="",i={},s={},o=t.length>1&&1===e.length,a=o?e.length:t.length,c=0;c<a;c++)i[t[c][1]]=t[c],s[t[c][2]]=t[c];for(var l=0;l<e.length;l++){n&&(n+=" ");var u=r.Utils.escapeExpression(e[l][0]),h=i[e[l][1]];if(h)n+='<a class="cr-call-moment snappy" data-moment-id="'+(o?"multiple_moments":h[3])+'" title="'+h[0]+'">';n+=u,s[e[l][2]]&&(n+="</a>")}return new r.SafeString(n)},formatRichMedia:function(e,t){var n,i="",s=0,o=e.rich_media?JSON.parse(JSON.stringify(e.rich_media)):[],a=e.text;l._addHighlightRichMedia(a,o,t);for(var u=0;u<o.length;u++)n=o[u],i+=l._escapeText(e.text.substring(s,n.start||s)),i+=l._getRichMediaHtml(n,u),s=n.end||s;var h=e.text.substring(s);return n&&"vcard"==n.type&&!h.match(c)&&(h=""),i+=l._escapeText(h),new r.SafeString(i)},_addHighlightRichMedia:function(e,n,i){if(i){var r=0;t.highlight(e,i,function(e,t){for(var i=t,s=t+e.length,o=r;o<n.length;o++){r=o;var a=n[o],c=i;if(i<a.start?(c=a.start>s?s:a.start,l._spliceHighlightRichMedia(i,c,e.substring(i-t,c-t),n,r)):i<a.end&&(c=a.end>s?s:a.end,a.rich_media=a.rich_media||[],l._spliceHighlightRichMedia(i-a.start,a.raw.length-(a.end-c),e.substring(i-t,c-t),a.rich_media,r)),(i=c)>=s)break}l._spliceHighlightRichMedia(i,s,e.substring(i-t),n,r+1)})}},_spliceHighlightRichMedia:function(e,t,n,i,r){e>=t||i.splice(r||0,0,{start:e,type:"highlight",end:t,raw:n})},_escapeText:function(e){var t=r.Utils.escapeExpression(e);return t=t.replace(a,"<br>"),t=l.replaceLeadingSpaces(t)},_getRichMediaHtml:function(e,t){switch(e.text=e.raw,e.raw=l.formatRichMedia(e).toString(),e.type){case"link":return this._getAnchor(e.url,e.raw);case"youtube":return this._getYouTubeHtml(e,t);case"vimeo":return this._getVimeoHtml(e,t);case"highlight":return this._getHighlightHtml(e);case"phone":return this._getPhoneHtml(e.number,e.text,e.raw);case"vcard":return this._getVcardHtml(e,t);case"mention":return this._getMentionHtml(e,t);case"hashtag":return this._getHashtagHtml(e,t);default:return e.raw}},_getYouTubeHtml:function(e,t){var n="https://www.youtube.com/embed/"+e.id;return e.time&&(n+="?start="+e.time),this._getEmbedHtml(n,e.raw,t)},_getVimeoHtml:function(e,t){var n="https://player.vimeo.com/video/"+e.id;return this._getEmbedHtml(n,e.raw,t)},_getHighlightHtml:function(e){return'<span class="highlight">'+e.raw+"</span>"},_getVcardHtml:function(e,t){return'<div class="'+(e.type+"-container-"+t)+'"></div>'},_getMentionHtml:function(e,t){return'<a class="link a-mention" title="'+this._escapeText(e.display_name)+'" data-idx="'+t+'">@'+e.username+"</a>"},_getHashtagHtml:function(e,t){return'<a class="link a-hashtag" data-idx="'+t+'">#'+e.hashtag+"</a>"},opt_highlight:function(e,n){var i=r.Utils.escapeExpression(e);return i=l.replaceLeadingSpaces(i),i=t.highlight(i,n),new r.SafeString(i)},replaceLeadingSpaces:function(e){return(e||"").replace(s,function(e){return e.replace(o,"&nbsp;")})},_getAnchor:function(e,t){return'<a href="'+e+'" title="'+e+'" target=_blank class="link external" rel="noopener noreferrer">'+t+"</a>"},_getEmbedHtml:function(t,n,i){var r=e.isApp?"webview":"iframe";return'<div class="embed-iframe-container loading-embed embed-'+r+'"><div class="embed-scroll-shim"></div><svg class="embed-loading-icon"><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#mms_play"></use></svg><div class="embed-frame-container" data-src="'+t+'" data-type="'+r+'" data-idx="'+i+'"></div></div>'},_getPhoneHtml:function(e,t,n){return'<a class="phone link" data-phone-number="'+e+'" title="'+e+'">'+n+"</a>"},stripPlus:function(e){return e.substring(1)},if_eq:function(e,t,n){return e===t?n.fn(this):n.inverse(this)},if_gt:function(e,t,n){return e>t?n.fn(this):n.inverse(this)},if_both:function(e,t,n){return e&&t?n.fn(this):n.inverse(this)},eachkeys:function(e,t){var n=t.fn,i=t.inverse,r="",s=null,o=!0;for(s in e){o=!1;break}if(o)r=i(this);else for(s in e)r+=n({key:s,value:e[s]});return r},loop:function(e,t){for(var n="",i=0;i<e;++i)n+=t.fn(i);return n},loopStartAt1:function(e,t){for(var n="",i=0;i<e;++i)n+=t.fn(i+1);return n},formatNumber:function(e){var t=null;return e&&(11===(e=(e=e.toString()).replace("+","")).length&&(t=e.substr(0,1),e=e.substr(1,11)),"1"===t)?"("+e.substr(0,3)+") "+e.substr(3,3)+"-"+e.substr(6,4):""},firstName:function(e){return fsutil.firstName(e)},firstNameOrPhone:function(e){return fsutil.firstNameOrPhone(e)},firstNameLastInitial:function(e){return fsutil.firstNameLastInitial(e)},abs:function(e){return Math.abs(e)},divide:function(e,t){return e/t},formatPercent:function(e){return fsutil.formatPercent(e)},formatUrl:function(e){return/^https?:\/\//.test(e)?e:"http://"+e},intComma:function(e){return fsutil.numToLocaleString(e)},lineBreaksToBR:function(e){var t=e.fn(this);return t=t.replace(/(?:\r\n|\r|\n)/g,"<br/>")}};return r.registerHelper("translate",l.translate),r.registerHelper("urlEncode",l.urlEncode),r.registerHelper("imageSrc",l.imageSrc),r.registerHelper("imageUrl",l.imageUrl),r.registerHelper("localUrl",l.localUrl),r.registerHelper("commaValueJoin",l.commaValueJoin),r.registerHelper("commaJoin",l.commaJoin),r.registerHelper("length",l.length),r.registerHelper("ifLength",l.ifLength),r.registerHelper("ellipsis",l.ellipsis),r.registerHelper("ifAll",l.ifAll),r.registerHelper("ifAny",l.ifAny),r.registerHelper("unlessAny",l.unlessAny),r.registerHelper("ifEq",l.ifEquals),r.registerHelper("ifIsAny",l.ifIsAny),r.registerHelper("ifIn",l.ifIn),r.registerHelper("ifNotIn",l.ifNotIn),r.registerHelper("unlessEq",l.unlessEquals),r.registerHelper("ifLt",l.ifLessThan),r.registerHelper("ifGt",l.ifGreaterThan),r.registerHelper("unlessLt",l.unlessLessThan),r.registerHelper("unlessGt",l.unlessGreaterThan),r.registerHelper("default",l.defaultTo),r.registerHelper("truncate",l.truncate),r.registerHelper("ifOdd",l.ifOdd),r.registerHelper("ifDef",l.ifDef),r.registerHelper("boldQuery",l.boldQuery),r.registerHelper("boldQueryInList",l.boldQueryInList),r.registerHelper("toLowerCase",l.toLowerCase),r.registerHelper("toUpperCase",l.toUpperCase),r.registerHelper("titleCase",l.titleCase),r.registerHelper("locationDisplay",l.locationDisplay),r.registerHelper("secondsToMinutes",l.secondsToMinutes),r.registerHelper("yesNo",l.yesNo),r.registerHelper("urlize",l.urlize),r.registerHelper("urlize_embed_with_opt_highlight",l.urlize_embed_with_opt_highlight),r.registerHelper("highlightTranscriptionMoment",l.highlightTranscriptionMoment),r.registerHelper("formatRichMedia",l.formatRichMedia),r.registerHelper("opt_highlight",l.opt_highlight),r.registerHelper("stripPlus",l.stripPlus),r.registerHelper("if_eq",l.if_eq),r.registerHelper("if_gt",l.if_gt),r.registerHelper("if_both",l.if_both),r.registerHelper("eachkeys",l.eachkeys),r.registerHelper("loop",l.loop),r.registerHelper("loopStartAt1",l.loopStartAt1),r.registerHelper("formatNumber",l.formatNumber),r.registerHelper("firstName",l.firstName),r.registerHelper("firstNameOrPhone",l.firstNameOrPhone),r.registerHelper("firstNameLastInitial",l.firstNameLastInitial),r.registerHelper("abs",l.abs),r.registerHelper("divide",l.divide),r.registerHelper("formatPercent",l.formatPercent),r.registerHelper("formatUrl",l.formatUrl),r.registerHelper("intComma",l.intComma),r.registerHelper("hadEmbed",l.hasEmbed),r.registerHelper("lineBreaksToBR",l.lineBreaksToBR),r.registerHelper("unlessFirst",l.unlessFirst),l}),require.config({baseUrl:"/static/js",waitSeconds:20,paths:{backbone:"lib/backbone-1.0.0",handlebars:"lib/handlebars-1.0.0",jquery:"lib/jquery-1.8.3",underscore:"lib/underscore",build_vars:"guest/build_vars",config:"guest/config",constants:"guest/constants",guest_router:"guest/router",guest_main:"guest/guest",bubble_block:"compressed/bubble_block",clock:"compressed/guest_clock",carousel:"compressed/carousel",chat:"compressed/olark",email:"compressed/email",eq_height:"compressed/eq_height",form:"compressed/form",form_verify:"compressed/form_verify",full_height_module:"compressed/full_height_module",header:"compressed/header",iframe:"compressed/iframe",inview:"compressed/in_view",logo_marquee:"compressed/logo_marquee",menu:"compressed/menu",mutation_observer:"compressed/mutation_observer",newsletter_functionality:"compressed/newsletter_functionality",newsletter:"compressed/newsletter",numbers_helpers:"compressed/numbers_helpers",pagination:"compressed/pagination",path:"compressed/path",phone:"compressed/phone",secondary_nav:"compressed/secondary_nav",tabs:"compressed/tabs",throttle:"compressed/throttle",user_cookie:"compressed/user_cookie",uuid:"compressed/uuid",youtube:"compressed/youtube",guest_about:"compressed/about",guest_birthday:"compressed/birthday",guest_customer_detail:"compressed/customer_detail",guest_download:"compressed/download",guest_features:"compressed/features",guest_free:"compressed/free",guest_googleapps:"compressed/google_apps",guest_home:"compressed/home",guest_industry:"compressed/industry",guest_international:"compressed/international",guest_landing:"compressed/dialpad_landing",guest_legal:"compressed/legal",guest_login:"compressed/login",guest_mktg:"compressed/mktg_landing",guest_mktg_ks:"compressed/mktg_landing_kitchensink",guest_news:"compressed/news",guest_notify:"compressed/notify_me",guest_pricing:"compressed/pricing",guest_product_pages:"compressed/product_pages",guest_resources:"compressed/resources",guest_signup:"compressed/signup",guest_ucgapps:"compressed/uc_gapps",guest_update:"compressed/update",guest_weebly:"compressed/weebly",hbs:"lib/requirejs/hbs-1.0.0",hbs_partial:"lib/requirejs/hbs_partial-1.0.0",text:"lib/requirejs/text",cookie:"lib/jquery.cookie",facebook:"compressed/facebook",handlebars_helpers:"fslib/handlebars_helpers/common",iframe_resizer:"lib/iframe_resizer",isotope:"lib/isotope.pkgd.min","js-cookie":"lib/js.cookie",linkify:"lib/linkify",moment:"lib/moment",olark:"compressed/olark",scriptjs:"lib/script",sprintf_console:"fslib/sprintf_console",unveil:"lib/jquery.unveil",user_context:"compressed/user_context",jobscore:"//www.jobscore.com/jobs/switchco/widget",slick:"//cdn.jsdelivr.net/jquery.slick/1.6.0/slick.min",twitter:"https://platform.twitter.com/widgets",youtube_api:"https://www.youtube.com/player_api?noext",Vue:"empty:",vuex:"empty:",mixpanel:"compressed/mixpanel","mixpanel-dev":"mixpanel/mixpanel_dev",marketo:"compressed/marketo",testcall:"lib/webrtc_test_call",jssip:"lib/jssip"},shim:{backbone:{deps:["underscore","jquery"],exports:"Backbone"},handlebars:{exports:"Handlebars"},underscore:{exports:"_"},bubble_block:{deps:["jquery"],exports:"BubbleBlock"},facebook:{exports:"Facebook"},marketo:{deps:["underscore","js-cookie","scriptjs"],exports:"Mkto"},menu:{deps:["jquery"],exports:"Menu"},newsletter_functionality:{deps:["jquery"],exports:"NewsletterFunctionality"},newsletter:{deps:["jquery","newsletter_functionality"],exports:"Newsletter"},path:{exports:"Path"},tabs:{exports:"Tabs"},unveil:{deps:["jquery"]},secondary_nav:{deps:["jquery"],exports:"SecondaryNav"},throttle:{deps:["jquery"],exports:"Throttle"},user_context:{deps:["underscore","js-cookie"]},youtube:{deps:["underscore","youtube_api"],exports:"Youtube"},slick:{deps:["jquery"]},youtube_api:{exports:"YT"},guest_main:{deps:["jquery"],exports:"uv"},guest_router:{deps:["marketo"]},guest_about:{deps:["jquery","underscore","jobscore","slick","youtube"],exports:"About"},guest_birthday:{deps:["jquery","underscore","slick","facebook","twitter"],exports:"Birthday"},guest_download:{deps:["jquery","iframe"]},guest_features:{deps:["jquery","youtube"],exports:"Features"},guest_free:{deps:["jquery","youtube"],exports:"Free"},guest_enterprise_mktg:{deps:["jquery","youtube"],exports:"EnterpriseMktg"},guest_googleapps:{deps:["jquery","underscore"],exports:"Googleapps"},guest_home:{deps:["jquery","underscore","newsletter","slick"],exports:"Home"},guest_industry:{deps:["jquery","slick"],exports:"Industry"},guest_international:{deps:["jquery","inview"],exports:"International"},guest_mktg:{deps:["jquery"],exports:"MktgLanding"},guest_landing:{deps:["jquery","youtube","iframe"],exports:"Landing"},guest_legal:{deps:["jquery"],exports:"Legal"},guest_news:{deps:["jquery","moment"],exports:"News"},guest_notify:{deps:["jquery"],exports:"Notify"},guest_pricing:{deps:["jquery"],exports:"Pricing"},guest_product_pages:{deps:["jquery","slick"],exports:"ProductPages"},guest_signup:{deps:["jquery","email","facebook","twitter"],exports:"Signup"},guest_smb_mktg:{deps:["jquery","youtube"],exports:"SMBMktg"},guest_ucgapps:{deps:["jquery","email"],exports:"Ucgapps"},guest_weebly:{deps:["jquery","youtube"],exports:"Weebly"},testcall:{exports:"TestCall"},jssip:{exports:"JsSIP"}}}),require(["jquery","underscore","backbone","guest_router","guest_main","config","header","menu","newsletter_functionality","user_context","youtube","unveil","handlebars_helpers"],function($,e,t,n,i,r,s,o,a,c,l,u){this.router=new n,s.initialize(),o.initialize(),a.initialize(),c.initialize(),l.initialize();var h=$("img");h.length&&$(window).on("load",function(){h.unveil(300,function(){$(this).load(function(){this.style.opacity=1})})})}),define("guest/main_prod",function(){});